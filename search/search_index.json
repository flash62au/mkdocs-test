{"config":{"lang":["en"],"separator":"[,;\\$\\|\\-\\.\\s\\[\\]\\(\\)\\{\\}\"]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Home","text":""},{"location":"#home","title":"Home","text":""},{"location":"#welcome-to-dcc-ex","title":"Welcome to DCC-EX","text":"<p>Our Command Station is highly regarded as one of the best you can get and has many unique features that are specifically designed to bring control and fun to your hobby.</p> <ul> <li>Wi-fi access, with DCC-EX unique features, Engine Driver on Android, ThrottleCard on iOS and a wide variety of other Apps. We can even show you how to build your own throttle.</li> <li>The ability to run DCC and DC trains from the same throttle at the same time.</li> <li>The powerful but easy EXRAIL scripting language to configure and control accessories such as turnouts, signals, lights, and sounds. It can also run trains automatically and animate your layout!</li> <li>Integration with JMRI, iTrain, and RocRail if you prefer to run trains from your computer.</li> </ul> <p> The EX-CommandStation Booster 1 Express, otherwise known as a CSB1, can be purchased ready to run, complete with WiFi and power supply. If you have a phone, you could be running your trains in less than 5 minutes, without a computer. If you would like to buy one, check out our sellers If you want to get started with a CSB1 read the product page</p> <p> Or you can enjoy building your own, staggeringly cheap, version from readily-available Arduino parts in use by modellers from all over the world. We have even designed parts to make this easy for beginners, no soldering required.  Of course, we also have a wealth of information for more adventurous builders if you have the appropriate electronics skills.</p> <p>Both systems use the same powerful EX-CommandStation software which is totally free and easy to configure and install using our installation tool.</p> <p>We also have a a continually evolving range of additional products to enhance your entire layout including an integrated fast clock, integrated turntable controller, and I/O expansion.</p>"},{"location":"#who-is-dcc-ex","title":"Who is DCC-EX","text":"<p>DCC-EX is world-wide team of dedicated enthusiasts producing free and open source DCC and DC software and hardware solutions to run your model trains and layout. Our mission is to use our many decades of software and hardware experience to make model trains accessible and affordable to everyone.</p> <p>You can learn more on our About Us page.</p> <p>This website contains a vast amount of information, ranging from how to run your first train to how to automate a large exhibition layout.</p> <p>The navigation buttons above should help you find what you want and the search facility is extremely powerful.</p> <p>This site does not use Third Party Cookies.</p> <p>There is a light/dark mode button beside the search bar.</p>"},{"location":"about/about/","title":"About the DCC-EX Project","text":"<p>Who is behind all this? And will they ever face justice? Who knows, but the following is a list of those names associated with taking over Gregg Berman\u2019s original DCC++ BaseStation Project, and rewriting/expanding it into EX\u2011CommandStation and the wider DCC-EX project.</p> <p>First, a special thanks to Gregg E. Berman, who had the original idea for a model railroad Command Station using an Arduino Uno and a Motor Driver.</p> <p>If you wish to get in touch with the team, try our Discord server as the first preference, and you can also find some of the team on the DCC++ Forum on TrainBoard.</p>"},{"location":"about/about/#a-brief-history-of-dcc-ex","title":"A Brief History of DCC-EX","text":"<p>TODO</p>"},{"location":"about/about/#the-dcc-ex-team","title":"The DCC-EX Team","text":"<p>The DCC-EX team is a worldwide group of enthusiasts who volunteer their time to produce the DCC-EX project, making model trains accessible and affordable for everyone.</p> <p>Names below in parentheses are screen names on TrainBoard and Discord.</p>"},{"location":"about/about/#project-lead","title":"Project Lead","text":"<ul> <li>Fred Decker - Holly Springs, North Carolina, USA (FlightRisk)</li> </ul>"},{"location":"about/about/#ex-commandstation","title":"EX-CommandStation","text":"<ul> <li> <p>Lead Developer</p> <ul> <li>Chris Harlow - Nottingham, UK (UKBloke)</li> </ul> </li> <li> <p>Developers</p> <ul> <li>Harald Barth - Stockholm, Sweden (Haba)</li> <li>Fred Decker - Holly Springs, North Carolina, USA (FlightRisk)</li> <li>Herb Morton - Kingwood, Texas, USA (Ash++)</li> <li>Paul Antoine - Western Australia (Paul Antoine)</li> </ul> </li> </ul>"},{"location":"about/about/#ex-installer","title":"EX-Installer","text":"<ul> <li> <p>Developers</p> <ul> <li>Peter Cole - Brisbane, QLD, Australia (peteGSX)</li> <li>Paul Antoine - Western Australia (Paul Antoine)</li> </ul> </li> </ul>"},{"location":"about/about/#ex-webthrottle","title":"EX-WebThrottle","text":"<ul> <li> <p>Developers</p> <ul> <li>Fred Decker - Holly Springs, North Carolina, USA (FlightRisk)</li> </ul> </li> </ul>"},{"location":"about/about/#ex-dccinspector","title":"EX-DCCInspector","text":"<ul> <li> <p>Developers</p> <ul> <li>Fred Decker - Holly Springs, NC, USA (FlightRisk)</li> </ul> </li> </ul>"},{"location":"about/about/#ex-toolbox","title":"EX-Toolbox","text":"<ul> <li> <p>Developers</p> <ul> <li>Looking for volunteers!</li> </ul> </li> </ul>"},{"location":"about/about/#ex-ioexpander","title":"EX-IOExpander","text":"<ul> <li> <p>Developers</p> <ul> <li>Peter Cole - Brisbane, QLD, Australia (peteGSX)</li> </ul> </li> </ul>"},{"location":"about/about/#ex-turntable","title":"EX-Turntable","text":"<ul> <li> <p>Developers</p> <ul> <li>Peter Cole - Brisbane, QLD, Australia (peteGSX)</li> </ul> </li> </ul>"},{"location":"about/about/#ex-fastclock","title":"EX-FastClock","text":"<ul> <li> <p>Developers</p> <ul> <li>Colin Murdoch - Pontypool, Wales (ColinM)</li> </ul> </li> </ul>"},{"location":"about/about/#ex-sensorcam","title":"EX-SensorCam","text":"<ul> <li> <p>Developers</p> <ul> <li>Barry Daniel- Gold Coast, Australia (BarryD)</li> </ul> </li> </ul>"},{"location":"about/about/#dccexprotocol","title":"DCCEXProtocol","text":"<ul> <li> <p>Developers</p> <ul> <li>Peter Cole - Brisbane, QLD, Australia (peteGSX)</li> <li>Chris Harlow - Nottingham, UK (UKBloke)</li> </ul> </li> </ul>"},{"location":"about/about/#dcc-classic","title":"DCC++ Classic","text":"<ul> <li> <p>Developers (no longer in active development)</p> <ul> <li>Mike Dunston - Sonora, California, USA (Atani)</li> <li>Fred Decker - Holly Springs, North Carolina, USA (FlightRisk)</li> </ul> </li> </ul>"},{"location":"about/about/#website-and-documentation","title":"Website and Documentation","text":"<ul> <li> <p>Developers</p> <ul> <li>Peter Cole - Brisbane, QLD, Australia (peteGSX)</li> <li>Fred Decker - Holly Springs, North Carolina, USA (FlightRisk)</li> </ul> </li> <li> <p>Contributors</p> <ul> <li>The whole team plus friends!</li> </ul> </li> </ul>"},{"location":"about/about/#hardware-electronics","title":"Hardware / Electronics","text":"<ul> <li> <p>Lead Developer</p> <ul> <li>Paul Antoine - Western Australia (Paul Antoine)</li> </ul> </li> <li> <p>Developers</p> <ul> <li>Harald Barth - Stockholm, Sweden (Haba)</li> <li>Erwin Peterlin - Graz, Austria (caperp)</li> <li>Fred Decker - Holly Springs, NC, USA (FlightRisk)</li> <li>Herb Morton - Kingwood Texas, USA (Ash++)</li> <li>Keith Trayler</li> </ul> </li> </ul>"},{"location":"about/about/#testing-research-support","title":"Testing / Research / Support","text":"<ul> <li>Kevin Smith - Rochester Hills, Michigan, USA (KC Smith)</li> <li>Sumner Patterson - Blanding Utah, USA (Sumner)</li> <li>Herb Morton - Kingwood Texas, USA (Ash++)</li> <li>Travis Farmer - Farmington Maine, USA (travis_farmer)</li> <li>Henk Kruisbrink - UK (Henkk)</li> </ul>"},{"location":"about/about/#related-software-friends-of-dcc-ex","title":"Related Software - Friends of DCC-EX","text":"<p>Making sure this software works well with |EX-CS|</p> <ul> <li> <p>JMRI</p> <ul> <li>M Steve Todd - USA (MSteveTodd)</li> </ul> </li> <li> <p>Engine Driver (ED)</p> <ul> <li>M Steve Todd - USA (MSteveTodd)</li> <li>Peter Akers - South East QLD, Australia (flash62au)</li> </ul> </li> </ul>"},{"location":"contributing/contributing/","title":"How Can I Contribute?","text":"<p>The DCC-EX Team has several projects and sub teams where you can help donate your expertise. See the sections below for the project or projects you are interested in.</p>"},{"location":"contributing/contributing/#documentation","title":"Documentation","text":"<p>This documentation is written in MkDocs so a knowledge of HTML, CSS or Javascript is not necessary.</p>"},{"location":"contributing/contributing/#development","title":"Development","text":"<p>We use C++, Python, HTML/CSS/Javascript, Java (for Android), and even make up our own languages. If you like dealing with code, there's something for all. See here for how to contribute code.</p>"},{"location":"contributing/contributing/#web-support","title":"Web Support","text":"<p>We do our support mostly via Discord, although some users prefer Facebook.</p>"},{"location":"contributing/contributing/#organisationcoordination","title":"Organisation/Coordination","text":"<p>If you are good at herding cats in several countries and time zones then we could always do with some help.</p>"},{"location":"contributing/contributing/#code-of-conduct","title":"Code of Conduct","text":"<p>Be Nice</p>"},{"location":"contributing/contributing/#enforcement","title":"Enforcement","text":"<p>Contributors who do not follow the be nice rule in good faith may face temporary or permanent repercussions as determined by other members of the project's leadership.</p>"},{"location":"contributing/release-checklist/","title":"Release Checklist","text":"<p>Everything on this page supports the team being able to determine when these docs can be released.</p> <p>This is a list of to do items that will allow us to release this new documentation, and move the existing to a separate \"legacy-docs\" URL for reference only.</p>"},{"location":"contributing/release-checklist/#content","title":"Content","text":"<ul> <li> <p>Conductor friendly getting started with RTR and officially supported Mega DIY stack only:</p> <ul> <li> General getting started page</li> <li> General EX-CommandStation page</li> <li> Clarity on what you need including good and recommended power supplies</li> <li> EXRAIL under EX-CS</li> <li> TrackManager under EX-CS - no waveform/DC PWM details, they can be a reference later, just focus on config and use</li> <li> EX-CSB1 RTR information - must be complete</li> <li> Mega DIY stack page - Mega + EX8874/Arduino R3 + WiFiShield8266 only (no hardware mods, plug n play only)</li> </ul> </li> <li> <p>Advanced DIY stacks:</p> <ul> <li> ESP32</li> <li> Nucleo</li> </ul> </li> <li> <p>Product pages for:</p> <ul> <li> CommandStation (includes EXRAIL and TrackManager)</li> <li> EX-CSB1</li> <li> EX-Motorshield8874</li> <li> EX-WiFiShield8266</li> </ul> </li> <li> <p>Better how to get help and support info:</p> <ul> <li> How to use Discord, code snippets, upload files, raise a ticket</li> <li> What are the logs/file required, how to get them</li> </ul> </li> <li> <p>EX-CommandStation troubleshooting steps:</p> <ul> <li> USB issues - drivers, cables, ports, permissions, other programs open</li> <li> WiFi/serial interfering</li> <li> WiFi issues</li> <li> EX-Installer common issues</li> <li> Not seeing roster/routes/turnouts in throttles/JMRI</li> </ul> </li> <li> <p>I2C more accessible information:</p> <ul> <li> As close to \"out-of-the-box\" as we can get device list (Adafruit, Qwiic, etc.)</li> <li> Wiring/pullups/distance in layman's terms</li> <li> Default device addresses and how to disable</li> <li> Troubleshooting steps</li> </ul> </li> <li> <p>Purchasing information for hardware:</p> <ul> <li> Official DCC-EX reseller stores</li> <li> Recommended third-party suppliers</li> </ul> </li> <li> <p> EXRAIL command reference from doxyGen</p> </li> <li> <p>User journeys to guide users through the site:</p> <ul> <li> Brand new users no knowledge</li> <li> Just want to run trains</li> <li> Just want to run trains - DC only version</li> <li> Wanting to add accessories</li> <li> Wanting to animate/automate</li> <li> Large club layout</li> <li> Downloader</li> </ul> </li> <li> <p> Add donation info</p> </li> </ul>"},{"location":"contributing/release-checklist/#release-qa-items","title":"Release QA Items","text":"<ul> <li> Proof-reading all pages but not by original author</li> <li> Address all TODO markers search for TODO</li> </ul>"},{"location":"contributing/release-checklist/#menu-and-page-structure","title":"Menu and Page Structure","text":"<ul> <li> All hardware pages should \"next\" onto the EX-Installer EX-CommandStation configuration instructions, maybe nav plugin extension, maybe JS</li> <li> <p>If DIY on tap nav menu, RTR must be their too, choose:</p> <ul> <li> Both DIY and RTR on nav menu</li> <li> Move both under products menu</li> </ul> </li> <li> <p>Redirects for key items from the previous site, and QR codes on hardware devices</p> <ul> <li> EX-CSB1 QR code</li> <li> EX8874 QR code</li> <li> show QR codes for Toolbox, and ED.</li> <li> and any other recommended throttle apps.</li> </ul> </li> <li> <p> Page numbers should be double digits (leading 0)</p> </li> </ul>"},{"location":"contributing/release-checklist/#styling","title":"Styling","text":"<ul> <li> Revisit navigation menu bar colouring</li> <li> Table separator colours are almost invisible</li> <li> Validate all colours are accessible friendly (reports links might be difficult to read)</li> </ul>"},{"location":"contributing/release-checklist/#team-info","title":"Team Info","text":"<ul> <li> <p> Ensure MkDocs contributor guide covers all customisations</p> <ul> <li> How to use our logos</li> <li> Grid cards</li> <li> CSS/JS customisations</li> <li> Custom plugins</li> <li> Custom footer</li> <li> How we use Material extensions</li> <li> Icons/emojis</li> <li> Snippets</li> </ul> </li> <li> <p> About Us page</p> </li> </ul>"},{"location":"contributing/release-checklist/#release-to-do","title":"Release To Do","text":"<ul> <li> GitHub workflow to build these docs on push/merge</li> <li> GitHub workflow must use strict mode to error on all warnings and errors</li> <li> News article on existing site ahead of release</li> <li> News article with this release</li> </ul>"},{"location":"contributing/user-journeys/","title":"User Personas and Journeys - Front Page Tiles","text":"<p>Use these Mermaid diagrams to help ensure the various user types can navigate successfully from the front page to get to the information they require.</p>"},{"location":"contributing/user-journeys/#new-to-dcc-ex","title":"New to DCC-EX","text":"<p>These users don't really know what DCC-EX is, but saw it at their club, on a YouTube channel, at a show, or someone told them they should check it out.</p> <pre><code>graph LR\n    A[Home page] --&gt; B[DCC-EX introduction];\n    B --&gt; C[General product overview];\n    C --&gt; D[How they can get them];\n    D --&gt; E[Purchasing info];\n    D --&gt; F[DIY info];</code></pre>"},{"location":"contributing/user-journeys/#ready-to-run-csb1","title":"Ready-to-Run CSB1","text":"<p>These users just purchased their brand new shiny EX-CSB1 and want to get up and running with it ASAP. They need to know how to connect it safely to their layout, how to connect a throttle (eg. EX-WebThrottle, Engine Driver), and how to power it.</p> <pre><code>graph LR\n    A[Home page] --&gt; B[Get Started or Run trains?];\n    B --&gt; C[EX-CSB1 how to plug it in or user manual];\n    C --&gt; D[What's next to expand?];</code></pre>"},{"location":"contributing/user-journeys/#dc-ready-to-run-users","title":"DC Ready-to-Run Users","text":"<p>These users are similar to the above but want to run their existing DC trains. They may have a large collection that is too expensive or difficult to convert. They also need to know how to connect it to the layout and connect throttles as well as how to power it, but they also need to understand about isolation between the track outputs and potentially PWM sync issues.</p> <pre><code>graph LR\n    A[Home page] --&gt;B[Get Started with DC];\n    B --&gt; C[EX-CSB1 manual - plug it in];\n    C --&gt; D[DC considerations];\n    D --&gt; E[What's next to expand?];</code></pre>"},{"location":"contributing/user-journeys/#existing-users-adding-accessories","title":"Existing Users Adding Accessories","text":"<p>These users already have a CSB1 or DIY stack up and running and want to extend to using accessories including turnouts, signals, sensors, turntables, and so forth. They need to know how to physically connect them (I2C) and enable them in software (myAutomation.h). This will move them from Conductor into early Tinkerer territory for I2C in particular.</p> <pre><code>graph LR\n    A[Home page] --&gt; B[Adding Accessories];</code></pre>"},{"location":"contributing/user-journeys/#existing-users-looking-to-automateanimate","title":"Existing Users Looking to Automate/Animate","text":"<p>These users already have a CSB1 or DIY stack up and running and may or may not have accessories as well. They want to understand how to automate and/or animate running trains and/or their layout in general. This may be as simple as a shuttle running back and forth between two stations, or a complex display running trains, controlling various layout aspects (eg. lighting, cross gates), and automating shunting or routes across different tracks. This will definitely be out of Conductor territory but is all about EXRAIL, although guidance on what hardware is required to achieve these will be required.</p> <pre><code>graph LR\n    A[Home page] --&gt; B[EXRAIL introduction];\n    B --&gt; C[Accessory options];\n    B --&gt; D[EXRAIL cookbook];\n    B --&gt; E[EXRAIL reference];</code></pre>"},{"location":"contributing/user-journeys/#large-club-layout","title":"Large Club Layout","text":"<p>These users are aware of DCC-EX and know enough to be able to start implementing it on a large club layout. They want to know about wiring, boosters, power districts, multiple wired and wireless throttles, and connecting accessories.</p> <pre><code>graph LR\n    A[Home page] --&gt; B[Large layout page];\n    B --&gt; C[Sample use cases?];\n    B --&gt; D[Accessories?];\n    B --&gt; E[EXRAIL animation/automation?];</code></pre>"},{"location":"contributing/user-journeys/#downloader","title":"Downloader","text":"<p>These users already know enough and just want a quick way to get the latest version of software.</p> <pre><code>graph LR\n    A[Home page] --&gt; B[Download page];</code></pre>"},{"location":"contributing/code/contributing-code/","title":"Contributing to the public domain code","text":"<p>Thanks for considering contributing to our project. Here is a guide for how to get started and and a list of our conventions. We will also walk you through the Github command line and Desktop commands necessary to download the code, make changes, and get it included in a next version of the software.</p> <p>Before contributing to this repository, please first discuss the change you wish to make via issue, or any other method with the owners of this repository before making a change.</p> <p>Find us on our website, on our Discord, or on Trainboard.</p> <p>If you reach out on discord, we have areas reserved for developers to discuss technicalities to avoid confusing users.</p>"},{"location":"contributing/code/contributing-code/#development-environment","title":"Development Environment","text":"<p>We recommend using PlatformIO IDE for VSCode. If you haven't yet used it, it is an easy to learn and easy to use IDE that really shines for embedded development and the Arduino based hardware we use. For more information go to the PlatformIO website.</p> <ul> <li>Download and install the latest version of the Arduino IDE</li> <li>Download and install the latest version of Visual Studio Code from Microsoft</li> <li>Run VSCode and click on the \"extensions\" icon on the left. Install \"PlatformIO IDE for VSCode\" and the \"Arduino Framework\" support</li> </ul> <p>If you don't see C/C++ Installed in the list, install that too. We also recommend installing the Gitlens extension to make working with Git and GitHub even easier.</p> <p>You may ask if you can use the Arduino IDE, Visual Studio, or even a text editor and the answer is \"of course\" if you know what you are doing. Since you are just changing text files, you can use whatever you like as long as your commits and pull requests can be merged in GitHub. However, it will be much easier to follow our coding standards if you have an IDE that can automatically format things for you.</p>"},{"location":"contributing/code/contributing-code/#coding-style-guidelines","title":"Coding Style Guidelines","text":"<p>We have adopted the Google style guidelines. In particular please make sure to adhere to these standards:</p> <ol> <li>All header files should have <code>#define</code> guards to prevent multiple inclusion. (EXCEPT .h files containing EXRAIL scripts!)</li> <li>Use Unix style line endings</li> <li>We indent using two spaces (soft tabs)</li> <li>Braces</li> </ol> <p>For more information just check our code or read the style guide.</p>"},{"location":"contributing/code/contributing-code/#using-the-repository","title":"Using the Repository","text":"<ol> <li>Clone the repository on your local machine</li> <li>Create a working branch using the format \"username-featurename\" ex: \"git branch -b frightrisk-turnouts\"</li> <li>Commit often, ex: \"git add .\" and then \"git commit -m \"description of your changes\"</li> <li>Push your changes to our repository \"git push\"</li> <li>When you are ready, issue a pull request for your changes to be merged into the main branch</li> </ol>"},{"location":"contributing/code/contributing-code/#pull-request-process","title":"Pull Request Process","text":"<ol> <li>Ensure any install or build dependencies are removed before the end of the layer when doing a build.</li> </ol>"},{"location":"contributing/documentation/docs/","title":"Contributing to Documentation","text":"<p>This page outlines what you need in order to contribute to the documentation, along with the various markdown attributes and so forth you can use.</p> <p>The documentation is hosted using GitHub Pages and is written in Markdown format, using MkDocs to publish the content. We use the MkDocs Material theme to give us the framework for the look and feel of the website, along with a number of other useful plugins and extensions to enhance the content.</p> <p>Important! Once up and running with the information on this page, please ensure you are familiar with general markdown syntax.</p> <p>Refer to the Markdown Guide.</p>"},{"location":"contributing/documentation/docs/#how-to-contribute","title":"How to Contribute","text":"<p>For contributions from the general public, we recommend forking the GitHub repository and submitting pull requests for the DCC-EX Documenter team to review and merge.</p> <p>If you wish to contribute more fully and become a part of the DCC-EX Documenter team, reach out to us via Discord. To gain access to the GitHub repository, one of the DCC-EX team administrators will need to add you to the \"Web\" team in GitHub.</p>"},{"location":"contributing/documentation/docs/#mkdocs-links","title":"MkDocs Links","text":"<p>Here are some handy links with more info:</p> <ul> <li>MkDocs website - The official MkDocs documentation.</li> <li>MkDocs Material theme - The MkDocs Material theme documentation.</li> <li>MkDocs Awesome Nav plugin - MkDocs Awesome Nav plugin is what we use for dynamic page structure.</li> <li>MkDocs RSS plugin - The MkDocs RSS Plugin publishes our DCC-EX News feed.</li> <li>MkDocs Open in New Tab plugin - The Open in New Tab plugin ensures all links to external websites open in a new tab to ensure the users' browsing experience in our documentation is consistent.</li> </ul>"},{"location":"contributing/documentation/docs/#what-you-need-to-install","title":"What You Need to Install","text":"<p>This is the list of software you need to successfully contribute to the documentation, including being able to preview it locally:</p> <ul> <li>Visual Studio Code (VSCode)</li> <li>Python - Version 3.13 is recommended, minimum required is 3.10</li> </ul> <p>There are two VSCode plugins that are highly recommended also:</p> <ul> <li>Markdown Preview Mermaid Support by Matt Bierner - enables previewing Mermaid diagrams in VSCode</li> <li>markdownlint by David Anson - helps keep consistent, good formatting in Markdown files (like flake8 for Python)</li> </ul>"},{"location":"contributing/documentation/docs/#getting-started","title":"Getting Started","text":"<p>Once you have installed VSCode and Python, you need to clone the GitHub repository, set up a virtual environment, and install the MkDocs requirements.</p> <p>We recommend using the built-in Git functionality of VSCode to clone the repository, or you can use GitHub Desktop or command line Git, whichever you prefer. There is plenty of information generally available on that so we won't cover it here, and instead will focus on the specifics required to ready to contribute to MkDocs content.</p> <p>Follow the appropriate section below to setup MkDocs in Python for your operating system:</p>"},{"location":"contributing/documentation/docs/#setup-on-macos","title":"Setup on macOS","text":"<pre><code>cd mkdocs-test\npython3 -m venv venv\nsource venv/bin/activate\npip install -r requirements.txt\n</code></pre>"},{"location":"contributing/documentation/docs/#setup-on-linux","title":"Setup on Linux","text":"<pre><code>cd mkdocs-test\npython3 -m venv venv\n. ./venv/bin/activate\npip install -r requirements.txt\n</code></pre>"},{"location":"contributing/documentation/docs/#setup-on-windows","title":"Setup on Windows","text":"<pre><code>cd mkdocs-test\nvirtualenv venv\nvenv\\scripts\\activate\npip install -r requirements.txt\n</code></pre>"},{"location":"contributing/documentation/docs/#previewing-and-building-mkdocs","title":"Previewing and building MkDocs","text":"<p>Previewing locally is very simple:</p> <pre><code>mkdocs serve\n</code></pre> <p>Navigate to the local preview in a browser.</p> <p>When finished with the local preview, stop the local server with either Ctrl+C (Windows/Linux) or Cmd+C (macOS).</p> <p>Building locally is equally as simple:</p> <pre><code>mkdocs build --strict\n</code></pre> <p>MkDocs also has a feature to deploy to GitHub pages without using a workflow:</p> <pre><code>mkdocs gh-deploy\n</code></pre>"},{"location":"contributing/documentation/formatting-guide/","title":"Formatting Guide","text":"<p>This page provides guidelines on how to use the various markdown attributes and other MkDocs Material extensions we have enabled to enhance the documentation.</p>"},{"location":"contributing/documentation/formatting-guide/#page-and-section-links","title":"Page and Section Links","text":"<p>There are three types of links you can use:</p> <ul> <li>Section links - link to another section heading on the same page</li> <li>Document links - link to another document, or a section heading on another document</li> <li>External links - link to an external website</li> </ul> <p>All internal links to other pages and sections should be relative to the docs directory. We have enabled a setting to ensure links are correctly converted to the correct html href, and enable permalinks for headings to support this.</p>"},{"location":"contributing/documentation/formatting-guide/#section-links","title":"Section Links","text":"<p>Links to sections on the same page should just use the permalink section heading name:</p> <pre><code>[Link to this section](#page-and-section-links)\n</code></pre> <p>Results in: Link to this section</p>"},{"location":"contributing/documentation/formatting-guide/#document-links","title":"Document Links","text":"<pre><code>[Link to Contributing to Documentation Page](/contributing/documentation/docs.md)\n</code></pre> <p>Results in: Link to Contributing to Documentation Page</p> <pre><code>[Link to How to Contribute Section](/contributing/documentation/docs.md#how-to-contribute)\n</code></pre> <p>Results in: Link to How to Contribute Section</p> <p>Note: when typing a link in VSCode, the intellisense dropdown will help you complete the link by following the path from the project directory. This creates links that start with \"/docs\" (for example \"/docs/contributing/1-contribute-docs.md\" ). These links will not work unless you manually delete the /docs prefix.  Its a pain but we have raised a PR for VScode and mkDocs on this.</p>"},{"location":"contributing/documentation/formatting-guide/#external-links","title":"External Links","text":"<pre><code>[Link to Google Search](https://www.google.com)\n</code></pre> <p>Results in: Link to Google Search</p>"},{"location":"contributing/documentation/formatting-guide/#search-links","title":"Search Links","text":"<p>We have added a link feature to directly invoke the MkDocs powerful search dialog. This is particularly useful when you wish to refer to information that may be spread over several places and possibly not yet written.</p> <pre><code> [Find out about PCA9685 servo controllers](?PCA9685)\n</code></pre> <p>Find out about PCA9685 servo controllers</p> <p>Multi word searches are also accepted</p> <pre><code> [hidden turnouts](?hidden turnout)\n</code></pre> <p>hidden turnouts</p>"},{"location":"contributing/documentation/formatting-guide/#headings","title":"Headings","text":"<p>Headings are simply defined by one or more leading <code>#</code>, noting you can only have one top level heading on a page, which is the page title.</p> <p>The top level heading defines how the page appears in menus, so for this page this is the top level heading:</p> <pre><code># Standards and Formatting Guide\n</code></pre> <p>Further, this general section on \"Headings\" is a second level heading:</p> <pre><code>## Headings\n</code></pre> <p>Following are how to define the lower level headings with a demo of each.</p>"},{"location":"contributing/documentation/formatting-guide/#heading-level-3","title":"Heading Level 3","text":"<pre><code>### Heading Level 3\n</code></pre>"},{"location":"contributing/documentation/formatting-guide/#heading-level-4","title":"Heading Level 4","text":"<pre><code>#### Heading Level 4\n</code></pre>"},{"location":"contributing/documentation/formatting-guide/#heading-level-5","title":"Heading Level 5","text":"<pre><code>##### Heading Level 5\n</code></pre>"},{"location":"contributing/documentation/formatting-guide/#glossary-terms-and-linking","title":"Glossary Terms and Linking","text":"<p>Glossary plugins seem to be either very complicated to implement, or don't yield the results we're looking for. Instead, we have opted for a simple DIY glossary to define the terms, and provide a search link to enable users to find where they have been used in the documentation.</p> <p>To add a term to the glossary, use the search URL syntax and a second level heading:</p> <pre><code>## [Term](?term)\n\nThis is a new term being added to the glossary.\n</code></pre>"},{"location":"contributing/documentation/formatting-guide/#code-blocks","title":"Code blocks","text":"<p>When including code blocks, be sure to include an appropriate language for syntax highlighting, and use triple backtick \"`\" characters to surround the code for highlighting.</p> <p>For example:</p> <pre><code>```cpp\nTURNOUTL(id, address, \"description\")\n\nTURNOUT(id, shortAddress, subAddress, \"description\")\n```\n</code></pre> <p>Will render as:</p> <pre><code>TURNOUTL(id, address, \"description\")\n\nTURNOUT(id, shortAddress, subAddress, \"description\")\n</code></pre> <p>For EXRAIL and general configuration file code blocks (eg. config.h, myAutomation.h), \"cpp\" is as good as any, and for any others use an appropriate language specifier.</p> <p>If appropriate, line numbers can also be displayed by appending <code>linenums=\"X\"</code> to the language, where \"X\" is the starting line number:</p> <pre><code>```cpp linenums=\"20\"\nTURNOUTL(id, address, \"description\")\n\nTURNOUT(id, shortAddress, subAddress, \"description\")\n```\n</code></pre> <p>Will render as:</p> <pre><code>TURNOUTL(id, address, \"description\")\n\nTURNOUT(id, shortAddress, subAddress, \"description\")\n</code></pre> <p>This is a nonsense C++ code block generated by Gemini to demonstrate the full syntax highlighting:</p> <pre><code>#include &lt;iostream&gt;  // Standard I/O library\n#include &lt;vector&gt;    // For dynamic arrays\n#include &lt;string&gt;    // For string manipulation\n#include &lt;map&gt;       // For key-value pairs\n\n// A simple namespace to organize code\nnamespace MyLibrary {\n\nconst double PI_VALUE = 3.1415926535; // A global constant\n\n/**\n * @brief Represents a generic item with properties.\n * This is a multi-line comment to test comment colors.\n */\nclass GenericItem {\nprivate:\n    std::string itemName;\n    int itemId;\n    double itemPrice;\n    bool isAvailable;\n\npublic:\n    // Constructor with default values\n    GenericItem(const std::string&amp; name = \"Default Item\", int id = 0, double price = 0.0, bool available = true)\n        : itemName(name), itemId(id), itemPrice(price), isAvailable(available) {}\n\n    // Member function to display item details\n    void displayDetails() const {\n        std::cout &lt;&lt; \"Item Name: \" &lt;&lt; itemName &lt;&lt; std::endl;\n        std::cout &lt;&lt; \"Item ID: \" &lt;&lt; itemId &lt;&lt; std::endl;\n        std::cout &lt;&lt; \"Price: $\" &lt;&lt; itemPrice &lt;&lt; std::endl;\n        std::cout &lt;&lt; \"Available: \" &lt;&lt; (isAvailable ? \"Yes\" : \"No\") &lt;&lt; std::endl;\n    }\n\n    // Getter for itemPrice\n    double getPrice() const {\n        return itemPrice;\n    }\n\n    // Setter for itemPrice (with a simple check)\n    void setPrice(double newPrice) {\n        if (newPrice &gt;= 0.0) {\n            this-&gt;itemPrice = newPrice;\n        } else {\n            std::cerr &lt;&lt; \"Warning: Price cannot be negative.\" &lt;&lt; std::endl;\n        }\n    }\n}; // Don't forget the semicolon after class definition!\n\n// Template function to find the maximum of two values\ntemplate &lt;typename T&gt;\nT findMax(T a, T b) {\n    return (a &gt; b) ? a : b; // Ternary operator test\n}\n\n} // end namespace MyLibrary\n\n// Main function - entry point of the program\nint main() {\n    using namespace MyLibrary; // Use MyLibrary namespace\n\n    // Create instances of GenericItem\n    GenericItem item1(\"Laptop\", 101, 1200.50, true);\n    GenericItem* item2 = new GenericItem(\"Mouse\", 202, 25.99, false); // Using 'new'\n\n    // Display details using a loop\n    std::vector&lt;GenericItem&gt; inventory;\n    inventory.push_back(item1);\n    inventory.push_back(*item2);\n\n    std::cout &lt;&lt; \"--- Inventory Details ---\" &lt;&lt; std::endl;\n    for (const auto&amp; item : inventory) { // Range-based for loop\n        item.displayDetails();\n        std::cout &lt;&lt; \"-------------------------\" &lt;&lt; std::endl;\n    }\n\n    // Test the template function\n    int maxInt = findMax(10, 20);\n    double maxDouble = findMax(PI_VALUE, item2-&gt;getPrice()); // Accessing member via pointer\n\n    std::cout &lt;&lt; \"Maximum integer: \" &lt;&lt; maxInt &lt;&lt; std::endl;\n    std::cout &lt;&lt; \"Maximum double: \" &lt;&lt; maxDouble &lt;&lt; std::endl;\n\n    // Exception handling test\n    try {\n        if (item1.getPrice() &lt; 1.0) {\n            throw \"Price too low!\"; // Throwing a string literal\n        }\n        item1.setPrice(1500.00); // Change price\n    } catch (const char* msg) { // Catching a C-style string\n        std::cerr &lt;&lt; \"Error: \" &lt;&lt; msg &lt;&lt; std::endl;\n    }\n\n    // Clean up dynamic memory\n    delete item2; // Using 'delete'\n    item2 = nullptr; // Best practice to nullify pointer after delete\n\n    // Return 0 for successful execution (integer literal)\n    return 0;\n}\n</code></pre>"},{"location":"contributing/documentation/logos/","title":"Using Our Logos","text":"<p>We have various logos available for both the DCC-EX brand and our various products.</p> <p>These are typically created using InkScape in SVG format, which are located in the \"image-artefacts\" directory.</p> <p>The generated logos are exported in PNG format with a transparent background, and located in the \"docs/_static/images/logos\" directory.</p>"},{"location":"contributing/documentation/logos/#light-and-dark-theme","title":"Light and Dark Theme","text":"<p>Due to most logos using a transparent background, there are typically both a light and dark version of each logo available, and a CSS class is required to display the correct one using an attribute.</p> <p>If a logo has a solid background (for example our main DCC-EX logo), this is not required.</p> <p>For example, the EX-CommandStation logo has both options:</p> <pre><code>![EX-CommandStation Logo](/_static/images/logos/product-logo-ex-commandstation-only-light.png){ .only-light }\n![EX-CommandStation Logo](/_static/images/logos/product-logo-ex-commandstation-only-dark.png){ .only-dark }\n</code></pre> <p>This renders, and switching your browser between light and dark modes will demonstrate the result:</p> <p> </p>"},{"location":"contributing/documentation/logos/#branded-and-non-branded-product-logos","title":"Branded and Non-Branded Product Logos","text":"<p>In most instances, using our full brand and product logos can cause pages to become too \"busy\". Users are navigating the DCC-EX website looking at our products, so incorporating our brand along with the product name can cause content and visual overload.</p> <p>Where possible, use product name logos only, but if a product is being used in isolation from other DCC-EX context, branded logos are also available.</p> <p>Logo PNG files including the word \"only\" have no branding.</p> <p>EX-CommandStation branded logo:</p> <pre><code>![EX-CommandStation Logo](/_static/images/logos/product-logo-ex-commandstation-light.png){ .only-light }\n![EX-CommandStation Logo](/_static/images/logos/product-logo-ex-commandstation-dark.png){ .only-dark }\n</code></pre> <p> </p> <p>EX-CommandStation product only logo:</p> <pre><code>![EX-CommandStation Logo](/_static/images/logos/product-logo-ex-commandstation-only-light.png){ .only-light }\n![EX-CommandStation Logo](/_static/images/logos/product-logo-ex-commandstation-only-dark.png){ .only-dark }\n</code></pre> <p> </p>"},{"location":"contributing/documentation/logos/#logo-sizing","title":"Logo Sizing","text":"<p>As you can see by the examples above, the logo sizes can be quite intrusive if use unconstrained.</p> <p>If sizing needs to be constrained, use an additional attribute to set the width only (do not set height):</p> <pre><code>![EX-CommandStation Logo](/_static/images/logos/product-logo-ex-commandstation-only-light.png){ .only-light width=400px }\n![EX-CommandStation Logo](/_static/images/logos/product-logo-ex-commandstation-only-dark.png){ .only-dark width=400px }\n</code></pre> <p> </p> <p>All our product logos are generated with the same dimensions.</p>"},{"location":"contributing/documentation/mermaid-diagrams/","title":"Mermaid Diagrams","text":"<p>Mermaid diagrams are a great way of codifying diagrams and charts within Markdown documents, and we have enabled a plugin to support these within MkDocs.</p> <p>The full capability of Mermaid is outlined on the Mermaid website.</p>"},{"location":"contributing/documentation/mermaid-diagrams/#flowchart","title":"Flowchart","text":"<pre><code>```mermaid\ngraph LR\n  A[Start] --&gt; B{Error?};\n  B --&gt;|Yes| C[Hmm...];\n  C --&gt; D[Debug];\n  D --&gt; B;\n  B ----&gt;|No| E[Yay!];\n```\n</code></pre> <pre><code>graph LR\n  A[Start] --&gt; B{Error?};\n  B --&gt;|Yes| C[Hmm...];\n  C --&gt; D[Debug];\n  D --&gt; B;\n  B ----&gt;|No| E[Yay!];</code></pre>"},{"location":"contributing/documentation/mermaid-diagrams/#sequence-diagram","title":"Sequence Diagram","text":"<pre><code>``` mermaid\nsequenceDiagram\n  autonumber\n  Alice-&gt;&gt;John: Hello John, how are you?\n  loop Healthcheck\n      John-&gt;&gt;John: Fight against hypochondria\n  end\n  Note right of John: Rational thoughts!\n  John--&gt;&gt;Alice: Great!\n  John-&gt;&gt;Bob: How about you?\n  Bob--&gt;&gt;John: Jolly good!\n```\n</code></pre> <pre><code>sequenceDiagram\n  autonumber\n  Alice-&gt;&gt;John: Hello John, how are you?\n  loop Healthcheck\n      John-&gt;&gt;John: Fight against hypochondria\n  end\n  Note right of John: Rational thoughts!\n  John--&gt;&gt;Alice: Great!\n  John-&gt;&gt;Bob: How about you?\n  Bob--&gt;&gt;John: Jolly good!</code></pre>"},{"location":"contributing/documentation/mermaid-diagrams/#state-diagram","title":"State Diagram","text":"<pre><code>``` mermaid\nstateDiagram-v2\n  state fork_state &lt;&lt;fork&gt;&gt;\n    [*] --&gt; fork_state\n    fork_state --&gt; State2\n    fork_state --&gt; State3\n\n    state join_state &lt;&lt;join&gt;&gt;\n    State2 --&gt; join_state\n    State3 --&gt; join_state\n    join_state --&gt; State4\n    State4 --&gt; [*]\n```\n</code></pre> <pre><code>stateDiagram-v2\n  state fork_state &lt;&lt;fork&gt;&gt;\n    [*] --&gt; fork_state\n    fork_state --&gt; State2\n    fork_state --&gt; State3\n\n    state join_state &lt;&lt;join&gt;&gt;\n    State2 --&gt; join_state\n    State3 --&gt; join_state\n    join_state --&gt; State4\n    State4 --&gt; [*]</code></pre>"},{"location":"contributing/documentation/mkdocs-features/","title":"Working with MkDocs","text":"<p>As outlined previously, MkDocs with the MkDocs Material theme are used as the basis of our documentation, utilising markdown plus other enhanced features to give our users a good experience.</p> <p>Only a brief introduction to these are outlined below to set the context for their use within our documentation, aside from custom plugins we have written which are covered here.</p> <p>Read the full MkDocs documentation and MkDocs Material documentation for more information.</p>"},{"location":"contributing/documentation/mkdocs-features/#previewing-and-deploying-mkdocs","title":"Previewing and Deploying MkDocs","text":"<p>Don't forget when working with MkDocs, you can preview locally by running <code>mkdocs serve</code> at a command prompt or bash console, and you can manually deploy to GitHub Pages (provided you have permissions to do so) with <code>mkdocs gh-deploy</code>.</p>"},{"location":"contributing/documentation/mkdocs-features/#dcc-ex-css-styling","title":"DCC-EX CSS Styling","text":"<p>All customised styling for our branding and other customisations is contained in the \"dccex_theme.css\" file.</p> <p>Do not adjust the contents of this file without liaising with the DCC-EX Documenter team to ensure styling is consistent with our theme.</p>"},{"location":"contributing/documentation/mkdocs-features/#dcc-ex-javascript-files","title":"DCC-EX JavaScript Files","text":"<p>There are several JavaScript files included to perform various client side functions:</p> <ul> <li>clickable-cards.js - Makes a grid card clickable using the card's HREF, works with CSS to hide the link also</li> <li>ex-installer-run-helper.js - Helper to hide irrelevant installer links/pages based on the detected browser's operating system</li> <li>legacy-docs-new-tab.js - Ensures all HREF links pointing to <code>https://dcc-ex.com/legacy-docs/</code> open in a new tab</li> <li>platform.js - Helper to determine the browser's operating system</li> <li>search-helper.js - Helper to create search links, see The search link</li> </ul>"},{"location":"contributing/documentation/mkdocs-features/#mkdocs-material-extensions","title":"MkDocs Material Extensions","text":"<p>While basic markdown is sufficient to get pages published with MkDocs and our documentation, there are certain extensions and plugins for MkDocs and the MkDocs Material theme that both improve the maintainability of our documentation, and improve the experience for our users.</p> <p>The authoritative list of enabled extensions can be determined by the \"mkdocs.yml\" file.</p> <p>Do not adjust the contents of this file without liaising with the DCC-EX Documenter team to ensure no existing functionality is broken.</p>"},{"location":"contributing/documentation/mkdocs-features/#admonitions-warning-danger-example-note","title":"Admonitions - Warning, Danger, Example, Note","text":"<p>Use admonitions to create callouts for specific user attention, but please ensure these are used sparingly and only where strictly necessary. Adding general notes and using these tends to make the content too \"busy\", but adding a specific callout about voltage level differences is a good use case.</p> <p>Some examples:</p> <pre><code>!!! warning \"This is a warning\"\n\n    Warnings are good to call out when appropriate.\n</code></pre> <p>This is a warning</p> <p>Warnings are good to call out when appropriate.</p> <pre><code>!!! danger \"This is dangerous!\"\n\n    When dealing with things like voltage levels or power supplies, these are good to call out.\n</code></pre> <p>This is dangerous!</p> <p>When dealing with things like voltage levels or power supplies, these are good to call out.</p> <pre><code>??? example \"A collapsible example\"\n\n    Examples can be good to call out sparingly, and this one is collapsible.\n</code></pre> A collapsible example <p>Examples can be good to call out sparingly, and this one is collapsible.</p> <pre><code>!!! note \"A general note\"\n\n    This is a general note, use very sparingly.\n</code></pre> <p>A general note</p> <p>This is a general note, use very sparingly.</p>"},{"location":"contributing/documentation/mkdocs-features/#attribute-lists","title":"Attribute Lists","text":"<p>Adding HTML attributes to inline or block level elements can be done using Attribute Lists.</p> <p>NOTE that like all markdown syntax, there must be no spaces between the attribute list and the element it is being applied to.</p> <pre><code>![Logo example small](/_static/images/logos/logo.png){ width=100px }\n![Logo example](/_static/images/logos/logo.png){ width=200px }\n</code></pre> <p>This renders:</p> <p> </p> <p>The other most common example in our documentation is to provide a specific CSS class to an element, for example our buttons are a CSS class applied to a link:</p> <pre><code>[Windows x64](https://github.com/DCC-EX/EX-Installer/releases/latest/download/EX-Installer-Win64.exe){ .md-button }\n</code></pre> <p>Renders Windows x64</p> <p>Multiple attributes can be applied using spaces between them, don't use a comma or any other separator.</p> <p>For example, this logo will be 100px wide and only show in light mode (switch to dark mode to hide it):</p> <pre><code>![Logo example](/_static/images/logos/logo.png){ width=100px .only-light }\n</code></pre> <p></p>"},{"location":"contributing/documentation/mkdocs-features/#snippets","title":"Snippets","text":"<p>To help us remove unnecessary duplication of content, we have enabled the <code>pymdownx.snippets</code> extension, which allows us to include content from a single file in other markdown files.</p> <p>All files that are to be included as snippets must reside in the \"snippets\" directory, and preferably within a subdirectory relevant to the topic.</p> <p>NOTE: the code below includes extra back tick \"`\" characters at the beginning and end to prevent MkDocs rendering this as a snippet.</p> <pre><code>`--8&lt;-- \"snippets/snippet-example/snippet-example.md\"`\n</code></pre> <p>The text below is included from this file:</p> <p>This text is being included from the file <code>snippets/snippet-example/snippet-example.md</code>.</p>"},{"location":"contributing/documentation/mkdocs-features/#icons-and-emojis","title":"Icons and Emojis","text":"<p>To include an icon or emoji search for them in the Icons, Emojis section of the documentation.</p> <p>To include, simply reference them as such:</p> <pre><code>:thumbsup:\n</code></pre> <p>This renders </p>"},{"location":"contributing/documentation/mkdocs-features/#mkdocs-plugins","title":"MkDocs Plugins","text":"<p>The authoritative list of enabled plugins can be determined by the \"mkdocs.yml\" file.</p> <p>Do not adjust the contents of this file without liaising with the DCC-EX Documenter team to ensure no existing functionality is broken.</p> <p>We have written two custom plugins for MkDocs to highlight the latest news articles and ensure the previous/next navigation buttons make sense within the context of what the user is seeing.</p> <p>These plugins reside within the \"plugins\" directory and are included in \"requirements.txt\" for installation by contributors.</p>"},{"location":"contributing/documentation/mkdocs-features/#dcc-ex-custom-latest-news-plugin","title":"DCC-EX Custom Latest News Plugin","text":"<p>This plugin simply grabs the title of the latest news/blog articles to create an unordered list which can be used in markdown files.</p> <p>To include it in a file, include this text on its own line with a blank line above and below:</p> <pre><code>- :material-newspaper: New Documentation\n{ .news-headline-list }\n</code></pre> <p>You may need to indent this line to suit the nesting of lists etc.</p> <p>This is included as a plugin in mkdocs.yml:</p> <pre><code>plugins:\n  - latest-news\n</code></pre> <p>By default, the latest 2 articles are included, this can be changed with:</p> <pre><code>plugins:\n  - latest-news:\n      count: 3\n</code></pre> <p>To customise the list styling, either create the default class \"news-list\" or define your own:</p> <pre><code>plugins:\n  - latest-news:\n      list-class: my-list-class\n</code></pre> <p>To ensure the CSS class correctly overrides MkDocs Material classes, make it specific, eg:</p> <pre><code>.md-typeset li.news-headline-list {\n  font-family: Audiowide,Helvetica,Arial,sans-serif;\n  list-style: none;\n  padding-left: 0;\n  margin-left: 0 !important;\n}\n</code></pre>"},{"location":"contributing/documentation/mkdocs-features/#dcc-ex-custom-scoped-nav-plugin-and-custom-footerhtml","title":"DCC-EX Custom Scoped Nav Plugin and Custom footer.html","text":"<p>This plugin is used to set the scope of the previous and next navigation buttons to the directory pages are located in.</p> <p>The first page in a directory will have no previous button, and the last no next button.</p> <p>NOTE: This is calculated based on the sorting order of the page file names within the directory, and therefore custom ordering of pages using .nav.yml will cause unexpected results.</p> <p>To enable this customised navigation, a custom \"footer.html\" template has been included and can be found in \"overrides/partials/footer.html\". This is required in order to show/hide the previous and next arrows as determined by the plugin.</p>"},{"location":"contributing/documentation/standards/","title":"Documentation Standards","text":"<p>This guide outlines the mandatory standards to adhere to for page naming, directory structure, and other related items.</p> <p>We try to keep as few mandatory standards as possible, but these items must be adhered to in order for our documentation to be maintainable.</p>"},{"location":"contributing/documentation/standards/#general-content","title":"General Content","text":"<p>When creating content, remember to keep the target user in mind at all times, with a strong preference to Conductor level users. A significant (and growing) proportion of our user base do not understand software, nor a lot of electronics or embedded systems. Use terminology they are likely understand.</p> <p>Most importantly, keep pages concise, to the point, and avoid excess words or waffle. Not only does this make the key messages clear and easy to read for our users, but maintaining lengthy pages that are a wall of text becomes onerous, daunting, and reduces the likelihood of keeping our documentation current.</p> <p>So:</p> <ul> <li>Brevity is good, keep topics to the concise point (eg. Conductors don't care about DCC waveforms, they care about running a train).</li> <li>Avoid jargon where possible.</li> <li>If something does need elaboration, link to a relevant reference.</li> <li>Don't document things generally available on the Internet, eg. we don't document MkDocs or the Material theme as there is good documentation available, we only document the context of our use cases.</li> </ul>"},{"location":"contributing/documentation/standards/#do-not-duplicate-content","title":"Do Not Duplicate Content","text":"<p>DO NOT CREATE DUPLICATE CONTENT as this increases the maintenance burden significantly but, more importantly, makes it difficult for users when content appears slightly differently in two different places or even contradicts itself. When needing to repeat information in more than one place, take advantage of the MkDocs Snippets feature. This allows you to include the same markdown content in multiple places.</p>"},{"location":"contributing/documentation/standards/#directory-naming-page-naming-and-titles","title":"Directory Naming, Page Naming, and Titles","text":"<p>With the exception of the home page and the DCC-EX News page, do not use \"index.md\", but rather name pages according to their primary message. Using \"index.md\" adjusts the rendering of pages when navigating through the menus, and the team has a preference for the navigation experience using the benefits of the MkDocs Awesome Nav plugin over having an initial index page.</p> <ul> <li>All directory and page names must be in lower case and use \"-\" instead of spaces.</li> <li>Page ordering is determined by the Awesome Nav \".nav.yml\" file, see Directory Structure.</li> <li>The page title is determined by the top level heading, see Headings.</li> </ul>"},{"location":"contributing/documentation/standards/#address-all-mkdocs-warnings-and-errors","title":"Address all MkDocs Warnings and Errors","text":"<p>When running locally with <code>mkdocs serve</code>, ensure any INFO, WARNING, or ERROR level messages are dealt with prior to submitting pull requests or deploying a new version.</p> <p>Warning</p> <p>When we release the new MkDocs based documentation, the deployment GitHub workflow will enforce <code>strict</code> mode, meaning any issues will generate a workflow error, preventing updates being deployed.</p>"},{"location":"contributing/documentation/standards/#directory-structure-and-navigation","title":"Directory Structure and Navigation","text":"<p>Note firstly that we use the MkDocs Awesome Nav plugin to control the menu structure, which uses a \".nav.yml\" file in any directory where the default needs to be overridden.</p> <p>The top level directories under the \"docs\" directory determine the tabs or horizontal menu items on the header bar, with the subsequent directories and files in each of these determining the menu on the left pane.</p> <p>Do not adjust the top level directories without consulting the DCC-EX Documenter team, as these fundamentally adjust the user experience.</p> <p>If a new top level directory is to be added, it needs to be added to the \"/docs/.nav.yml\" file in the appropriate order. Files and directories created within existing top level directories will automatically be added to the menus (see Page Naming and Titles for page ordering).</p>"},{"location":"contributing/documentation/standards/#managing-navigation-files-navyml","title":"Managing Navigation files \".nav.yml\"","text":"<p>When the default sort order or structure of a directory is not presenting as desired, a \".nav.yml\" file can be created to determine sort order and navigation contents according to how the navigation structure is desired.</p> <p>This is part of the MkDocs Awesome Nav plugin and all options are outlined on the Features page.</p> <p>If the directory you're creating a new Markdown file in has no \".nav.yml\" file, the default sort order will be used, meaning you must preview the changes to ensure the end result is as desired.</p> <p>If there is an existing \".nav.yml\" file, simply add the new file in the correct order to the file.</p> <p>Be sure to review the build output for information and warnings regarding pages. If the page you are creating has not been added, you will receive an informational message that it exists, but is not in the navigation tree. If you have added it incorrectly to the \".nav.yml\" file, you will receive a warning message that an entry has been defined that does not exist.</p> <p>A typical \".nav.yml\" file should look like this:</p> <pre><code>nav:\n  - Contributing to Documentation: docs.md\n  - Documentation Standards: standards.md\n  - Formatting Guide: formatting-guide.md\n  - Understanding Links: understanding-links.md\n  - Using Our Logos: logos.md\n  - Working With MkDocs: mkdocs-features.md\n  - Mermaid Diagrams: mermaid-diagrams.md\n</code></pre> <p>Note on relative paths in .nav.yml: At the time of writing, there seems to be an undocumented bug related to MkDocs and/or the MkDocs Awesome Nav plugin that means you cannot use upwards level relative links within the \".nav.yml\" file.</p> <p>So, this will not work:</p> <pre><code>nav:\n  - A relative up link: ../relative/page.md\n</code></pre> <p>You must instead use an absolute path for this:</p> <pre><code>nav:\n  - A relative up link: parent/relative/page.md\n</code></pre>"},{"location":"contributing/documentation/standards/#managing-previous-and-next-buttons","title":"Managing Previous and Next Buttons","text":"<p>Our custom Scoped Nav plugin automatically adjusts previous/next links to ensure that the previous and next buttons don't prompt a user to navigate automatically into irrelevant content.</p>"},{"location":"contributing/documentation/understanding-links/","title":"Understanding Links","text":""},{"location":"contributing/documentation/understanding-links/#what-the-html-browser-sees-is-this","title":"What the html browser sees is this","text":"<p>An ABOSLUTE link in html starts with <code>/</code>  which makes the browser prepend the web server address so <code>href=\"/blah/blah.html\"</code>  for example would link to <code>\"http:://dcc-ex.com/blah/blah.html\"</code> which would be BAD because  we actually wanted  <code>http:://dcc-ex.com/mkdocs-test/blah/blah.html</code> but there was no way of doing that if you didn't know the sub-directory mkdocs-test in advance and code it on all your links.</p> <p>To resolve this, you have to use RELATIVE hrefs, in which the link is relative to the current page.  So if you are on page   <code>blah1/blah2/blah3.html</code> and you want a link or image in  <code>_static/images/stuff.jpg</code>  you have to use <code>href=\"../../_static/images/stuff.jpg\"</code></p> <p>So.. RELATIVE HTML links are the only reliable way to work, otherwise your website is borked if you install it in for example <code>http:://dcc-ex.com/newsite/</code></p>"},{"location":"contributing/documentation/understanding-links/#what-the-mkdocs-author-sees","title":"What the mkdocs author sees","text":"<p>In mkdocs,  the markdown to html generator  passes through RELATIVE links unchanged, this means that you can easily refer to images in the same directory as the current page by just giving the name, or get to any other directory with the appropriate number of ../ to go up the tree.  That's great until you move the current page to another directory so the relative link is no longer going to find the image or page you want.</p> <p>MkDocs has a solution. When you code what appears to be an absolute link like <code>/_static/images/spaff.png</code> then the HTM generated will look like <code>href=\"../../_static/images/spaff.png\"</code>  with the appropriate number of <code>../</code> to walk back up the tree from the current file to the docs directory. So basically you code what looks like an ABSOLUTE link, but the html is generated with a relative link. Hooray!</p> <p>BUT there is one annoying little quirk...</p> <p>The intellisense when typing the start of a link like <code>[look here](/</code>   gives you a dropdown starting at docs  so you get <code>/docs/_static/images/spaff.jpg</code>   which wont get converted so it gives <code>href=\"/docs/_static/images/spaff.jpg\"</code>  which isn't found because the <code>/docs/</code> directory level isnt copied to the website.</p> <p>Pending a VSCode or mkDocs fix (both applied for) the only solution is to manually remove the <code>/docs</code> prefix from the link created by intellisense.</p>"},{"location":"contributing/documentation/understanding-links/#the-search-link","title":"The search link","text":"<p>The search link like <code>?turnout</code> is passed through unchanged by mkDocs but is intercepted in the browser by our own  JavaSCript code</p>"},{"location":"diy/diy/","title":"Build Your Own Command Station","text":"<p>A command station consists of a processor and a shield/board to convert the low voltage digital signal from the processor into the high powered track output.</p> <p>DCC-EX started life on home-built command stations using Arduino UNO and Mega processors and the standard Arduino motor shield. This was attractive to users that liked to experiment and was exceptionally cheap to create.</p> <p>However, if you build your own, or even buy a pre-built stack from a third party, you will need to learn quite a lot more than using our plug-and-go solution the Command Station Booster 1 Express (CSB1).</p> <p>Buyer beware!</p> <p>There are many different brands and clones of various different microprocessors, shields/boards, and power supplies on the market, particularly when using marketplaces such as AliExpress and Amazon. Sometimes the prices on these marketplaces seem too good to be true for a genuine item, and usually they are and you will end up with a clone or inferior product, potentially with quality, reliability, and compatibility issues.</p> <p>When reading through these self-build options, we endeavour to be as clear as we can on the specific options we recommend, but we cannot possibly tell you all the options of where to purchase reliably, so you must take care when purchasing that you are buying the correct component. If in doubt, ask via our Discord server for a second opinion before spending your money.</p> <p>Further, should you select a different processor, or progress to adding accessories, you will find that lots of \"standards\" are not at all standard, and that apparently attractive alternatives to the recommended items are totally incompatible. You may need to configure the software or even modify hardware shields.</p> <p>In addition to the command station components, you will also need</p> <ul> <li>a power supply appropriate you your track and locos.</li> <li>a \u201cMain\u201d track, aka \u201cOperations\u201d track - most people already have this: it\u2019s your layout! If you don't yet have this, no problem you can still test on the programming track (below).</li> <li>a \u201cProgramming\u201d track, aka \"PROG\" or \u201cService\u201d track - an isolated short section of track that you will use to program locomotives</li> <li>a Train - Specifically, a locomotive equipped with a DCC decoder (either a standard or sound decoder). Ideally, it should be a loco already proven to work on DCC. Otherwise, if you have a problem, you may not be able to tell if the problem is the decoder or the EX-CommandStation</li> </ul> <p>Like any command station, you will want some kind of throttle but you can start to drive trains with just the basic system and your PC.</p>"},{"location":"diy/diy/#getting-the-dcc-ex-software","title":"Getting the DCC-EX Software","text":"<p>All builds will require the DCC-EX software to be configured and loaded onto the Arduino processor from your PC. This is best done using the EX-Installer</p>"},{"location":"diy/diy/#quick-and-easy-arduino-mega","title":"Quick and Easy Arduino Mega","text":"<p>If you build our standard Mega-based Command station and use our EX-MotorShield8874  and, optionally, the EX-WiFiShield8266 which have been specifically designed to meet our requirements, then you will be up and running quickly. Easy Build Instructions</p>"},{"location":"diy/diy/#slightly-more-difficult-mega","title":"Slightly more difficult Mega","text":"<p>Using other supported motor or WiFi shields requires a slightly more complex setup.</p> <p>You will eventually require a multimeter, a soldering iron, and a variety of dupont wires or similar and you will probably collect a bucket-load of connectors, adapters, and gizmos that you thought might be useful but don't have time to try.</p> <p>In fact, TIME is the thing you will need most, and time spent building your command station is just too easy an excuse for not building your layout!</p> <p>The following documentation pages can only take you through the basics and should you contact us for support it is well to remember that we do this for fun, we don't get paid, and we don't all have access to the same weird but cheap gizmo you found on the web with an instruction sheet in Klingon.</p> <p>Apart from that... it's great fun!</p>"},{"location":"diy/esp32/","title":"Complex Build - ESP32","text":"<p>ESP32-WROOM-32 was selected as the microprocessor for the EX-CSB1. Although folks are encouraged to use the EX-CSB1, the information on this page should assist in building an ESP32-based DCC-EX command station.</p> <p>ESP32 Wroom Only!</p> <p>The only Espressif ESP32 microprocessor we support is the ESP32 Wroom. Espressif has released numerous ESP32 modules and variants (S2, S3, C3 etc.) but these are NOT supported. Other variants do not have the necessary RMT hardware, or do not have enough such hardware to run DCC-EX.</p> <p> </p> <ul> <li> <p>ESP32-WROOM-32 advantages  </p> <ul> <li>Built-in WiFi  </li> <li>Memory  </li> <li>Sniffer/Booster capable (with additional optocoupler circuit)  </li> </ul> </li> <li> <p>ESP32-WROOM-32 is more complex than using the Arduino Mega  </p> <ul> <li>GPIO pin numbers are used (vs. Arduino style pin location numbers)  </li> <li>ESP32 pins are not 5V tolerant  </li> <li>I2C bus is 3.3V  </li> <li>Soldering is required to modify the WeMos D1 R32/ESPDuino-32 board  </li> <li>Modifications are required for motor shields to protect ADC input pins  </li> <li>ADC input range begins at 0.15V  </li> <li>ESP32 Espressif boards package version 2.0.17 is required</li> </ul> </li> </ul> <p> </p>"},{"location":"diy/esp32/#wemos-d1-r32","title":"WeMos D1 R32","text":"<ul> <li>WeMos D1 R32/ESPDduino-32 has the Uno form factor.</li> <li> <p>WeMos D1 R32 boards have some obvious hardware errors:  </p> <ul> <li>Pullup voltage to the IO0 pin is too high (4.2v instead of 3.3-3.8v) which leads to unreliable WiFi.  </li> <li>IOREF pin does not output 3v3, but instead breaches the UNO R3 specification and outputs 5V.  </li> <li>A0 and A1 pins cannot be used for ADC input when WiFi is used.</li> </ul> </li> <li> <p>There are other ESP32-WROOM-32 boards with the Uno form factor which might work, but these will require a custom motor define when there are differences in GPIO pin locations.</p> </li> </ul>"},{"location":"diy/esp32/#esp32-wroom-32-development-boards","title":"ESP32-WROOM-32 Development boards","text":"<ul> <li>ESP32-WROOM-32 Development boards come in various sizes and pin configurations.</li> <li>38-pin and 30-pin boards are common.</li> <li>Only the ESP32-WROOM-32 variants can be used.</li> </ul>"},{"location":"diy/esp32/#reference-esp32","title":"Reference ESP32","text":"<ul> <li>Assembly and other information: Reference - ESP32</li> <li>Legacy ESP32 documentation</li> </ul>"},{"location":"diy/ethernet/","title":"Optionally install Ethernet","text":"<p>The standard Ethernet shields must be first in the stack as they use pins that are not passed through the headers of the motor shield. Look underneath the shield and this will become obvious. The shields also cause issues with their height, shields above may not sit level (but will still work) unless you introduce an extra row of header extenders.</p>"},{"location":"diy/ethernet/#arduino-network-shield-2","title":"Arduino Network Shield 2","text":"<p> There have been different revisions for the Arduino Network Shields, the main difference is the version of the Wiznet chip on the board. The \u201c2\u201d board uses the Wiznet W5500, other versions used the older W5100 chip. The only supported chip currently is the W5500, but the other boards may work as well. The W5500 can handle 8 simultaneous socket connections while the W5100 can only handle 4.</p> <p>This board also has an SDCard capability but it can't be used in the  EX\u2011CommandStation due to timing limitations.</p>"},{"location":"diy/ethernet/#wiznet-wiz850io","title":"Wiznet WIZ850IO","text":"<p> This is a micro Ethernet board no bigger than the RJ45 connector it is attached to. You have to wire this with jumpers or solder it to a prototyping PCB.</p>"},{"location":"diy/ethernet/#sunfounder-ethernet-shield","title":"Sunfounder Ethernet Shield","text":"<p> This board is tested and works. It is less expensive than the Arduino brand-name board and based on the Wiznet W5100 instead of the W5500.</p>"},{"location":"diy/installer/","title":"Installing Command Station firmware","text":"<p>Your command station cannot operate without the appropriate firmware which must be configured in advance to suit the hardware target.</p> <p>Once your initial Command Station build is operating, you will almost certainly wish to make use of additional features such as defining turnouts, rosters, signals, routes, animations and other varied accessories. In each case, we make it as simple as possible but you do need to use the appropriate tools to re-install the firmware to incorporate your changes.</p> <p>The EX-Installer guides you through the process.</p>"},{"location":"diy/mega-easy/","title":"Easy build - Arduino Mega","text":"<p>The instructions below detail the steps required to use an EX8874 motor shield.</p> <p>DO NOT USE ANY OTHER SHIELD TYPE WITHOUT FIRST CHECKING OUR DETAILED INSTRUCTIONS FOR THAT SHIELD.</p>"},{"location":"diy/mega-easy/#what-you-need","title":"What you need","text":"<p>To build a basic DIY Command Station in easy steps you will need:</p> <ul> <li>A PC or laptop (Not a Raspberry Pi) running a reasonably recent versions of Windows, Linux or macOS</li> <li>an Arduino Mega microprocessor or Elegoo clone.</li> <li>USB cable to your PC for the processor.</li> <li>an EX-MotorShield8874 to power the track.</li> <li>A double-insulated DC power supply with a voltage suitable for your layout/locos.</li> <li>(Optional) EX-WiFiShield8266 to use Wi-Fi throttles.</li> </ul>"},{"location":"diy/mega-easy/#step-by-step-build","title":"Step-by-Step Build","text":""},{"location":"diy/mega-easy/#prepare-your-mega","title":"Prepare your Mega","text":"<ol> <li> <p>Use sticky tape or similar to cover up the barrel connector on the Mega. (Power to the processor will be provided by the EX8874 shield and you don't want accidents.)</p> </li> <li> <p>Use sticky tape or similar to cover the top of the USB connector on the mega. This prevents any accidental contact with the underside of the motor shield. </p> </li> <li> <p>Mount your Mega on 3d printed tray, a piece of plastic card or wood to make sure that the underside solder points are insulated. Placing your Command Station down on a tool, coin or even your track can short the pins and, in some cases, damage the board.</p> </li> </ol>"},{"location":"diy/mega-easy/#mount-the-ex8874-shield","title":"Mount the EX8874 shield","text":"<p>DO NOT USE ANY OTHER SHIELD TYPE WITHOUT FIRST CHECKING OUR DETAILED INSTRUCTIONS FOR THAT SHIELD.</p> <ol> <li>Make sure the pins are straight.</li> <li>Line up the shield with the connectors at the same end as the mega and carefully insert the pins. This is easiest if you insert one side slightly first. Don\u2019t force anything, there will be a visible gap  between the bottom of the motor board and the top of the headers.</li> </ol> <p>Check your work. Look under and through where the boards connect, make sure no pins missed the holes and got bent so that they run along the outside of the headers.</p> <p> </p>"},{"location":"diy/mega-easy/#optionally-install-wifishield","title":"Optionally Install WiFiShield","text":"<ol> <li>Prepare your EX-WiFiShield8266 by removing the two jumpers, see picture. </li> <li>Mount the Wi-Fi shield on the EX8874 noting the correct orientation in the pictures and there will be 2 pins on either side which are deliberately missing.</li> <li>Use a male-female Dupont wire (normally supplied with the shield) to connect to any one of the row of Tx pins on the Wi-Fi Board, and connect the other end to the Rx1 pin on the mega (pin 19). See photo below.</li> <li>Take a second jumper wire and connect it to any one of the row of Rx pins on the Wi-Fi Board and connect the other end to Tx1 on the mega (pin 18).</li> <li>Use a small piece of sticky tape or similar to keep the Dupont wires firmly in place in the mega header sockets. They are easily knocked out.  </li> </ol>"},{"location":"diy/mega-easy/#connect-your-power-supply","title":"Connect your power supply","text":"<p>We recommend you label the power supply so that it does not get confused with others of different voltages you may use later. Plug in to the barrel connector on the EX8874 shield (NOT the Mega).</p>"},{"location":"diy/mega-easy/#connect-to-your-pc","title":"Connect to your PC","text":"<p>Using a suitable USB cable (must carry Data and Power, not all cables do this!) connect the Mega USB to your PC.</p>"},{"location":"diy/mega-easy/#connect-your-track","title":"Connect your track","text":"<p>The EX8874 track connectors unplug for easy access.     If you only have one piece of track for testing, wire it to the PROG track plug.</p> <ol> <li>Your PROG track is wired to the green socket closest to the power barrel connector.</li> <li>The MAIN track is wired to the far connector.</li> </ol> <p></p>"},{"location":"diy/mega-easy/#load-the-software","title":"Load the software","text":"<p>Congratulations, you have built a DIY command station the easy way. But you still have to load the software.</p> <p>For simplicity, software loading is best done with the EX-Installer</p>"},{"location":"diy/mega-harder/","title":"Alternative build - Arduino Mega","text":"<p>These instructions assume a slightly more competent user who has made the decision to trade simplicity for price. It is assumed that you are comfortable modifying devices, maybe soldering etc. and are not going to make costly mistakes such as mixing up the power supplies or putting the processor board down on something that will short the underside of the pins.</p> <p>There are a limited number of suitable motor or WiFi shields available and each has its own quirks.</p>"},{"location":"diy/mega-harder/#what-you-need","title":"What you need","text":"<p>To build a basic DIY Command Station you will need:</p> <ul> <li>A PC or laptop (Not A Raspberry Pi) running a reasonably recent versions of Windows, Linux or MacOS</li> <li>an Arduino Mega microprocessor running our free Open Source software</li> <li>USB cable to your PC for the processor.</li> <li>an Arduino standard (or others as noted in details) motor-shield to power the track.</li> <li>A double-insulated DC power supply with a voltage suitable for your layout/locos.</li> <li>An additional double-insulated DC Power supply of 5 to 8 volts suitable to drive the Arduino logic. (This may also be fed through the USB cable, and old phone charger is suitable or if you intend to use JMRI your computer will supply this power.)</li> <li>Optionally<ul> <li>a female barrel connector to match the plug on your chosen track power supply</li> <li>a suitable WiFi shield to use WiFi throttles (Recommended) with 2 suitable M-F Dupont wires.</li> <li>OR an Ethernet Shield</li> </ul> </li> </ul>"},{"location":"diy/mega-harder/#step-by-step-build","title":"Step By Step Build","text":""},{"location":"diy/mega-harder/#prepare-your-mega","title":"Prepare your Mega","text":"<ul> <li>Use sticky tape or similar to cover the top of the USB connector on the mega. This prevents any accidental contact with the underside of the motor shield.  </li> </ul>"},{"location":"diy/mega-harder/#optionally-mount-your-ethernet-shield","title":"Optionally mount your Ethernet Shield","text":"<p>Note, you can't have Ethernet and WiFi running on the same command station, but you can install both shields and choose one or the other when installing the software. See Ethernet Install</p>"},{"location":"diy/mega-harder/#prepare-your-motor-shield","title":"Prepare your motor shield","text":"<p>FAILURE TO DO THIS CAN DESTROY YOUR MEGA.</p> <p></p> <ol> <li> <p>Unless you are using an EX8874 shield, you MUST prevent the shield from feeding track voltage into your Mega. This is done by cutting the VIN trace and/or removing the pin that feeds the Mega.</p> </li> <li> <p>Ensure shield pins are straight and correctly aligned.</p> </li> </ol>"},{"location":"diy/mega-harder/#mount-the-motor-shield","title":"Mount the motor shield","text":"<p>Align the motor shield so that the power connectors are at the same end as the Mega power/USB connectors. It is normal for you to see a few millimetres of the pins between the bottom of the motor board and the top of the headers.</p>"},{"location":"diy/mega-harder/#connect-your-track","title":"Connect your track","text":"<p> Don't skip this step if you don't yet have any track because the WiFi shield will cover the connectors.</p> <p>It's best to create fly leads with a suitable pluggable connectors for later. It makes it much easier to detach your command station from your layout when you need to fiddle with it or throw it against the wall out of sheer frustration.</p> <p>If you only have one piece of track for testing, wire it to the PROG track plug.</p> <ol> <li>The MAIN track is wired to the A channel output.</li> <li>Your PROG track is wired to the B channel output.</li> </ol>"},{"location":"diy/mega-harder/#connect-your-track-power-supply","title":"Connect your track power supply","text":"<p> Wire your track power supply to the input turrets of the motor shield, observing polarity. It is best to create short wire with a female barrel connector.</p>"},{"location":"diy/mega-harder/#optionally-install-a-wifi-shield","title":"Optionally install a WiFi Shield","text":"<p>See WiFi Install</p>"},{"location":"diy/mega-harder/#load-the-software","title":"Load the software","text":"<p>Software loading is best done with the EX-Installer</p>"},{"location":"diy/nucleo/","title":"Complex Build - Nucleo","text":"<p>Reasons to consider the supported Nucleo-F4 boards</p> <ul> <li> <p>Nucleo-144 can have up to 8 districts.   - DCC signals are in sync, as is the case for all of the DCC-EX command stations.   - DC signals can be in sync, which makes Nucleo-144 the better choice if you want 8 DC mode districts.</p> </li> <li> <p>Nucleo-144 - Ethernet is onboard/included with F429ZI and F439ZI   \u00a0 \u00a0 \u00a0 \u00a0 hint:  minimal cost difference; you may find it useful.  </p> </li> <li> <p>Nucleo boards are quality products.   - Pricing is best when purchased from st.com or one of their distributors:   \u00a0 \u00a0 Digikey, Farnell, Mouser</p> </li> <li> <p>Nucleo-64   Why would someone go this route vs. Nucleo-144 or CSB1/ESP32-WROOM?   - More pins than ESP32   - More memory than Mega   - F411RE could be used as EX-IOExpander   - Already have EX8874 and WiFi shield and/or want the smaller size</p> </li> </ul>"},{"location":"diy/nucleo/#nucleo-f4-boards-supported","title":"Nucleo-F4 boards supported","text":"<ul> <li> <p>Nucleo-144   F429ZI / F439ZI - Ethernet included   F446ZE   F413ZH</p> </li> <li> <p>Nucleo-64   F411RE   F446RE</p> </li> <li> <p>Other notes   - The three Nucleo-144 boards' pin locations are quite consistent with each other.   - Nucleo-144 boards have the Zio headers installed - headers (top) and pins (bottom).   \u00a0 \u00a0 Morpho headers will require installation/soldering, if you want to use them.    - Nucleo-64 boards' pin locations are less consistent.  If you are aware, it should not be an issue.   - Nucleo-64 boards have Arduino headers (top) and Morpho pins (top and bottom) installed.  </p> </li> </ul>"},{"location":"diy/nucleo/#reference-nucleo","title":"Reference - Nucleo","text":"<ul> <li> <p>Nucleo information</p> </li> <li> <p>Legacy Nucleo documentation</p> </li> </ul>"},{"location":"diy/others/","title":"DIY - Other devices","text":"<p>We are unable to support you self building with devices other than those described in the earlier pages. In some cases we do know about devices that simply don't work or have so little market penetration that it is not worth the considerable effort required to develop, test and maintain software for them.</p> <p>DCC-EX is not a simple Arduino program, it requires precise access to the internals of each processor type. This means development time is taken and support issues rise whenever we take on a new processor.</p> <p>We are unable to rely on third party libraries which are generally designed to be the only thing on your Arduino and do not play well in such a demanding scenario.</p>"},{"location":"diy/others/#the-following-devices-are-not-supported","title":"The following devices are NOT supported:","text":"<ul> <li>Arduino UNO and Nano. We have supported them in the past but the increase in Command Station features has oustripped their miniscule memory capabilities.</li> <li>Mega Wifi. Some users have had success with this but we have had approximately 50% failure rate on these devices. Its just not worth it. </li> <li>Arduino Giga. This has a very high cost and some strange WiFi limitations.</li> <li>Teensy (various models). These have been made to work in the past but without help we are unable to update or support them.</li> <li>ESP32. There are dozens of ESP32 versions and the vast majority of them will not be able to run DCC-EX. We can only support the explicitly recommended version.</li> <li>UNO R4 WiFi. Useless and expensive.</li> <li>Nano Every.  Not enough FLASH memory.</li> <li> <p>Pi Pico.  Lack of demand and awkward form factor for shields.</p> </li> <li> <p>Motor shields other than those recommended.</p> </li> </ul> <p>Many of these require modification or simply do not provide the features we need. Even the Arduino standard motor shield (which we do support) is not capable of the full range of the newer DCC-EX functions and requires physical modification to avoid melting your processor.</p>"},{"location":"diy/power/","title":"Selecting a power supply","text":"<p>You will require a power supply unit to provide track power and to run the Command Station processor.</p>"},{"location":"diy/power/#volts-and-amps","title":"Volts and Amps","text":"<p>The volt and current requirements for your track vary according to the scale of your locos and the number you expect to run simultaneously.</p> <p>These recommendations are generalised, and you must check to make sure they don't exceed your loco and DCC decoder manufacturer's recommendations.</p> Scale Recommended Voltage (DC) Minimum Current (Amps) Notes Z (1:220) 10\u201312V 2A Lower voltage protects tiny motors; avoid exceeding 12V. N (1:160) 12V 3A Most decoders rated for 12V max; higher voltages increase brush wear. TT (1:120) 12\u201314V 3\u20134A Slightly more headroom than N scale. HO (1:87) 14\u201315V 4\u20135A Common sweet spot for DCC; 15V is typical for DCC-EX setups. OO (1:76) 15V 4\u20135A Similar to HO; check decoder specs. S (1:64) 15\u201316V 5A Larger motors can handle more voltage. O (1:48) 16\u201318V 5\u20136A Ensure decoder supports higher voltage; some cap at 18V. G (1:22.5) 18\u201322V 6A+ Outdoor locos often need more torque and current."},{"location":"diy/power/#using-an-ex8874-or-csb1","title":"Using an EX8874 or CSB1","text":"<p>The EX8874 (which is also built in to the CSB1) provides power for both the track and the Command Station. There is almost zero voltage drop between the power supply and the track.</p> <p>We strongly advise purchasing a suitable power supply at the same time as the CSB or EX8874 from a vendor who understands your requirements.</p>"},{"location":"diy/power/#other-motor-shields","title":"Other motor shields","text":"<p>Should you have the temerity to choose a motor-shield other than the EX8874:</p> <ul> <li>you must allow for the voltage drop within your chosen shield.</li> <li>you must provide separate power for the Command Station processor, most easily via the USB socket. A standard phone charger, or a connection to a computer, will be adequate. Other options are significantly more complex.</li> <li>you may not be protected from reverse-polarity mistakes.</li> </ul>"},{"location":"diy/power/#what-to-look-for","title":"What to look for","text":"<p>Typically, retired or replacement laptop power supply bricks are suitable and readily available. You need to check their markings:</p> <ul> <li>Volts and Amps suitable for your trains and layout (see above)</li> <li>Double square safety markings.</li> <li>Plug polarity indicator, center positive.</li> </ul>"},{"location":"diy/power/#safety-warning","title":"SAFETY WARNING","text":"<p>A Command Station is NOT a typical consumer electronics device where the user is never in contact with any bare wire of any voltage.  Your track is effectively a large bare wire that will be touched frequently.</p> <p>You MUST use a suitable, double insulated, power supply where it is not possible for a loose wire or stray flexi-track clipping from your model building to fall in and bridge the gap between mains voltage and the output.</p> <p>Should this happen, it could melt your electronics, locos or children.</p>"},{"location":"diy/wifi/","title":"Optionally install Wifi","text":"<p>This page does not apply to CSB1 or other ESP32-based command stations which have Wi-Fi built in.</p> <p>If you intend to use an ESP-01 development board, please skip to ESP01</p>"},{"location":"diy/wifi/#ex-wifishield8266","title":"EX-WiFiShield8266","text":"<p> We recommend you purchase an EX-WiFiShield8266 (a joint venture with Makerfabs) which has been designed to make the installation easy.</p> <p>You can find installation instructions here WiFiShield8266 install</p>"},{"location":"diy/wifi/#other-shields","title":"Other shields","text":"<p>Most other Arduino ESP8266 Wi-Fi shields, including the dodgy ones with \"Shiald\" and \"Arbuino\" spelling mistakes, will work well with a DCC-EX command station but must be modified slightly to bypass the useless design based on UNOs with one user and no USB connection. They are frequently shipped with firmware versions that do not work well with DCC-EX (latest is not always best!) and it's non-trivial to rectify this.</p> <p>In addition, the shield size overlaps the standard Arduino motor-shield terminal blocks which is a pain if you failed to follow the Command Station build suggestions at the time.</p> <ol> <li> <p>Ensure that the WiFi shield is physically modified to avoid it communicating over the standard Arduino Tx/Rx Serial pins, by removing pins 0 and 1. If it has any DIP switches, set them all off.</p> </li> <li> <p>Mount the shield above the command station motor shield making sure the tab end of the WiFi shield is away from the power connector end of the motor shield.</p> </li> <li> <p>Use two male-female Dupont wires to connect the WiFi Shield to your Command Station. (Pay Attention... we get a lot of support calls from users who have not noticed that the wires cross!)</p> </li> </ol> <pre><code>- Arduino      Shield\n- Rx1  -------&gt; Tx\n- TX1  -------&gt; Rx\n</code></pre>"},{"location":"diy/wifi/#esp-01-or-esp-01s","title":"ESP-01 or ESP-01S","text":"<p> These devices are not recommended because there are power consumption issues that may cause random Command Station brown-out failure while attempting to connect in a low WiFi signal area.  They will probably NOT work without a non-trivial firmware update.</p> <p>The ESP-01 should be connected with dupont wires to the Command Station with wiring as follows:</p> <pre><code>- Arduino      ESP-01\n- 3.3V  -----&gt; Vcc\n- 3.3V  -----&gt; CH_PD\n- Gnd   -----&gt; Gnd\n- Tx1   -----&gt; Rx\n- Rx1   -----&gt; Tx\n</code></pre> <p>Incorrect wiring can destroy this device.</p>"},{"location":"donations/donations/","title":"Donations","text":""},{"location":"donations/donations/#how-we-use-donations","title":"How We Use Donations","text":"<p>Your donations help to offset the cost of running some of the resources used to operate DCC-EX and bring you new software and hardware. Your generosity funds the purchasing of technology we use in testing to add new features such as motor drivers, the latest microcontrollers, expansion boards, and similar items. At the end of the year, if there is any money left over, a few of the key contributors for that year may receive a small gift certificate to their favourite coffee shop or train store to thank them personally for their efforts. We truly appreciate your support!</p> <p>US Donors, In order to save fees, please use PayPal or Venmo for one-time donations and choose the \"Friends and Family\" option. You can also use GitHub. Use any credit you may have or the bank account linked to your account. Using a credit card will incur fees. For automatic monthly donations, you may use GitHub or Patreon.</p> <p>Non-US Donors, Use GitHub for one-time or automatic monthly donations or Patreon for automatic monthly donations. You may use PayPal for one-time donations also, though their fees are higher.</p>"},{"location":"donations/donations/#donation-options","title":"Donation Options","text":"<p>PayPal</p> <p>Or choose user @FNDecker in your PayPal App</p> <p>Venmo</p> <p>Or choose user @FNDecker in your Venmo App</p> <p>Patreon</p> <p>Or choose user \"dccex\" on Patreon</p> <p>GitHub</p> <p>We are DCC-EX on GitHub Sponsors. You can also donate from our EX-CommandStation GitHub repository page by scrolling down the right side column.</p> <p>By Mail: You may send checks made out to DCC-EX to: DCC-EX PO Box 674 Holly Springs, NC 27540-0674</p>"},{"location":"installer/download-linux/","title":"Download linux","text":""},{"location":"installer/download-linux/#download-and-install-on-linux","title":"Download and install on Linux","text":"<p>TODO - Add screenshots &amp; fix page flow</p> <p>Download from here Linux x64</p> <p>Right-click on the file, go to Properties, then the Permissions tab, and check \u201cAllow executing file as program\u201d</p> <p>Open a terminal window and navigate to that folder</p> <p>Run the installer with the following command:</p> <pre><code>./EX-Installer-Linux64\n</code></pre>"},{"location":"installer/download-mac/","title":"Download mac","text":""},{"location":"installer/download-mac/#download-and-install-on-macos","title":"Download and install on MacOS","text":"<p>Download from here macOS</p> <p>Open a terminal window and navigate to the that folder that you downloaded the file to. e.g.:</p> <pre><code>cd Downloads\n</code></pre> <p>Enter the following command to tell the OS that it is an executable:</p> <pre><code>chmod +x EX-Installer-macOS\n</code></pre> <p>Run the installer with the following command:</p> <pre><code>./EX-Installer-macOS\n</code></pre> <p>On later macOS versions, go to Privacy &amp; Security in System Settings, and scroll down to Allow applicaitons downloaded from \"App Store and identified developers\" and then when EX-Installer is blocked, click \"Allow Anyway\"</p> <p></p>"},{"location":"installer/download-win/","title":"Download win","text":""},{"location":"installer/download-win/#download-and-install-on-windows","title":"Download and install on Windows","text":"<ul> <li>Download from here Windows x64</li> <li>Open the downloads folder where your browser has saved the EX-Installer-Win64.exe and execute it.</li> </ul> <p>NOTE: Depending on the configuration of your computer the \u2018.exe\u2019 may or may not appear. This is not of concern.</p> <p>If your browser shows a warning like </p> <p> </p> <p>you will need to select the \"...\" and select \"Keep\". On the next dialog </p> <p> </p> <p>Select \"Show more\" and \"Keep Anyway\".</p> <p>You should see </p> <p></p> <p>and you can now select \"Open file\" to run the installer.</p>"},{"location":"installer/first-run/","title":"First Run installer","text":"<p>You will be presented with the Welcome screen\u2026</p> <p></p> <p>This screen provides some basic information about the process of loading the Software. The font may be very small on a high quality screen so use the \"tools sizing\" menu to find a better zoom factor. </p> <p>To proceed, click the Manage Arduino CLI button.</p> <p></p> <p>This screen allows you to install or update the Arduino Command Line Interface (CLI).</p> <p>We use the Arduino Command Line Interface (CLI) to upload the DCC-EX products to your Arduino. The CLI eliminates the need to install the more daunting Arduino IDE. EX\u2011Installer is able to manage the installation and updating of the Arduino CLI for you at the click of a button.</p> <p>If you have not installed the CLI previously you will see an 'Install Arduino CLI' button.</p> <p>If you have previously installed the CLI you will see a 'Refresh Arduino CLI' button.</p> <p>HINT:</p> <p>Expressif ESP32 is required for the EX\u2011CSB1</p> <p>If you are using an Espressif or STMicroelectronics device (including the EX\u2011CSB1, as opposed to the other CPU based Arduinos, you will need to enable support for these by selecting the appropriate additional platform option.</p> <p>NOTE:</p> <p>Enabling additional platforms that you will not be using will take more space on your hard drive and is likely to add several minutes to the installation process.</p> <p>You must have Arduino CLI installed to proceed, simply click the Install Arduino CLI button if it is showing.</p> <p>If you already have the Arduino CLI installed, it is recommended that you refresh it periodically (e.g. weekly) to ensure support for the various device details are kept up to date. To refresh the CLI, simply click the Refresh Arduino CLI button.</p> <p>Installing the CLI can take some time. Maybe grab a cup of tea or coffee, and watch magic happen!</p>"},{"location":"installer/install-cs/","title":"Installing Command Station Software","text":"<p>This assumes you have read and done the EX-Installer installation, know how to execute it and have done the CLI download and optional ESP32 steps to make sure you have the necessary build processor and run time libraries for your Command Station.</p> <p>To proceed, click the Select your device button.</p>"},{"location":"installer/install-cs/#device-selection","title":"Device Selection","text":"<p>A scan for devices will start automatically. Usually the installer is able to work out the details automatically.</p> <p>If you see No devices found it means that you either</p> <ul> <li>have not connected the device to the computer, connect it now then click the Scan for Devices button again</li> <li>the device was not recognised by the computer, this may be a bad USB cable or a missing USB driver. Refer to the Diagnosing Basic Problems page for assistance.</li> </ul> <p>Next select the USB port (if several) and the type of device you wish to load the EX\u2011CommandStation software onto. EX\u2011Installer will attempt to work out both of these for you, but it may need assistance.</p> <p>NOTE: For the EX\u2011CSB1 select \u2018DCC-EX EX-CSB1\u2019 from the drop-down list.</p> <p>Now press the Select Product To Install button and click on the EX\u2011CommandStation logo to proceed.</p>"},{"location":"installer/install-cs/#version-selection","title":"Version Selection","text":"<p>Select which version of the EX\u2011CommandStation software to load onto your hardware. If you are unsure, or unless you have been otherwise directed by the support team, we recommend you select Latest Production.</p>"},{"location":"installer/install-cs/#configuration","title":"Configuration","text":"<p>When loading for the first time, you should use Configure Options. Alternatively you may reuse your previous files.</p> <p>On this screen you can select some of the flexible and optional features of the EX\u2011CommandStation:</p>"},{"location":"installer/install-cs/#motor-driver-type","title":"Motor Driver Type","text":"<p>You must select the motor shield that you have installed. The installer can\u2019t detect this. Selecting the wrong board will not work and may damage the hardware by compromising the short-circuit protection.</p> <ul> <li>For the EX\u2011CSB1 alone select \u2018EX-CSB1\u2019 or \u2018EXCSB1_WITH_EX8874\u2019 as appropriate.</li> </ul> <p></p>"},{"location":"installer/install-cs/#other-options","title":"Other options","text":"<p>You should select \"Disable EEPROM support\" for most cases. </p>"},{"location":"installer/install-cs/#optional-lcd-or-oled-display","title":"Optional LCD or OLED display","text":"<p>The EX\u2011CSB1 will generally be supplied with an OLED 128 X 64</p> <p>If you have installed and optional OLED or LED display, enable [I have a display] option, which will present you with a drop-down list to select the type of display you have.</p> <p></p>"},{"location":"installer/install-cs/#optional-wi-fi","title":"Optional Wi-fi","text":"<p>If you are using a CSB1 or other board with integrated Wi-Fi, or have installed and optional Wi-Fi board you need to enable the <code>I have Wi-Fi</code>. This enables the \"Wi-fi Options\" button where you can configure the Wi-Fi.</p>"},{"location":"installer/install-cs/#wi-fi-access-point-mode","title":"Wi-Fi Access Point mode","text":"<p>In Access Point mode, you command station runs a completely isolated Wi-Fi Network. This is most useful if your layout is away from the house, or you transport your layout frequently, or do not want to give guests access to your home Wi-Fi. Wi-Fi phones or tablets will need to connect their Wi-Fi to the Access Point and will lose access to your home Wi-Fi.  Wi-Fi Password is optional. If this field is left blank the password will default to \u2018PASS_xxxxxx\u2019 where \u2018xxxxxx\u2019 will be the same as the SSID name that will be automatically configured. If possible, choose a channel that is unused (or least used) by other Wi-Fi networks around your location. There are numerous phone apps that can help you determine which channels are being used by other networks. For Android, \u2018Wi-fi Analyzer\u2019 is one that works. For iOS \u2018Netspot\u2019 is suitable (you don\u2019t need to purchase WiPry device they mention).</p> <p>Wi-Fi Channel can be any value from 1-11.</p>"},{"location":"installer/install-cs/#wi-fi-station-mode","title":"Wi-Fi Station mode","text":"<p>In Station mode, the CommandStation connects to your existing home Wi-Fi Network or other router. Phone and Tablet throttles on your home network can find the CommandStation easily.</p> <p>Wi-Fi SSID is the name of your home network.</p> <p>Wi-Fi Password is the password for your home network.</p> <p>Additionally, if you choose, you may customise the Wi-Fi hostname, or leave it as the default \u201cdccex\u201d which is easily found by throttles. </p>"},{"location":"installer/install-cs/#optional-ethernet","title":"Optional Ethernet","text":"<p>If you have installed and Ethernet board, select this option.</p> <p>Note that it is not possible to have both Wi-Fi and Ethernet enabled at the same time.</p>"},{"location":"installer/install-cs/#start-with-power-on","title":"Start With Power On","text":"<p>The EX\u2011CSB1 will generally be supplied with this enabled.</p> <p>If you don\u2019t enable this, you will need to turn the track power with your controller, or with TrackManger automations.</p>"},{"location":"installer/install-cs/#override-current-limit-advanced","title":"Override Current Limit (Advanced)","text":"<p>Do not select without Engineer level knowledge.</p>"},{"location":"installer/install-cs/#set-track-modes-advanced","title":"Set Track Modes (Advanced)","text":"<p>The default has Track A and DCC MAIN  and Track B as a PROG track. This is an advanced option and should only be used do not need to alter this unless you are running multiple motor shields or wish to operate only in DC.</p>"},{"location":"installer/install-cs/#advanced-configuration-optional","title":"Advanced Configuration (Optional)","text":"<p>Skip this page when you first start. You will need it later once you start adding accessories or automations.  </p> <p>Note there is an additional option Create myAutomation.h that allows a blank myAutomation.h file to be created, which you can edit on the following Advanced Config screen. Leaving this option disabled means a myAutomation.h file will not be generated if it is not required, which saves memory on your EX\u2011CommandStation device.</p>"},{"location":"installer/install-cs/#compile-and-load","title":"Compile and Load","text":"<p>This proceeds to compile your configuration in with the base code and load it into the Command Station Arduino processor.</p> <p>There may be errors compiling (usually due to a mistake in the advanced configuration or myAutomation.h) and this will prevent the load stage from taking place.</p> <p></p> <p>Errors during the load stage are almost invariably caused by problems communicating with the Arduino, possibly by incorrect selection of the type or by having another program, such as JMRI or EX-Webthrottle still using the USB connection.</p>"},{"location":"installer/install-cs/#backup","title":"Backup","text":"<p>After loading the software onto your device, you can optionally copy the generated configuration files to a folder of your choice as a backup by clicking the Backup config files button. You will be prompted to select a folder, and if the chosen folder already contains config files, you can overwrite these, or you can select an alternative location.</p>"},{"location":"installer/install-cs/#device-monitor","title":"Device Monitor","text":"<p>Once you have selected a device in EX\u2011Installer on the \u201cSelect your device\u201d screen, or after successfully loading software onto your device, a View device monitor button will be available.</p> <p>When clicking this button, the EX-Installer Device Monitor window will open, allowing you to interact with your device by sending commands and viewing the serial console output.</p> <p> For further details on using EX-Installer Device Monitor, continue on to the next page with the \u2018Next\u2019 button, or go straight to Using the EX-Installer Device Monitor.</p> <p>Next Steps - Test your setup\uf0c1</p> <p>IMPORTANT</p> <p>The programming track is for programming only. Make sure you are on the main track if you expect your loco to move or respond to light or sound commands.</p> <p>See the Testing your installation page or click the \u2018Next\u2019 button to learn how to test and use your EX\u2011CommandStation.</p>"},{"location":"installer/install-cs/#stored-configuration-files","title":"Stored Configuration Files","text":"<p>Click the Browse button and navigate through your computer\u2019s folders and files to select any file in the folder containing your existing configuration.</p> <p>On this screen you can edit the configuration files. If you have more than two files to edit, they will be separated into tabs as shown in the second figure above.</p> <p>NOTE: If you did not enable any options requiring myAutomation.h, and did not enable Create myAutomation.h, you will only be able to edit config.h on this screen.</p> <p></p>"},{"location":"installer/installer/","title":"EX-Installer","text":"<p>With the exception of a Command Station Booster1 Express CSB1 used solely as shipped with no accessories or options, you will need to download and install software to your Command Station or other DCC-EX products.</p> <p>This is managed by EX-Installer which is responsible for obtaining the relevant software and libraries, merging your custom configurations and mind-bending automations, locating the USB connection to your device,  compiling and downloading the result and showing the serial log from your device if required.</p> <p>Since every layout is essentially a prototype, and there are a huge variety of hardware build combinations, it is not possible to download a pre-built firmware package from the web.</p>"},{"location":"installer/installer/#warning-antivirus-software","title":"Warning Antivirus Software","text":"<p>You may need to turn off your antivirus software before you try to install, or you may be prompted to trust this executable.</p> <p>Sometimes our software gets blocked by antivirus applications. If you see any errors on the installation screen, this is usually the issue.</p>"},{"location":"installer/installer/#download-ex-installer","title":"Download EX-Installer","text":"<p>Windows x64 macOS Linux x64</p> <p>NOTE: There is no support for EX-Installer on Windows 7, nor 32-bit operating systems such as Windows x32 or RaspberryPi OS.</p>"},{"location":"installer/installer/#alternatives-to-the-ex-installer","title":"Alternatives to the EX-Installer","text":"<p>Experienced programmers or those wishing to develop new features or products will generally find VSCode/PlatformIO a more powerful and familiar option.</p> <p>Methods involving downloading zip files have caused  support issues in the past, are troublesome and not recommended.</p> <p>Use of the Arduino IDE is discouraged and not covered in this documentation as it has far less functionality than VSCode and has limitations with respect to compiler and library options.</p>"},{"location":"installer/overview/","title":"Using EX-Installer","text":"<p>We highly recommend using EX-Installer to configure and install EX-CommandStation, EX-IOExpander, and EX-Turntable.</p> <p>It is aimed to be easy to use, and also supports getting help and support by providing the mechanism to obtain log files and monitor your device which is necessary to provide sufficient information to get help.</p>"},{"location":"installer/overview/#installing","title":"Installing","text":"<p>This needs to outline the steps to install EX-Installer.</p>"},{"location":"installer/overview/#using-device-monitor","title":"Using Device Monitor","text":"<p>Instructions on using Device Monitor.</p> <p>Testing a link to dcc-ex.com</p> <p>Test an internal link to EX-IOExpander</p>"},{"location":"installer/platformio/","title":"Advanced Users - VSCode/PlatformIO","text":"<p>TODO - provide setup help.</p>"},{"location":"installer/select-product/","title":"Select Product to Install","text":"<p>Select which product you want to install</p> <p></p>"},{"location":"news/","title":"DCC-EX News","text":""},{"location":"news/#get-this-in-your-rss-feed","title":"Get this in your RSS feed","text":"<p>Notes on how to get the RSS feed here when figured out.</p>"},{"location":"news/2025/06/new-documentation/","title":"New Documentation","text":"<p>We have new documentation!</p> <p>We've changed our documentation.</p> <p>Need to highlight reclassification of products.</p> <p>Need to link to legacy docs.</p>"},{"location":"products/getting-started/","title":"Getting Started with DCC-EX","text":"<p>If you are just starting here for the first time, it's more than likely you are interested in the possibility of using a DCC-EX Command Station to run some trains.</p> <p>A Command Station is the electronic device that translates throttle commands, such as telling a loco to move, into electronic signals sent on the track to the loco. </p> <p>These signals are usually DCC  (Digital Command Control) which allows commands that control multiple locos on the same piece of track.</p> <p>However, the DCC-EX Command Station is also capable of running DC (Direct Current) locos as there are millions of them still in use.</p> <p>You have the option to buy a DCC-EX Command station ready-to-run or build it yourself from cheaper parts.</p> <p>You will probably want to install a throttle on your phone/tablet. You can get the preferred Engine Driver here </p>"},{"location":"products/products/","title":"DCC-EX Product Overview","text":"<p>The DCC-EX team has designed and released various different open source products aimed at making model trains accessible to more people.</p> <p>This page briefly outlines each of our products, the experience level you need to be able to use them, and links to more information.</p>"},{"location":"products/products/#conductor-level","title":"Conductor Level","text":"<p>These are our easy to use, get up and running quickly type products. You don't need to pick up a soldering iron or write any software, just plug them in and go!</p> <p>NOTE: You may need to install some software on your computer to take advantage of some of these, but our documentation will walk you through that process.</p> <p></p>"},{"location":"products/products/#ex-commandstation-booster-1-express","title":"EX-CommandStation Booster 1 Express","text":"<p>A ready-to-run, all in one Command Station and Booster with built-in WiFi preloaded with our flagship train control, layout animation and automation software. </p> <p>For more information on this and how to purchase, head over to the EX-CSB1 product page</p> <p>You can learn more about the software in the EX-CommandStation documentation.</p>"},{"location":"products/products/#ex-webthrottle","title":"EX-WebThrottle","text":"<p>This is the easiest way to validate you've connected your command station correctly to your track. Just load it up in your Chromium based web browser (Edge, Chrome, Opera) after connecting your command station to your computer and you can run your trains with it.</p> <p>To access it, refer to the EX-WebThrottle documentation.</p>"},{"location":"products/products/#ex-toolbox","title":"EX-Toolbox","text":"<p>For Android phone users, this is an extremely useful tool to help with configuring various aspects of your trains, command station, and accessories.</p> <p>You can download it here </p> <p>TODO ... Refer to the EX-Toolbox documentation for how to install and use it.</p>"},{"location":"products/products/#tinkerer-level","title":"Tinkerer level","text":"<p>These products are more involved to get up and running, and aren't just plug in and go.</p> <p>You will need to perform some assembly and configure and install some software to take advantage of these ones, but you won't need to solder anything.</p> <p></p>"},{"location":"products/products/#ex-commandstation-recommended-self-build-option-diy","title":"EX-CommandStation Recommended Self Build Option (DIY)","text":"<p>A supported DIY stack for EX-CommandStation using an Arduino Mega + EX-MotorShield8874 (or Arduino R3 Motor Shield) + EX-WiFiShield8266 (optional).</p> <p>If you want to build it yourself, this is our recommended setup which simply requires some assembly and software installation with no advanced modifications required.</p> <p>Refer to the Easy build Arduino Mega page for information on what to buy and how to assemble.</p>"},{"location":"products/products/#ex-motorshield8874","title":"EX-MotorShield8874","text":"<p>A dual channel, 5 amp (per channel) motor shield designed specifically for DCC-EX in an Arduino shield format.</p> <p>Assembly is required to add this to an Arduino Mega along with software configuration.</p> <p>Refer to the EX-MotorShield8874 page for more information.</p>"},{"location":"products/products/#ex-wifishield8266","title":"EX-WiFiShield8266","text":"<p>A WiFi shield designed specifically for DCC-EX in an Arduino shield format.</p> <p>Assembly is required to add this to an Arduino Mega along with software configuration.</p> <p>Refer to the EX-WiFiShield8266 page for more information.</p>"},{"location":"products/products/#engineer-level","title":"Engineer level","text":"<p>These products are far more involved and complicated to get up and running.</p> <p>This products go beyond simple assembly and you will need a good understanding of configuring software and hardware, including soldering components and making some modifications to existing hardware devices.</p> <p>If you are new to DCC-EX and/or electronics in general, we do not recommend you try to tackle any of these products until you have become familiar with how our products work.</p>"},{"location":"products/products/#ex-commandstation-advanced-self-build-diy","title":"EX-CommandStation Advanced Self Build (DIY)","text":"<p>A more complex DIY stack for EX-CommandStation using Espressif ESP32 or STMicroelectronics Nucleo microcontrollers. Some modifications may be required depending on the device chosen, and there are various nuances to be aware of when assembling and configuring these DIY options.</p> <p>You will need to need to be careful when configuring and installing software on these devices also.</p> <p>Refer to the EX-CommandStation DIY Pages for information on what options are available and supported.</p>"},{"location":"products/products/#ex-fastclock","title":"EX-FastClock","text":"<p>An integrated fast clock for your layout.</p> <p>While it's possible to get up and running with this fairly easily, there is still some software configuration and installation to be performed which makes this a little more complicated.</p> <p>Refer to the EX-FastClock documentation for how to get up and running.</p>"},{"location":"products/products/#ex-turntable","title":"EX-Turntable","text":"<p>An integrated turntable/traverser controller using a stepper motor.</p> <p>The software and integration side of EX-Turntable is reasonably straight forward, however the mechanics of getting a turntable operational with a stepper motor and the required sensors to control the location of the turntable accurately is quite involved.</p> <p>Refer to the EX-Turntable documentation for what's required and how to get up and running.</p>"},{"location":"products/products/#ex-dccinspector","title":"EX-DCCInspector","text":"<p>A diagnostic tool to inspect DCC packets.</p> <p>This requires some assembly and soldering to get up and running, and you will need to understand various aspects of the DCC protocol to get the most out of it.</p> <p>Refer to the EX-DCCInspector documentation for more information.</p>"},{"location":"products/products/#ex-ioexpander","title":"EX-IOExpander","text":"<p>Driven by a shortage of I2C connected I/O expansion devices, EX-IOExpander allows you to use various Arduino devices to expand the I/O capabilities of your command station.</p> <p>However, this does mean you will need to understand I2C connectivity and will likely need some more complex assembly and/or soldering to use this on your layout.</p> <p>Refer to the EX-IOExpander documentation for more information.</p>"},{"location":"products/products/#ex-sensorcam","title":"EX-SensorCAM","text":"<p>Provides up to 80 sensors for your layout using an ESP32 based camera solution.</p> <p>Refer to the EX-SensorCAM documentation for more information.</p>"},{"location":"products/ex-commandstation/config-h/","title":"Build configuration (config.h)","text":"<p>During compilation and build, there are a number of settings that control the way the code is constructed and important features are configured.</p> <p>Most configuration takes place in EXRAIL but some things just need setting before that.</p> <p>If you are using the EX-Installer, the important options will be automatically managed and configured. There are several more advanced options covered in the config.h advanced but these should not trouble the vast majority of users.</p> <p>These options should be coded in the file <code>config.h</code> which will be automatically included in the compilation process.</p>"},{"location":"products/ex-commandstation/config-h/#motor-shield-definition-mandatory","title":"Motor shield definition (Mandatory)","text":"<pre><code>#define MOTOR_SHIELD_TYPE typeName\n</code></pre> <p>The motor shield definition tells the code how many tracks your command station has and which pins are used to talk to the motor shield(s). It also describes the electrical characteristics of the current sensing and the current limits to be applied to each track.</p> <p>There are a number of pre-defined motor shield typeNames available of which the most common are:</p> <ul> <li>STANDARD_MOTOR_SHIELD : Arduino Motor shield Rev3 based on the L298 with 18V 2A per channel</li> <li>EX8874_SHIELD         : DCC-EX TI DRV8874 based motor shield</li> <li>EXCSB1                : DCC-EX CSB-1 hardware</li> <li>EXCSB1_WITH_EX8874    : DCC-EX CSB-1 hardware with DCC-EX TI DRV8874 shield</li> <li>NO_SHIELD             : CS without any motor shield (as an accessory only CS)</li> </ul> <p>Further pre-defined shield names can be found in the code file MotorDrivers.h although their presence there does not necessarily mean that we can provide support for issues.</p>"},{"location":"products/ex-commandstation/config-h/#wifi-settings","title":"WiFi settings","text":"<p>Ignore this if you do not have WiFi on your command station or choose to avoid it.</p> <p>WiFi has two operating modes:</p> <ul> <li>AP (Access point) means the Command station acts as its own private WiFi network so throttle devices must connect first to the Command Station Wifi network.</li> <li>STA (Station mode) means the command station connects to your WiFi router and appears as a device on that network. If the WiFI is configured for STA mode, but fails to connect to your router, it will fall back to AP mode in much the same way as smart plugs, lights etc.</li> </ul>"},{"location":"products/ex-commandstation/config-h/#setup-sta-station-mode","title":"Setup STA (Station) mode","text":"<pre><code>#define ENABLE_WIFI true\n#define WIFI_SSID \"deadBudgie\"\n#define WIFI_PASSWORD \"myHovvercraftIsFullOfEels\"\n</code></pre>"},{"location":"products/ex-commandstation/config-h/#setup-ap-access-point-default-mode","title":"Setup AP (Access Point) default mode","text":"<pre><code>#define ENABLE_WIFI true\n</code></pre> <p>The WiFi chip will first try to connect to the previously configured network and if that fails fall back to Access Point mode.</p> <p>The SSID of the AP will be automatically set to <code>DCCEX_*</code> where the <code>*</code> part is taken from an internal device number (for example <code>DCCEX_12b7c</code>) to try and avoid duplications. The password will be set to <code>PASS_*</code> where the <code>*</code> part matches the generated SSID name.</p>"},{"location":"products/ex-commandstation/config-h/#setup-ap-access-point-advanced-mode","title":"Setup AP (Access Point) advanced mode","text":"<pre><code>#define ENABLE_WIFI true\n#define WIFI_FORCE_AP true\n#define WIFI_SSID \"MyCSB1\"\n#define WIFI_PASSWORD \"Don't tell him Pike!\"\n#define WIFI_CHANNEL 1\n</code></pre> <p>The AP mode password must be at least 8 characters long.</p> <p>The default channel is set to \"1\". Use a phone WiFi analyser app to see which channels are relatively quiet in your area. If you need to use an alternate channel (we recommend using only 1,6, or 11) you may change it here.</p> <ul> <li>WIFI_HOSTNAME: The default is \"dccex\" but you can change this if you have more than one CS on you home router to make them show up with different names on the network. Host names starting with \"dccex\" are more readily found by WiFi throttles.</li> </ul> <pre><code>#define WIFI_HOSTNAME \"dccex-csb1\"\n</code></pre> <p>In some environments you may want to hide the SSID from phones scanning for access points. If you do hide the SSID, it is still possible to connect by entering the SSID manually on the phone/tablet.</p> <pre><code>#define WIFI_HIDE_SSID\n</code></pre>"},{"location":"products/ex-commandstation/config-h/#ethernet-settings","title":"Ethernet settings","text":"<p>It is not valid to enable Ethernet and WiFi at the same time.</p> <pre><code>#define ENABLE_ETHERNET true\n</code></pre>"},{"location":"products/ex-commandstation/config-h/#lcdoled-support","title":"LCD/OLED support","text":"<p>The LCD feature requires an I2C enabled LCD screen using a Hitachi HD44780 controller and a commonly available PCF8574 based I2C 'backpack'. To define LCD_DRIVER for I2C address 0x27, 16 cols, 2 rows</p> <pre><code>#define LCD_DRIVER  0x27,16,2\n</code></pre> <p>For an OLED display define OLED_DRIVER [address,]width,height in pixels (address auto detected if not supplied)</p> <p>128x32 or 128x64 I2C SSD1306-based devices are supported. Use 132,64 for a SH1106-based I2C device with a 132x64 display.</p> <p>For example</p> <pre><code>#define OLED_DRIVER 132,64\n</code></pre> <p>OR</p> <pre><code>#define OLED_DRIVER 0x3c,132,64\n</code></pre> <p>Define scroll mode as 0, 1 or 2</p> <ul> <li>0 is scroll continuous (fill screen if possible),</li> <li>1 is by page (alternate between pages),</li> <li>2 is by row (move up 1 row at a time).</li> </ul> <pre><code>#define SCROLLMODE 1\n</code></pre> <p>In order to avoid wasting memory the current scroll buffer is limited to 8 lines.  Some users wishing to display additional information such as TrackManager power states have requested additional rows aware of the warning that this will take extra RAM.  if you wish to include additional rows</p> <pre><code>#define MAX_CHARACTER_ROWS 12\n</code></pre>"},{"location":"products/ex-commandstation/config-h/#disable-eeprom","title":"Disable EEPROM","text":"<p>The EEPROM feature is only there for backward support of deprecated methods of turnout, sensor and output creation inherited from DCC++. You are advised to turn this off to save memory.</p> <pre><code> #define DISABLE_EEPROM\n</code></pre>"},{"location":"products/ex-commandstation/config-h/#delayed-startup","title":"Delayed startup","text":"<p>Some newer 32bit microcontrollers boot very quickly, so powering on I2C and other peripheral devices at the same time may result in the CommandStation booting too quickly to detect them.</p> <p>To work around this, set STARTUP_DELAY to a value in milliseconds that works for your environment.</p> <pre><code> #define STARTUP_DELAY 3000\n</code></pre>"},{"location":"products/ex-commandstation/dc-running/","title":"Running a DC layout","text":"<p>Using a DCC-EX Command Station to run a DC layout provides a number of advantages over conventional DC systems.</p> <ul> <li>All Wifi and connected throttles will operate the same for DC and DCC</li> <li>Momentum can be defined for acceleration and braking</li> <li>Multiple DC blocks can be independently controlled and reconfigured to allow crossing between blocks and polarity reversal</li> <li>EXRAIL automation can be used to run trains, create routes, switch block relays, control signals, manage reversing loops etcetera</li> <li>PWM Frequency can be adjusted to suit your locos and/or reduce noise with a touch of the F29-F31 keys</li> <li>It is possible to run parts of the layout with DC and other parts with DCC at the same time (But do not leave a DC loco on a track configured for DCC)</li> </ul>"},{"location":"products/ex-commandstation/dc-running/#basic-funtionality","title":"Basic funtionality","text":"<p>The command station has Track Manager commands that can change each track output to DC with appropriate polarity.  By associating a numeric locoid (1..10239 the same range as DCC) with each track output the command station accepts incoming DCC throttle commands (Or EXRAIL automation commands) for that locoid and converts it to a DC output on every track output with the same locoid.</p> <p>The throttles or EXRAIL are unaware that they are driving a DC track and so any DCC Throttle such as Engine Driver that can talk to DCC-EX will work for DC. In effect, in DC mode, the throttle drives the track compared with DCC mode where the throttle drives the loco.</p> <p>Although the CSB-1 can be switched to DC operation by commands from the throttle (Engine Driver has a Track Manager panel to help do this) it is generally easier, for a fully DC layout, to configure it so that it starts up in the desired mode.</p> <p>Warning: The sometimes-suggested technique of using a DCC decoder to output to a DC track instead of a motor is NOT RECOMMENDED as most decoders are not tolerant of a short between the motor outputs. This means a common track short could destroy an expensive decoder.</p>"},{"location":"products/ex-commandstation/dc-running/#configuring-default-outputs","title":"Configuring Default Outputs","text":"<p>The normal configuration method for DCC-EX Command Station is to use EXRAIL to define things like:</p> <ul> <li>What turnouts or signals you have and how they are electronically driven</li> <li>What happens at startup</li> <li>What routes can a throttle set</li> <li>What automations can a throttle send a loco along</li> <li>Buttons and lights on a mimic panel</li> </ul> <p>all of which apply equally to DC operation, plus:</p> <ul> <li>How track blocks are set for DC and which locoid thay are mapped to</li> </ul> <p>To start this you need to follow the Installer process described here and create an AUTOSTART section in your myAutomation.h file to set the track manager options suitable for your layout:</p> <pre><code>AUTOSTART \n   SETLOCO(1)\n   SET_TRACK(A,DC)\n   SET_POWER(A,ON)\n   SETLOCO(2)\n   SET_TRACK(B,DC)\n   SET_POWER(B,ON)\n   DONE\n</code></pre> <p>This sequence will run as the command station starts up it will</p> <ul> <li>associate locoid 1 with track A and switch it to DC.</li> <li>associate locoid 2 with track B and switch it to DC.</li> <li>turn track power on. No power will be seen on the track until a throttle is used, but unless you SET_POWER ON the track will never receive power.</li> </ul> <p>Where the command station has 4 or more track outputs, you can also setup tracks C to H as appropriate.</p>"},{"location":"products/ex-commandstation/dc-running/#switching-between-tracks","title":"Switching between tracks","text":"<p>In a simple DC double-track oval, the tracks are wired in opposite directions so that driving \"forward\" is in opposite directions on each oval.</p> <p>If you introduce turnouts that allow a train to cross from one track to another, it is necessary to switch the polarity of the \"to\" track to match that of the \"from\" track, switch the turnouts and associate the \"to\" track with the same locoid as the \"from\" track so that the throttle user can simply drive across the join.</p> <p>EXRAIL ROUTEs (they go in the same file as the configuration setup above) are ideal for this and can be activated from throttle buttons. For example, we assume the outer loop is track A locoid 1 and the inner Track B locoid 2.</p> <pre><code>ROUTE(12,\"Drive from outer to inner loop\")\n  SETLOCO(1)\n  SET_TRACK(B,DCX)  // reverse polarity on track B and treat as loco 1\n  SET_POWER(B,ON)\n  THROW(100) THROW(101) // throw the turnouts that join the tracks\n  DONE\n\nROUTE(21,\"Drive from inner to outer loop\")\n  SETLOCO(2)\n  SET_TRACK(A,DCX)  // reverse polarity on track B and treat as loco 1\n  SET_POWER(A,ON)\n  THROW(100) THROW(101) // throw the turnouts that join the tracks\n  DONE\n\nROUTE(99,\"Restore tracks to normal\")\n  CLOSE(100) CLOSE(101)  // close the turnouts  \n  SETLOCO(1)\n  SET_TRACK(A,DC)\n  SET_POWER(A,ON)\n\n  SETLOCO(2)\n  SET_TRACK(B,DC)\n  SET_POWER(B,ON)\n  DONE\n</code></pre> <p>Notice that when you apply ROUTE(12), you are now driving on both tracks with the same loco id 1. Throttles attempting to drive loco id 2 will be ignored.</p> <p>As you get more advanced, the routes can be programmed to happen automatically or contain additional items such as signals, sounds, mimic panel control and so on.</p>"},{"location":"products/ex-commandstation/dc-running/#reversing-loops","title":"Reversing Loops","text":"<p>In contrast to DCC, a DC reversing loop must have the polarity to correctly represent the direction of the loco. Thus the loop part will require the polarity to control the direction of the train around the loop. while the train is in the loop, the main track leading into the loop must be switched to allow the train to exit the loop and continue back along the track without reversing the locomotive. There is no automatic polarity reversing for DC layouts, this must be programmed using EXRAIL to suit the topology of your layout.</p>"},{"location":"products/ex-commandstation/dc-running/#more-blocks","title":"More blocks","text":"<p>The separate track outouts supplied by the Command Station represent the number of separate throttle ids that may be operating. Like any large DC layout, the switching of throttle outputs to multiple other blocks can still take place using mechanical switches or relays which can be controlled by suitable EXRAIL sequences. Power routing turnouts operate as normal but may be awkward if you are building a new layout with tyhe intention of running DCC later.</p> <p>If you have several throttles operating the same locoid, they will automatically synchronise with each other.</p>"},{"location":"products/ex-commandstation/ex-csb1/","title":"EX-CSB1 CommandStation Booster","text":"<p>This is the EX-CSB1 Getting Started Guide.</p>"},{"location":"products/ex-commandstation/ex-csb1/#features","title":"Features","text":"<p>The DCC-EX EX-CSB1 Command Station/Booster comes ready to use out of the box and has the following features:</p> <ul> <li>Dual DCC/PWM DC outputs with up to 5A capacity \u2013 easily expandable to 4 outputs</li> <li>Wi-Fi built-in \u2013 fast 802.11n capable, with Access Point and Station modes including support for connecting as many as 10 Wi-Fi throttles (you can also connect to JMRI via Wi-Fi, but a USB cable is often better)</li> <li>Single power supply for track and onboard electronics \u2013 12-25V DC with polarity protection</li> <li>USB-C connector \u2013 for software upload, diagnostic monitoring, DCC-EX WebThrottle and JMRI connectivity</li> <li>Railsync DCC input \u2013 enables Booster or Sniffer modes, which with an EXRAIL script can be automatically engaged on receipt of a signal</li> <li>OLED screen \u2013 for diagnostics, status and information display</li> </ul> <p></p>"},{"location":"products/ex-commandstation/ex-csb1/#connecting","title":"Connecting","text":"<p>The DCC-EX EX-CSB1 Command Station/Booster needs the minimum following connections to be able to run trains:</p> <ul> <li>Power input on the 2.1mm black barrel connector \u2013  accepts 10-25V DC fully regulated, preferably a modern switch-mode power brick, double-insulated with good power overload protection. Minimum current capability of 4A, suggested 12-16V for Z, N or HO/OO scales, with DCC+Sound locos generally wanting 14-16V even in N scale.</li> <li>One track connection \u2013 on either the Track Out A (topmost) or Track Out B (beside the power) connector. Note that by default, A is configured for DCC MAIN operation, and B is configured for PROG or programming track. We recommend connecting your track to the A MAIN output initially to test running of trains. </li> </ul> <p>When correctly supplied with track power, both green Power LEDs will light. If the right-most LED alone is lit, it indicates power is being supplied from the USB-C connector so software upload can proceed, but trains cannot be run.</p> <p>The Wi-Fi LED will light once a Wi-Fi network is created (Access Point mode), or once connected to an existing Wi-Fi network (Station mode.)</p> <p>Other Connectors:</p> <ul> <li>Qwiic I2C connector \u2013 allows a broad range of 3.3V I2C peripherals to be easily with simple cables.</li> <li>Railsync connector \u2013 allows connection to Railsync or a DCC track signal for Booster and Sniffer modes when enabled with suitable software configuration.</li> </ul>"},{"location":"products/ex-commandstation/ex-csb1/#booster-mode","title":"Booster mode","text":"<p>When configured correctly, connecting a Railsync or DCC signal to the Railsync connector will enable your EX-CSB1 to operate as a booster.</p> <p>Refer to the EX-CSB1 in DCC Booster Mode page for information on how to configure the software to enable this.</p>"},{"location":"products/ex-commandstation/overview/","title":"The DCC-EX Command Station","text":"<p>A DCC Command Station powers your track and sends digital signals to the locos and accessories through the track. All commercial command stations do that, but we think we do it a lot better for a lot less money.</p> <p>Our primary solution is the EX-CSB1 CommandStation which provides a ready-to-run system with integrated WiFi. You can start running trains from your Android phone in a couple of minutes if you plug your track in one end and a power supply in the other.</p> <ul> <li> <p>If you want to buy a ready built command station, see Purchase a Command Station and come back here to learn about it while you are waiting for the delivery.</p> </li> <li> <p>If you want to build your own command station and are prepared to learn about Arduinos see Building your own Command station but you are advised to read the basic guidance that follows so you will have a better understanding of what you want to achieve, and what will be possible.</p> </li> <li> <p>If you already have a DCC-EX command station, read on.</p> </li> </ul> <p>To follow the basic setup process, you can use the \"next\" button seen at the bottom right of each page.</p>"},{"location":"products/ex-commandstation/testing/","title":"Testing your Command Station","text":"<p>(LOTS OF TODO in this file)</p> <p>The simplest and most direct testing method is to use a serial monitor to talk directly to the USB connection of you command station. This is a fundamental aspect of the Arduino system and thus avoids issues such as wifi connections. Indeed, this is the only way to see what's going wrong if your problems are wifi related.</p>"},{"location":"products/ex-commandstation/testing/#serial-monitors","title":"Serial Monitors","text":"<p>There are several serial monitors available:</p> <p>Instructions on using Device Monitor.</p> <p>Testing a link to dcc-ex.com</p> <p>Test an internal link to EX-IOExpander</p> <ul> <li>Built in to the EX-Installer     ??? TODO EX INSTALLER showing serial log</li> <li>Built in to VSCode is you are using that as an IDE.</li> <li>Built in to the Arduino IDE (We do not recommend that for development)</li> <li>Built in to the EX-WebThrottle</li> <li>Built in to JMRI or other train control software. (TODO.. above provide links to individual side-pages showing how to get at the serial monitor in each case)</li> </ul> <p>Whichever you use, please ensure the baud rate is set to 115200 so that it matches that used by the command station. (Installer anf WebThrottle do this automatically)</p> <p>Its important to note that only one program on your PC can be connected to the Command Station USB. It is a common cause of error messages if you try and open a serial monitor when one of the other programs is still running.</p> <p>In most cases, connecting a serial monitor causes the Command station to restart.</p>"},{"location":"products/ex-commandstation/testing/#simple-testing-commands-main-track","title":"Simple testing commands (Main track)","text":"<p>Commands are entered as shown, complete with the <code>&lt; &gt;</code> markers. Case is important because <code>&lt;T</code> is a completely different command to <code>&lt;t</code></p>"},{"location":"products/ex-commandstation/testing/#check-communication-and-version","title":"Check communication and version","text":"<pre><code>&lt;s&gt;\n</code></pre> <p>TODO... pic</p>"},{"location":"products/ex-commandstation/testing/#turn-on-track-power","title":"Turn on track power","text":"<p><code>&lt;1&gt;</code> will turn on all 4 leds that lie behind the track output sockets.</p> <p><code>&lt;0&gt;</code> Will turn the tracks off.</p>"},{"location":"products/ex-commandstation/testing/#move-a-loco","title":"Move a loco","text":"<p>You can only drive a loco if you know the loco DCC address. For a brand new loco or decoder this is normally preset to 3. If you don't know the loco address, then you can find out using the simple programming commands</p> <p>Assuming you know the loco address is 3, the following commands may be useful:  </p> <p><code>&lt;!&gt;</code> Emergency stop all locos</p> <p><code>&lt;t 3 50 1&gt;</code>  Move loco 3 speed 50 forward.</p> <p><code>&lt;t 3 20 0&gt;</code>  Move loco 3 speed 20 reverse.</p> <p><code>&lt;t 3 0 1&gt;</code>  Stop loco 3 (decoder may stop loco realistically)</p> <p><code>&lt;t 3 -1 1&gt;</code>  Emergency Stop loco 3</p>"},{"location":"products/ex-commandstation/testing/#test-loco-functions","title":"Test loco functions","text":"<p><code>&lt;F 3 0 1&gt;</code>   Turn on loco 3 function 0</p> <p><code>&lt;F 3 0 0&gt;</code>   Turn off loco 3 function 0</p>"},{"location":"products/ex-commandstation/testing/#things-to-remember","title":"Things to remember","text":"<p>The commands <code>&lt;t</code> and <code>&lt;F</code> will normally reply with a <code>&lt;l</code> response when something about a loco is changed. This response is designed for throttles to share information and not generally for human reading.</p> <p>A response of <code>&lt;X&gt;</code> indicates the command was not understood by the command station, so check your typing as <code>&lt;T</code> and <code>&lt;f</code> are not the same as <code>&lt;t</code> and <code>&lt;F</code>.</p> <p>DCC generally has no way of knowing whether the loco exists, is listening or has dirty wheels. If you get no movement the first thing to do is check the track is clean.</p>"},{"location":"products/ex-commandstation/accessories/accessories/","title":"Overview - What are Accessories?","text":"<p>Once you go beyond just wanting to run trains, and want to control turnouts (points), signals, turntables, and potentially automate other parts of your layout, you will need to know how to connect accessories to your Command Station.</p> <p>Within the DCC-EX ecosystem, an accessory is anything you can connect to or control from your EX-CommandStation which also includes our other products such as EX-FastClock, EX-IOExpander, EX-SensorCAM, and EX-Turntable.</p>"},{"location":"products/ex-commandstation/accessories/accessories/#accessory-types","title":"Accessory Types","text":"<p>Accessories are broadly divided into two categories:</p> <ul> <li> <p>Outputs:</p> <ul> <li>Turnouts or points</li> <li>Signals</li> <li>Turntables</li> <li>Lighting</li> <li>Servos</li> </ul> </li> <li> <p>Inputs:</p> <ul> <li>Sensors</li> <li>Push buttons</li> <li>Keypads</li> <li>Rotary encoders</li> <li>Clocks</li> </ul> </li> </ul> <p>Note that we consider throttles/controllers differently to accessories, so these are not covered in this section. See our Throttles section instead.</p>"},{"location":"products/ex-commandstation/accessories/accessories/#connecting-accessories","title":"Connecting Accessories","text":"<p>There are generally three ways accessories can be connected to and controlled by your Command Station:</p> <ul> <li>I2C</li> <li>Serial</li> <li>DCC accessories attached to a DCC main track output</li> </ul> <p>Throughout these pages, we will primarily be focusing on accessories connected via I2C.</p> <p>Most devices connected via Serial are typically throttles or controllers rather than accessories.</p> <p>When purchasing DCC accessories, you will have received a user manual for these, so follow that for instructions on how to connect them.</p>"},{"location":"products/ex-commandstation/accessories/accessories/#voltage-differences","title":"Voltage Differences","text":"<p>Danger</p> <p>It is essential to be aware that hardware devices may operate at different voltage levels, meaning simply connecting an accessory to your Command Station may lead to damage or incorrect operation should this situation occur.</p> <p>This applies to any peripheral device connected directly to your Command Station via either serial or I2C interfaces.</p> <p>The most common issue is connecting an accessory designed for 5V operation to a Command Station that operates at 3.3V, such as our EX-CSB1. This will cause damage!</p>"},{"location":"products/ex-commandstation/accessories/actuators/","title":"Actuators - to make stuff happen","text":"<p>Actuators are devices that you can add to make things happen under the control of the Command station. For example throwing a turnout, setting a signal or switching lights. There are basically two types of actuator that will commonly be used:</p> <ul> <li>PWM output used for Servo movement of turnouts, semaphore signals, crossing gates, fancy animations and LED fading.</li> <li>Digital output (On/Off) mostly used for LEDs, relays and some turnout types.</li> </ul> <p>Other actuator types include:</p> <ul> <li>NeoPixel output used for advanced lighting, mimic panels, signals etc.</li> <li>Sound players</li> <li>Turntable control systems</li> <li>Relay boards</li> </ul>"},{"location":"products/ex-commandstation/accessories/actuators/#servo-actuators","title":"Servo actuators","text":"<p>Servo actuators generally use a PCA9685 device which can connect up to 16 Servos or LEDs over a single I2C connection. This device also acts to provide servo movement power separately from the movement control signal.</p> <p>EXRAIL is used to</p> <ul> <li>Define the PCA9685 connection and its address so that each output can be given a unique VPIN to control it.</li> <li>For turnouts define a SERVO_TURNOUT for each VPIN so that the rest of DCC-EX can throw or close this turnout without knowledge of the underlying mechanism.</li> <li>For semaphore signals, define a SERVO_SIGNAL to that the rest of DCC-EX can control the signal.</li> <li>Control animation servos directly, such as crossing gates or shed doors.</li> </ul>"},{"location":"products/ex-commandstation/accessories/actuators/#digital-actuators","title":"Digital actuators","text":"<p>Digital outputs are generally connected via an MCP23017 device which offers up to 16 output pins on a single I2C connection. PCA9554, TCA9554, PCA9555, TCA9555 devices opereate in the same way as long as the relevant driver is used.</p> <p>EXRAIL is used to</p> <ul> <li>Define the MCP23017 (or other driver) connection and its address so that each output can be given a unique VPIN to control it.</li> <li>Set or reset the pin output when appropriate</li> </ul>"},{"location":"products/ex-commandstation/accessories/buying-i2c-devices/","title":"Buying I2C devices","text":"<p>There are many I2C devices available and the price/availability can vary widely depending on your location and delivery options. Where devices are very cheap, you may find quality issues and so expect a few duds.</p> <p>Some devices come with QWiic connectors which makes them easier to plug-and-play with the QWiic connector on your EX-CSB1 or EX8874 motor shield.</p> <p>In general, the Adafruit devices below are high quality and well documented but that is usually reflected in the price.</p> <ul> <li> <p>MCP23017 provides 16 pins for mixed input or output.(see details). This is good for:</p> <ul> <li>Up to 14 inputs from push-buttons, switches, sensors.</li> <li>Up to 16 outputs to LEDs and signals (which require current limiting resistors) and relays.</li> </ul> </li> <li> <p>PCA9685 provides up to 16 outputs for servos and LEDs (PWM pins used for V+ include resistors) (See details).</p> </li> <li> <p>PCA9548 multiplexor allows for I2C devices that must share the same I2C address (See details).</p> </li> <li> <p>NeoDriver provides an interface to NeoPixel chains of LEDs (See details).</p> </li> <li> <p>LTC4311 resolves electronic issues when the total of I2C wiring is greater than approximately 2m or 6ft (See details).</p> </li> <li> <p>QWiic wires make it easy to plug these devices together(See details).</p> </li> </ul>"},{"location":"products/ex-commandstation/accessories/buying-i2c-devices/#rosscoe-trains","title":"Rosscoe Trains","text":"<p>Rosscoe supplies I2c devices with QWiic sockets and additional power feeds which makes wiring much easier.</p> <p>The Rosscoe Shop is linked from our Third Party Products and Sellers page.</p>"},{"location":"products/ex-commandstation/accessories/connecting-servo-turnout/","title":"Connecting a servo turnout","text":"<p>The details below assume you are using an EX-CSB1 command station or a DIY station with an EX8874 motor shield and Wifi connection. Otherwise the steps are the same but the wiring is trickier without the Qwiic sockets and testing requires command input.</p> <p>You will need the following for up to 16 servos.</p> <ul> <li>Your Command Station with power supply and USB connection to your PC.</li> <li>Qwiic cable for connection to CSB1, with Qwiic or dupont connectors for connection to PCA9685.</li> <li>PCA9685 module</li> <li>Up to 16 SG90 servos</li> <li>EX-Installer downloaded on your PC</li> <li>(Optionally) Android phone with EX-Toolbox installed</li> <li>A servo power supply 5V 2A DC -- and not taken from the command station.</li> </ul>"},{"location":"products/ex-commandstation/accessories/connecting-servo-turnout/#follow-the-steps-below","title":"Follow the steps below","text":"<ol> <li>Turn off power to your Command station and unplug the USB cable and power supply.</li> <li>Connect the Qwiic cable between the CSB1 or EX8874 and the PCA9685 module.  When using Mega, the I2C bus is 5V. Use the I2C headers, where 5V is available (IOREF/Vdd). </li> <li> <p>Run the EX-Installer on your PC and select the cpu type, then the Serial Monitor. You should see output similar to the following where the Command Station enumerates all the I2C devices it can find. from the startup logs using the serial monitor</p> <pre><code>&lt;* I2C Device found at 0x3C, OLED Display or HMC583L Magnetometer? *&gt;\n&lt;* I2C Device found at 0x40, PWM? *&gt;\n. . .\nand then it shows the OLED is configured\n&lt;* 132x64 OLED display configured on I2C:0x3c *&gt;\n\nsend the command: &lt;D HAL SHOW&gt; to see the vPins configured\n&lt;* Arduino Vpins:2-39 *&gt;\n&lt;* PCA9685 I2C:0x40 Configured on Vpins:100-115  *&gt;\n&lt;* PCA9685 I2C:0x41 Configured on Vpins:116-131 OFFLINE *&gt;\n&lt;* MCP23017 I2C:0x20 Configured on Vpins:164-179 OFFLINE *&gt;\n&lt;* MCP23017 I2C:0x21 Configured on Vpins:180-195 OFFLINE *&gt;\n</code></pre> </li> <li> <p>Examine the log to check that your PCA9685 has been detected and note the I2C address it found. This will typically be 0x40. If this address is 0x40 or 0x41 then the CS has defaulted this to be a PCA9685 and automatically assigned a range of 16 VPINs to represent the 16 servo outputs.</p> </li> <li>Examine the log further down and you should see where the VPINs are assigned. The following advice assumes that the address was 0x40 and the first VPIN will be 100.</li> <li>Plug a servo into the first output socket. DO NOT mechanically connect the servo arm to any turnout or animation as the servo may move unexpectedly and cause physical damage.  You will connect the servo arm after exercising the servo (step 8).</li> <li>Connect the additional servo power supply to the long-edge turrets on the PCA9685, observing the correct polarity. </li> <li>On the installers serial monitor, enter the command <code>&lt;D SERVO 100 200&gt;</code> which should move the servo. Experiment with other positions than 200. The usable range is approximately 102 to 490.  </li> <li>(Optionally) Use the EX-Toolbox Andoid app to experiment with servo angles and servo arm lengths until you have the required throw distance and angles to suit your servo mounting preferences.</li> </ol>"},{"location":"products/ex-commandstation/accessories/connecting-servo-turnout/#define-your-turnouts","title":"Define your Turnouts","text":"<ol> <li> <p>In EX-Installer, edit myAutomation.h and define each turnout to give an id of your choice, the VPIN of the servo, the closed and open servo values you have discovered by experimentation and a suitable decription to show on your throttle.</p> <pre><code>//SERVO_TURNOUT( turnout_id, vpin, active_angle, inactive_angle, profile [, \"description\"|HIDDEN] )\nSERVO_TURNOUT(1, 100, 350, 120, Slow, \"Coal yard exit\")\nSERVO_TURNOUT(2, 101, 400, 200, Slow, \"Branch line siding\")\nSERVO_TURNOUT(3, 102, 400, 200, Slow, HIDDEN)\n</code></pre> </li> <li> <p>Reload the command station from the installer.</p> </li> </ol>"},{"location":"products/ex-commandstation/accessories/connecting-servo-turnout/#test-your-turnout-definitions","title":"Test your turnout definitions","text":"<ol> <li>Using the serial monitor as before, enter the commands <code>&lt;T 1 T&gt;</code> to throw turnout 1, <code>&lt;T 2 C&gt;</code> to close turnout 2 and so on.</li> <li>With your Wifi throttle (Typically Engine Driver) navigate to the turnouts page where you will see the two turnouts listed. From there you can throw or close them as required.</li> </ol>"},{"location":"products/ex-commandstation/accessories/connecting-servo-turnout/#connect-your-servos-to-turnouts","title":"Connect your servos to turnouts","text":"<p>There are many ways of mounting servos both above and below the baseboard using 3D printed mounts or a strip of plastic L shape. You will probably want to use microswitches to switch frog polarity or use more expensive frog juicers or EXRAIL driven relays.</p> <p>We recommend that whatever mechanical connection you make allows for protection of you turnout from excess servo movement.</p>"},{"location":"products/ex-commandstation/accessories/connecting-servo-turnout/#pca9685-configure-additional-boards","title":"PCA9685 Configure additional boards","text":"<p>The first two PCA9685 are pre-defined at addresses 0x40 and 0x41, for pins 100-115 and 116-131. Configure additional PCA9685 in myAutomation.h.</p> <pre><code>  HAL(PCA9685, 132, 16, 0x42)\n  HAL(PCA9685, 148, 16, {I2CMux_0,SubBus_4,0x43})\n</code></pre> <p>Nucleo-144 boards do not have pre-defined PCA9685 due to pin conflicts, as pins thru 116 are reserved for the microprocessor.  All PCA9685 connected to Nucleo-144 boards require configuration in myAutomation.h.</p>"},{"location":"products/ex-commandstation/accessories/hardware-list/","title":"Hardware device list","text":"<p>The following hardware devices, available from various sources, have support code built in to the Command Station. Some are commonly used in the electronics and Arduino market, others are specifically designed for model railway use.</p> <p>Although the devices are summarised here, you should refer to EXRAIL cookbooks for examples of how to use these, or refer to the appropriate source code, normally found in a file called IO_something.h (e.g. IO_PCA9685.h)</p> <ul> <li>ADS111x I2C-connected analogue input</li> <li>DCCAccessoryDecoder creates VPINs to drive DCC connected accessory decoders</li> <li>DFPlayer Serial connected MP3 player</li> <li>DS1307 Real time clock</li> <li>duinoNodes for DNIN8, DNIN8K and DNOU8 pin expanders</li> <li>EncoderThrottle for simple throttle driving with a rotary encoder</li> <li>EXFastclock connects to the EXFastClock product</li> <li>EXIOExpander connects to an EXIOExpander </li> <li>EXSensorCAM connects to the EXSensorCAM video sensor device</li> <li>EXTurntable connects to a  turntable device</li> <li>HALDisplay connects additional OLED or Liquid Crystal displays</li> <li>HCSR04 Ultrasonic distance measure</li> <li>I2CDFPlayer  MP3 sound player over I2C connection</li> <li>I2CRailcom connection to EXRailcomCollector device</li> <li>MCP23007 I/O expander</li> <li>MCP23017 I/O 16 bit pin expander</li> <li>NeoPixel Adafruit NeoPixel driver</li> <li>PCA9554 / TCA9554 8 bit pin expander</li> <li>PCA9555 / TCA9555 16 bit pin expander</li> <li>PCA9685 16 pin servo controller</li> <li>PCF8574 I/O expander</li> <li>PCF8575 I/O expander</li> <li>RotaryEncoder read encoder connected to a separate Arduino</li> <li>TCA8418 80-key keypad encoder</li> <li>TM1638  8-button, 8-led, 8 digit device</li> <li>TouchKeypad capacitative touch-pad based on the TTP229-B</li> <li>Trainbrains see trainbrains.eu </li> <li>VL53LOX time-of-flight</li> <li>XL95535 Multi-relay device</li> </ul>"},{"location":"products/ex-commandstation/accessories/i2c-intro/","title":"I2C \u2013 An Introduction","text":""},{"location":"products/ex-commandstation/accessories/i2c-intro/#what-is-i2c","title":"What is I2C?","text":"<p>If you want the nitty gritty of what I2C is, you can refer to the Wikipedia article, which covers more detail than we will here.</p> <p>To keep it simple and in the context of DCC-EX, I2C is a bus that allows multiple accessories or peripherals to be connected to your Command Station, utilising two signal lines/connections and a common ground connection. While power can be provided by your Command Station, it is recommended to have your accessories powered separately.</p> <p>Each I2C device must have a unique address in order to be detected and configured by the software.</p> <p>You will typically see these addresses in hexadecimal format, for example <code>0x40</code>.</p>"},{"location":"products/ex-commandstation/accessories/i2c-intro/#how-does-it-help","title":"How does it help?","text":"<p>Model trains come alive when we add points (turnouts), signals, sensors, lights, sounds and more. DCC-EX comes ready-equipped with the capability to add many such devices. In the hands of users experienced in electronics, DCC-EX can support hundreds of such devices using a connection system called I2C \u201cI Squared C\u201d which is built-into your Command Station. While I2C is very powerful, it is not a consumer plug and play set up. If you have not used it before and are not experienced in electronics, you will need to teach yourself some new skills \u2013 which can be fun and which also creates its own challenges.</p> <p>To help Conductors to get up the learning curve, we have 3 proven and essential building blocks that will get you there as smoothly as possible. We ask new users to closely follow all 3 of these, as otherwise our volunteer support teams get overwhelmed with support requests as the success of the DCC-EX venture grows.</p> <p>The 3 I2C building blocks we very strongly request Conductors build for themselves are:</p> <ul> <li> <p>Firstly, we have developed a set of tightly-specified components and configurations that we know work well in practice. Yes, you can often find cheaper individual components but these are a false economy as they are often poorly manufactured, meaning they may not work at all, causing frustration and a non-functioning model train layout. Please use these configurations initially, so that you can get used to the I2C system before becoming more adventurous.</p> </li> <li> <p>Secondly, there are new skills to learn and new terms to become familiar with if you are to be able to understand why your own set up is or is not working. You will hear terms like pullup resistors, logic voltage level, clock and data lines bandied about. Some of these you\u2019ll need to understand well, others can wait. Self-education on I2C therefore is vital for Conductors to enjoy your deployment of I2C from the very beginning. We have curated a number of videos and guides that we know to be helpful. There is even a foundation set that we strongly urge new users to watch, so that you understand the basics of I2C.</p> </li> <li> <p>Third, even when using a configuration that is known to work, you will be using a number of cables to connect items and it is very common to have problems caused by inadvertently swapping cables, or simply poor connections, which can cause things not to work, or worse, be damaged. The use of a multimeter to confirm correct set up and to troubleshoot any issues arising is mission critical. Yes, we are strong on this point because it is such a vital tool for you to enjoy this aspect of your hobby and for our support teams to guide you through any problems you may encounter.</p> </li> </ul> <p>Using these 3 proven building blocks together, you will likely have a successful installation. If you choose to ignore these, you will probably find a multitude of unexpected and unknown issues and join the ranks of users that can\u2019t get their accessories to work and don\u2019t understand why.</p>"},{"location":"products/ex-commandstation/accessories/sensors/","title":"Sensors","text":"<p>Sensors become necessary when you wish to add automated control of accessories or trains, or you wish to add a control panel separate from the functions of your throttle. Each sensor device can trigger actions or be read in EXRAIL or be passed up to a PC controller such as JMRI, RocRail or iTrain.</p> <p>Sensor devices include</p> <ul> <li>Switches and buttons on a control panel</li> <li>InfraRed or ultrasonic detectors when a train crosses a point on the track</li> <li>Video camera using AI to detect train position or children's hands reaching over the layout</li> <li>Block Occupancy (or Train-on-track, TOTI) detectors that detect the current consumed by a loco decoder or resistor-fitted rolling stock when present in an isolated track block.</li> </ul>"},{"location":"products/ex-commandstation/accessories/sensors/#tracklayout-sensors-for-automation","title":"Track/Layout sensors for automation","text":"<p>There are basically 2 very different types of track sensor.....</p> <ul> <li> <p>Block occupancy sensors, described above.</p> </li> <li> <p>Position sensors (IR, reed switch, or camera) that detect something reaching a specific point on the layout.</p> </li> </ul> <p>The problem with BOTH these systems is that the sensors do not know the DCC address of the loco involved. Unlike the old DC system, you cant just have a bit of track switch off to stop a loco.... you need to send a message to it when you know its id.</p> <p>Also block occupancy is no help if you think in terms of \"the block isn't occupied so I can go into it\" because you don't know if another train is already heading towards that block at 300kph.. (single line working or anything involving a crossover)</p> <p>Automation in DCC-EX is much simpler if you forget the \"Oh, a train is approaching signal x which is red so I now need to find out which train it is and tell it to stop\" and start thinking from the perspective of a driver...</p> <p>It's much simpler to think \"Im proceeding along track 4 in a westerly direction and when I get to the footbridge I must look ahead at signal x and start braking, then carry on to the coal yard and stop at the buffers.\" Position sensors are ideal for this kind of thing, block occupancy just doesnt cut it.</p> <p>EXRAIL makes this stuff easy.... \ud83d\ude01  but you have to start with the right perspective.</p>"},{"location":"products/ex-commandstation/accessories/sensors/#defining-sensors","title":"Defining sensors","text":"<p>EXRAIL is used to describe how the sensor devices are wired to the command station (usually via I2C) and what VPIN is to be assigned to each sensor</p> <p>The most common method of connecting sensor devices to your command station is through an MCP23017 device which offers up to 14 input pins (or 16 output pins, or a mix of both) through a single I2C connection. For more inputs you can add more MCP23017 devices to the I2C chain.</p> <p>The EX-IOExpander can be used to connect multiple sensors over a single I2C connection depending on the microprocessor used to build it.</p> <p>The EX-SensorCam can be used to offer up to 80 sensor points on a single I2C connection.  </p>"},{"location":"products/ex-commandstation/accessories/various-devices/ds1307/","title":"DS1307 Real Time clock chip","text":"<p>The DS1307 device contains a battery backed real time clock which can be read over I2C by the IO_DS1307 driver. The usual I2C address is 0x68 and the clock is defined as follows with a suitable VPIN number of your choice.</p> <pre><code>HAL(DS1307,444,0x68)\n</code></pre> <p>The clock must be manually set when first used, on a time-zone change or when it had drifted (They are not as accurate as a quartz watch). You may also prefer to change the clock to suit the time of day you are modelling rather then the real time.</p> <p>The clock is set with a serial command <code>&lt;z vpin hh mm ss&gt;</code> to write to the chosen VPIN using the 24hour clock.</p> <p>For example:</p> <pre><code>&lt;z 444 13 25 15&gt;\n</code></pre> <p>The driver will monitor the clock and will invoke EXRAIL time events every minute (synchronized with the 0 seconds of the clock)</p> <ul> <li> <p>ONTIME(minute_in_day) Start task here when clock matches the minute_in_day value (0..1439) </p> </li> <li> <p>ONCLOCKTIME(hours,mins) Starts task at given time</p> </li> <li> <p>ONCLOCKMINS(mins) Start task here hourly when clock minutes matches.</p> </li> </ul> <p>You can stack the ON* handlers in EXRAIL so the example below will trigger every 15 minutes.</p> <pre><code>ONCLOCKMINS(0)\nONCLOCKMINS(15)\nONCLOCKMINS(30)\nONCLOCKMINS(45)\n  PRINT(\"something happened\")\n  ... do something clever\nDONE\n</code></pre> <p>An analog read in EXRAIL <code>IFGTE(vpin, value)</code> etc will check against the hh*60+mm time.</p>"},{"location":"products/ex-commandstation/accessories/various-devices/dfplayer/dfplayer/","title":"DFPlayer Sound player","text":"<p>The DFPlayer device van be used to play pre-recorded sounds from an onboard SD-card.</p>"},{"location":"products/ex-commandstation/accessories/various-devices/dfplayer/dfplayer/#suggested-uses","title":"Suggested uses","text":"<p>An example of a layout line side sound scenario of what can be achieved with two or more DFPlayers:</p> <ol> <li>Background ambiance sound of a grand central station (repeat sound file on one DFPLayer)</li> <li>Conductor shouts: \u201cAll aboard\u201d</li> <li>The Solari departure/arrival board comes to live (random play)</li> <li>A station announcement, synchronized with a train arrival (triggered via an input sensor)</li> <li>Station announcements (random play)</li> <li>Car horns outside station (random play)</li> <li>Someone shouting: \u201cTaxi\u201d (random play)</li> <li>Only limited by your imagination</li> </ol>"},{"location":"products/ex-commandstation/accessories/various-devices/dfplayer/dfplayer/#hardware-connection","title":"Hardware connection","text":"<p>Because the DFPlayer is a Serial device, this can be inconvenient for command stations with limited serial pins available (eg CSB-1) so dcc-ex provides an additional HAL driver to access the device over I2C with a suitable UART breakout board.</p> <p>Please see the relevant connection details:</p> <ul> <li>DFPlayer Serial connection</li> <li>DFPlayer I2C connection</li> </ul>"},{"location":"products/ex-commandstation/accessories/various-devices/dfplayer/dfplayer/#audio-file-storage-and-naming-convention","title":"Audio file storage and naming convention","text":"<p>The DFPlayer read audio files from a microSD flash card. If audio files are copied in the root directory, then the order of the copying determine which audio file will be the 1st.  So when a command is sent to the DFPlayer to play track 1, it will play the 1st audio file that was copied on the microSD card.</p> <p>To control consistently which audio file is to be played, the DFPlayer needs a folder structure. Folders need to be named 01, 02, 03 . . . . 99, and the audio files in each folder need to be named 001.mp2, 002.mp3 up to 255.mp3. Audio files in MP3 format are preferred, but WAV format is also supported, but take up more space.</p> <p>Audio files may be renamed from \u2018my favourite song.mp3\u2019 to \u2018001My favourite song.mp3\u2019 as per DFPlayer manual.</p> <p>The (current) exception is an audio file that is to be played continuously with the DF_REPEATPLAY command, as there is no DFPlayer REPEAT command to play a specific audio file in a specific folder. Therefor it is recommended to store the audio file that needs to be played continuously in the root folder and name it \u2018001.mp3\u2019.</p>"},{"location":"products/ex-commandstation/accessories/various-devices/dfplayer/dfplayer/#providing-sound-files","title":"Providing sound files","text":"<p>the DFPlayer has a strange behaviour when the audio files are stored in the root directory. It does not look at the file name for example 001.mp3 to play file 001.mp3, but will play the 1st file that has been copied on the microSD card when it receives the command to play file 1. To solve this issue, a directory structure must be in place.</p> <p>The DFLayer implementation require a directory named 01 to 99, and should contain all the audio files named 001.mp3 to 255.mp3. The format <code>001&lt;sound title&gt;.mp3</code> is also supported.</p> <p>Best practice is to compile an audio catalogue and store files in different folders, for example each folder is for a different category. It makes it easy to write EXRAIL scripts to control sound when each DFPLayer has the same sound catalogue on its microSD card. We have created an example sound catalogue, royalty free, full attribution document and open source to get you started.</p> <p>Files in WAV format are also supported, but take up more space, audio files in MP3 format are recommended.</p> <p>The EXRAIL cookbooks provide several worked example sound scenarios.</p>"},{"location":"products/ex-commandstation/accessories/various-devices/dfplayer/dfplayer/#testing-dfplayer","title":"Testing DFPlayer","text":"<p>There is a  command that is specifically designed for easy testing and control from the serial monitor. Every command is directed towards the previously defined vpin. <ul> <li><code>&lt;y vpin PLAY track [volume]&gt;</code> Plays given track number and specified (or default) volume</li> <li><code>&lt;y vpin REPEAT track [volume]&gt;</code> Plays track repeatedly</li> <li><code>&lt;y vpin PAUSE &gt;</code> Pauses playing</li> <li><code>&lt;y vpin RESUME&gt;</code> Resumes playing</li> <li><code>&lt;y vpin STOP&gt;</code> Stops playing</li> <li><code>&lt;y vpin FOLDER folder&gt;</code> Switches future play commands to a different folder</li> <li><code>&lt;y vpin VOL volume&gt;</code> Changes default play volume (Does not affect currently playing track)</li> <li><code>&lt;y vpin EQ eq&gt;</code> Changes sound equalisation</li> <li><code>&lt;y vpin RESET&gt;</code> Resets the DFPlayer</li> </ul>"},{"location":"products/ex-commandstation/accessories/various-devices/dfplayer/i2c-dfplayer/","title":"I2C Connected DFPlayer","text":"<p>The UART on the SC16IS752 has 2 UARTS so can drive 2 DFplayers independently, the SC16IS750 has only one UART.</p> <p>The breakout boards out in the wild have been discovered being fitted with either a 1.8432Mhz or 14.7456Mhz Crystal. The driver will automatically detect the frequency to make sure the correct baud rate is generated for each UART individually.</p>"},{"location":"products/ex-commandstation/accessories/various-devices/dfplayer/i2c-dfplayer/#sc16is750-sc16is752-breakout-board-hookup","title":"SC16IS750 - SC16IS752 Breakout board hookup","text":"<p> SC16IS750 breakout board hookup</p> <p> SC16IS750 breakout board hookup</p>"},{"location":"products/ex-commandstation/accessories/various-devices/dfplayer/i2c-dfplayer/#i2c-address-selection","title":"I2C address selection","text":"<p>The I2C addresses shown in Table 2 are different from the addresses shown in the datasheet, this is because the datasheet include the LSB in the address, the DCC-EX system start the I2C address at bit 1 (shifted). The I2C addresses in Table 2 are correct for the DCC-EX system and for the examples in section 3.</p> A1 A0 I2C Address Vdd Vdd 0x48 Vdd Vss 0x49 Vdd SCL 0x4A Vdd SDA 0x4B Vss Vdd 0x4C Vss Vss 0x4D Vss SCL 0x4E Vss SDA 0x4F SCL Vdd 0x50 SCL Vss 0x51 SCL SCL 0x52 SCL SDA 0x53 SDA Vdd 0x54 SDA Vss 0x55 SDA SCL 0x56 SDA SDA 0x57 <p>A total of 16 I2C addresses can be selected. The number of serial controllers can be significantly increased when they are installed on a PCA9548 multiplexer SubBus as each SubBus is its own I2C bus.</p>"},{"location":"products/ex-commandstation/accessories/various-devices/dfplayer/i2c-dfplayer/#configuring-in-myautomationh","title":"Configuring in myAutomation.h","text":"<p>The I2C connected DFplayer is defined in EXRAIL using the HAL command</p> <pre><code>HAL(DFPlayer,firstVpin,numVpins,i2cAddress)\n</code></pre> <ul> <li>firstVpin is First virtual pin that EXRAIL can control to play a sound, or sent a command</li> <li>numVpins=1 indicates only one DFPLayer attached at UART channel 0, numpins=2 indicates two DFPlayers attached, the second player will have a vipin of firstVpin+1.</li> <li>i2cAddress is the connected i2cAddress of the UART device</li> </ul> <p>Typicaal examples</p> <pre><code>HAL(DFPlayer,10000,1,0x48)\n</code></pre> <p>Where the connection is made through a multiplexor, the i2cAddress will reflect that, as for all other I2C HAL drivers.</p>"},{"location":"products/ex-commandstation/accessories/various-devices/dfplayer/serial-dfplayer/","title":"Serial connected DFPlayer","text":"<p>A serial connected DFPlayer is defined in EXRAIL (myAutomation.h) using the HAL command</p> <pre><code>HAL(DFPlayer,vpin,serial)\n</code></pre> <p>For Example:</p> <pre><code>HAL(DFPlayer,3500,Serial2)  // Use tx2/rx2 Arduino Serial2\n</code></pre>"},{"location":"products/ex-commandstation/accessories/various-devices/dfplayer/serial-dfplayer/#csb1-and-esp32-serial-connections","title":"CSB1 and ESP32 Serial connections","text":"<p>Note that the ESP32/CSB1 does not by default have a configured Serial2 so it is necessary to provide the spare pins to be used for the setup.</p> <pre><code>HAL(DFPLayer,3500,Serial2,16,17)  // For an ESP32 \n</code></pre>"},{"location":"products/ex-commandstation/exrail/command-list/","title":"EXRAIL Command List","text":"<p>The following list is dynamically built from the EXRAIL code. It contains all the EXRAIL commands with brief definitions. In many cases the parameters are self explanitory, for example a speed (which will always be a DCC compatible 0..127 where 0=stop and 1=emergency stop)</p>"},{"location":"products/ex-commandstation/exrail/command-list/#activateaddrsubaddr","title":"ACTIVATE(addr,subaddr)","text":"<p>Send DCC Accessory Activate packet (gate on then off)</p> <ul> <li>addr DCC short address of accessory</li> <li>subaddr DCC sub address</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#activatellinearaddr","title":"ACTIVATEL(linearaddr)","text":"<p>Send DCC Accessory Activate packet (gate on then off)</p> <ul> <li>linearaddr DCC linear address of accessory</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#aftervpintimer","title":"AFTER(vpin,timer...)","text":"<p>Wait for sensor activated, then deactivated for given time</p> <ul> <li>vpin Virtual Pin number of sensor</li> <li>timer... optional wait in ms, default 500</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#afteroverloadtrack_id","title":"AFTEROVERLOAD(track_id)","text":"<p>Wait for overload to be resolved</p> <ul> <li>track_id A..H</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#aliasnamevalue","title":"ALIAS(name,value...)","text":"<p>defines a named numeric value.</p> <ul> <li>name c++ variable name that can be used throughout the script</li> <li>value...  if omitted, a large negative value is created automatically</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#ambersignal_id","title":"AMBER(signal_id)","text":"<p>Sets a signal to amber state</p> <p>see ONAMBER</p>"},{"location":"products/ex-commandstation/exrail/command-list/#anoutvpinvalueparam1param2","title":"ANOUT(vpin,value,param1,param2)","text":"<p>Writes to the HAL analog output interface of a device driver.</p> <ul> <li>vpin Virtual pin number of device</li> <li>value basic analog value</li> <li>param1 device dependent</li> <li>param2 device dependent</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#atvpin","title":"AT(vpin)","text":"<p>Wait until a sensor becomes active</p> <ul> <li>vpin Virtual pin of sensor. Use negative value for sensors that are HIGH when activated</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#aspectaddressvalue","title":"ASPECT(address,value)","text":"<p>Sends a DCC aspect value to an accessory address. May also change status of a signal defined using this aspect.</p> <ul> <li>address Linear DCC address of device</li> <li>value Aspect value (Device dependent)</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#atgtevpinvalue","title":"ATGTE(vpin,value)","text":"<p>Wait for analog sensor to be greater than given value</p> <ul> <li>vpin Analog pin number</li> <li>value integer value to compare against</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#atltvpinvalue","title":"ATLT(vpin,value)","text":"<p>Wait for analog sensor value to be less than given value</p> <ul> <li>vpin Analog pin number</li> <li>value integer value to compare against</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#attimeoutvpintimeout_ms","title":"ATTIMEOUT(vpin,timeout_ms)","text":"<p>Wait for sensor active, with timeout. Use IFTIMEOUT to determine whether the AT was satisfied.</p> <p>see IFTIMEOUT</p> <ul> <li>vpin Sensor pin number</li> <li>timeout_ms Milliseconds to wait before timeout</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#automationsequence_iddescription","title":"AUTOMATION(sequence_id,description)","text":"<p>Defines starting point of a sequence that will be shown as an Automation by</p> <p>the throttles. Automations are started by the throttle handing over a loco id to be driven.</p> <ul> <li>sequence_id Unique sequence id value</li> <li>description (Quoted text) will be shown on throttle button</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#autostart","title":"AUTOSTART","text":"<p>A new task will be created starting from this point at Command Station startup</p>"},{"location":"products/ex-commandstation/exrail/command-list/#blinkvpinondutyoffduty","title":"BLINK(vpin,onDuty,offDuty)","text":"<p>Starts a blinking process for a vpin (typically a LED). Stop blink with SET or RESET.</p> <ul> <li>vpin Pin to blink</li> <li>onDuty Milliseconds with LED ON</li> <li>offDuty Milliseconds with LED off</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#broadcastmsg","title":"BROADCAST(msg)","text":"<p>Send raw message text to all throttles using the DCC-EX protocol</p> <p>see WITHROTTLE</p> <ul> <li>msg  Quoted message</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#build_consistloco_id","title":"BUILD_CONSIST(loco_id)","text":"<p>Adds a loco to follow the current loco in a consist</p> <ul> <li>loco_id may be negative to indicate loco facing backwards</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#break_consist","title":"BREAK_CONSIST","text":"<p>Breaks up any consist involving the current loco</p>"},{"location":"products/ex-commandstation/exrail/command-list/#callsequence_id","title":"CALL(sequence_id)","text":"<p>transfer control to another sequence with expectation to return</p> <p>see RETURN</p> <ul> <li>sequence_id SEQUENCE to jump processing to, must terminate or RETURN</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#clear_stashstash_id","title":"CLEAR_STASH(stash_id)","text":"<p>Clears loco value stored in stash</p> <ul> <li>stash_id which stash to clear.</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#clear_all_stash","title":"CLEAR_ALL_STASH","text":"<p>Clears all stashed loco values</p>"},{"location":"products/ex-commandstation/exrail/command-list/#clear_any_stash","title":"CLEAR_ANY_STASH","text":"<p>Clears loco value from all stash entries</p>"},{"location":"products/ex-commandstation/exrail/command-list/#closeturnout_id","title":"CLOSE(turnout_id)","text":"<p>Close turnout by id</p> <p>see THROW</p>"},{"location":"products/ex-commandstation/exrail/command-list/#configure_servovpinpos1pos2profile","title":"CONFIGURE_SERVO(vpin,pos1,pos2,profile)","text":"<p>Set up servo movement parameters for non-turnout</p> <ul> <li>vpin must refer to a servo capable pin</li> <li>pos1 SET position of servo</li> <li>pos2 RESET position of servo</li> <li>profile Movement profile (Instant, Fast, Medium, Slow, Bounce)</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#dcc_signalsignal_idaddrsubaddr","title":"DCC_SIGNAL(signal_id,addr,subaddr)","text":"<p>Define a DCC accessory signal with short address</p> <ul> <li>signal_id Id used for all signal manipulation commands</li> <li>addr DCC address</li> <li>subaddr DCC subaddress</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#dccx_signalsignal_idredaspectamberaspectgreenaspect","title":"DCCX_SIGNAL(signal_id,redAspect,amberAspect,greenAspect)","text":"<p>Define advanced DCC accessory signal with aspects</p> <ul> <li>signal_id DCC Linear address AND Id used for all signal manipulation commands</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#dcc_turntableturntable_idhomedescription","title":"DCC_TURNTABLE(turntable_id,home,description...)","text":"<p>defines a Turntable device</p> <ul> <li>homeAngle the angle of the home position, valid angles are 0 - 3600</li> <li>description... Quoted text description of turntable</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#deactivateaddrsubaddr","title":"DEACTIVATE(addr,subaddr)","text":"<p>Sends DCC Deactivate packet (gate on, gate off)</p> <ul> <li>addr DCC accessory address</li> <li>subaddr DCC accessory subaddress</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#deactivateladdr","title":"DEACTIVATEL(addr)","text":"<p>Sends DCC Deactivate packet (gate on, gate off)</p> <ul> <li>addr DCC Linear accessory address</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#delaydelay_ms","title":"DELAY(delay_ms)","text":"<p>Waits for given milliseconds delay (This is not blocking)</p> <ul> <li>delay_mS Delay time in milliseconds</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#delayminsdelay_minutes","title":"DELAYMINS(delay_minutes)","text":"<p>Waits for given minutes delay (This is not blocking)</p>"},{"location":"products/ex-commandstation/exrail/command-list/#delayrandommindelaymaxdelay","title":"DELAYRANDOM(mindelay,maxdelay)","text":"<p>Waits for random delay between min and max milliseconds (This is not blocking)</p> <ul> <li>mindelay minimum delay in ms</li> <li>maxdelay maximum delay in ms</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#done","title":"DONE","text":"<p>Stops task loco (if any) and terminates current task</p>"},{"location":"products/ex-commandstation/exrail/command-list/#driveanalogpin","title":"DRIVE(analogpin)","text":"<p>RESERVED do not use</p>"},{"location":"products/ex-commandstation/exrail/command-list/#else","title":"ELSE","text":"<p>introduces alternate processing path after any kind of IF</p> <p>see IF</p>"},{"location":"products/ex-commandstation/exrail/command-list/#endexrail","title":"ENDEXRAIL","text":"<p>obsolete.. no longer needed. Does nothing.</p>"},{"location":"products/ex-commandstation/exrail/command-list/#endif","title":"ENDIF","text":"<p>determines end of IF(any type)  block.</p> <p>IF something ENDIF, or</p> <p>IF something ELSE something ENDIF</p> <p>see IF</p>"},{"location":"products/ex-commandstation/exrail/command-list/#endtask","title":"ENDTASK","text":"<p>same as DONE</p> <p>see DONE</p>"},{"location":"products/ex-commandstation/exrail/command-list/#estop","title":"ESTOP","text":"<p>Performs emergency stop on current task loco</p>"},{"location":"products/ex-commandstation/exrail/command-list/#estopall","title":"ESTOPALL","text":"<p>Performs emergency stop on all locos</p>"},{"location":"products/ex-commandstation/exrail/command-list/#estop_pause","title":"ESTOP_PAUSE","text":"<p>Emergency stop, and preventing all movement until resumed</p>"},{"location":"products/ex-commandstation/exrail/command-list/#estop_resume","title":"ESTOP_RESUME","text":"<p>Resumes loco speeds after ESTOP_PAUSE</p>"},{"location":"products/ex-commandstation/exrail/command-list/#exrail","title":"EXRAIL","text":"<p>obsolete.. no longer needed. Does nothing.</p>"},{"location":"products/ex-commandstation/exrail/command-list/#extt_turntableidvpinhomedescription","title":"EXTT_TURNTABLE(id,vpin,home,description...)","text":"<p>Defines the EX\u2011Turntable turntable/traverser object only, so you will need a separate HAL() statement for an EX\u2011Turntable device driver.</p> <ul> <li>homeAngle  the angle of the home position, valid angles are 0 - 3600</li> <li>quoted description...</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#fadevpinvaluems","title":"FADE(vpin,value,ms)","text":"<p>Modifies analog value slowly taking a given time</p> <ul> <li>vpin Servo virtual pin number</li> <li>value new target value</li> <li>ms time to reach value</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#fofffunc","title":"FOFF(func)","text":"<p>Turns off current loco function</p> <p>see FON</p>"},{"location":"products/ex-commandstation/exrail/command-list/#followsequence_id","title":"FOLLOW(sequence_id)","text":"<p>Task processing follows given route or sequence (Effectively a GoTo)</p>"},{"location":"products/ex-commandstation/exrail/command-list/#fonfunc","title":"FON(func)","text":"<p>Turn on current loco function</p> <p>see FOFF</p>"},{"location":"products/ex-commandstation/exrail/command-list/#forget","title":"FORGET","text":"<p>Removes current loco from task and DCC reminders table.</p>"},{"location":"products/ex-commandstation/exrail/command-list/#freetoken_id","title":"FREE(token_id)","text":"<p>Frees logical token</p> <p>see RESERVE</p> <ul> <li>token_id 0..255</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#freeall","title":"FREEALL","text":"<p>Frees all logical tokens</p> <p>see RESERVE</p>"},{"location":"products/ex-commandstation/exrail/command-list/#ftogglefunc","title":"FTOGGLE(func)","text":"<p>Toggles function for current loco</p>"},{"location":"products/ex-commandstation/exrail/command-list/#fwdspeed","title":"FWD(speed)","text":"<p>Instructs current loco to set DCC speed</p> <ul> <li>speed 0..127   (1=ESTOP)</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#greensignal_id","title":"GREEN(signal_id)","text":"<p>Sets signal to green state</p>"},{"location":"products/ex-commandstation/exrail/command-list/#halhaltypeparams","title":"HAL(haltype,params...)","text":"<p>Defines VPIN mapping for specific hardware drivers</p> <ul> <li>haltype driver name, normally device type</li> <li>params... depend on driver.</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#hal_ignore_defaults","title":"HAL_IGNORE_DEFAULTS","text":"<p>System will ignore default HAL device mappings</p>"},{"location":"products/ex-commandstation/exrail/command-list/#ifvpin","title":"IF(vpin)","text":"<p>Checks sensor state, If false jumps to matching nested ELSE or ENDIF</p> <ul> <li>vpin  VPIN of sensor. Negative VPIN will invert sensor state.</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#ifambersignal_id","title":"IFAMBER(signal_id)","text":"<p>Checks if signal is in AMBER state.</p> <p>see IF</p>"},{"location":"products/ex-commandstation/exrail/command-list/#ifclosedturnout_id","title":"IFCLOSED(turnout_id)","text":"<p>Checks if given turnout is in close state</p> <p>see IF</p>"},{"location":"products/ex-commandstation/exrail/command-list/#ifgreensignal_id","title":"IFGREEN(signal_id)","text":"<p>Checks if given signal is in GREEN state</p> <p>see IF</p>"},{"location":"products/ex-commandstation/exrail/command-list/#ifgtevpinvalue","title":"IFGTE(vpin,value)","text":"<p>Checks if analog vpin sensor &gt;= value</p> <p>see IF</p>"},{"location":"products/ex-commandstation/exrail/command-list/#iflocoloco_id","title":"IFLOCO(loco_id)","text":"<p>Checks if current task loco = loco_id</p> <p>see IF</p>"},{"location":"products/ex-commandstation/exrail/command-list/#ifltvpinvalue","title":"IFLT(vpin,value)","text":"<p>Checks if analog sensor &lt; value</p> <p>see IF</p> <ul> <li>vpin  Analog vpin of sensor</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#ifnotvpin","title":"IFNOT(vpin)","text":"<p>Inverse of IF</p> <p>see IF</p>"},{"location":"products/ex-commandstation/exrail/command-list/#ifrandompercent","title":"IFRANDOM(percent)","text":"<p>randomly satisfied IF at given percent probability</p> <p>see IF</p>"},{"location":"products/ex-commandstation/exrail/command-list/#ifredsignal_id","title":"IFRED(signal_id)","text":"<p>Checks if given signal is in RED state</p> <p>see IF</p>"},{"location":"products/ex-commandstation/exrail/command-list/#ifstashstash_id","title":"IFSTASH(stash_id)","text":"<p>Checks if given stash entry has a non-zero value</p> <p>see IF</p>"},{"location":"products/ex-commandstation/exrail/command-list/#ifstashed_herestash_id","title":"IFSTASHED_HERE(stash_id)","text":"<p>Checks if given stash entry has the current loco</p> <p>see IF</p>"},{"location":"products/ex-commandstation/exrail/command-list/#ifthrownturnout_id","title":"IFTHROWN(turnout_id)","text":"<p>Checks if given turnout is in THROWN state</p> <p>see IF</p>"},{"location":"products/ex-commandstation/exrail/command-list/#ifreservetoken_id","title":"IFRESERVE(token_id)","text":"<p>Attempts to reserve token and if satisfiled the token remains reserved.</p> <p>see IF RESERVE FREE</p>"},{"location":"products/ex-commandstation/exrail/command-list/#iftimeout","title":"IFTIMEOUT","text":"<p>Checks TIMEOUT state after an AT/AFTER request with timeout value.</p> <p>see IF AT AFTER</p>"},{"location":"products/ex-commandstation/exrail/command-list/#ifttpositionturntable_idposition","title":"IFTTPOSITION(turntable_id,position)","text":"<p>Checks if Turntable is in given position</p> <p>see IF</p>"},{"location":"products/ex-commandstation/exrail/command-list/#ifrevpinvalue","title":"IFRE(vpin,value)","text":"<p>Checks external rotary encoder value</p> <ul> <li>vpin of device driver for rotary encoder</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#ifbitmap_allvpinmask","title":"IFBITMAP_ALL(vpin,mask)","text":"<p>Checks if (vpin pseudo-analog value &amp; mask) == mask.</p> <p>see IF</p> <ul> <li>mask Binary mask applied to vpin value</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#ifbitmap_anyvpinmask","title":"IFBITMAP_ANY(vpin,mask)","text":"<p>Checks if vpin pseudo-analog value &amp; mask is non-zero</p> <p>see IF</p> <ul> <li>mask Binary mask applied to vpin value</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#ifroute_activesequence_id","title":"IFROUTE_ACTIVE(sequence_id)","text":"<p>Checks if route is active</p> <p>see IF</p>"},{"location":"products/ex-commandstation/exrail/command-list/#ifroute_inactivesequence_id","title":"IFROUTE_INACTIVE(sequence_id)","text":"<p>Checks if route is inactive</p> <p>see IF</p>"},{"location":"products/ex-commandstation/exrail/command-list/#ifroute_hiddensequence_id","title":"IFROUTE_HIDDEN(sequence_id)","text":"<p>Checks if route is hidden</p> <p>see IF</p>"},{"location":"products/ex-commandstation/exrail/command-list/#ifroute_disabledsequence_id","title":"IFROUTE_DISABLED(sequence_id)","text":"<p>Checks if route is disabled</p> <p>see IF</p>"},{"location":"products/ex-commandstation/exrail/command-list/#invert_direction","title":"INVERT_DIRECTION","text":"<p>Marks current task so that FWD and REV commands are inverted.</p>"},{"location":"products/ex-commandstation/exrail/command-list/#jmri_sensorvpincount","title":"JMRI_SENSOR(vpin,count...)","text":"<p>Defines multiple JMRI <code>&lt;s&gt;</code> type sensor feedback definitions each with id matching vpin and INPUT_PULLUP</p> <ul> <li>vpin first vpin number</li> <li>count... Number of consecutive VPINS for which to create JMRI sensor feedbacks. Default 1.</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#jmri_sensor_nopullupvpincount","title":"JMRI_SENSOR_NOPULLUP(vpin,count...)","text":"<p>Defines multiple JMRI <code>&lt;s&gt;</code> type sensor feedback definitions each with id matching vpin</p> <ul> <li>vpin first vpin number</li> <li>count... Number of consecutive VPINS for which to create JMRI sensor feedbacks. Default 1.</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#join","title":"JOIN","text":"<p>Switches PROG track to receive MAIN track DCC packets. (Drive on PROG track)</p>"},{"location":"products/ex-commandstation/exrail/command-list/#killall","title":"KILLALL","text":"<p>Terminates all running EXRAIL tasks</p>"},{"location":"products/ex-commandstation/exrail/command-list/#latchvpin","title":"LATCH(vpin)","text":"<p>Make all AT/AFTER/IF see vpin as HIGH without checking hardware</p> <ul> <li>vpin Must only be for VPINS 0..255</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#lcceventid","title":"LCC(eventid)","text":"<p>Issue event to LCC</p>"},{"location":"products/ex-commandstation/exrail/command-list/#lccxsenderideventid","title":"LCCX(senderid,eventid)","text":"<p>Issue LCC event while impersonating another sender</p>"},{"location":"products/ex-commandstation/exrail/command-list/#lcdrowmsg","title":"LCD(row,msg)","text":"<p>Write message on row of default configured LCD/OLED</p> <p>see SCREEN</p> <ul> <li>msg Quoted text</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#momentumacceldecel","title":"MOMENTUM(accel,decel...)","text":"<p>sets momentum in ms per DCC 127 step for current loco.</p> <ul> <li>accel Acceleration momentum</li> <li>decel... Braking momentum. (=Acceleration if not given)</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#screendisplayrowmsg","title":"SCREEN(display,row,msg)","text":"<p>Send message to external display handlers</p> <ul> <li> <p>display number, 0=local display, others are handled by external displays which may have different display numbers on different devices.</p> </li> <li> <p>msg Quoted text</p> </li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#lcnmsg","title":"LCN(msg)","text":"<p>Reserved for LCN communication. Refer to their documentation.</p>"},{"location":"products/ex-commandstation/exrail/command-list/#messagemsg","title":"MESSAGE(msg)","text":"<p>Send a human readable message to all throttle users</p> <ul> <li>msg Quoted text</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#movettturntable_idstepsactivity","title":"MOVETT(turntable_id,steps,activity)","text":"<p>Move Turntable to specific position</p> <p>see ROTATE</p> <ul> <li>steps position to move to</li> <li>activity see ROTATE</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#neopixelvpinrgbcount","title":"NEOPIXEL(vpin,r,g,b,count...)","text":"<p>Set a NEOPIXEL vpin to a given red/green/blue colour</p> <ul> <li>vpin VPIN of a pixel</li> <li>r red component 0-255</li> <li>g green component 0-255</li> <li>b blue component 0-255</li> <li>count... Number of consecutive pixels to set, Default 1.</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#neopixel_signalvpinredcolourambercolourgreencolour","title":"NEOPIXEL_SIGNAL(vpin,redcolour,ambercolour,greencolour)","text":"<p>Define a signal that uses a single multi colour pixel</p> <p>see NEORGB</p> <ul> <li>vpin unique signal_id</li> <li>redcolour  RGB colour use NEORGB(red,green,blue) to create values.</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#aconeventid","title":"ACON(eventid)","text":"<p>Send MERG CBUS ACON to Adapter</p>"},{"location":"products/ex-commandstation/exrail/command-list/#acofeventid","title":"ACOF(eventid)","text":"<p>Send MERG CBUS ACOF to Adapter</p>"},{"location":"products/ex-commandstation/exrail/command-list/#onaconeventid","title":"ONACON(eventid)","text":"<p>Start task here when ACON for event received from MERG CBUS</p>"},{"location":"products/ex-commandstation/exrail/command-list/#onacofeventid","title":"ONACOF(eventid)","text":"<p>Start task here when ACOF for event received from MERG CBUS</p>"},{"location":"products/ex-commandstation/exrail/command-list/#onactivateaddrsubaddr","title":"ONACTIVATE(addr,subaddr)","text":"<p>Start task here when DCC Activate sent for short address</p>"},{"location":"products/ex-commandstation/exrail/command-list/#onactivatellinear","title":"ONACTIVATEL(linear)","text":"<p>Start task here when DCC Activate sent for linear address</p>"},{"location":"products/ex-commandstation/exrail/command-list/#onambersignal_id","title":"ONAMBER(signal_id)","text":"<p>Start task here when signal set to AMBER state</p>"},{"location":"products/ex-commandstation/exrail/command-list/#onblockenterblock_id","title":"ONBLOCKENTER(block_id)","text":"<p>Start task here when a loco enters a railcom block</p> <ul> <li>block_id vpin associated to block by HAL(I2CRailcom..)</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#onblockexitblock_id","title":"ONBLOCKEXIT(block_id)","text":"<p>Start task here when a loco leaves a railcom block</p> <ul> <li>block_id vpin associated to block by HAL(I2CRailcom..)</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#ontimeminute_in_day","title":"ONTIME(minute_in_day)","text":"<p>Start task here when fastclock matches</p> <ul> <li>minute_in_day (0..1439)</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#onclocktimehoursmins","title":"ONCLOCKTIME(hours,mins)","text":"<p>Start task here when fastclock matches time</p>"},{"location":"products/ex-commandstation/exrail/command-list/#onclockminsmins","title":"ONCLOCKMINS(mins)","text":"<p>Start task here hourly when fastclock minutes matches</p>"},{"location":"products/ex-commandstation/exrail/command-list/#onoverloadtrack_id","title":"ONOVERLOAD(track_id)","text":"<p>Start task here when given track goes into overload</p> <ul> <li>track_id A..H</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#onrailsyncon","title":"ONRAILSYNCON","text":"<p>Start task here when the railsync (booster) input port get a valid DCC signal</p>"},{"location":"products/ex-commandstation/exrail/command-list/#onrailsyncoff","title":"ONRAILSYNCOFF","text":"<p>Start task here when the railsync (booster) input port does not get a valid DCC signal any more</p>"},{"location":"products/ex-commandstation/exrail/command-list/#ondeactivateaddrsubaddr","title":"ONDEACTIVATE(addr,subaddr)","text":"<p>Start task here when DCC deactivate packet sent</p>"},{"location":"products/ex-commandstation/exrail/command-list/#ondeactivatellinear","title":"ONDEACTIVATEL(linear)","text":"<p>Start task here when DCC deactivate sent to linear address</p>"},{"location":"products/ex-commandstation/exrail/command-list/#oncloseturnout_id","title":"ONCLOSE(turnout_id)","text":"<p>Start task here when turnout closed</p>"},{"location":"products/ex-commandstation/exrail/command-list/#onlccsenderevent","title":"ONLCC(sender,event)","text":"<p>Start task here when LCC event arrives from sender</p>"},{"location":"products/ex-commandstation/exrail/command-list/#ongreensignal_id","title":"ONGREEN(signal_id)","text":"<p>Start task here when signal set to GREEN state</p>"},{"location":"products/ex-commandstation/exrail/command-list/#onredsignal_id","title":"ONRED(signal_id)","text":"<p>Start task here when signal set to RED state</p>"},{"location":"products/ex-commandstation/exrail/command-list/#onrotateturntable_id","title":"ONROTATE(turntable_id)","text":"<p>Start task here when turntable is rotated</p>"},{"location":"products/ex-commandstation/exrail/command-list/#onthrowturnout_id","title":"ONTHROW(turnout_id)","text":"<p>Start task here when turnout is Thrown</p>"},{"location":"products/ex-commandstation/exrail/command-list/#onchangevpin","title":"ONCHANGE(vpin)","text":"<p>Rotary encoder change starts task here (This is obscurely different from ONSENSOR which will be merged in a later release.)</p>"},{"location":"products/ex-commandstation/exrail/command-list/#onsensorvpin","title":"ONSENSOR(vpin)","text":"<p>Start task here when sensor changes state (debounced)</p>"},{"location":"products/ex-commandstation/exrail/command-list/#onbitmapvpin","title":"ONBITMAP(vpin)","text":"<p>Start task here when bitmap sensor changes state (debounced)</p>"},{"location":"products/ex-commandstation/exrail/command-list/#onbuttonvpin","title":"ONBUTTON(vpin)","text":"<p>Start task here when sensor changes HIGH to LOW.</p>"},{"location":"products/ex-commandstation/exrail/command-list/#pause","title":"PAUSE","text":"<p>Pauses all EXRAIL tasks except the current one.</p> <p>Other tasks ESTOP their locos until RESUME issued</p>"},{"location":"products/ex-commandstation/exrail/command-list/#pin_turnoutidvpindescription","title":"PIN_TURNOUT(id,vpin,description...)","text":"<p>Defines a turnout which operates on a single pin</p> <ul> <li>description... Quoted text (shown to throttles) or HIDDEN</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#printmsg","title":"PRINT(msg)","text":"<p>prints diagnostic message on USB serial</p> <ul> <li>msg Quoted text</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#parsemsg","title":"PARSE(msg)","text":"<p>Executes <code>&lt;&gt;</code> command as if entered from serial</p> <ul> <li>msg Quoted text, preferably including <code>&lt;&gt;</code></li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#pickup_stashstash_id","title":"PICKUP_STASH(stash_id)","text":"<p>see STASH</p> <p>Loads stashed value into current task loco</p> <ul> <li>stash_id position in stash where a loco id was previously saved.</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#play_eqvpineqname","title":"PLAY_EQ(vpin,eqname)","text":"<p>Sets EQ setting on DFPlayer module</p> <ul> <li>eqname One of: NORMAL,POP,ROCK,JAZZ,CLASSIC,BASS</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#play_foldervpinfolder","title":"PLAY_FOLDER(vpin,folder)","text":"<p>Sets DFPlayer folder to use for tracks </p> <ul> <li>folder number</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#play_pausevpin","title":"PLAY_PAUSE(vpin)","text":"<p>Pauses sound play</p> <p>see PLAY_RESUME</p>"},{"location":"products/ex-commandstation/exrail/command-list/#play_repeatvpintrackvolume","title":"PLAY_REPEAT(vpin,track,volume...)","text":"<p>Plays a track on a DFPlayer module on repoeat</p> <ul> <li>track number</li> <li>volume... optional volume 0-30 or use default set below</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#play_resetvpin","title":"PLAY_RESET(vpin)","text":"<p>Resets DFPlayer </p>"},{"location":"products/ex-commandstation/exrail/command-list/#play_resumevpin","title":"PLAY_RESUME(vpin)","text":"<p>Resumes playing sound</p> <p>see PLAY_PAUSE </p>"},{"location":"products/ex-commandstation/exrail/command-list/#play_stopvpin","title":"PLAY_STOP(vpin)","text":"<p>Stops DFPlayer </p>"},{"location":"products/ex-commandstation/exrail/command-list/#play_trackvpintrackvolume","title":"PLAY_TRACK(vpin,track,volume...)","text":"<p>Plays a track on a DFPlayer module</p> <ul> <li>track number</li> <li>volume... optional volume 0-30 or use default set below</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#play_volumevpinvolume","title":"PLAY_VOLUME(vpin,volume)","text":"<p>Sets default volume on a DFPlayer module</p> <ul> <li>volume... volume 0-30</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#pomcvvalue","title":"POM(cv,value)","text":"<p>Write value to cv on current tasks loco (Program on Main)</p>"},{"location":"products/ex-commandstation/exrail/command-list/#poweroff","title":"POWEROFF","text":"<p>Powers off all tracks</p>"},{"location":"products/ex-commandstation/exrail/command-list/#poweron","title":"POWERON","text":"<p>Powers ON all tracks</p>"},{"location":"products/ex-commandstation/exrail/command-list/#random_callsequence_id","title":"RANDOM_CALL(sequence_id...)","text":"<p>CALL to another sequence randomly chosen from list</p> <p>see CALL</p> <ul> <li>sequence_id.. list of SEQUENCE that may be called, each must terminate or RETURN</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#random_followsequence_id","title":"RANDOM_FOLLOW(sequence_id...)","text":"<p>jump to another sequence randomly chosen from list</p> <p>see FOLLOW</p> <ul> <li>sequence_id.. list of SEQUENCE that may be followed</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#read_loco","title":"READ_LOCO","text":"<p>Reads loco Id from prog track and sets currenmt task loco id.</p>"},{"location":"products/ex-commandstation/exrail/command-list/#redsignal_id","title":"RED(signal_id)","text":"<p>sets signal to RED state</p>"},{"location":"products/ex-commandstation/exrail/command-list/#reservetoken_id","title":"RESERVE(token_id)","text":"<p>Waits for token for block. If not available immediately, current task loco is stopped.</p>"},{"location":"products/ex-commandstation/exrail/command-list/#resetvpincount","title":"RESET(vpin,count...)","text":"<p>Sets output pin LOW</p> <p>see SET</p> <ul> <li>count... Number of consecutive pins, default 1</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#restore_speed","title":"RESTORE_SPEED","text":"<p>Resumes locos saved speed</p> <p>see SAVE_SPEED</p>"},{"location":"products/ex-commandstation/exrail/command-list/#resume","title":"RESUME","text":"<p>Resumes PAUSEd tasks</p> <p>see PAUSE</p>"},{"location":"products/ex-commandstation/exrail/command-list/#return","title":"RETURN","text":"<p>Returns to CALL</p> <p>see CALL</p>"},{"location":"products/ex-commandstation/exrail/command-list/#revspeed","title":"REV(speed)","text":"<p>Issues DCC speed packet for current loco in reverse.</p> <p>see FWD</p> <ul> <li>speed  (0..127, 1=ESTOP)</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#rotateturntable_idpositionactivity","title":"ROTATE(turntable_id,position,activity)","text":"<p>Rotates an EX-Turntable to a given position</p> <ul> <li>activity .. One of:</li> <li> <p>Turn: Rotate turntable, maintain phase</p> </li> <li> <p>Turn_PInvert: Rotate turntable, invert phase</p> </li> <li> <p>Home: Initiate homing</p> </li> <li> <p>Calibrate: Initiate calibration sequence</p> </li> <li> <p>LED_On: Turn LED on</p> </li> <li> <p>LED_Slow: Set LED to a slow blink</p> </li> <li> <p>LED_Fast: Set LED to a fast blink</p> </li> <li> <p>LED_Off: Turn LED off</p> </li> <li> <p>Acc_On: Turn accessory pin on</p> </li> <li> <p>Acc_Off: Turn accessory pin off</p> </li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#rotate_dccturntable_idposition_id","title":"ROTATE_DCC(turntable_id,position_id)","text":"<p>Rotates turntable to a given position using DCC commands</p>"},{"location":"products/ex-commandstation/exrail/command-list/#rostercabnamefuncmap","title":"ROSTER(cab,name,funcmap...)","text":"<p>Describes a loco roster entry visible to throttles</p> <ul> <li>cab loco DCC address or 0 for default entry</li> <li>name Quoted text</li> <li>funcmap... Quoted text, optional list of function names separated by / character with momentary function names prefixed with an *.</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#routesequence_iddescription","title":"ROUTE(sequence_id,description)","text":"<p>Defines starting point of a sequence that will appear as a route on throttle buttons.</p> <ul> <li>description Quoted text, throttle button caption.</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#route_activesequence_id","title":"ROUTE_ACTIVE(sequence_id)","text":"<p>Tells throttle to display the route button as active</p> <ul> <li>sequence_id of ROUTE/AUTOMATION</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#route_inactivesequence_id","title":"ROUTE_INACTIVE(sequence_id)","text":"<p>Tells throttle to display the route button as inactive</p> <ul> <li>sequence_id of ROUTE/AUTOMATION</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#route_hiddensequence_id","title":"ROUTE_HIDDEN(sequence_id)","text":"<p>Tells throttle to hide the route button</p> <ul> <li>sequence_id of ROUTE/AUTOMATION</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#route_disabledsequence_id","title":"ROUTE_DISABLED(sequence_id)","text":"<p>Tells throttle to display the route button as disabled</p> <ul> <li>sequence_id of ROUTE/AUTOMATION</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#route_captionsequence_idcaption","title":"ROUTE_CAPTION(sequence_id,caption)","text":"<p>Tells throttle to change thr route button caption</p> <ul> <li>sequence_id of ROUTE/AUTOMATION</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#save_speed","title":"SAVE_SPEED","text":"<p>Resumes locos saved speed</p> <p>see RESTORE_SPEED</p>"},{"location":"products/ex-commandstation/exrail/command-list/#sendlococabsequence_id","title":"SENDLOCO(cab,sequence_id)","text":"<p>Start a new task to drive the loco</p> <ul> <li>cab loco to be driven</li> <li>route sequence_id of route, automation or sequence to drive</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#sequencesequence_id","title":"SEQUENCE(sequence_id)","text":"<p>Provides a unique label that can be used to call, follow or start.</p> <p>see CALL</p> <p>see FOLLOW</p> <p>see START</p>"},{"location":"products/ex-commandstation/exrail/command-list/#serialmsg","title":"SERIAL(msg)","text":"<p>Write direct to Serial output</p> <ul> <li>msg Quoted text</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#serial1msg","title":"SERIAL1(msg)","text":"<p>Write direct to Serial1 output</p> <ul> <li>msg Quoted text</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#serial2msg","title":"SERIAL2(msg)","text":"<p>Write direct to Serial2 output</p> <ul> <li>msg Quoted text</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#serial3msg","title":"SERIAL3(msg)","text":"<p>Write direct to Serial3 output</p> <ul> <li>msg Quoted text</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#serial4msg","title":"SERIAL4(msg)","text":"<p>Write direct to Serial4 output</p> <ul> <li>msg Quoted text</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#serial5msg","title":"SERIAL5(msg)","text":"<p>Write direct to Serial5 output</p> <ul> <li>msg Quoted text</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#serial6msg","title":"SERIAL6(msg)","text":"<p>Write direct to Serial6 output</p> <ul> <li>msg Quoted text</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#servovpinpositionprofile","title":"SERVO(vpin,position,profile)","text":"<p>Move servo to given position</p> <ul> <li>vpin of servo</li> <li>position  servo position (values are hardware dependent)</li> <li>profile movement profile (Instant, Fast, Medium, Slow, Bounce)</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#servo2vpinpositionduration","title":"SERVO2(vpin,position,duration)","text":"<p>Move servo to given position taking time</p> <ul> <li>vpin of servo</li> <li>position  servo position (values are hardware dependent)</li> <li>duration mS</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#servo_signalvpinredposamberposgreenpos","title":"SERVO_SIGNAL(vpin,redpos,amberpos,greenpos)","text":"<p>Dedfine a servo based signal with 3 servo positions</p> <ul> <li>vpin of servo, acts as signal_id</li> <li>redpos servo position (values are hardware dependent)</li> <li>amberpos servo position (values are hardware dependent)</li> <li>greenpos servo position (values are hardware dependent)</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#servo_turnoutturnout_idvpinactiveangleinactiveangleprofiledescription","title":"SERVO_TURNOUT(turnout_id,vpin,activeAngle,inactiveAngle,profile,description...)","text":"<p>Define a servo driven turnout</p> <ul> <li>turnout_id used by THROW/CLOSE</li> <li>vpin for servo</li> <li>activeAngle servo position (values are hardware dependent)</li> <li>inactiveAngle servo position (values are hardware dependent)</li> <li>profile movement profile (Instant, Fast, Medium, Slow, Bounce)</li> <li>description... Quoted text shown to throttles or HIDDEN keyword to hide turnout button</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#setvpincount","title":"SET(vpin,count...)","text":"<p>Set pin HIGH</p> <p>see RESET</p> <ul> <li>count...  Number of sequential vpins to set. Default 1.</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#set_tracktrackmode","title":"SET_TRACK(track,mode)","text":"<p>Set output track type</p> <ul> <li>track A..H</li> <li>mode NONE, MAIN, PROG, DC, EXT, BOOST, BOOST_INV, BOOST_AUTO, MAIN_INV, MAIN_AUTO, DC_INV, DCX</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#set_powertrackonoff","title":"SET_POWER(track,onoff)","text":"<p>Set track power mode</p> <ul> <li>track A..H</li> <li>onoff ON or OFF</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#setlocoloco","title":"SETLOCO(loco)","text":"<p>Sets the loco being handled by the current task</p>"},{"location":"products/ex-commandstation/exrail/command-list/#setfreqfreq","title":"SETFREQ(freq)","text":"<p>Sets the DC track PWM frequency</p> <ul> <li>freq Frequency is default 0, or 1..3</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#signalredpinamberpingreenpin","title":"SIGNAL(redpin,amberpin,greenpin)","text":"<p>Define a Signal with LOW=on leds</p> <p>see SIGNALH</p> <ul> <li>redpin vpin for RED state, also acts as signal_id</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#signalhredpinamberpingreenpin","title":"SIGNALH(redpin,amberpin,greenpin)","text":"<p>define a signal with HIGH=ON leds</p> <ul> <li>redpin vpin for RED state, also acts as signal_id</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#speedspeed","title":"SPEED(speed)","text":"<p>Changes current tasks loco speed without changing direction</p> <ul> <li>speed 0..127 (1=ESTOP)</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#speedupspeedstep","title":"SPEEDUP(speedstep)","text":"<p>Increases current tasks loco speed by given amount</p> <ul> <li>speedstep 0..127</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#slowdownspeedstep","title":"SLOWDOWN(speedstep)","text":"<p>Decreases current tasks loco speed by given amount</p> <ul> <li>speedstep 0..127</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#speed_relpercent","title":"SPEED_REL(percent)","text":"<p>Sets current tasks loco speed to percentage of current speed</p> <ul> <li>percent 1..500</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#startsequence_id","title":"START(sequence_id)","text":"<p>Starts a new task at the given route/animation/sequence</p>"},{"location":"products/ex-commandstation/exrail/command-list/#start_sharedsequence_id","title":"START_SHARED(sequence_id)","text":"<p>Starts a new task at the given route/animation/sequence and share current loco with it</p>"},{"location":"products/ex-commandstation/exrail/command-list/#start_sendsequence_id","title":"START_SEND(sequence_id)","text":"<p>Starts a new task at the given route/animation/sequence and send current loco to it. Remove loco from current task.</p>"},{"location":"products/ex-commandstation/exrail/command-list/#stashstash_id","title":"STASH(stash_id)","text":"<p>saves current task's loco id in the stash array</p> <ul> <li>stash_id  position in stash array to save loco id</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#stealthcode","title":"STEALTH(code...)","text":"<p>Allows for embedding raw C++ code in context of current task.</p> <ul> <li>code... c++ code to be executed. This requires intimate understanding of the product architecture.</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#stealth_globalcode","title":"STEALTH_GLOBAL(code...)","text":"<p>Allows for embedding raw c++ code out of context.</p> <ul> <li>code...  c++ code to be defined. This requires intimate understanding of the product architecture.</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#stop","title":"STOP","text":"<p>Same as SPEED(0)</p>"},{"location":"products/ex-commandstation/exrail/command-list/#throwturnout_id","title":"THROW(turnout_id)","text":"<p>Throws given turnout</p> <p>see CLOSE</p>"},{"location":"products/ex-commandstation/exrail/command-list/#toggle_turnoutturnout_id","title":"TOGGLE_TURNOUT(turnout_id)","text":"<p>Toggles given turnout</p>"},{"location":"products/ex-commandstation/exrail/command-list/#tt_addpositionturntable_idposition_idvalueangledescription","title":"TT_ADDPOSITION(turntable_id,position_id,value,angle,description...)","text":"<p>Defines a turntable track position</p> <ul> <li>position_id each position is given an id</li> <li>address DCC accessory address</li> <li>angle Used only for throttles that may draw a visual representation of the turntable</li> <li>description... quoted text or HIDDEN</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#turnoutturnout_idaddrsubaddrdescription","title":"TURNOUT(turnout_id,addr,subaddr,description...)","text":"<p>Defines a DCC accessory turnout with legacy address</p> <ul> <li>turnout_id to be used in THROW/CLOSE etc</li> <li>addr DCC accessory address</li> <li>subaddr DCC accessory subaddress</li> <li>description... Quoted text or HIDDEN, appears on throttle buttons</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#turnoutlturnout_idaddrdescription","title":"TURNOUTL(turnout_id,addr,description...)","text":"<p>Defines a DCC accessory turnout with linear address</p> <p>see TURNOUT</p> <ul> <li>turnout_id to be used in THROW/CLOSE etc</li> <li>addr DCC accessory linear address</li> <li>description... Quoted text or HIDDEN, appears on throttle buttons</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#unjoin","title":"UNJOIN","text":"<p>Disconnects PROG track from MAIN</p> <p>see JOIN</p>"},{"location":"products/ex-commandstation/exrail/command-list/#unlatchvpin","title":"UNLATCH(vpin)","text":"<p>removes latched on flag</p> <p>see LATCH</p> <ul> <li>vpin (limited to 0..255)</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#virtual_signalsignal_id","title":"VIRTUAL_SIGNAL(signal_id)","text":"<p>Defines a virtual (no hardware) signal, use ONhandlers to simulate hardware</p> <p>see SIGNAL ONRED ONAMBER ONGREEN</p>"},{"location":"products/ex-commandstation/exrail/command-list/#virtual_turnoutiddescription","title":"VIRTUAL_TURNOUT(id,description...)","text":"<p>Defines a virtual (no hardware) turnout, use ONhandlers to simulate hardware</p> <p>see TURNOUT ONCLOSE ONTHROW</p> <ul> <li>description... quoted text or HIDDEN</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#bitmap_andvpin1mask","title":"BITMAP_AND(vpin1,mask)","text":"<p>Performs a bitwise AND operation on the given vpin analog value and mask.</p> <ul> <li>mask Binary mask to be ANDed with vpin1 value</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#bitmap_incvpin","title":"BITMAP_INC(vpin)","text":"<p>Increments pseudo analog value by 1</p>"},{"location":"products/ex-commandstation/exrail/command-list/#bitmap_decvpin","title":"BITMAP_DEC(vpin)","text":"<p>Decrements pseudo analog value by 1  (to zero)</p>"},{"location":"products/ex-commandstation/exrail/command-list/#bitmap_orvpin1mask","title":"BITMAP_OR(vpin1,mask)","text":"<p>Performs a bitwise OR operation on the given vpin analog value and mask.</p> <ul> <li>mask Binary mask to be ORed with vpin1 value</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#bitmap_xorvpin1mask","title":"BITMAP_XOR(vpin1,mask)","text":"<p>Performs a bitwise XOR operation on the given vpin analog value and mask.</p> <ul> <li>mask Binary mask to be XORed with vpin1 value</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#waitforpin","title":"WAITFOR(pin)","text":"<p>Waits for completion of servo movement</p>"},{"location":"products/ex-commandstation/exrail/command-list/#waitforttturntable_id","title":"WAITFORTT(turntable_id)","text":"<p>waits for completion of turntable movement</p>"},{"location":"products/ex-commandstation/exrail/command-list/#wait_while_redsignal_id","title":"WAIT_WHILE_RED(signal_id)","text":"<p>Keeps loco at speed 0 while signal is RED</p>"},{"location":"products/ex-commandstation/exrail/command-list/#withrottlemsg","title":"WITHROTTLE(msg)","text":"<p>Broadcasts a string in Withrottle protocol format to all throttles using this protocol.</p> <ul> <li>msg quoted string</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#xfoffcabfunc","title":"XFOFF(cab,func)","text":"<p>Turns function off for given loco</p> <ul> <li>func function number</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#xfoncabfunc","title":"XFON(cab,func)","text":"<p>Turns function ON for given loco</p>"},{"location":"products/ex-commandstation/exrail/command-list/#xftogglecabfunc","title":"XFTOGGLE(cab,func)","text":"<p>Toggles function state for given loco</p>"},{"location":"products/ex-commandstation/exrail/command-list/#xfwdcabspeed","title":"XFWD(cab,speed)","text":"<p>Sends DCC speed to loco in forward direction</p> <ul> <li>speed (0..127, 1=ESTOP)</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#xrevcabspeed","title":"XREV(cab,speed)","text":"<p>Sends DCC speed to loco in reverse direction</p> <ul> <li>speed (0..127, 1=ESTOP)</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#xpomcabcvvalue","title":"XPOM(cab,cv,value)","text":"<p>Sends DCC speed to loco in reverse direction</p> <ul> <li>cab loco id</li> <li>cv  to be updated</li> <li>value to be written to cv</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#xrestore_speedcab","title":"XRESTORE_SPEED(cab)","text":"<p>Resumes locos saved speed</p> <ul> <li>cab loco id see XSAVE_SPEED</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#xsave_speedcab","title":"XSAVE_SPEED(cab)","text":"<p>Resumes locos saved speed</p> <ul> <li>cab loco id see XRESTORE_SPEED</li> </ul>"},{"location":"products/ex-commandstation/exrail/command-list/#ztestcommandtestcode","title":"ZTEST(command,testcode...)","text":"<p>Developer Unit testing.  Do not use. </p>"},{"location":"products/ex-commandstation/exrail/command-list/#ztest2commandreply","title":"ZTEST2(command,reply)","text":"<p>Developer Unit testing.  Do not use.</p>"},{"location":"products/ex-commandstation/exrail/command-list/#ztest3commandreplytestcode","title":"ZTEST3(command,reply,testcode...)","text":"<p>Developer Unit testing.  Do not use. </p> <p>Autogenerated from devel/EXRAIL2MacroBase.h at Tue Feb 17 07:28:33 UTC 2026</p>"},{"location":"products/ex-commandstation/exrail/exrail/","title":"What is EXRAIL?","text":"<p>EXRAIL is an \u201cEXtended Railroad Automation Instruction Language\u201d used to:</p> <ul> <li>Describe your turnouts, signals etc.</li> <li>Configure your Command Station to understand the hardware and accessories you have attached.</li> <li>Handle what to do when things happen (e.g. a button is pressed)</li> <li>Create automated route settings through your layout</li> <li>Move things, make sounds, flash lights</li> <li>Drive trains under automatic control</li> <li>Implement mimic panels and control panels</li> <li>Display status information or platform announcements on OLED screens.</li> </ul>"},{"location":"products/ex-commandstation/exrail/exrail/#you-dont-need","title":"You DON\u2019T need","text":"<ul> <li>JMRI, or any additional utilities</li> <li>Engine Driver, wiThrottle, or any other WiThrottle app</li> <li>A separate computer living under your layout</li> <li>Knowledge of C++ or Python/Jython programming</li> </ul> <p>Although EXRAIL has more than 100 individual commands available, it is generally easier to work from the how-to cookbook examples rather than attempt to understand every feature. It's important to understand a few principles first.</p>"},{"location":"products/ex-commandstation/exrail/exrail/#important-background-information","title":"Important Background Information","text":"<ul> <li>EXRAIL scripts are written into a file called myAutomation.h which you can edit with any suitable text editor. You don't need any extra tools installed on your PC that you don't already have in VSCode or the EX-Installer.</li> <li>When you upload the command station with the DCC-EX code, myAutomation.h is used by the compiler to configure the software and embed any sequences so that the command station can run without further assistance from your PC. If you change myAutomation.h then you must upload again.</li> <li>EXRAIL can run multiple sequences simultaneously so it's great for annoying Arduino programmers who find that extremely complex to do in C++.</li> </ul>"},{"location":"products/ex-commandstation/exrail/exrail/#basic-building-blocks","title":"Basic building blocks","text":"<p>There are a few basic building blocks that will appear in the examples:</p> <ul> <li><code>SEQUENCE</code> - Simply a list of things to be done in order. These things might be to actually drive a train around, or merely to set some turnouts or flash some scene or panel lights. Actions can be made to wait for conditions to be met, like a sensor detecting a train, a button being pushed, or a period of time elapsing. e.g.</li> </ul> <pre><code>  SEQUENCE(27) // Close crossing gates\n    BLINK(100,500,500) // start flasher\n    DELAY(4000)\n    SERVO(200,30,Slow) // move barrier\n    DONE   // sequence completed\n</code></pre> <ul> <li><code>ROUTE</code> \u2013 A special type of SEQUENCE that is made visible to a throttle with a readable name so the user can press a button to get the sequence executed. This might be best used to set a series of turnouts and signals to create a route through the layout. For example</li> </ul> <pre><code>  ROUTE(1,\"Platform A to Mainline\")\n    THROW(27) // set turnouts\n    CLOSE(6)\n    GREEN(101) // change departure signal\n    DONE \n</code></pre> <ul> <li><code>AUTOMATION</code> \u2013 A special type of SEQUENCE that is made visible to a throttle so that a user can hand over a loco and let EXRAIL drive the train away, following each step listed in the sequence. For example, a user could manually drive a train into a station and press a handoff button in the throttle to run an AUTOMATION to take it on a journey around the layout.</li> </ul> <pre><code>  AUTOMATION(17,\"Depart to Byeckaslike\")\n    FWD(20) // start slowly\n    AT(167) // when we reach sensor 167\n    SPEED(55)\n    AT(168) // approaching station\n    SPEED(10) // slow down\n    AT(169) // at the terminus\n    ESTOP // stop dead\n    DONE\n</code></pre> <ul> <li>ON-[HANDLER] \u2013 a sequence that is automatically started when some event happens. For example when a button is pressed (ONBUTTON) or a turnout is changed (ONTHROW / ONCLOSE) so you can intercept turnout/point changes to automatically adjust signals or other turnouts.</li> </ul> <pre><code>ONBUTTON(167)\n  RED(108)\n  THROW(6)\n  GREEN(112)\n  DONE\n</code></pre>"},{"location":"products/ex-commandstation/exrail/exrail/#a-users-story","title":"A users story","text":"<p>I have used C++ on Arduino\u2019s and Python/Jython on JMRI software to build Automation sequences. I now use EXRAIL instead because:</p> <ul> <li> <p>It\u2019s significantly easier and more flexible than the other two options.</p> </li> <li> <p>I reduce the number of Uno and Nano accessory boards needed to do the same tasks on the layout by using the DCC-EX Command Station and embedded EXRAIL instead.</p> </li> <li> <p>I can create Automations, Routes, &amp; Sequence scripts With EXRAIL on the Command Station and still access them from JMRI PanelPro and DecoderPro GUI buttons with a simple sendDCCmessage.py script pointer that passes them to the EXRAIL scripts on the Command Station, so I don\u2019t have to rewrite the script in Jython/Python.</p> </li> <li> <p>EXRAIL is ten times easier to learn and use and is more flexible than the other methods.</p> </li> </ul>"},{"location":"products/ex-commandstation/exrail/vpins/","title":"Virtual Bitmap device pins (VPINs)","text":"<p>A VPIN is an Arduino pin number that has been extended to include pins on external devices or expanders.</p> <p>By giving external device pins unique VPIN numbers, the vast majority of the pin manipulation required by the user is controlled the same way regardless of whether the pin is an actual Arduino pin on the main CPU, an expander pin over i2c perhaps behind a multiplexer, a virtual pin or even a software-only pin simulation.</p> <p>The vast majority of VPINs are either output (e.g. LEDs and servos) or input (e.g. buttons and sensors) but rarely both.  </p>","boost":4},{"location":"products/ex-commandstation/exrail/vpins/#creating-virtual-pins","title":"Creating virtual pins","text":"<p>Virtual pins are normally defined by specifying the Hardware Driver that is used to connect to an external device. There is no way for the command station to know for sure what devices are connected so it must be told. This is done by including HAL commands in myAutomation.h which configure the device.</p> <p>For Example</p> <pre><code>    HAL(PCA9685, 100, 16, 0x40) \n    HAL(PCA9685, 116, 16, 0x41) \n    HAL(PCA9685, 132, 16, 0x42) \n    HAL(PCA9685, 148, 16, {I2CMux_0,SubBus_4,0x43})\n\n    HAL(MCP23017, 164, 16, 0x20) \n    HAL(MCP23017, 180, 16, 0x21) \n</code></pre> <p>This would create VPINs 100 to 115 to represent the 16 servo outputs on the first PCA9685 servo control board at I2C address 0x40 and VPINs 164 to 179 on the first MCP23017 i/o expander. VPINs for two PCA9685 and two MCP23017 are pre-defined, except for PCA9685 used with Nucleo-144. Refer to wiring details and fuller list of supported I2C devices elsewhere.</p>","boost":4},{"location":"products/ex-commandstation/exrail/vpins/#using-output-vpins","title":"Using OUTPUT VPINS","text":"<p>Pin values can be changed with basic digital pin commands common to all VPINs.  In EXRAIL</p> <p><code>SET(180)</code> <code>RESET(180)</code>  sets value HIGH or LOW.</p> <p><code>SET(181,5)</code> or <code>RESET(181,5)</code>  sets/resets a range of pins (181..185 in this case).</p> <p><code>BLINK(180,250,750)</code> sets pin 180 blinking for 250mS on and 750mS off. Blinking is stopped by a SET or RESET of the pin.</p> <p>Serial commands can set HIGH/LOW values to VPINs using <code>&lt;z 180&gt; &lt;z -180&gt;</code> as for any digital output.</p>","boost":4},{"location":"products/ex-commandstation/exrail/vpins/#using-input-vpins","title":"Using INPUT VPINs","text":"<p><code>IF(200)</code> tests if pin value is HIGH.</p> <p><code>ONBUTTON(200)</code> triggers when a pin goes HIGH. This is most useful for push buttons connected between the pin and ground. This causes a new EXRAIL task to start and switch bounce will be ignored until the task completes.</p> <p>For example:</p> <pre><code>ONBUTTON(202) \n   RED(11) \n   THROW(2)\n   CLOSE(1)\n   GREEN(12)\n   DONE\n</code></pre> <p><code>ONSENSOR(200)</code> triggers when a sensor changes state. This is less useful and you need to use <code>IF(200)</code> to see what state the sensor has changed to.</p> <p>Other more advanced commands are available, see cookbooks.</p>","boost":4},{"location":"products/ex-commandstation/exrail/vpins/#using-inputoutput-vpins","title":"Using INPUT/OUTPUT VPINs","text":"<p>Bitmap pins are software flags with no actual hardware implementation. They can be used as INPUT and OUTPUT and thus can be used as flags between EXRAIL processes.  See Bitmaps</p>","boost":4},{"location":"products/ex-commandstation/exrail/cookbooks/animation-sensors/","title":"Buttons and Switches","text":"<p>Buttons and switches are connected to an input vpin, usually on an expander such as an MCP23017 which provides a number of input or output pins.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/animation-sensors/#detecting-a-button-press","title":"Detecting a button press","text":"<p>The ONBUTTON(x) sequence is started when the vpin x is made HIGH by a button press or other sensor being triggered.</p> <pre><code>ONBUTTON(172)\n  PRINT(\"Moooving on\")\n  SERVO(135,417) // move cow out of the way\n  DELAY(4000)  // wait \n  THROW(3) // throw turnout 3 \n  GREEN(130) // set a signal\n  DONE\n</code></pre> <p>Repeated pressing of the button will be ignored until the DONE has completed.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/animation-sensors/#detecting-a-switch-change","title":"Detecting a switch change","text":"<p>The ONSENSOR(x) sequence is started when an input vpin changes state between HIGH and LOW. You will probabaly need to check the state inside the sequence using an IF(x) command.</p> <pre><code>ONSENSOR(176)\n  IF(176) \n    PRINT(\"Sensor 176 gone HIGH\")\n    GREEN(110) // set signal\n  ELSE\n    PRINT(\"Sensor 176 gone LOW\")\n    RED(110)  // set signal\n  ENDIF\n  DONE\n</code></pre> <p>Note: Switches are not suitable for controlling turnouts because the command station cant reach out a finger and change the switch position when the turnout is changed from a throttle or some other EXRAIL script. (Unless of course, you are into animating a servo to do just that!)</p> <p>You can toggle a turnout with a single button</p> <pre><code>ONBUTTON(172) TOGGLE_TURNOUT(7) DONE\n</code></pre> <p>Or have 2 buttons</p> <pre><code>ONBUTTON(172) THROW(7) DONE\nONBUTTON(173) CLOSE(7) DONE\n</code></pre>"},{"location":"products/ex-commandstation/exrail/cookbooks/dc-tracks/","title":"DC Track Control","text":"<p>Refer to Running a DC layout</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/estop-button/","title":"Emergency stop button","text":"<p>An emergency stop is a way of stopping all locos immediately. DCC locos often have sustainers that are there to allow the loco to move over short sections of dirty track or insulated turnout frogs. Because of these sustainers, turning off the track power is not a reliable way of stopping trains, those with sustainers may continue moving for serveral metres/yards. To stop a loco immediately, the powewr must remain on and we must send it a particular DCC packet and the decoder will know to stop.  </p>"},{"location":"products/ex-commandstation/exrail/cookbooks/estop-button/#estopall","title":"ESTOPALL","text":"<p>The ESTOPALL command will stop all locos and inform all throttles. In this example, ONBUTTON(173) will start a sequence at this point when a button on vpin 173 is pressed. The DONE command completes/terminates the process started by ONBUTTON.</p> <pre><code>ONBUTTON(173) ESTOPALL DONE\n</code></pre> <p>However, ESTOPALL does have disadvantages:</p> <ul> <li>Nothing prevents a throttle or EXRAIL script sending in a speed command a fraction of a second later</li> <li>Users can throttle up when they are ready, but an EXRAIL script may be stuck waiting for a loco to arrive somewhere and with no way of restarting it.</li> </ul>"},{"location":"products/ex-commandstation/exrail/cookbooks/estop-button/#estop_pause","title":"ESTOP_PAUSE","text":"<p>The ESTOP_PAUSE command can be used to stop all traffic and block all train movement. Perfect for things like pausing all traffic after a derailment.</p> <pre><code>ONBUTTON(173) ESTOP_PAUSE DONE\n</code></pre> <p>When paused:</p> <ul> <li>the speed of each loco at the time of the pause is not forgotten</li> <li>throttles can be moved, perhaps to adjust a train that was causing the panic, but all locos will remain stopped.</li> </ul>"},{"location":"products/ex-commandstation/exrail/cookbooks/estop-button/#estop_resume","title":"ESTOP_RESUME","text":"<p>ESTOP_RESUME is used to restart the locos at their previous speed, or at the speed that was modified during the pause.</p> <pre><code>ONBUTTON(174) ESTOP_RESUME DONE\n</code></pre>"},{"location":"products/ex-commandstation/exrail/cookbooks/estop-button/#advanced-scenarios","title":"Advanced scenarios","text":"<p>Of course you may wish to enhance the control by adding flashing lights, sounds or other effects.</p> <pre><code>ONBUTTON(173) \n  ESTOP_PAUSE \n  BLINK(180,250,250)\n  PLAY_SOUND(8000,6) // \"Don't Panic\"\n  DONE\n\nONBUTTON(174) \n  PLAY_SOUND(8000,7) // \"Stand clear of the layout, resuming\"\n  DELAY(2000)\n  RESET(180) \n  DELAY(1000)\n  ESTOP_RESUME \n  DONE\n</code></pre> <p>In some cases you may prefer that the system is locked but movement does not restart automatically when the resume is issued. This can be achieved by performing an ESTOPALL immediately before resuming. This forces all locos to have a current speed of 0 before releaseing the speed reminders onto the track.</p> <pre><code>ONBUTTON(174) \n  ESTOPALL\n  ESTOP_RESUME \n  DONE\n</code></pre> <p>You may have a situation, like a lifting gate on your layout, where you need to prevent movement when the Command Station is started with the gate open.</p> <p>This example runs at startup and will check the gate switch on pin 174 to block all movement if it is open.</p> <pre><code>AUTOSTART \n  IF(174) \n    ESTOP_PAUSE\n    ENDIF\n  DONE\n</code></pre>"},{"location":"products/ex-commandstation/exrail/cookbooks/estop-button/#estop-serial-commands","title":"ESTOP serial commands","text":"<p>For convenience thare are also serial commands that have the same function:</p> <ul> <li><code>&lt;!&gt;</code> equivalent to ESTOPALL</li> <li><code>&lt;!P&gt;</code> equivalent to ESTOP_PAUSE</li> <li><code>&lt;!R&gt;</code> equivalent to ESTOP_RESUME</li> <li><code>&lt;!Q&gt;</code> used by throttles to request the esop status (When a throttle starts up, it will not have seen any previous status broadcast messages)</li> </ul>"},{"location":"products/ex-commandstation/exrail/cookbooks/roster-similar-locos/","title":"Roster for Similar Sound Locos","text":"<p>The ROSTER command in EXRAIL can be tedious if you have several sound locos with the same function settings. Using a preprocessor definition saves typing.</p> <pre><code>ROSTER(1201,\"Red class 99\",\"light/*horn/flash/bang/wallop/squeal/honk\") \nROSTER(1202,\"Green class 99\",\"light/*horn/flash/bang/wallop/squeal/honk\") \n</code></pre> <p>Can be simplified by pre-defining the functions:</p> <pre><code>#define CLASS99F \"light/*horn/flash/bang/wallop/squeal/honk\" \nROSTER(1201,\"Red class 99\",CLASS99F) \nROSTER(1202,\"Green class 99\",CLASS99F) \n</code></pre> <p>This technique is particularly useful for rostering DC tracks where the function keys are related to PWM frequency:</p> <pre><code>#define DCFuncs\"/////////////////////////////FQ490 Hz/FQ3400 Hz/FQ62500 Hz\"\nROSTER(1225,\"DC TRACK B 1225\",DCFuncs)\nROSTER(1226,\"DC TRACK C 1226\",DCFuncs)\n</code></pre> <p>It is also possible to utilise the compiler rule that \"Hello\" \"Sailor\" is treated as \"HelloSailor\". This means that common functions can be used with loco specific additions.</p> <pre><code>#define CommonFuncs \"light/*horn\" \nROSTER(1201,\"Noisy class 99\",CommonFuncs \"/flash/bang/wallop/squeal/honk\") \nROSTER(1202,\"Quieter class 99\",CommonFuncs) \n</code></pre>"},{"location":"products/ex-commandstation/exrail/cookbooks/route-button-control/","title":"Route button control","text":"<p>Route buttons appear on the throttle and can be controlled from EXRAIL to hide, disable or recaption the button. Everything here applies equally to AUTOMATIONs.</p> <p>If a route button can be in one of 4 states:</p> <ul> <li>Inactive (waiting to be pressed)</li> <li>Active (highlighted as if selected)</li> <li>Disabled (you can't press this)</li> <li>Hidden (the entire route is not visible on the throttle)</li> </ul> <p>This allows EXRAIL to prevent multiple conflicting routes to be set, or to replace the default \"Set\" button with open/close, start/stop, yes/no, on/off or whatever makes most sense in context.</p> <p>Here are examples of solving the same problem but with different user experiences. In this case we want a way of setting a light on or off.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/route-button-control/#simple-light-switch-route","title":"Simple light switch route","text":"<p>This example just has the logic to switch a light on/off with the \"Set\" button.  It uses the route state to remember whether the light is on or off.  Note that the route state will default to inactive and the light will default to off.</p> <pre><code>ROUTE(600,\"Shed lights\")\n  IFROUTE_ACTIVE(600)  // is the light on? \n    RESET(120)        // lights off\n    ROUTE_INACTIVE(600)\n  ELSE  // light is off \n    SET(120)  // lights on\n    ROUTE_ACTIVE(600)\n  ENDIF\nDONE\n</code></pre>"},{"location":"products/ex-commandstation/exrail/cookbooks/route-button-control/#changing-button-captions","title":"Changing button captions","text":"<p>The same logic includes changing the button caption from \"Set\" to \"Turn On\" or \"Turn Off\". The AUTOSTART section is to make sure the caption is set correctly at startup.</p> <pre><code>ROUTE(600,\"Shed lights\")\n  IFROUTE_ACTIVE(600)  // is the light on? \n    RESET(120)        // lights off\n    ROUTE_INACTIVE(600)\n    ROUTE_CAPTION(600,\"Turn on\") // change button caption\n  ELSE  // light is off \n    SET(120)  // lights on\n    ROUTE_ACTIVE(600)\n    ROUTE_CAPTION(600,\"Turn off\") // change button caption\n  ENDIF\nDONE\n\nAUTOSTART\n  ROUTE_CAPTION(600,\"Turn on\") // set button caption default at startup\nDONE\n</code></pre>"},{"location":"products/ex-commandstation/exrail/cookbooks/route-button-control/#two-separate-routes-example","title":"Two separate routes example","text":"<p>This example has two \"routes\" to control lights, but only one of them will be visible at a time so we dont need a flag. Each route will have the default \"Set\" button.</p> <pre><code>ROUTE(600,\"Shed lights on\")\n  SET(120)\n  ROUTE_HIDDEN(600) // hide self\n  ROUTE_INACTIVE(601) // reveal off \n  DONE\n\nROUTE(601,\"Shed lights off\")\n  RESET(120)\n  ROUTE_HIDDEN(601)\n  ROUTE_INACTIVE(600)\n  DONE\n\nAUTOSTART\n    ROUTE_HIDDEN(601)  // shed lights are off already\n  DONE\n</code></pre> <p>EXRAIL hs the full set of route setting and testing commands which should be self explanitory once the above simple examples have been understood. Each route can only be in one of the 4 states.</p> <pre><code>IFROUTE_INACTIVE(route_id)\nIFROUTE_ACTIVE(route_id)\nIFROUTE_HIDDEN(route_id)\nIFROUTE_DISABLED(route_id)\n\nROUTE_INACTIVE(route_id)\nROUTE_ACTIVE(route_id)\nROUTE_HIDDEN(route_id)\nROUTE_DISABLED(route_id)\n</code></pre>"},{"location":"products/ex-commandstation/exrail/cookbooks/timecontrol/","title":"Time Control","text":"<p>The Command Station has additional commands added to exrail allow events to be controlled by a EX-FastClock.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/timecontrol/#time-command","title":"Time Command","text":"<p>The basic form of the clock command is:</p> <pre><code>ONCLOCKTIME( hour, mins)\n</code></pre> <p>This is an event based command and will activate a sequence of commands until a DONE command is reached.  An example of how this might be used is as follows:</p> <pre><code>ONCLOCKTIME(06,15) \n  SETLOCO(7309) \n  ....\n  .... Do some stuff\n  ....\n  DONE\n</code></pre> <p>Sequences built this way can only be run via a clock command.  If it was required to have a sequence that could be run for Engine Driver for example, then this could be operated by a clock command as below:</p> <pre><code>ONCLOCKTIME(06,15) SENDLOCO(7309,10) DONE\n\nSEQUENCE(10)\n    PRINT(\"Go Somewhere\")\n    FON(1)\n    DELAY(500)\n    FWD(50)\n    DELAY(20000)\n    FWD(0)\n    DELAY(2000)\n    FON(4)\n    DELAY(3000)\n    FOFF(4)\n    PRINT(\"You have arrived\")\n    FOFF(1)\nDONE\n</code></pre> <p>This event could either be run by the clock or could be selected at will from Engine Driver.  To stop the Command Station from running timed commands to switch to manual running, simply pause the clock.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/timecontrol/#repeating-time-events","title":"Repeating Time events","text":"<p>Some users may wish to repeat an event at the same time every hour - e.g. to play a recording of a clock chime.  It is possible to achieve this as follows:</p> <pre><code>ONCLOCKMINS( mins )\n</code></pre> <p>This is an event based command that will activate at the same time each hour as in the example below:</p> <pre><code>ONCLOCKMINS(15) \n  SET(1000)             // Start playing first MP3 file\n  AT(-1000)             // Wait for playing to finish\n  RESET(1000)           // Stop player \n  ....\n  .... Do some other stuff\n  ....\nDONE\n</code></pre> <p>The sequence above will repeat at 15 munites past the hour per FastClock time.  It would also be possible to make these routines be selectable from Engine Driver by configuring them as follows:</p> <pre><code>ONCLOCKMINS(15) FOLLOW(10) DONE\n\nSEQUENCE(10)\n  SET(1000)             // Start playing first MP3 file\n  AT(-1000)             // Wait for playing to finish\n\n  RESET(1000)           // Stop player \n  ....\n  .... Do some other stuff\n  ....\nDONE\n</code></pre> <p>In that way the Sequence 10 can either be run by the clock, or if the clock is not running may be selected manually from Engine Driver.</p> <p>NB:  See the following page for details on running sound files.</p> <p>( add a refernce )</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/timecontrol/#testing-timed-sequences","title":"Testing Timed Sequences","text":"<p>If one is testing out a sequence using a timed command it can be done quickly without using the clock.  The following command can be entered from the System Monitor:</p> <pre><code>&lt;JC mmmm ss&gt; \n</code></pre> <p>where mmmm is the time in minutes since midnight.  This is (hours * 60) + mins and is how the time is held within  Command Station.  So for the time in the example above (6:15) the following:</p> <pre><code>&lt;JC 375 4&gt;\n</code></pre> <p>would execute the command immediately (4 being the perceived speed factor i.e. 1 minutes every 15 seconds).  The  Command Station would respond with:</p> <pre><code>&lt;jC 375&gt;\n</code></pre> <p>And would then display any messages generated by the SEQUENCE 10.</p> <p>The final command available is:</p> <pre><code>  &lt;JC&gt;\n</code></pre> <p>which requests the latest time from  Command Station which responds with:</p> <pre><code>  &lt;jC 375&gt;\n</code></pre>"},{"location":"products/ex-commandstation/exrail/cookbooks/advanced/analog-sensors/","title":"Analog sensors","text":"<p>Sensors that read analog values are comparatively rare for model railway use but are sometimes used to detect a binary state depending on the current detected by a sensor.</p> <p>ADS1113 and ADS1114 are restricted to 1 input.  ADS1115 has 4 way multiplexer which allows any of four input pins to be read by its ADC.</p> <p>The ADS111x is set up so that the maximum input voltage of 5V (when Vss=5V) gives a reading of 32767*(5.0/6.144) = 26666.</p> <p>A device like the above is defined in EXRAIL by</p> <pre><code>HAL(ADS1113,300, 1, 0x48);  // single-input ADS1113 on vpin 300\n// or\nHAL(ADS1115,300, 4, 0x48);  // four-input ADS1115 on pins 300..303\n</code></pre> <p>To monitor a vpin like this for a binary decision</p> <pre><code>AUTOSTART SEQUENCE(99)\nATGTE(300,1000) // wait intil vpin 300 reaches 1000 or greater\n... do something\nATGTE(300,950) // wait until it drops back below 950\n.. do something else\nFOLLOW(99) // continue monitoring\n</code></pre>"},{"location":"products/ex-commandstation/exrail/cookbooks/advanced/command-filter/","title":"Command Filters","text":"<p>A command filter intercepts <code>&lt; &gt;</code> type commands from throttles or the serial monitor and can be used to override, block or modify existing commands and implement completely new commands.</p> <p>The following code, added to myAutomation.h like any other EXRAIL code, gives a basic example.</p> <pre><code>STEALTH_GLOBAL(\n  void myFilter(Print * stream, byte &amp; opcode, byte &amp; paramCount, int16_t p[]) {\n    (void)stream;\n    // use command &lt;U locoid&gt; to display name from roster\n    if (opcode == 'U' &amp;&amp; paramCount == 1) {\n      auto locoId=p[0];\n      auto name=RMFT2::getRosterName(locoId);\n      if (!name) return; // caller will &lt;X&gt; this\n      opcode=0; // caller can now ignore this\n      StringFormatter::lcd(0, F(\"Loco %d name %S\"), locoId, name);\n    }\n  }\n)\n</code></pre> <ul> <li>All <code>&lt;&gt;</code> commands will be broken into an opcode and numeric parameters before being passed to myFilter.</li> <li>You can only have one myFilter function but it can filter multiple commands by inspecting the opcode.</li> <li>The filter function can inspect or modify the opcode and parameters, make changes and return. If the opcode is set to 0, the caller will assume that the filter has completely handled the command and will not check it further.  </li> <li>Output directed to the stream parameter will be transmitted back to the originating throttle. If no output is expected then casting to void is a good way of eliminating the \"unused parameter\" compiler warning.</li> <li>the <code>&lt;U&gt;</code> and <code>&lt;u&gt;</code> opcodes are reserved for use by users. They will not clash with any future DCC-EX commands.  </li> <li>Although this is a conventional c++ function, the use of STEALTH_GLOBAL in EXRAIL avoids the need to #include a vast array of weird and wonderful API and memory management definitions.</li> <li>To recognize keyword parameters (e.g <code>&lt;1 MAIN&gt;</code>) you would test using the _hk suffix like this</li> </ul> <pre><code> if (opcode == '1' &amp;&amp; paramCount == 1 &amp;&amp; p[0] == \"MAIN\"_hk) \n</code></pre>"},{"location":"products/ex-commandstation/exrail/cookbooks/advanced/display-locos-on-oled/","title":"Display Loco speeds on OLED (Advanced)","text":"<p>The following example creates a C++ function to display loco details on an OLED screen. By using a generic HAL driver, the function can be invoked repeatedly according to a time delay.</p> <p>BEWARE that code like this is sensitive to many restrictions such as time taken and memory use. It is also subject to version changes in some of the internal dcc-ex routines so is only given here as an example.</p> <p>EXRAIL macros cannot be used inside STEALTH sections. Users using STEALTH and STEALTH_GLOBAL are expected to understand the implications and the C++ language features used and the need to avoid any lengthy process.</p> <p>The STEALTH_GLOBAL macro allows the creation of C++ functions within the command station environment. This function displays the first 8 locos in the DCC speed reminders table on LCD/OLED screen 2.</p> <p>Notice that it will only update one OLED row per call, and will not update the row if the speed byte has not changed. This is because OLED updates are very \"expensive\" in terms of cpu time and I2C traffic volumes and attempting to do too much in one call can cause blocking of other more important functions.</p> <pre><code>STEALTH_GLOBAL(\n  void updateLocoScreen() {\n    const byte loco_slots=8;\n    static byte current_slot=loco_slots-1;\n    static byte shown_speed[loco_slots]; // remember whats already shown\n    static bool first_call=true;\n\n    if (first_call) {\n      first_call=false;\n      for (int i=0; i&lt;loco_slots; i++) shown_speed[i]=127;\n    }\n\n    // switch to next row\n    current_slot= (current_slot + 1) % loco_slots;\n    auto loco=DCC::speedTable[current_slot].loco;\n    if (loco&lt;0) return; // this slot is no longetr used\n    if (loco==0) return; // we are beyond the last loco   \n\n    auto speed = DCC::speedTable[current_slot].speedCode;\n    if (speed== shown_speed[current_slot]) return; // no change in speed\n    shown_speed[current_slot] = speed; // remember speed for next time\n\n    auto direction = (speed &amp; 0x80) ? 'F' : 'R';\n    speed = speed &amp; 0x7f;\n    if (speed &gt; 0) speed = speed - 1; // make it look like JMRI\n    StringFormatter::lcd2(2, current_slot+2, F(\"Loco:%4d %3d %c\"), loco, speed, direction);\n  }\n)\n</code></pre> <p>To ensure the function is called twice per second we use the UserAddin HAL feature. The LCD/OLED number 2 used by the function is connected by I2C. </p> <pre><code>HAL(UserAddin,updateLocoScreen,500) \nHAL(HALDisplay&lt;OLED&gt;, 2, 0x3d, 128, 64)  \n</code></pre>"},{"location":"products/ex-commandstation/exrail/cookbooks/advanced/passing-locos-between-sequences/","title":"Passing locos between sequences","text":"<p>Each of the methods below involves creating a new Exrail task that will run in parallel with the current task. The difference is in how the locoid information is passed to the new sequence.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/advanced/passing-locos-between-sequences/#startsequence_id","title":"START(sequence_id)","text":"<p>Start a new task with no loco attached.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/advanced/passing-locos-between-sequences/#sendlocoloco_idsequence_id","title":"SENDLOCO(loco_id,sequence_id)","text":"<p>Start a new task with the given loco id</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/advanced/passing-locos-between-sequences/#start_sendsequence_id","title":"START_SEND(sequence_id)","text":"<p>Hands over the current loco to the new task. The current task is no longer connected to this loco.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/advanced/passing-locos-between-sequences/#start_sharedsequence_id","title":"START_SHARED(sequence_id)","text":"<p>Shares the loco with the new task. For example the new task may flash the loco lights to a disco beat while the original task continues to drive the loco.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/driving-trains/advanced/","title":"Controlling trains and decoders directly","text":"<p>For the majority of loco control, a task is running with a specific loco in mind, this means that commands like <code>STOP</code>, <code>SPEED(20)</code>, <code>REV(10)</code> etc. do not need to know the loco id at the time you write the sequence. Indeed, the same sequence may be running in multiple parallel tasks controlling different locos.</p> <p>In other circumstances, it may be necessary to be more explicit, for example switching the carriage lights on a known train. In these cases the X.. functions exist to make explicit calls to a given decoder without having to know or disturb the current task's loco id.</p> <p>These commands are</p> <pre><code>XFWD(loco,speed)\nXREV(loco,speed)\nXFON(loco,function)\nXFOFF(loco,function)\nXFTOGGLE(loco,function)\nXPOM(loco,cv,value)\nXSAVE_SPEED(loco)\nXRESTORE_SPEED(loco)\n</code></pre> <p>Note that speed is saved at the loco level, not the exrail task.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/driving-trains/automations/","title":"AUTOMATIONS","text":"<p>An AUTOMATION is a sequence of EXRAIL commands used to drive a loco.</p> <p>By creating an AUTOMATION in EXRAIL, your throttle will show the automation on its Routes display. To send a loco along an AUTOMATION, you must first drive the loco to a point where the automation can start and then select the automation from the routes screen of your throttle.</p> <p>The automation will take over driving the loco but you will still see the throttle moving if the loco changes speed. If you manually alter the speed with the throttle that will take effect normally as the automation spends most of its time in an AT command waiting for the train to reach a sensor, and will not wake up again until the sensor is detected. You may, for example, stop the train manually to fix a derailment, dropped rolling stock or cat sitting on the track. When you restart the loco and drive it to the sensor the automation is expecting, the automation will carry on.</p> <p>Of particular interest, compared with a PC (JMRI, iTrain, RocRail etc) running the loco, EXRAIL is only interested in the sensor your task us trying to reach. This makes it vastly more efficient than even the fastest PC system.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/driving-trains/basic/","title":"Basic driving functions","text":"<p>EXRAIL contains a number of basic commands to drive locos and control their functions such as lights and sounds.</p> <p>Its important to understand that EXRAIL has \"tasks\". A task may be driving loco 3 using sequence(555) while another task is driving loco 7 using a the same or a different sequence. That is why the driving commands below do not refer to the loco address, they take the address from the task executing the sequence.</p> <p>The loco associated with a task can be set with a <code>SETLOCO(locoid)</code> executed within the task, or it can be automatically assigned from a throttle using a hand-off to an AUTOMATION.</p> <p>All driving speeds are in the range 0 to 127 where 0 is a normal stop (where a loco's decoder will usually stop gently as if the driver were applying the brakes) and speed 1 is an emergency stop where the loco will stop immediately without any semblance of momentum. The same speed range applies for DC and when running with 28 speed steps.</p> <ul> <li><code>FWD(speed)</code> will start the loco moving forward at the given speed.</li> <li><code>REV(speed)</code> will start the loco moving in reverse at the given speed.</li> <li><code>SPEED(speed)</code> alters the loc speed without changing the direction.</li> <li><code>STOP</code> is the same as SPEED(0)</li> <li><code>ESTOP</code> is the same as SPEED(1)</li> <li><code>SPEEDUP(by)</code> increases speed (adds by value to speed)</li> <li><code>SLOWDOWN(by)</code> decreases speed (subtracts byvalue)</li> <li><code>SPEED_REL(percent)</code> changes speed to a percentage (1..500) of current speed</li> </ul> <p>Bear in mind that FWD(0) and REV(0) are not quite the same thing as it will affect the loco lights (if the loco has direction changing lights fitted) and may involve sound effects if the loco simulates the driver changing the reversing gear.</p> <p>Usually, a sequence being used to drive a loco will include <code>AT(vpin)</code> commands to continue until a given sensor is detected.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/driving-trains/consists/","title":"Consists","text":"<p>A \"Consist\" refers to multiple locos driving one train. This requires the locos to follow the same throttle commands.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/driving-trains/consists/#consist-types","title":"Consist Types","text":"<p>There are four types of consist:</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/driving-trains/consists/#all-locos-have-the-same-address","title":"All locos have the same address","text":"<p>This involves programming the loco addresses individually. All functions will be read by all locos in the consist. Addresses can be easily programmed on the PROG track with the <code>&lt;W locoid&gt;</code> command. Disadvantages, visitors or club members domt like having their CVs changed.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/driving-trains/consists/#decoder-consist","title":"Decoder consist","text":"<p>The decoders have CVs (19 and 20) to give an address to which they will all respond. Their normal address is not altered. This consist address may be programmed into each loco with the PROG track <code>&lt;W CONSIST id [REVERSE]&gt;</code> command or main track <code>&lt;w locoid CONSIST consistid [REVERSE]&gt;</code>. Disadvantages as above for CV changes.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/driving-trains/consists/#throttle-consist-not-possible-for-exrail","title":"Throttle Consist (NOT POSSIBLE for EXRAIL)","text":"<p>The locos are unchanged and the throttle sends individual speed command to each loco. Disadvantages are that only the throttle knows about the relationship between the locos and that information can't easily be shared with other throttles, so another throttle may command one of the locos differently and cause mayhem. EXRAIL drives on one loco id so cannot drive this kind of consist.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/driving-trains/consists/#command-station-consists","title":"Command Station consists","text":"<p>The command station knows the locos that are in the consist. Any speed commands to the lead loco are transmitted to all following locos. No CVs are modified and any throttle, including EXRAIL  can drive the lead loco or send function commands to the followers.</p> <p>Throttle commands sent to the following locos are ignored but throttles will still see the correct lead loco speed changes.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/driving-trains/consists/#consisting-with-exrail","title":"Consisting with EXRAIL","text":"<p>Command Station consists can be built up with EXRAIL commands:</p> <p><code>BUILD_CONSIST(newloco)</code>  adds the new loco to follow the existing task loco. Specifying newloco as negative means the loco is facing the opposite way to the rest of the consist.</p> <p>For example:</p> <pre><code>SETLOCO(3)        // sets currect loco\nBUILD_CONSIST(77)  // Makes 3 a consist of 3 and 77\nBUILD_CONSIST(88)  // adds loco 88 to the consist\nBUILD_CONSIST(-99) // adds loco 99 facing backwards\nFWD(10) // all 4 locos set off together \n</code></pre>"},{"location":"products/ex-commandstation/exrail/cookbooks/driving-trains/functions/","title":"Loco Functions","text":"<p>Functions can be set on or off. EXRAIL knows nothing about the meaning of each function because this is internal to the loco decoder.</p> <ul> <li><code>FON(func)</code>  turns on a loco function</li> <li><code>FOFF(func)</code> turns off a function</li> </ul> <p>In more advanced cases, an automation driving a loco may need to manage functions on another address, perhaps carriage lights. This can be done with the commands</p> <ul> <li><code>XFON(locoid, function)</code></li> <li><code>XFOFF(locoid, function)</code></li> </ul> <p>For eaxample:</p> <pre><code>... while driving...\n   AT(189)   // passing tunnel\n   FON(0)    // loco lights on\n   FON(8)    // make like a boy-racer  \n   XFON(3001,0) // carriage lights on\n   AT(190)   // at far end of tunnel\n   FOFF(8)   // pretend we didn't do that\n   FOFF(0)   // loco lights off\n   XFOFF(3001,0) // carriage lights off\n... and so on\n</code></pre>"},{"location":"products/ex-commandstation/exrail/cookbooks/driving-trains/improved-shuttle/","title":"Improved shuttle","text":"<p>In this and following examples, the previous example comments have been removed and new changes commented to make them easier to see. Some lines have been joined together to keep the example short on screen and make it generally more human readable.</p> <p>By adding more sensors, the shuttle can be made more realistic, slowing down at station approach and making sounds.</p> <pre><code>Dogbath                                                  Catflap\n||============================================================||\n  |         |                                      |         |\n 164       166                                    167       165\n</code></pre>"},{"location":"products/ex-commandstation/exrail/cookbooks/driving-trains/improved-shuttle/#speed-changes","title":"Speed changes","text":"<p>Using the previous example.</p> <pre><code>AUTOMATION(123,\"Dogbath to Catflap shuttle\")\n  FWD(40)\n  AT(167) SPEED(15) // At Catflap slow down point, change speed\n  AT(165) ESTOP     // ESTOP avoids any momentum issue   \n  DELAYRANDOM(15000,20000)  \n  REV(40)  \n  AT(166) SPEED(15) // At Dogbath slow down point, change speed\n  AT(164) ESTOP \n  DELAYRANDOM(5000,10000)  \n  FOLLOW(123) \n</code></pre>"},{"location":"products/ex-commandstation/exrail/cookbooks/driving-trains/improved-shuttle/#sounds-and-lights","title":"Sounds and lights","text":"<p>Headlight settings and sounds may be added using the FON(functionNumber) and FOFF(functionNumber). These numbers will depend on the features of the loco decoder but it is not an error to send functions to DC or non-sound locos.</p> <pre><code>AUTOMATION(123,\"Dogbath to Catflap shuttle\")\n  FON(0) FON(3) DELAY(2000) FOFF(3) // light on, sound whistle for 2 seconds\n  FWD(40)\n  AT(167) SPEED(15) \n  AT(165) ESTOP\n  FOFF(0)  // turn off light \n  DELAYRANDOM(15000,20000)  \n  FON(0) FON(3) DELAY(2000) FOFF(3) // Lights and whistle\n  REV(40)  \n  AT(166) SPEED(15) \n  AT(164) ESTOP \n  DELAYRANDOM(5000,10000)  \n  FOLLOW(123) \n</code></pre>"},{"location":"products/ex-commandstation/exrail/cookbooks/driving-trains/improved-shuttle/#signals","title":"Signals","text":"<p>Signals don't actually control trains, the drivers do. But for model purposes it is sufficient to include signal changes in the engine driving script.</p> <p>In this case we will define a signal at each end of the line using RED &amp; GREEN leds on extender vpins 170..173. and use them to go green when a train is allowed to leave each station. Each signal is then only referred to by the first pin, as you will see.</p> <p>Remember, its just for show because there can be no other trains on this line anyway. (Well at least until we get to some more advanced scenarios.)</p> <p>Define the signals anywhere but not normally inside an AUTOMATION or other sequence.</p> <pre><code>SIGNALH(170,0,171) // Dogbath depart. Red LED on 170, Green on 171, no amber\nSIGNALH(172,0,173) // Catflap Depart. \n\nAUTOMATION(123,\"Dogbath to Catflap shuttle\")\n  GREEN(170) // set Dogbath departure signal to green\n  FON(0) FON(3) DELAY(2000) FOFF(3) \n  FWD(40)\n  AT(167) SPEED(15)\n  RED(170)  // remember to set Dogbath signal red at some point \n  AT(165) ESTOP FOFF(0) \n  DELAYRANDOM(15000,20000)  \n  GREEN(172) // Set Catflap departure signal to green\n  FON(0) FON(3) DELAY(2000) FOFF(3) \n  REV(40)  \n  AT(166) SPEED(15) \n  RED(172) // rember to reset Catflap signal\n  AT(164) ESTOP \n  DELAYRANDOM(5000,10000)  \n  FOLLOW(123) \n</code></pre>"},{"location":"products/ex-commandstation/exrail/cookbooks/driving-trains/passing-loop/","title":"Passing loop shuttle","text":"<p>A passing loop shuttle involving two trains with a passing loop can be controlled quite easily but involves some more advanced concepts.</p> <p>If we have a layout like this:</p> <pre><code>          164           166\n           |             |              Turnout2\nDogbath ||====[1]=====\\====[4]===&lt;&lt;=========\\\n                       \\===[2]===&gt;&gt;==========\\========[3]==========|| Catflap\n                     Turnout1            |                      |\n                                        167                    165\n</code></pre>"},{"location":"products/ex-commandstation/exrail/cookbooks/driving-trains/passing-loop/#block-reservations","title":"Block Reservations","text":"<p>In EXRAIL we operate multiple trains at the same time and coordinate them with block reservations which is an entirely virtual concept but similar to early era real train operations where a driver must obtain a token from the signalman before proceeding into a particular block. In this example, we don't care which train enters the loop first or how it affects the other train. We define (in our minds) the block numbers which are shown in <code>[x]</code> above. There is no need for track breaks or other electronics, just the sensors so a train driver can say \"When I get to the buffers.. STOP!\"</p> <p>For example, a train leaving Dogbath is already occupying <code>[1]</code> but it must reserve <code>[2]</code> before departing in case the other train has been stopped in <code>[2]</code> by a cow on the line. Similarly it cant leave <code>[2]</code> before the other train has cleared <code>[3]</code>.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/driving-trains/passing-loop/#basic-passing-loop-logic","title":"Basic passing-loop logic","text":"<p>So, the sequence starting from Dogbath, going to Catflap will look like this:</p> <pre><code>SEQUENCE(100) \n  DELAYRANDOM(5000,10000)\n  RESERVE(2) // will wait with loco stopped until block 2 is available.\n  THROW(1)   // set the turnout so we will enter the loop correctly\n  FWD(40)    // move off\n  AT(167)    // we are in the West&gt;East loop\n  FREE(1)    // we are no longer in block 1\n  RESERVE(3) // This will stop loco if 3 not yet free, and wait.\n  CLOSE(2)   // set turnout to exit loop\n  FWD(40)    // must resume speed if we were stopped.\n  AT(165)    // when we get to Catflap\n  STOP\n  FREE(2)    // we are not in loop\n  FOLLOW(101) // now follow the Catflap -&gt; Dogbath sequence\n</code></pre> <p>And the Catflap to Dogbath sequence will be a similar logic but in reverse and with different sensors etc.</p> <pre><code>SEQUENCE(101)  // Catflap to Dogbath (loco in reverse)\n  DELAYRANDOM(5000,10000)\n  RESERVE(4) // will wait with loco stopped and until block 4 is available.\n  THROW(2)   // set the turnout so we will enter the loop correctly\n  REV(40)    // move off backwards \n  AT(166)    // we are in the E-&gt;W loop\n  FREE(3)    // we are no longer in block 3\n  RESERVE(1) // This will stop loco if 3 not yet free, and wait.\n  CLOSE(1)   // set turnout to exit loop\n  REV(40)    // must resume speed if we were stopped.\n  AT(164)    // when we get to Dogbath\n  STOP\n  FREE(4)    // we are not in loop\n  FOLLOW(101) // now follow the Dogbath-Catflap sequence \n</code></pre> <p>Notice that you don't drive into an area of the track without first reserving the corresponding block, and you must remember to free it once you have safely left. Also the script above assumes that a train can cause the turnout to change quickly enough if it reaches a sensor in the loop and doesn't need to stop, this can be alleviated if you throw/close the turnout behind you as you reach your loop sensor so that the other train does not need to worry about any slow turnout movement.</p> <p>Please bear in mind that your turnout geometry may be different. The diagram is for two right-hand turnouts, you may have used a left/right pair so modify the THROW/CLOSE statements above to suit.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/driving-trains/passing-loop/#starting-the-shuttle","title":"Starting the shuttle","text":"<p>We have the issue that one train is starting from the far end, and we have to establish the train positions, directions, initial reserved status and where in the sequence they must start.</p> <p>If we assume that:</p> <ul> <li>Loco id 3 is ready at Dogbath and faces Catflap.</li> <li>Loco id 4 is ready at Catflap and faces Catflap (ie BOTH locos face East).</li> </ul> <p>Then we can create a ROUTE that will appear on your throttle and start the sequences.</p> <pre><code>ROUTE(1,\"Start Dogbath-Catflap\")\nFREEALL   // Clear any reserves left over from previous running \nRESERVE(1) // loco is already at Dogbath\nRESERVE(3) // loco is already at Catflap\nSENDLOCO(3,100) // start loco 3 running the sequence from Dogbath\nSENDLOCO(4,101) // start loco 4 running the sequence from Catflap\nDONE\n</code></pre>"},{"location":"products/ex-commandstation/exrail/cookbooks/driving-trains/passing-loop/#handling-facing-trains","title":"Handling facing trains","text":"<p>If your two trains start facing each other from opposite ends of the loop, you must allow for this change otherwise the train starting at Catflap will be told to reverse when leaving, this is embarrassing to say the least.</p> <p>The INVERT_DIRECTION command tells EXRAIL to invert the FWD/REV commands for the current loco in the current task. Rather than duplicate both sequences with different direction commands, or litter them with IFLOCO checks, we can alter the startup to apply this invert to the task running loco 4 before starting at Catflap.</p> <p>Note that EXRAIL is running a separate task for each loco.</p> <pre><code>ROUTE(1,\"Start Dogbath-Catflap\")\nFREEALL   // Make sure all reserves are cleared \nRESERVE(1) \nRESERVE(3)\nSENDLOCO(3,100) \nSENDLOCO(4,102) // start loco 4 running the inverted sequence from Catflap\nDONE\n\nSEQUENCE(102) // run inverted direction commands from Catflap\n INVERT_DIRECTION // tell current task to invert directions \n FOLLOW(101) // carry on \n</code></pre>"},{"location":"products/ex-commandstation/exrail/cookbooks/driving-trains/passing-loop/#advanced-extras","title":"Advanced Extras","text":"<p>Once you have this basic shuttle working, you can use the methods described in previous examples to add signals, sound effects or perhaps a level crossing with gates.</p> <p>You may consider having an intermediate station stop along one end of the line or extend the design to use three locos and two passing loops.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/driving-trains/random-selection/","title":"Random selection","text":"<p>EXRAIL provides a number of randomising functions that make it easy to create more interesting automations that behave in unpredictable ways. This may be as simple as a random delay time at a station, choosing a different route to follow or selecting a train from a fiddle yard.</p> <p>Some layout builders have used this to create non-train animations such as flickering camp fires, welding flashes and crane movements.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/driving-trains/random-selection/#random-time-delay","title":"Random time delay","text":"<p>The <code>DELAYRANDOM(mindelay,maxdelay)</code> delays a random time between two millisecond values, for example between 5 and 10 seconds use</p> <pre><code>DELAYRANDOM(5000,10000)\n</code></pre>"},{"location":"products/ex-commandstation/exrail/cookbooks/driving-trains/random-selection/#random-choice-on-a-given-percentage","title":"Random choice on a given percentage","text":"<p>The <code>IFRANDOM(percent)</code> command will return true a given percentage of the time.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/driving-trains/random-selection/#random-selection-of-a-path-to-follow","title":"Random selection of a path to follow","text":"<p>The <code>RANDOM_FOLLOW(sequence1,sequence2.....)</code> command will randomly choose between sequences with equal probability. Since this will always <code>FOLLOW</code> one of the specified sequences, this will never return to the next command.</p> <p>The <code>RANDOM_CALL(sequence1,sequence2.....)</code> command will randomly choose between sequences with equal probability and since they are CALLed they should <code>RETURN</code> and processing continues at the statement after <code>RANDOM_CALL</code>.</p> <p>Up to 8 sequences can be passed to these commands. If you need more than 8 just let us know and it can be extended but it's not as simple as changing a single number because the C++ pre-processor does not have macro parameter enumeration.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/driving-trains/save-restore/","title":"Saving and Restoring speeds","text":"<p>Under some circumstances, you may need to save and restore the speed of your loco. For example after stopping at a signal or being stopped by a <code>RESERVE</code> it is necessary to re-apply speed to the loco in order to carry on.</p> <p><code>RESERVE</code> does not save the speed before it stops your loco, and it doesnt restore it afterwards.</p> <p>The <code>SAVE_SPEED</code> command will save the current loco speed setting (including direction). Where momentum is involved, this will be the speed that the loco has been commanded to use even though it may be accelerating or decelerating towards that value.</p> <p>The <code>RESTORE_SPEED</code> command will restore the saved throttle setting.</p> <p>For example you may have a signal and you want to stop the loco if the signal is RED...</p> <pre><code>AT(300)  // when I get to the sensor ahead of the signal\nSAVE_SPEED  // in case I am forced to stop\nWAIT_WHILE_RED(4) // Wait until signal is green or amber\nRESTORE_SPEED // carry on as before\n</code></pre> <p>In the above scenario, the save and restore will have no real effect if the signal is amber or green.</p> <p>The <code>WAIT_WHILE_RED</code> command will stop the loco if the signal is red and wait until the signal changes. Once the signal changes, the script will resume and <code>RESTORE_SPEED</code> will restore the previously saved speed.</p> <p>Note that speed is saved at the loco level, not the exrail task.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/driving-trains/simple-shuttle/","title":"Simple shuttle","text":"<p>Imagine we have a track like this with sensors 164 and 165 at each end.</p> <pre><code>Dogbath                                                  Catflap\n||============================================================||\n  |                                                          |\n 164                                                        165\n</code></pre>"},{"location":"products/ex-commandstation/exrail/cookbooks/driving-trains/simple-shuttle/#sensor-positioning","title":"Sensor positioning","text":"<p>This illustrates an important aspect of EXRAIL driving. The sequence is only interested in one sensor at a time, there is no case for logic that says \"Oh wait! Sensor 164 has been hit, how do I know which loco it was and which way it was going... and was it the loco that hit it or the end of the reversing train..\"</p> <p>If you are using magnet-operated sensors that only detect the loco, you must adjust the sensor positions to take into account the length of the train when it is reversing. In this case, moving the sensors at the Dogbath end by one train length towards Catflap.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/driving-trains/simple-shuttle/#creating-the-basic-automation","title":"Creating the basic AUTOMATION","text":"<p>Create an automation like this. The automation id needs to be unique amongst all AUTOMATION, ROUTE or SEQUENCE definitions.  </p> <pre><code>AUTOMATION(123,\"Dogbath to Catflap shuttle\")\n  FWD(40) // Set off from Dogbath\n  AT(165) // wait until we get to Catflap stopping point \n  STOP // and then stop\n  DELAYRANDOM(15000,20000) // wait for driver to have a smoke \n  REV(40) // reverse back \n  AT(164) STOP // At Dogbath \n  DELAYRANDOM(5000,10000) // wait 5 to 10 seconds \n  FOLLOW(123) // and follow the sequence again\n</code></pre> <p>First drive your train to Dogbath, with the front facing Catflap. Select the automation from your throttle and the train should start after a random wait.</p> <p>It should be pretty obvious what this does and where the sensors need to be to give a reasonable stopping point, but this may depend on inertia settings in your loco decoder or command station setup.</p> <p>The AT command pauses the driving task until the sensor is activated.</p> <p>EXRAIL commands can be on the same line or separate lines, it makes no difference but sometimes it's easier to read if you put things like \"AT something DO something\" on one line.</p> <p>Also notice that this automation will work just as well for a DC loco or when DCC is being run at 28 speed steps for very old decoders.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/editing-tricks/multi-files/","title":"Multiple Files in EXRAIL","text":"<p>EXRAIL commands are read by the compiler only from the file myAutomation.h, the absence of a file with this name means no EXRAIL code is loaded into the command station. However, it is simple to partition myAutomation.h into separate files for the convenience of editing. For example myTurnouts.h, myRoster.h and so on. By ensuring all the files start with \"my\" it avoids issues with name clashes or Git.</p> <p>To include your additional files, use the c++ preprocessor #include control in myAutomation.h to insert the file contents exactly as if you had typed them into myAutomation.h</p> <pre><code>// Include my roster file\n#include \"myRoster.h\"\n// Include my turnout definitions\n#include \"myTurnouts.h\"\n// Special animation\n#include \"myCowOnElectricFence.h\"\n</code></pre> <p>A note to hardened C++ programmers... do not be tempted to add include guards to your .h files.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/editing-tricks/multiple-command-stations/","title":"Maintaining multiple command stations","text":"<p>Maybe you have more than one command station and you wish to have slightly different EXRAIL setups, perhaps because you are testing a new release on a separate CPU or need to compile different scripts for different layouts.</p> <p>The C++ compiler pre-processor is available to select various parts of your myAutomation.h based on definitions created in your config.h or those created by defines.he which automates the detection of the CPU type of your command station.</p> <p>For example:</p> <pre><code>#if defined(ARDUINO_ARCH_AVR)\n  // on my Mega, I have signal1 on pins (30,31,32)\n  ALIAS(mysignal1,30)\n#else \n  // on my CSB1 or similar, I use pins 800,801,802 on an expander\n  ALIAS(mysignal1,800)\n#endif\n  SIGNALH(mysignal1,mysignal1+1,mysignal1+2)\n  ONTHROW(1) RED(mysignal1) DONE\n  ONCLOSE(1) GREEN(mysignal1) DONE\n</code></pre> <p>In addition, each EXRAIL command is actually a preprocessor definition so it is possible to use an #ifdef to include a section that uses a new feature but only if the code version has that feature available.</p> <pre><code>#ifdef NEOPIXEL\n   NEOPIXEL(2013,255,255,0)\n#endif   \n</code></pre> <p>Note #ifdef xxx and #if defined(xxx) do the same thing.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/editing-tricks/naming-a-sequence/","title":"Naming sequences for easy commands","text":"<p>The DCC-EX command</p> <pre><code>&lt;/START id&gt;\n</code></pre> <p>can be used to start a sequence when the sequence id is known.</p> <p>However its is sometimes more convenient to code a sequence so that it can be started by name.</p> <p>This is made possible by using upper case quoted sequence names with the _hk suffix.</p> <pre><code>SEQUENCE(\"BEER\"_hk)  \n  PRINT(\"BEER sequence started\")\n  ... and so on\n</code></pre> <p>The name must be specified in upper case but it can be started by the command in any mixed case.</p> <pre><code> &lt;/start beer&gt;\n</code></pre>"},{"location":"products/ex-commandstation/exrail/cookbooks/editing-tricks/using-call-return/","title":"Using CALL and RETURN","text":"<p>Where you want to use the same sequence of commands from several places in other sequences you can avoid copying the repeated stuff by using CALL and RETURN</p> <pre><code>ROUTE(1,\"Platform A to mainline\")\n  CALL(911)\n  THROW(1)\n  CLOSE(2)\n  DONE\n\nROUTE(2,\"Platform B to mainline\")\n  CALL(911)\n  CLOSE(1)\n  CLOSE(2)\n  DONE\n\nSEQUENCE(911)\n  SERVO(123,100,Slow)  // move the cow out of the way\n  PLAYSOUND(500,3) // Make it Moo\n  DELAYRANDOM(5000,10000) // make the route wait 5 to 10 seconds\n  RETURN      // return to the calling sequence\n</code></pre>"},{"location":"products/ex-commandstation/exrail/cookbooks/editing-tricks/using-call-return/#notes","title":"Notes","text":"<ul> <li>You can nest CALLs 4 deep.</li> <li>If the called sequence executes a <code>DONE</code> statement, the task is terminated and there is no return.</li> </ul>"},{"location":"products/ex-commandstation/exrail/cookbooks/editing-tricks/using-macros/","title":"Using C++ Macros","text":"<p>The EXRAIL language is compiled by C++ and this means you can use MACROS of your own design according to the C++ compiler pre-processor specification.</p> <p>A MACRO is essentially a tiny program that types stuff for you while substituting parameters.</p> <p>For example: This macro can be used to start two leds flashing alternately at half second intervals:</p> <pre><code>#define FLIPFLOP(led) \\\n   BLINK(led,500,500) \\\n   DELAY(500) \\\n   BLINK(led+1,500,500)\n</code></pre> <p>Notice that a C++ macro must be only one logical line long! So we must use the <code>\\</code> character on the end of the line to indicate that this line is continued on the following.</p> <p>In the above example, the FLIPFLOP macro takes a LED VPIN and starts flashing it, then half a second later it starts flashing the next pin in line. Since the delay and the on/off period are the same, the LEDs will flash alternately.</p> <p>So you might use it in a sequence like this:</p> <pre><code>ONBUTTON(30)\n   FLIPFLOP(32)  // start flashing leds 32 and 33\n   DELAY(4000)   // wait 4 seconds\n   SERVO(123,1033,Slow) // close crossing gates\n   DELAY(3000) // give red-light jumpers a chance to consider their life choices\n   GREEN(34) // change approach signal to green\n   DONE\n</code></pre> <p>and</p> <pre><code>ONBUTTON(31)\n   RED(34) // change approach signal to red\n   SERVO(123,3200,Slow) // Open crossing gates\n   RESET(32,2) // turn off the blinking on pins 32,33\n   DONE\n</code></pre> <p>The servo positions above are of course dependent on your servos and how they are mounted. You must experiment first see Servos.</p> <p>Macros like these are, obviously, more useful if you use the macro in more than one place.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/flags-and-latches/flags/","title":"Flags, Counters and Bitmaps","text":"<p>These are implemented by a software-only driver that mimics a set of VPINs that can be used for both digital and analogue values. Unlike sensors and leds, these VPINs are both INPUT and OUTPUT  These can be used in many ways:</p> <ul> <li>As a simple digital flag to assist in inter-thread communication.</li> <li>A flag or value that can be set from commands and tested in EXRAIL.(e.g. to stop a sequence)</li> <li>As a counter for looping or occupancy counts such as trains passing over a multi track road crossing.</li> <li>As a collection of 16 digital bits that can be set, reset, toggled, masked and tested.</li> </ul> <p>Existing &lt;&gt; and exrail commands for vpins work on these pins.  </p>"},{"location":"products/ex-commandstation/exrail/cookbooks/flags-and-latches/flags/#creating-virtual-pins","title":"Creating virtual pins","text":"<pre><code>  HAL(Bitmap,firstpin,npins) \n</code></pre> <p>creates 1 or more virtual pins in software.</p> <p>e.g. <code>HAL(Bitmap,1000,20)</code>  creates pins 1000..1019</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/flags-and-latches/flags/#use-as-flags","title":"Use as flags","text":"<p>When used as a digital flag, these pins can be changed or tested with the basic digital pin commands common to all VPINs.  SET, RESET, BLINK, IF, ONBUTTON, ONSENSOR and so forth. Serial commands operate in the same way.  </p>"},{"location":"products/ex-commandstation/exrail/cookbooks/flags-and-latches/flags/#use-as-counters","title":"Use as counters","text":"<p>For loop counting, counters can be incremented by <code>BITMAP_INC(1013)</code> and decremented by <code>BITMAP_DEC(1013)</code> and tested with IF/IFNOT/IFGTE etc.</p> <p>Counters be used to automate a multi track crossing where each train entering increments the counter and decrements it on clearing the crossing. Crossing gate automation can be started when the value changes from 0, and be stopped when the counter returns to 0.</p> <p>Detecting the first increment from 0 to 1 can be done with <code>ONBUTTON(1013)</code> and the automation can use <code>IF(1013)</code> or <code>IFNOT(1013)</code> to detect when it needs to reopen the road gates.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/flags-and-latches/flags/#use-as-analogue-values-advanced","title":"Use as analogue values (advanced)","text":"<p>Analog values may be set into the virtual pins and tested using the existing analog value commands and exrail macros. <code>&lt;z vpin value&gt;</code> <code>&lt;D ANIN vpin&gt;</code> etc. and in EXRAIL <code>ANOUT(vpin,value,0,0)</code></p>"},{"location":"products/ex-commandstation/exrail/cookbooks/flags-and-latches/flags/#use-as-binary-flag-groups-advanced","title":"Use as binary flag groups (advanced)","text":"<p>Virtual pins (and others that respond to an analog read in order to provide bit mapped digital data, such as SensorCam) can be set and tested with new special EXRAIL commands</p> <p><code>IFBITMAP_ALL(vpin,mask)</code>   Bitwise ANDs the  the vpin value with the mask value and is true if ALL the 1 bits in the mask are also 1 bits in the value.     e.g.    <code>IFBITMAP_ALL(1013,0x0f)</code>  would be true if ALL the last 4 bits of the value are 1s.</p> <p><code>IFBITMAP_ANY(1013,0x0f)</code> would be true if ANY of the last 4 bits are 1s.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/flags-and-latches/flags/#modifying-bitmap-values","title":"Modifying bitmap values","text":"<p><code>BITMAP_AND(vpin,mask)</code> performs a bitwise AND operation. <code>BITMAP_OR(vpin,mask)</code>  performs a bitwise OR operation <code>BITMAP_XOR(vpin,mask)</code> performs a bitwise EXCLUSIVE OR (which is basically a toggle).</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/flags-and-latches/latches/","title":"Latches","text":"<p>Latches were first introduced into EXRAIL as a way of latching a sensor value or pushbutton on, so that once detected it could be checked later and not suffer from bouncing. This use is comparatively rare and has generally been superseded by the more recent ONBUTTON event handler.</p> <p>Latches were also used as a way of setting a flag that could be read later, for example to remember whether a light had been switched on by a ROUTE so that the next call to the same route could switch it off again.</p> <p>Unfortunately, the LATCH implementation was designed in a limited way to support tiny processors like the UNO or NANO so the latch numbers were limited and could only apply to on-board pins and not extended VPINs. It became common to use latch numbers above the real pin numbers but below the artificial software limit (63 on a UNO, 255 on bigger CPUs) for various flags in routes and automations.</p> <p>Because of these limitations, it is recommended that you use the much simpler flags feature which provides virtual VPINs that can be set, reset and tested without the limitations of LATCH.</p> <p>For example:</p> <pre><code>HAL(Bitmap,800,16) // create flags 800..815 \nROUTE(600,\"Shed lights\")\n  IF(800)  // is the light on? \n     RESET(120)  // lights off\n     RESET(800)\n  ELSE  // light is off \n     SET(120)  // lights on\n     SET(800)\n  ENDIF\n  DONE\n</code></pre> <p>Note that the code cannot use <code>IF(120)</code> to test if the light is on because pin 120 is an OUTPUT pin on a physical device.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/flags-and-latches/stash/","title":"Using STASH to remember where locos are parked","text":"<p>STASH is used for scenarios where it is helpful to relate a loco id to where it is parked. For example a fiddle yard may have 10 tracks and it's much easier for the operator to select a train to depart by using the track number, or pressing a button relating to that track, rather than by knowing the loco id which may be difficult to see.</p> <p>Automated yard parking can use the stash to determine which tracks are empty without the need for block occupancy detectors.</p> <p>Note that a negative locoid may be stashed to indicate that the loco will operate with inverted direction. For example a loco facing backwards, with the INVERT_DRECTION state may be stashed by exrail and the invert state will be restored along with the loco id when using the PICKUP_STASH.  CLEAR_ANY_STASH will clear all references to the loco regardless of direction.</p> <p>The following Stash  commands are available:</p> EXRAIL command Serial protocol function STASH(s) <code>&lt;JM s locoid&gt;</code> Save the current loco id in the stash array element s. CLEAR_STASH(s) <code>&lt;JM s 0&gt;</code> Sets stash array element s to zero. CLEAR_ALL_STASH <code>&lt;JM CLEAR ALL&gt;</code> sets all stash entries to zero CLEAR_ANY_STASH <code>&lt;JM CLEAR ANY locoid&gt;</code> removes current loco from all stash elements PICKUP_STASH(s) N/A sets current loco to stash element s IFSTASH(s) N/A True if stash element s is not zero IFSTASHED_HERE(s) N/A True if stash element s contains the current tasks loco N/A <code>&lt;JM&gt;</code> query all stashes (returns <code>&lt;jM s loco&gt;</code> where loco is not zero) N/A <code>&lt;JM stash&gt;</code> Query loco in stash (returns <code>&lt;jM s loco&gt;</code>) <p>Notes: An automatic parking script can run through the various tracks and find one which has no stashed loco, then set the route and drive into the track. Once stopped, the locoid can be stashed against that track.</p> <p>If the operator wants to drive away a loco manually by loco id, an automation can search the tracks for that stashed loco id using IFSTASHED_HERE(trackid) so it can set the turnouts to exit the yard from that track.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/neopixels/","title":"NeoPixel support","text":"<p>The IO_NeoPixel.h driver supports the Adafruit NeoDriver - I2C to NeoPixel Driver</p> <p>The driver turns each pixel into an individual VPIN which can be given a colour and turned on or off using the the NEOPIXEL EXRAIL macro. EXRAIL SIGNALS can also drive a single pixel signal or multiple separate pixels See Neopixel Signals.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/neopixels/#defining-the-hardware-driver","title":"Defining the hardware driver","text":"<p>Add a driver definition in myAutomation.h for each adafruit I2C driver.</p> <pre><code>    HAL(neoPixel, firstVpin, numberOfPixels [, mode [, i2caddress])\n</code></pre> <p>Where mode is selected from the various pixel string types which have varying colour order or refresh frequency. For MOST strings this mode will be NEO_GRB but for others refer to the comments in IO_NeoPixel.h</p> <p>If omitted the node and i2caddress default to NEO_GRB, 0x60.</p> <p>For example:</p> <pre><code>    HAL(NeoPixel,1000,20)\n</code></pre> <p>This is a NeoPixel driver defaulting to I2C aqddress 0x60 for a GRB pixel string. Pixels are given vpin numbers from 1000 to 1019.</p> <pre><code>    HAL(NeoPixel,1020,20,NEO_GRB,0x61)\n</code></pre> <p>This is a NeoPixel driver on i2c address 0x61.</p> <p>For devices behind multiplexors see multiplexors</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/neopixels/neopixels/","title":"Setting neopixels","text":"<p>The NEOPIXEL macro provides the ability to set neopixels on or off change the colour. either individually or over a range of pixels.</p> <pre><code>NEOPIXEL([-]vpin, red, green, blue [,count])\n</code></pre> <p>vpin = pin number of the individual pixel in the range defined by the HAL(NeoPixel...) command. red = 0..255 intensity of the red channel green = 0..255 intensity of the green channel blue = 0..255 intensity of the blue channel count = numver of pixels to set, starting at vpin. Default =1.</p> <p>Setting pixels on or off (without colour change) can be done with SET/RESET.</p> <p>Because the pixels obey SET/RESET, the BLINK command can also be used to control blinking a pixel.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/signals/","title":"Signal Basics","text":"<p>EXRAIL is able to define varuous different signal types depending on their electrical connection and assign each of them a unique signal_id that can be used to change and tese them without reference to their type. In some cases, the signal is made up of individually addressed LEDs, others thgeir own decoder, and in the case of semaphore signals they may be driven by a servo.</p> <p>Signal definitions are extracted from myAutomation during the compile process and thus can appear anywhere in the EXRAIL script, they do not have to be executed as part of a sequence.</p> <p>Refer to the following cookbook entries for details of defining signals of various types.</p> <p>Once a signal has ben defined the following commands can be used:</p> <ul> <li><code>RED(signal_id)</code> <code>GREEN(signal_id)</code> <code>AMBER(signal_id)</code>   change the signal state</li> <li><code>IFRED(signal_id)</code> <code>IFGREEN(signal_id)</code> <code>IFAMBER(signal_id)</code> test the signal state</li> <li><code>ONRED(signal_id)</code> <code>ONGREEN(signal_id)</code> <code>ONAMBER(signal_id)</code> define event handlers to allow for any other processing associated with a signal change</li> <li><code>WAIT_WHILE_RED(signal_id)</code> keep a loco stopped until a signal changes</li> </ul>"},{"location":"products/ex-commandstation/exrail/cookbooks/signals/dcc-signals/","title":"DCC Signals","text":""},{"location":"products/ex-commandstation/exrail/cookbooks/signals/dcc-signals/#common-signals","title":"Common signals","text":"<p>Most DCC signals have an inbuilt decoder and genarally only have a RED and GREEN aspect. They are driven by dcc accessory packets sent over the track signal.</p> <p>To define a DCC signal use</p> <pre><code>DCC_SIGNAL(555,20,0)\n</code></pre> <p>defines a DCC encoder signal with a signal_id of 555 and encoder address/subaddress of 20/0.</p> <p>Thus it can be changed by a <code>RED(555)</code> or <code>GREEN(555)</code> command.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/signals/dcc-signals/#advanced-aspect-signals","title":"Advanced aspect signals","text":"<p>More advanced multi-aspect DCC based signals may have a variety of aspect choices to reperesent the common red/amber/green states, for example aspect 17 might show 2 green lamps with a flashing amber and aspect 18 might show 2 ambers with an illuminated cow-on-track warning sign in Klingon. There are no rules here!</p> <p>This kind of signal can be defined as follows</p> <pre><code>DCCX_SIGNAL(666,1,18,2)\n</code></pre> <p>where 666 is the DCC linear address and the signal_id used for EXRAIL commands, the 1,18,2 represents the choice of aspects the signal supports to represent the red, amber and green states.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/signals/flashing-signals/","title":"Signals with flashing","text":"<p>Flashing is achieved with the command</p> <pre><code>BLINK(vpin, onMs, offMs)\n</code></pre> <p>which will start a vpin blinking until such time as it is SET, RESET or set by a signal operation such as RED, AMBER, GREEN.</p> <p>BLINK returns immediately, the blinking is autonomous.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/signals/flashing-signals/#always-blink-amber","title":"Always blink AMBER","text":"<p>A signal that always blinks amber could be done like this:</p> <pre><code>SIGNALH(130,131,132)\nONAMBER(130) BLINK(131,500,500) \nDONE\n</code></pre> <p>The RED or GREEN calls will turn off the amber pin and that will stop the blink automatically.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/signals/flashing-signals/#amber-and-flashing-amber","title":"Amber and Flashing Amber","text":"<p>A signal that has normal AMBER and flashing AMBER could be done by creating a new macro to implement a FLAMBER(signalid) command</p> <pre><code>// create a new command\n#define FLAMBER(signal) \\\n        AMBER(signal) \\\n        BLINK(signal+1,500,500)\n\nSIGNALH(130,131,132) \n\n// then where necessary you can \nAMBER(130)   // set signal to AMBER\n// or \nFLAMBER(130) // set signal to flashing amber\n</code></pre> <p>(Caution: this assumes that the amber pin is redpin+1 in the SIGNAL or SIGNALH definition)</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/signals/led-signals/","title":"LED Signals","text":"<p>LED based signals are defined using the SIGNALH macro (For LEDS with common cathode) or SIGNAL macro (for leds with common annode)</p> <p>For example</p> <pre><code>SIGNALH(110,111,112)\n</code></pre> <p>defines a common cathode signal with a RED led on vpin 110, Amber LED on vpin 111 and Green LED on vpin 112. This signal is also automatically given a signal_id matching the red vpin.</p> <p>Thus it can be changed by a <code>RED(110)</code>, <code>AMBER(110)</code> or <code>GREEN(110)</code> command.</p> <p>For a signal with no amber or green led, the relevant vpin can be specified as zero.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/signals/neopixel-signals/","title":"Neopixel signals","text":"<p>There are two types possible:</p> <ul> <li>a mast with separate fixed colour pixels for each aspect</li> <li>a mast with one multiple colour pixel for all aspects.</li> </ul> <p>Bear in mind that a single multicolour neopixel used above might be physically a multi-colour LED (as in a searchlight signal), or 3 individual LEDS wired to a single neopixel chip (as in a 2 or 3 lamp signal).  </p> <p>For separate pixels, the colours should be established at startup and a normal SIGNALH macro used.</p> <pre><code>AUTOSTART \n  SIGNALH(1010,1011,1012)\n  NEOPIXEL(1010,255,0,0)       \n  NEOPIXEL(1011,128,128,0)\n  NEOPIXEL(1012,0,255,0)\n  RED(1010)  // force signal state otherwise all 3 lights will be on\n  DONE\n</code></pre> <p>For signals with 1 neopixel, the NEOPIXEL_SIGNAL macro will create a signal on one vpin with three separate colours</p> <pre><code>NEOPIXEL_SIGNAL(vpin,redfx,amberfx,greenfx)\n</code></pre> <p>redfx,amberfx,greenfx = colour values</p> <p>The fx values above can be created by the NeoRGB macro so a bright red would be <code>NeoRGB(255,0,0)</code>  bright green <code>NeoRGB(0,255,0)</code> and amber something like <code>NeoRGB(255,100,0)</code>. NeoRGB creates a single int32_t value so it can be used in several ways as convenient (but can't be used in an ALIAS command).</p> <pre><code>// create 1-lamp signal with NeoRGB colours\nNEOPIXEL_SIGNAL(1000,NeoRGB(255,0,0),NeoRGB(255,100,0),NeoRGB(0,255,0))\n\n// Create 1-lamp signal with named colours.\n// This is better if you have multiple signals.\n// (Note: ALIAS is not suitable due to word length defaults) \n#define REDLAMP NeoRGB(255,0,0)\n#define AMBERLAMP NeoRGB(255,100,0)\n#define GREENLAMP NeoRGB(0,255,0)\nNEOPIXEL_SIGNAL(1001,REDLAMP,AMBERLAMP,GREENLAMP)\n\n// Create 1-lamp signal with web type RGB colours \nNEOPIXEL_SIGNAL(1002,0xFF0000,0xFF6400,0x00FF00)\n</code></pre>"},{"location":"products/ex-commandstation/exrail/cookbooks/signals/semaphore-signals/","title":"Semaphore (servo) Signals","text":"<p>Semaphore signals may be driven by servos under the control of EXRAIL. (Some semaphore signals have DCC decoders and their own movement mechanism)</p> <p>To define a servo based signal, it is necessary to experiment to obtain the correct servo angles. Always do this without the serveo mechanically connected to the signal as servos are capable of serious damage. Use the SERVO_SIGNAL macro.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/sounds/dfplayer/","title":"Controlling Sounds in EXRAIL","text":"<p>There are multiple <code>PLAY_</code> commands in EXRAIL is used to control sound. The first parameter is always the VPIN of the device, the meaning of the argumants depend on the command.</p> <p>Note: Timing and race conditions may occur with multiple EXRAIL tasks sending commands to the same DFPlayer to the extent that commands could be overwritten before they are executed or not executed in the desired order, possibly leaving the DFPlayer module in an unknown state or causing a timeout.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/sounds/dfplayer/#playing-a-sound-play_track-play_repeat","title":"Playing a sound (PLAY_TRACK, PLAY_REPEAT)","text":"<p>Command to play a track (file) in the current selected folder and set the volume level. The folder on the microSD card default to folder 01 unless set with the FOLDER directive.</p> <p>This requires the file number on the DFPlayer microSD card (see DFPlayer manual) and optionally the volume (0-30)</p> <pre><code>PLAY_TRACK(3500,1,20) // plays file 1 at volume 20\nPLAY_TRACK(3501,4)    // plays file 4 on a different DFplayer at default volume\n</code></pre> <p>A file may also be played with automatic repeats by using the <code>PLAY_REPEAT</code></p> <pre><code>PLAY_REPEAT(3500,4,20) // repeat plays file 2 at volume 20\nPLAY_TRACK(3501,3)    // repeat plays file 3 on a different DFplayer at default volume\n</code></pre>"},{"location":"products/ex-commandstation/exrail/cookbooks/sounds/dfplayer/#pause-and-resume-play_pause-play_resume","title":"Pause and Resume (PLAY_PAUSE, PLAY_RESUME)","text":"<p>Playing may be paused and resumed </p> <pre><code>PLAY_PAUSE(3500) // pause playing\nPLAY_RESUME(3500) // resume playing\n</code></pre>"},{"location":"products/ex-commandstation/exrail/cookbooks/sounds/dfplayer/#changing-default-volume-play_volume","title":"Changing default volume (PLAY_VOLUME)","text":"<p>To change the default volume (0-30). </p> <pre><code>PLAY_VOLUME(3500,15) // change defualt volume to 15\n</code></pre> <p>Not all DFPlayers use the same chip, quality varies. Some will change the volume of a currently playing file, others may only change for the next file played.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/sounds/dfplayer/#stop-playing-play_stop","title":"Stop playing (PLAY_STOP)","text":"<pre><code>PLAY_STOP(3500) // My ears are hurting\n</code></pre>"},{"location":"products/ex-commandstation/exrail/cookbooks/sounds/dfplayer/#changing-current-folder-play_folder","title":"Changing current folder (PLAY_FOLDER)","text":"<p>To change the folder (1-99) from which sounds will be selected</p> <pre><code>PLAY_FOLDER(3500,2) // change folder to 2\n</code></pre>"},{"location":"products/ex-commandstation/exrail/cookbooks/sounds/dfplayer/#set-the-equalizer-proile-play_eq","title":"Set the Equalizer proile (PLAY_EQ)","text":"<p>The profiles available are NORMAL, POP, ROCK, JAZZ, CLASSCS, BASS</p> <pre><code>PLAY_EQ(3500,BASS) // Bring the Noise!\n</code></pre>"},{"location":"products/ex-commandstation/exrail/cookbooks/sounds/dfplayer/#reset-the-player-play_reset","title":"Reset the player (PLAY_RESET)","text":"<p>When you reset the DFPLayer module. Add a <code>DELAY(1000)</code> command after the reset to give the DFPlayer time to complete the reset. The volume level is also reset to the default of 30, you may want to add a command to set the volume to a desired level.</p> <pre><code>PLAY_RESET(3500)      // Reset the player\nDELAY(1000)           // let it settle\nPLAY_VOLUME_(3500,15) // set more sensible volume 15\n</code></pre>"},{"location":"products/ex-commandstation/exrail/cookbooks/startup/autostart/","title":"Things that happen at startup","text":"<p>When the command station starts:</p> <ul> <li>Definitions of HAL drivers, Turnouts and Signals will take place first regardless of where they are found in the myAutomation.h file.</li> <li>EXRAIL will run through all its sequences to detect any VPIN that has been used for input, perhaps by an AT, AFTER, ONBUTTON, ONSENSOR etc. These pins are then set to the Arduino INPUT_PULLUP mode. This is necessary so that EXRAIL can actually read the input pins.</li> </ul> <p>Where VPINS are mapped to external expanders (such as an MCP23017), the HAL driver will pass on the relevant commands to the expander.</p> <ul> <li>EXRAIL will then automatically start tasks at any point in the myAutomation.h file where an AUTOSTART command is found. There may be several, they will all run simultaneously and in no particular priority.</li> </ul> <p>To create commands that will automatically run at startup:</p> <pre><code>AUTOSTART\n  POWERON\n  THROW(1)\n  CLOSE(2)\n  PRINT(\"Ready to Rumble\")\n  DONE\n</code></pre>"},{"location":"products/ex-commandstation/exrail/cookbooks/startup/startup-poweron/","title":"Startup power","text":"<p>By default the Command station will start with the track power OFF.</p> <p>This can be inconvenient if you are using the free version of the WiThrottle app from the Apple store which does not have a power button.</p> <p>You can configure EXRAIL to power on at startup by using</p> <pre><code>AUTOSTART POWERON DONE\n</code></pre> <p>Alternatively, you can power tracks individually</p> <pre><code>AUTOSTART\n  SET_POWER(A,ON)\n  SET_POWER(D,ON)\n  DONE\n</code></pre>"},{"location":"products/ex-commandstation/exrail/cookbooks/startup/startup-set-track/","title":"Startup - Define Tracks","text":"<p>By default the Command station will start with  </p> <ul> <li>Track A - <code>MAIN</code> </li> <li>Track B - <code>PROG</code></li> </ul> <p>These lines can be added to myAutomation.h to define tracks as needed.</p> <pre><code>AUTOSTART \n  SET_TRACK(A,MAIN)\n  SET_TRACK(B,PROG)\n  SET_TRACK(C,MAIN)\n  SET_TRACK(D,MAIN)\n  POWEROFF\n DONE\n</code></pre> <p><code>POWEROFF</code> is the default.  </p> <p><code>POWERON</code> will set MAIN tracks ON.  </p> <p>Other track modes require the <code>SET_POWER</code> command, for each track.  </p> <p>For DC mode operation, please see DC Running</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/turnouts/animated-turnouts/","title":"Animated turnouts","text":"<p>Switching turnouts is easy, but sometimes you want to make it more realistic by introducing signals, delays and other automations.</p> <p>The combination of hidden and virtual turnouts makes this easy.</p> <p>Lets suppose you have a turnout ID 100 and to make it look realistic you need to set some signal to stop, wait for the signalman to walk accross the lever frame, throw the turnout, wait again and set another signal to green.</p> <p>First we need to hide the real turnout from the throttles. This is done by changing the description to the keyword HIDDEN and giving it a different id so we can refer to it later.</p> <pre><code>  TURNOUTL(100,1,\"Coal yard exit\")  // for example\n</code></pre> <p>is changed to</p> <pre><code>  TURNOUTL(1001,1,HIDDEN) \n</code></pre> <p>Now we can create a virtual turnout that will be seen by the throttles and specify what we want to happen when it is thrown or closed.</p> <pre><code>   VIRTUAL_TURNOUT(100,\"Coal yard exit\")\n\n   ONCLOSE(100)\n     RED(501)  // set approach signal\n     RED(505)  // set approach signal\n     DELAY(4000) // wait for signalman to move\n     CLOSE(1001) // close the real turnout \n     DELAY(5000)\n     GREEN(501) // set approach signal\n     DONE\n\n   ONTHROW(100)\n     RED(501)  // set approach signal\n     RED(505)  // set approach signal\n     DELAY(4000) // wait for signalman to move\n     THROW(1001) // throw the real turnout \n     DELAY(5000)\n     GREEN(505) // set approach signal\n     DONE\n</code></pre>"},{"location":"products/ex-commandstation/exrail/cookbooks/turnouts/defining-dcc-turnouts/","title":"Defining DCC turnouts","text":"<p>DCC Turnouts (or points) operate by listening to DCC messages sent along the track by the command station. Each turnout has a DCC address which may be specified as a pair of values (address,subaddress) or a single value linear address. Its generally easier to think in terms of the linear address but it makes no difference whatever to the kind of DCC message sent, other than the conversion from (address,subaddress) to linear is badly thought out and inconsistent between DCC implementations due to historically/histerically ambiguous standards.</p> <p>Define DCC based turnouts using EXRAIL.</p> <pre><code>TURNOUTL(id, address, \"description\")\n\nTURNOUT(id, shortAddress, subAddress, \"description\")\n</code></pre> <p>id = Unique turnout ID within the CommandStation. All other turnout commands will refer to this turnout by this id.</p> <p>address- the DCC address that the turnout decoder is listening to   or shortAddress,subAddress - the alternative form of the same address.</p> <p>description = A human-friendly description of the turnout that will appear in WiThrottle apps and Engine Driver. Note that this must be enclosed in quotes <code>\"\"</code>. In some cases the HIDDEN keyword can be used here to prevent the turnout being visible to the throttles.</p> <p>For example:</p> <pre><code>TURNOUTL(123,55,\"Up the junction\")\nTURNOUT(124,12,3,\"Down the mine\")\nTURNOUTL(125,56,HIDDEN) // not visible to throttles\n</code></pre>"},{"location":"products/ex-commandstation/exrail/cookbooks/turnouts/defining-pin-turnouts/","title":"Defining PIN turnouts","text":"<p>PIN Turnouts operate by detecting the state of an output pin.</p> <p>Define pin based turnouts using EXRAIL.</p> <pre><code>PIN_TURNOUT(id, vpin, \"description\")\n</code></pre> <p>id = Unique turnout ID within the CommandStation. All other turnout commands will refer to this turnout by this id.</p> <p>vpin- the pin to be set HIGH for thrown and LOW for closed  </p> <p>description = A human-friendly description of the turnout that will appear in WiThrottle apps and Engine Driver. Note that this must be enclosed in quotes \u201c\u201d. In some cases the HIDDEN keyword can be used here to prevent the turnout being visible to the throttles.</p> <p>For example:</p> <pre><code>PIN_TURNOUT(6,201,\"Round the bend\")\n</code></pre>"},{"location":"products/ex-commandstation/exrail/cookbooks/turnouts/defining-servo-turnouts/","title":"Defining Servo turnouts","text":"<p>(This does not include servos driven from track connected DCC decoders. See DCC Decoders)</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/turnouts/defining-servo-turnouts/#important-considerations-for-servo-operation","title":"Important considerations for servo operation","text":"<p>Servo turnouts are driven through a PCA9685 servo control board or an EX-IOExpander.</p> <p>Test, test, test your servo parameters prior to connecting to an actual turnout/point. If you have defined angles that exceed the physical limits of your turnout, you will likely damage it and/or the servo mechanism.</p> <p>Treat each servo and turnout as an individual as not all servos (or turnouts/points for that matter) are created equal. An angle that works with one servo and associated turnout will not necessarily provide the exact same result with another. Differences in servo brands, mounting methods, and even normal manufacturing tolerances will need to be factored in to the servo angles in use.</p> <p>The EX-Toolbox Android application provides a servo movement testing tool to help you discover the necessary values for the angles below.</p> <p>Use flexible wire to connect your servo arm to the turnout/point. Using a flexible connection between the turnout and the servo mechanism means if anything does go wrong such as the turnout getting jammed or an incorrect servo angle being sent, it reduces the chance of damaging the turnout or servo.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/turnouts/defining-servo-turnouts/#defining-servo-based-turnout-objects","title":"Defining servo based turnout objects","text":"<p>Define servo based turnouts using EXRAIL.</p> <pre><code>SERVO_TURNOUT(id, vpin, active_angle, inactive_angle, profile, \"description\")\n</code></pre> <p>id = Unique turnout ID within the CommandStation. All other turnout commands will refer to this turnout by this id.</p> <p>pin = The ID of the pin the servo is connected to, which would typically be the VPin ID of the PCA9685 controller board.</p> <p>active_angle = The angle to which the servo will move when the turnout is thrown (This is a value passed to the servo drtiver, it is not in degrees).</p> <p>inactive_angle = The angle to which the servo will move when the turnout is closed.</p> <p>profile = The speed at which a turnout will move: Instant, Fast, Medium, Slow.</p> <p>description = A human-friendly description of the turnout that will appear in WiThrottle apps and Engine Driver. Note that this must be enclosed in quotes \u201c\u201d. In some cases the HIDDEN keyword can be used here to prevent the turnout being visible to the throttles.</p> <p>An example definition for a servo connected to the second control pins of the first PCA9685 connected to the CommandStation, using the slow profile for prototypical operation:</p> <pre><code>SERVO_TURNOUT(200, 101, 450, 110, Slow, \"Coal yard exit\")\n</code></pre>"},{"location":"products/ex-commandstation/exrail/cookbooks/turnouts/facing-turnouts/","title":"Facing turnouts","text":"<p>When you have turnouts that face each other, its awkward for the throttle user to have to manually switch both to match each other. By treating the crossover as a single turnout, control is simplified and incorrect combinations are prevented.</p> <p>To do this, we need to hide one of the turnouts from the user, and make sure that throwing/closing the visible turnout automatically throws/closes the other turnout.</p> <p>All turnout definitions in EXRAIL allow for a text description to be shown to the user throttle. The HIDDEN keyword, used instead of a turnout description prevents it being visible to the throttle or JMRI/iTrain etc.</p> <pre><code>TURNOUTL(1,101,\"Cross inner to outer\")\nTURNOUTL(2,102,HIDDEN)\n\nONTHROW(1) THROW(2) DONE\nONCLOSE(1) CLOSE(2) DONE\n</code></pre>"},{"location":"products/ex-commandstation/exrail/cookbooks/turnouts/toggle-with-button/","title":"Toggle turnouts with button or sensor","text":"<p>A turnout of any type can be toggled by a button or sensor of any type.</p> <pre><code>ONBUTTON(173) TOGGLE_TURNOUT(6) DONE\n</code></pre>"},{"location":"products/ex-commandstation/exrail/cookbooks/various-devices/duinoNodes/","title":"Lew's Duino Gear boards","text":"<p>CAUTION: these boards require several GPIO pins on the Command Station and are therefore unsuitable for use with a CSB1 which has all available pins essentially reserved for track management.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/various-devices/duinoNodes/#dnin8-8-input-board","title":"DNIN8 8 Input board","text":"<p>This is a shift-register implementation of a digital input collector. Multiple DNIN8 may be connected in a chain sequence but it is IMPORTANT that the software configuratuion correctly represents the number of boards connected otherwise the results will be meaningless.</p> <p>Define boards in EXRAIL using HAL(IO_DNIN8, firstVpin, numPins, clockPin, latchPin, dataPin)</p> <pre><code>   HAL(IO_DNIN8, 400, 16, 40, 42, 44)\n</code></pre> <p>This will create VPINs 400-415 using two DNIN8 boards connected in sequence. VPINS 400-407 will be on the first board (closest to the CS) and 408-415 on the second.</p> <p>Note: 16 pins uses two boards. You may specify a non-multiple-of-8 pins but this will be rounded up to a multiple of 8 and you must connect ONLY the number of boards that this takes.</p> <p>This example used Arduino GPIO pins 40,42,44 as these are conveniently side-by-side on a Mega which is easier when you are using a 3 strand cable.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/various-devices/duinoNodes/#dnin8k-8-input-board","title":"DNIN8K 8 Input board","text":"<p>This module works the same as DNIN8 but you must use DNIN8K in the HAL setup instead of DNIN8. You can't mix 8 and 8k versions in the same string of boards but you can create another string of boards.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/various-devices/duinoNodes/#dnou8-8-output-board","title":"DNOU8 8 Output board","text":"<p>DNOU8 works in a very similar fashion to the the DNIN boards and is defined in EXRAIL using  HAL(IO_DNOU8, firstVpin, numPins, clockPin, latchPin, dataPin)</p> <pre><code>HAL(IO_DNOU8, 450, 16, 45, 47, 49)\n</code></pre> <p>This creates a string of output VPINs 450-465 (and thus on 2 boards). Note the clock/latch/data pins must be different to any DNIN8 or DNIN8K pins.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/various-devices/multiplexors/","title":"I2C Multiplexors","text":"<p>A Multiplexor allows for multiple i2c devices with the same address to be separately addressed so that messages pass through the multiplexor and it routes them to the correct channel to find the device you want.</p> <p>Multiplexors are handled automatically by dcc-ex and all drivers for i2c devivces can take a multiplexed address when being defined.</p> <p>When the command dtstion starts, it scans the i2c network for all devices it can find, including those behid one or more multiplexors. Although the list can only guess the device type (there is no automatic device recognition, nor rigid standards that associate addresses with device types) it will give the fully qualified I2C address of each device and it is this that must be copied to the HAL device definition.</p> <p>First step is to run the Command Station software without the drivers and note what addresses the I2C scan comes up with. This is especially important when using devices behind a multiplexor as the I2C address must include the multiplexor channel path. The scan will look something like this:</p> <pre><code>&lt;* License GPLv3 fsf.org (c) dcc-ex.com &gt;\n&lt; I2C Device found at 0x71, I2C Mux? &gt;\n&lt; I2C Device found at {I2CMux_1,SubBus_7,0x20}, GPIO Expander? &gt;\n</code></pre> <p>So the HAL definition will copy the {mux} information exactly as the I2C address. </p> <pre><code>// This would be a example vpins 160-175 on address 0x20  (no Mux)\nHAL(MCP23017,160,16,0x20)\n\n// Same device with address 0x20 but beyond a multiplexor\nHAL(MCP23017,160,16,{I2CMux_1,SubBus_7,0x20})\n</code></pre> <p>IMPORTANT: You can't have two devices with address 0x20 (for example) where one is behind the multiplexor and the other is not... that can't be made to work. So if you have two devices with the same address thay must BOTH be behind separate multiplexor channels.</p> <p>You can have multiple multiplexors, but each must have a separate address. You cant have a multiplexor behind another multiplexor.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/various-devices/pca955x/","title":"MCP23017, PCA955x and TCA955x devices","text":"<p>These devices are functionally very similar and provide a variety of pins for digital input or output over an I2C address.</p> <p>Essentially, there is no automatic hardware type detection so it is necessary for the user to provide the information about:</p> <ul> <li>Hardware chip type</li> <li>I2C address (including path through a multiplexor if used)</li> <li>VPIN to number the first pin on the device</li> <li>number of consecutibe VPINS on this device</li> </ul> <p>Once the driver and its information have been correctly defined, the pins on the device are addressed purely by VPIN number in the same way as any other Arduino pin. This significantly simplifies any code that has to set or test the pins.</p> <p>In addition, it is not necessary to define each pin as input or output as EXRAIL will work this out automatically and configure the device. However, youy can't use the same pin for output and input. </p>"},{"location":"products/ex-commandstation/exrail/cookbooks/various-devices/pca955x/#device-variations","title":"Device variations","text":"<ul> <li>MCP23017 has 17 pins but pins 7 and 15 (A7 and B7 on the pcb) are unsuitable for input due to a chip design fauilt found some years after production. This fault is very unlikely to affect you but it is best to avoid these pins. It is sometimes assumed that older chips are Ok and newer ones have the fault, but in fact they are all identical and only the datasheet was changed to warn users to avoid the 7 and 15 pins for inpiut.</li> <li>The PCA9554 and TCA9554 have only 8 pins</li> <li>The PCA9555 and TCA9555 have 16 pins</li> <li>The PCA and TCA models are identical but manufactured by different companies. You can use either driver name because its all the same code.</li> </ul>"},{"location":"products/ex-commandstation/exrail/cookbooks/various-devices/pca955x/#defining-devices","title":"Defining devices","text":"<p>These devices are defined by using HAL statements in your EXRAIL script (myAutomation.h or its included files).</p> <p>First step is to run the Command Station software without the drivers and note what addresses the I2C scan comes up with.</p> <pre><code>&lt;* License GPLv3 fsf.org (c) dcc-ex.com &gt;\n&lt; I2C Device found at 0x20, GPIO Expander? &gt;\n</code></pre> <p>The driver is created with a HAL command:</p> <pre><code>HAL(drivername,firstVpin,numberOfVpins,i2cAddress)\n</code></pre> <p>Some examples:</p> <pre><code>// simple example vpins 160-175 on address 0x20\nHAL(MCP23017,160,16,0x20)\n\n// as above but for a different chip type\nHAL(PCA9555,160,16,0x20) // easy isnt it...\n</code></pre> <p>For devices behind multiplexors see multiplexors</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/various-devices/tca8418-keyboard/","title":"TCA8418 keyboard scanner","text":"<p>The TCA8418 IC from Texas Instruments is a low cost and very capable GPIO and keyboard scanner. Used as a keyboard scanner, it has 8 rows of 10 columns of IO pins which allow encoding of up to 80 buttons. The IC is available on an Adafruit board with Qwiic I2C interconnect called the Adafruit TCA8418 Keypad Matrix and GPIO Expander Breakout.</p> <p>The great advantage of this IC is that the keyboard scanning is done continuously, and it has a 10-element event queue, so even if you don't get to the interrupt immediately, keypress and release events will be held for you. Since it's I2C its very easy to use with any DCC-EX command station.</p> <p>The TCA8418 driver presently configures the IC in the full 8x10 keyboard scanning mode, and then maps each key down/key up event to the state of a single vpin for extremely easy use from within EX-RAIL and JMRI as each key looks like an individual sensor.</p> <p>This is ideal for mimic panels where you may need a lot of buttons, but with this board you can use just 18 wires to handle as many as 80 buttons.</p> <p>By adding a simple HAL statement to myAutomation.h it creates between 1 and 80 buttons it will report back.</p> <pre><code>HAL(TCA8418, firstVpin, numPins, I2CAddress, interruptPin)\n</code></pre> <p>For example:</p> <pre><code>HAL(TCA8418, 300, 80, 0x34)\n</code></pre> <p>Creates VPINs 300-379 which you can monitor with EX-RAIL, JMRI sensors etc.</p> <p>With an 8x10 key event matrix, the events are numbered using the Rn row pins and Cn column pins as such:</p> <pre><code>     C0  C1  C2  C3  C4  C5  C6  C7  C8  C9\n    ========================================\n R0|  0   1   2   3   4   5   6   7   8   9\n R1| 10  11  12  13  14  15  16  17  18  19\n R2| 20  21  22  23  24  25  26  27  28  29\n R3| 30  31  32  33  34  35  36  37  38  39\n R4| 40  41  42  43  44  45  46  47  48  49\n R5| 50  51  52  53  54  55  56  57  58  59\n R6| 60  61  62  63  64  65  66  67  68  69\n R7| 70  71  72  73  74  75  76  77  78  79\n</code></pre> <p>So if you start with the first pin definition being VPIN 300, R0/C0 will be 300 + 0, and R7/C9 will be 300+79 or 379.</p> <p>And if needing an Interrupt pin to speed up operations:</p> <pre><code>HAL(TCA8418, 300, 80, 0x34, 21)\n</code></pre> <p>This is not for CSB1 which has no spare pins for interrupts.</p> <p>Note that using an interrupt pin speeds up button press acquisition considerably (less than a millisecond vs 10-100), but even with interrupts enabled the code presently checks every 100ms in case the interrupt pin becomes disconnected. Use any available Arduino pin for interrupt monitoring.</p> <p>For devices behind multiplexors see multiplexors</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/various-devices/tm-1638/","title":"TM1638 Buttons, leds and 7 segment display","text":"<p>CAUTION: This boards require several GPIO pins on the Command Station but as speed is unimportant, these 3 may be VPINS on another hardware expander such as an MCP23017.</p> <p>The TM1638 board provides a very cheap way of implementing 8 buttons, 8 leds and an 8 digit 7segment display in a package requiring just 5 Dupont wires (vcc, gnd + 3 GPIO pins) from the command station without soldering.</p> <p>This is ideal for prototyping and testing, simulating sensors and signals, displaying states etc. For a built layout, this could provide a control for things that are not particularly suited to throttle 'route' buttons, perhaps lineside automations or fiddle yard lane selection.  </p> <p>The board is defined in EXRAIL using HAL(TM1638,firstVpin,clk,dio,stb)</p> <pre><code>HAL(TM1638,500,29,31,33)\n</code></pre> <p>Creates VPINs 500-507 And describes the VPINs used to connect the clk,dio,stb pins on the TM1638 board.</p> <p>Setting each of the VPINs will control the associated LED (using for example SET, RESET or BLINK in EXRAIL or `   from a command). <p>Unlike most pins, you can also read the same pin number and get the button state, using EXRAIL IF/AT/ONBUTTON etc.</p> <p>All the following examples assume you are using VPIN 500 as the first, leftmost,  led/button on the TM1638 board.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/various-devices/tm-1638/#using-buttons-and-leds","title":"Using buttons and LEDs","text":"<pre><code>ONBUTTON(500)  // when button 500 is pressed \n  SET(500)     // light the first led\n  BLINK(501,500,500) // blink the second led\n  DELAY(2000)\n  RESET(500) RESET(501)  // turn leds off\n  DONE\n</code></pre>"},{"location":"products/ex-commandstation/exrail/cookbooks/various-devices/tm-1638/#using-the-7-segment-display","title":"Using the 7 Segment display","text":"<p>The 8 digit display can be treated as 8 separate digits (left most being the same VPIN as the leftmost button and led) or be written to in sections of any length. Writing uses the existing analogue interface to the common HAL but is awkward to use directly.  To make this easier from EXRAIL, a SEG7 macro provides a remapping to the ANOUT facility that makes more sense.</p> <pre><code>SEG7(vpin,value,format)\n</code></pre> <p>The vpin determines which digit to start writing at. The value can be a 32bit unsigned integer but is interpreted differently according to the format.</p> <p>Format values:</p> <ul> <li>1..8  give the length (number of display digits) to fill, and defaults to decimal number with leading zeros.</li> <li>1X..8X give the length but display in hex.</li> <li>1R..4R treats each byte of the value as raw 7-segment patterns so that it can write letters and symbols using any combination of the 7segments and decimal point. There is a useful description here:</li> </ul> <p>Examples:</p> <pre><code>SEG7(500,3,4)           // writes 0003 to first 4 digits of the display\nSEG7(504,0xcafe,4X)     // writes CAFE to the last 4 digits\nSEG7(500,0xdeadbeef,8X) // writes dEAdbEEF to all 8 digits. \n</code></pre> <p>Writing raw segment patters requires knowledge of the bit pattern to segment relationship:</p> <pre><code>    == 0 ==\n   5|     | 1\n    == 6 ==\n  4 |     | 2\n    == 3 == 7    (7 is decimal point)  \n</code></pre> <p>Thus Letter A is segments  6 5 4 2 1 0, represented in binary (zero bit is on right) as 0b01110111 or 0x77.</p> <p>This is not easy to do my hand and thus a new string type suffix <code>_s7</code> has been introduced to make simple text messages. Note that the HAL interface only has width for 32 bits which is only 4 symbols so writing 8 digits requires two calls.</p> <pre><code>SEG7(500,\"Hell\"_s7,4R) SEG7(504,\"o\"_s7,4R)\nDELAY(1000)\nSEG7(500,\"Worl\"_s7,4R) SEG7(504,\"d\"_s7,4R)\n</code></pre> <p>Note that some letters like k,m,v,x do not have particularly readable 7-segment representation.</p> <p>Credit to https://github.com/dvarrel/TM1638 for the basic formulae.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/various-devices/trainbrains/","title":"Trainbrains Devices","text":"<p>These devices are available from trainbrains.eu and operate over I2C.</p> <p>They auto-detect the device type so it is only necessary to provide HAL statements in myAutomation.h to identify that the device on the given address is a Trainbrains device and the number of VPINs that will be reserved for it by DCC-EX.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/various-devices/trainbrains/#turnout-drivers-solenoid-and-servo","title":"Turnout drivers (solenoid and servo)","text":"<p>Use the HAL statement to identify the device I2C address and create PIN_TURNOUT definitions so that DCC-EX sees the vpins as turnouts.</p> <pre><code>HAL(Trainbrains,700,2,0x14)\nPIN_TURNOUT(1,700,\"Coal yard exit\")\nPIN_TURNOUT(1,701,\"Oil yard exit\")\n</code></pre> <p>This creates VPINS 700 and 701 as turnouts. All other turnout operations in DCC-EX operate as normal. This isn't going to work if the devivce at I2C address 0x15 is not a Trainbrains turnout controller.</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/various-devices/trainbrains/#signal-controller","title":"Signal controller","text":"<p>The signal controller only has one VPIN but may have hundreds of different combinations of lamps, blinking and state. This can be handled by pretending it is a NEOPIXEL signal and setting the Red channel to the lamp combination, the Blue channel to the blinking combination and the Green channel to the signal state. (Refer to Trainbrains documentation for details)</p> <p>For example: (This is taken from the NEOPIXEL definitions, TODO we can replace this with a suitable alias. Just replace the colour values with the lamps,blink,state values. )</p> <pre><code>HAL(Trainbrains,720,1,0x15)\n\n// create 1-lamp signal with NeoRGB colours\nNEOPIXEL_SIGNAL(720,NeoRGB(255,0,0),NeoRGB(255,100,0),NeoRGB(0,255,0))\n\n// Create 1-lamp signal with named colours.\n// This is better if you have multiple signals.\n// (Note: ALIAS is not suitable due to word length defaults) \n#define REDLAMP NeoRGB(255,0,0)\n#define AMBERLAMP NeoRGB(255,100,0)\n#define GREENLAMP NeoRGB(0,255,0)\nNEOPIXEL_SIGNAL(702,REDLAMP,AMBERLAMP,GREENLAMP)\n\n// Create 1-lamp signal with web type RGB colours \nNEOPIXEL_SIGNAL(702,0xFF0000,0xFF6400,0x00FF00)\n</code></pre> <p>Signal values can be manually tested using the  command like this <pre><code>&lt;o vpin lamps flashes state&gt;\n</code></pre> <p>To have a disco party, try</p> <pre><code>&lt;o 702 255 255 1&gt;\n</code></pre> <p>For more than 3 signal aspects (other than RED/AMBER/GREEN) it is suggested that you create macros that will set the signal to the nearest equivalent RED/AMBER/GREEN and then overwrite the aspect with a NEOPIXEL command. In this way the IFRED/ONRED etc features will still work but the actual lamp display could be anything.</p> <pre><code>#define SHUNT(x) \\\nAMBER(x)  \\\nNEOPIXEL(x,10,2,2)\n</code></pre>"},{"location":"products/ex-commandstation/exrail/cookbooks/various-devices/trainbrains/#sensors","title":"Sensors","text":"<p>The block occupancy sensor has 3 blocks.</p> <pre><code>HAL(Trainbrains,730,3,0x13)\n</code></pre> <p>makes virtual pins 730..732 usable as sensors like any other in DCC-EX</p> <p>For devices behind multiplexors see multiplexors</p>"},{"location":"products/ex-commandstation/exrail/cookbooks/various-devices/xl9535/","title":"XL9535 Relay Board","text":"<p>The XL9535 devices have varying numbers of relays and are easier to wire than having to have separate relays connected to an IO Expander (such as MCP23017 or PCA/TCA9555)</p> <p>Driver definition is by a HAL command in myAutomation.h (or files it includes) </p> <pre><code>HAL(XL9535, firstVpin, NumberOfRelays, i2cAddress)\n</code></pre> <p>For devices behind multiplexors see multiplexors</p>"},{"location":"products/ex-commandstation/loco-programming/decoderpro/","title":"Using JMRI DecoderPro","text":"<p>While it is possible to use the DCC-EX API to program decoders, the recommended course of action , for anything beyond the simple examples, is to use JMRI DecoderPro for this as it provides a comprehensive yet relatively simple to use interface for all your programming needs.</p> <p>In addition, DecoderPro includes code to use advanced DCC-EX functions to significantly improve speed compared with most Command Stations.</p> <p>For a quick introduction, refer to JMRI DecoderPro</p> <p>To make changes to your decoder settings, select the loco you wish to program, then click the Program button to launch the programming dialog.</p> <p>To set basic items such as the decoder address and speed steps, use the options on the \u201cBasic\u201d tab</p> <p>For options such as acceleration and deceleration, use the \u201cMotor\u201d tab, noting there is also a \u201cMomentum\u201d tab for more control over inertia settings</p> <p>To adjust speed matching, you can update speed options on either the \u201cBasic Speed Control\u201d or \u201cSpeed Table\u201d tabs, depending upon your appetite for pain and frustration</p> <p>If you have a sound decoder, then adjust the appropriate settings on the \u201cSound\u201d and \u201cSound Levels\u201d tabs</p> <p>When you\u2019re finished editing, you need to write the changes to the decoder. To do so, there are four options:</p> <ul> <li> <p>Write changes on sheet - use this if you\u2019ve only made a few changes on one tab</p> </li> <li> <p>Write full sheet - use this if you\u2019re not sure if all settings on the tab are already set or not, it will take a little longer to write</p> </li> <li> <p>Write changes on all sheets - use this if you\u2019ve made changes on multiple tabs</p> </li> <li> <p>Write all sheets - use this if you want to ensure every setting on every tab is written, noting this will take some time to write</p> </li> </ul> <p>Note that this really is just scratching the surface of the capabilities of DecoderPro, and we highly recommend you read the full documentation on the JMRI website .</p> <p>Even if you don\u2019t intend to use JMRI to control your layout, it still has the best decoder programming functionality by far.</p>"},{"location":"products/ex-commandstation/loco-programming/engine-driver-programming/","title":"Programming with Engine Driver","text":"<p>These features are only available when the DCC-EX Native Protocol preference is enabled. The WiThrottle protocol does not include programming.</p> <p>Touching either the DCC-EX Menu item or the button will open the \u201cDCC-EX\u201d screen.</p> <p>On the DCC-EX Screen you can use the \u201cAction\u201d pulldown to select Programming Track (Service Mode)</p> <p>The commands do assume that you have the loco on the PROG track, and that it is clean etc. </p>"},{"location":"products/ex-commandstation/loco-programming/engine-driver-programming/#read-loco-address","title":"Read loco address","text":"<p>To read the address, click the Read button on the same line as the \u2018DCC Address\u2019 label.</p>"},{"location":"products/ex-commandstation/loco-programming/engine-driver-programming/#write-loco-address","title":"Write loco address","text":"<p>To write a new address, enter the address in the \u2018DCC Address\u2019 field and click Write</p>"},{"location":"products/ex-commandstation/loco-programming/engine-driver-programming/#read-and-write-cvs-of-decoders-on-the-programming-track","title":"Read and write CVs of decoders on the Programming Track\uf0c1","text":"<p>To read a CV, enter the CV number into the \u2018CV\u2019 field, and click the Read button on the same line as the \u2018CV\u2019 label.</p> <p>To write a new CV value, enter the CV number into the \u2018CV\u2019 field, enter the new value in the \u2018Value\u2019 field and click Write</p> <p>Optionally, you can use the \u2018NRMA CVs\u2019 pulldown to select a common CV from a list. This just enters the appropriate CV number in the \u2018CV\u2019 field.</p>"},{"location":"products/ex-commandstation/loco-programming/engine-driver-programming/#if-things-dont-work","title":"If things dont work","text":"<p>The best way to diagnose problems is to use a serial monito and the underlying commands. See Diagnostics</p>"},{"location":"products/ex-commandstation/loco-programming/programming/","title":"Programming DCC locos","text":""},{"location":"products/ex-commandstation/loco-programming/programming/#the-prog-track","title":"The PROG track","text":"<p>In normal DCC operation, running locos happens on a MAIN track (your layout) and programming takes place on a separate piece of track (typically just long enough for your loco) called a PROG track. You loco will not respond to throttles if it is on the PROG track, and the command station will not send programming commands to the MAIN track.</p> <p>Some command stations are not able to do programming and running at the same time, this restribction does not apply to DCC-EX.</p> <p>DCC-EX provides some tricks to switch tracks in software, perhaps because you only have a single loco or your PROG track is actually an isolated siding on a layout. See Track Manager</p>"},{"location":"products/ex-commandstation/loco-programming/programming/#readingwriting-decoder-settings","title":"Reading/Writing decoder settings","text":"<p>Simple programming usually involves detecting or changing the DCC address of a loco. More advanced programming, especially involving sound locos can be very complex and varies from decoder to decoder, even when they are made by the same manufacturer.</p> <p>The EX_Command station provides the underlying technology to read and write individual decoder settings (called CVs) plus some higher-level functions to simplify this process for common problems like reading or writing a loco address which involves many reads or writes.</p>"},{"location":"products/ex-commandstation/loco-programming/programming/#programming-using-serial-input-commands","title":"Programming using Serial input commands","text":"<p>This requires access to the serial monitor. It is the most flexible method and can provide diagnostics when things dont work. It also has the flexibility to adjust the tuning parameters to cope with decoders that are way outside the normal decoder electronic standards.</p> <p>See Programming with Serial commands</p>"},{"location":"products/ex-commandstation/loco-programming/programming/#programming-using-engine-driver","title":"Programming using Engine Driver","text":"<p>The Engine Driver throttle includes simple programming dialogs, including the \"Drive Away\" feature that allows a throttle to obtain the loco address from a prog track and drive the loco directly without having to re-enter the address.</p> <p>See Programming with Engine Driver</p>"},{"location":"products/ex-commandstation/loco-programming/programming/#programming-using-ex-toolbox","title":"Programming using EX-Toolbox","text":"<p>The EX-Toolbox Android application, includes simple programming dialogs and some more advanced features such as a speed matching tool used to adjust loco speed tables to match with another loco so that they can be coupled together in a consist.</p> <p>See Programming with EX-Toolbox</p>"},{"location":"products/ex-commandstation/loco-programming/programming/#programming-with-jmri-decoderpro","title":"Programming with JMRI DecoderPro","text":"<p>There are very few \"standards\" relating to DCC decoders and there are hundreds of incompatible devices in use around the world. JMRI DecoderPro contains a massive database of decoder types, and their quirks, built up over many years of experience.</p> <p>For advanced programming, this is the tool of choice.</p> <p>See Programming with DecoderPro</p>"},{"location":"products/ex-commandstation/loco-programming/serial-programming/","title":"Programming using Serial commands","text":"<p>Serial commands are entered on a serial monitor</p> <p>This gives you direct access to the underlying DCC-EX features to access the programming track.</p> <p>All other programming methods through throttles, toolbox or DecoderPro use this interface.</p> <p>In other words... If this method doesn't work, don't waste your time trying the others!</p>"},{"location":"products/ex-commandstation/loco-programming/serial-programming/#reading-a-loco-id","title":"Reading a loco id","text":"<p>The command <code>&lt;R&gt;</code> examines all the necessary CVs and should return something like <code>&lt;r 123&gt;</code> to indicate that address 123 will drive the loco. A negative result like <code>&lt;r -3&gt;</code> indicates that there was an error. See below for diagnosing this problem.</p> <p>Contrary to what you may read on the internet, reading CV1 is NOT sufficient to find the address of a DCC loco that you wish to drive. It is important to check up to 6 separate CVs to find the address that will drive the loco, especially if it has been given a DCC consist address.</p>"},{"location":"products/ex-commandstation/loco-programming/serial-programming/#setting-a-loco-id","title":"Setting a loco id","text":"<p>The command <code>&lt;W 123&gt;</code> will set the locoid to 123. You should confirm this with <code>&lt;R&gt;</code>.</p> <p>This command will clear any DCC consist settings, decide whether the address is a long or short type and set all the necessary CVs. As before, writing CV1 is not sufficient.</p>"},{"location":"products/ex-commandstation/loco-programming/serial-programming/#reading-a-cv-value","title":"Reading a CV value","text":"<p>The command <code>&lt;R 123&gt;</code> will read the value from CV123 and return it like <code>&lt;r 123 99&gt;</code></p> <p>Negative values indicate an error accessing the cv. Refer to diagnostics below.</p>"},{"location":"products/ex-commandstation/loco-programming/serial-programming/#setting-a-cv-value","title":"Setting a CV value","text":"<p>The command <code>&lt;W 123 99&gt;</code> will write the value 99 into CV123 and return it like <code>&lt;r 123 99&gt;</code></p> <p>A negative return value indicates an error.</p>"},{"location":"products/ex-commandstation/loco-programming/serial-programming/#dcc-consists","title":"DCC Consists","text":"<p>A loco may be given a DCC consist address, it's actual address is not altered, but it will no longer accept throttle movement commands on the actual address. </p> <p>The command  <code>&lt;W CONSIST 77&gt;</code> will set the consist address to 77.</p> <p>The command  <code>&lt;W CONSIST 77 REVERSE&gt;</code> will set the consist address to 77 but indicate that the loco is facing backwards compared to others.</p> <ul> <li>The <code>&lt;R&gt;</code> command will then return the consist address because that is the address needed to drive it.</li> <li>To obtain the actual locoid, use <code>&lt;R LOCOID&gt;</code>.</li> <li>To obtain the consist address, use <code>&lt;R LOCOID&gt;</code>.</li> </ul>"},{"location":"products/ex-commandstation/loco-programming/serial-programming/#bit-management","title":"Bit management","text":"<p>For advanced use, the individual bits of a cv make be read or written:</p> <p><code>&lt;R 123 7&gt;</code> Reads bit 7 of cv 123 <code>`&lt;W 123 7 1&gt;</code> Sets bit 7 of cv 123 to 1</p>"},{"location":"products/ex-commandstation/loco-programming/serial-programming/#diagnostics-when-things-dont-work","title":"Diagnostics when things don't work","text":"<p>There are a number of very basic checks that you should do before getting into software disgnostics. The vast majority of support calls are solved easily by checking:</p> <ul> <li>Is the loco on the PROG track?</li> <li>Is the PROG track wired to the correct motor shield output?</li> <li>Is the track clean?</li> <li>Are the loco wheels clean?</li> <li>Are the pickups from the wheels clean?</li> <li>Is the track power supply plugged in and switched on?</li> </ul> <p>Following that:</p> <ul> <li>DO you have a PROG track defined, the <code>&lt;=&gt;</code> command will tell you.</li> <li> <p>Issue the <code>&lt;1 PROG&gt;</code> command and check that the two leds on the motor shield for the PROG track oputput come on</p> </li> <li> <p>Check with a meter that you get power to the PROG track.</p> </li> </ul> <p>Issue the command <code>&lt;D ACK ON&gt;</code>, this will enable the output of detailed diagnostic information of what the Command station is doing when it runs programming commands.</p> <p>Then try the command <code>&lt;R 8&gt;</code> , this should attempt to read CV 8 (the Decoder manufacturer id). You will get a long diagnostic trace. If the final response is negatine (eg <code>&lt;r 8 -1&gt;</code>) then copy the entire diagnostic trace to a support ticket and we can help. (Experienced users will soon learn to read the trace)</p> <p>PLEASE DO NOT SEND A SCREENSHOT OR PHOTO!</p> <p>If the <code>&lt;R 8&gt;</code> command respinds with a non-negative number like <code>&lt;r 8 123&gt;</code> that that command has worked,  so you should re-attempt the command that failed and send in the trace of that.</p>"},{"location":"products/ex-commandstation/loco-programming/serial-programming/#ack-detector-tuning-parameters","title":"ACK detector tuning parameters","text":"<p>There are a variety of advanced tuning parameters that can be adjusted to help detect decoders that fall way outside the supposed \"standards\". In some cases we can only imagine that the decoder creator misplaced a decimal point as the results are a factor of ten outside the standard limits.</p> <p>These include:</p> Command Description Parameters <code>&lt;D ACK ON&gt;</code> Enable PROG track diagnostics None <code>&lt;D ACK OFF&gt;</code> Disable PROG track diagnostics None <code>&lt;D ACK LIMIT value&gt;</code> Set ACK detection limit mA <code>value</code>: Current limit in mA <code>&lt;D ACK MIN value MS&gt;</code> Set ACK minimum duration mS <code>value</code>: Duration in milliseconds <code>&lt;D ACK MIN value&gt;</code> Set ACK minimum duration \u00b5S <code>value</code>: Duration in microseconds <code>&lt;D ACK MAX value MS&gt;</code> Set ACK maximum duration mS <code>value</code>: Duration in milliseconds <code>&lt;D ACK MAX value&gt;</code> Set ACK maximum duration \u00b5S <code>value</code>: Duration in microseconds <code>&lt;D ACK RETRY value&gt;</code> Set ACK retry count <code>value</code>: Retry count"},{"location":"products/ex-commandstation/loco-programming/toolbox-programming/","title":"Programming wit EX-Toolbox","text":"<p>[TODO] toolbox generally. </p>"},{"location":"products/ex-commandstation/trackmanager/booster/","title":"EX-CSB1 in DCC Booster Mode","text":"<p>The EX-CSB1 can be configured as a DCC Booster.  As a booster it can take input from any DCC Command Station, not just an EX-CommandStation, to provide additional two power districts to your layout.  With the addition of an EX-MotorShield8874, it can provide up to 4 power districts.</p> <p>To configure the EX-CSB1 as a DCC Booster, you will need to install the EX-CommandStation software on it with the addition of the following commands to the <code>myAutomation.h</code> file:</p> <pre><code>AUTOSTART\n  PRINT(\"Auto Booster Mode\")\n  SET_TRACK(A, MAIN)\n  SET_TRACK(B, MAIN)\n  SET_POWER(A, OFF)\n  SET_POWER(B, OFF)\n  LCD(4, \"BOOSTER OFF\")\n  PRINT(\"Waiting for RAILSYNC\")\n  DONE\n\nONRAILSYNCON\n  SET_TRACK(A, BOOST)\n  SET_POWER(A, ON)\n  PRINT(\"RAILSYNC ON TRACK A BOOST\")\n  SET_TRACK(B, BOOST)\n  SET_POWER(B, ON)\n  PRINT(\"RAILSYNC ON TRACK B BOOST\")\n  LCD(4, \"BOOSTER A B ON\")\n  DONE\n\nONRAILSYNCOFF\n  SET_TRACK(A, MAIN)\n  SET_TRACK(B, MAIN)\n  SET_POWER(A, OFF)\n  SET_POWER(B, OFF)\n  LCD(4, \"BOOSTER OFF\")\n  PRINT(\"RAILSYNC OFF\")\n  DONE\n\n    // If you are using an EX-CSB1 with an EX-MotorShield8874 as your booster,\n    // add the commands for tracks C and D to the myAutomation.h file.\n</code></pre> <p>You also need to add these two lines to the <code>config.h</code> file:</p> <pre><code>#define WIFI_LED 33\n#define BOOSTER_INPUT 32\n</code></pre> <p>You will then need to connect a <code>MAIN</code> output from your command station to the Railsync connector on the EX-CSB1 Booster.  The EX-CSB1 Booster will then provide power to the rails on the A and B outputs.  If you are using an EX-MotorShield8874, it will also provide power to the rails on the C and D outputs.</p> <p>If you are using an EX-CSB1 as your Command Station, it is recommended that you use one of the outputs as the dedicated output to the EX-CSB1 Booster. If you use the output to the booster, as well as to a block of track, a short or overload on that block will cause the EX-CSB1 Booster to also kill power to all of its outputs.</p> <p>Output configuration options</p> <p>The outputs can be configured as:</p> <ul> <li><code>BOOST</code> - Booster mode</li> <li><code>BOOST_INV</code> - Booster mode inverted</li> <li><code>BOOST_AUTO</code> - Booster mode + Auto-reverser mode</li> </ul>"},{"location":"products/ex-commandstation/trackmanager/trackmanager/","title":"TrackManager","text":"<p>TrackManager is what lets you dynamically configure the outputs of your Command Station as either:</p> <ul> <li>Main DCC track output</li> <li>Programming DCC track output</li> <li>DC mode</li> <li>DCC Auto Reverse</li> <li>DCC Booster</li> </ul> <p>Track A defaults to MAIN.  Track B defaults to PROG.  </p> <p>Track mode can be defined in myAutomation.h Example: Set a track to DC</p> <p>This screen shows where track modes can be set with Engine Driver:  </p> <p> </p> <p>NOTE: \u00a0 DC output is only available with specific hardware requirements.</p> <p>TrackManager  -  reference document Multi-district DC mode track sync -  additional detail As these pages are under development, you may also want to refer to the legacy documentation</p>"},{"location":"products/ex-fastclock/calibration/","title":"Calibration","text":"<p>The MCUFRIEND style shield used in this project is usually a cheap(ish) import from China.  These come with a variety of processor chips and various tolerances on the touch screen.  As such before use it is necessary to carry out a calibration routine.  The MCUFRIEND library contains a routine for this and a number ot test programs to test out the functionality of the TFT/Touch screen.</p> <p>To carry out the calibration please carry out the following steps:</p> <p>In either VSCODE/PlatformIO or Arduino IDE locate and load the sketch TouchScreen_Calibr_Native.ino  This should be found in the MCUFRIEND_kbv/examples folder in the libraries.  By default this test is setup to run using the screen in Portrait mode which is the correct orientation.</p> <p>Load a System Monitor - this will display any output from the test program.</p> <p>Compile and upload this sketch to the Arduino UNO - this should generate the screen shown below.</p> <p></p> <p>Touching the screen will then display the calibration screen shown in Fig 2 below:</p> <p></p> <p>As requested - using a stylus press the crosses displayed in the squares in turn.  When this process is complete the configuration data will be displayed on the screen.  The same data should be displayed on the System Monitor.  The output should look like that shown in Fig 3 below:</p> <p></p> <p>Cut/Copy the two lines indicated in Fig 3. and paste them into the appropriate space in the config.h file from the EX-Fast_Clock code.</p>"},{"location":"products/ex-fastclock/configuration/","title":"Configuration","text":"<p>The FastClock can either operate in one of three modes:</p> <ul> <li>Standalone</li> <li>Serial Communication with the CS</li> <li>I2C Communication with the CS.</li> </ul> <p>To indicate which mode is in use it is necessary to edit the config.h file.</p>"},{"location":"products/ex-fastclock/configuration/#standalone-use","title":"Standalone use","text":"<p>The config.h file comes pre-configured to use the clock in standalone mode.  No changes are necessary.</p>"},{"location":"products/ex-fastclock/configuration/#serial-mode","title":"Serial Mode","text":"<p>To communicatein Serial mode it is necessary to edit the config.h file and uncomment the following line:</p> <pre><code>//#define SEND_VIA_SERIAL true\n</code></pre> <p>This will load the appropriate code including the Wire library.</p>"},{"location":"products/ex-fastclock/configuration/#i2c-mode","title":"I2C mode","text":"<p>To operate in I2C mode edit the config.h file and uncomment the following lines:</p> <pre><code>//#define I2CAddress 0x55 // default I2C address\n//#define SEND_VIA_I2C true\n</code></pre> <p>In this mode the CS will poll the FastClock to obtain the time.  It is necessary to set the same I2C address here as used in the myHal.cpp file within the CS.  This is set to a default of 0x55 (decimal 85) but can be set to some other value if this conflicts with othere I2C devices on your setup.</p>"},{"location":"products/ex-fastclock/configuration/#screen-header","title":"Screen Header","text":"<p>By default the top of the clock screen displays the name of my own layout.  To inset your layout name then change the following line.</p> <pre><code>char header[HDDR_SIZE] = {\"Nantyderry Junction\"};\n</code></pre>"},{"location":"products/ex-fastclock/configuration/#touchscreen-configuration","title":"Touchscreen Configuration","text":"<p>Finally insert the output of the touchscreen configuration program into the file in place of the following two lines.</p> <pre><code>const byte XP = 7, XM = A1, YP = A2, YM = 6;\nconst int TS_LEFT=899,TS_RT=122,TS_TOP=100,TS_BOT=898;\n</code></pre>"},{"location":"products/ex-fastclock/configuration/#configure-existing-clock","title":"Configure existing clock","text":"<p>If you already have a FastCLock there are a number of couple of configuration options which allow you to connect your own clock to a  Command Station.</p> <p>The various configuration options are outlined below</p>"},{"location":"products/ex-fastclock/configuration/#connecting-your-own-fastclock","title":"Connecting your own FastClock","text":""},{"location":"products/ex-fastclock/configuration/#connecting-via-serial","title":"Connecting via Serial","text":"<p>Connecting via Serial is the simplest option if available.  </p> <ul> <li>Run a dupont cable from the TX pin on the arduino to a RX pin on the EX-CommandStation.  It is not usually necessary to run a cable from RX to the TX on the EX-CommandStation as  the FastClock is not receiving data back.</li> <li>Find the Serial defines in the config.h file (or copy config.example.h to config.h if you dont have one), locate the following lines:</li> </ul> <pre><code>//#define SERIAL1_COMMANDS\n//#define SERIAL2_COMMANDS\n//#define SERIAL3_COMMANDS\n</code></pre> <p>and uncomment the appropriate one for the serial port you are using.</p> <ul> <li>Add the following code to your Setup() function:</li> </ul> <pre><code>Serial.begin(115200);\nwhile (!Serial) {\n; // wait for serial port to connect. Needed for native USB port only\n}\n</code></pre> <ul> <li>Include the following routine within your code:</li> </ul> <pre><code>void SendTime(byte hour, byte mins, byte speed) {\n\n  int itime = (hour * 60) + mins;\n  char buffer[20];\n  sprintf(buffer, \"&lt;JC %d %d&gt;\", itime, speed);\n  Serial.println(buffer);\n}\n</code></pre> <ul> <li>Each time the time changes call the SendTime routine as follows:</li> </ul> <pre><code>SendTime(HH, MM, clockSpeed);\n</code></pre> <p>where HH = the hour, MM = minutes and clockSpeed = the fast speed (e.g. at spped 4, 15 seconds represents a minute).</p>"},{"location":"products/ex-fastclock/configuration/#connecting-via-i2c","title":"Connecting via I2C","text":"<p>Connecting via I2C involves a HAL driver file to the Command Station as well as adding some code to the existing FastClock code.  Follow the following steps:</p> <ul> <li>In the  Command Station code copy the file myHal.cpp_example.txt to myHal.cpp.</li> <li>Edit the file myHal.cpp and uncomment the following line near the beginning of the file</li> </ul> <pre><code>//  #include \"IO_EXFastClock.h\"  // FastClock driver\n</code></pre> <ul> <li>Uncomment the following line near the end of the file</li> </ul> <pre><code>//  EXFastClock::create(0x55);\n</code></pre> <p>0x55 (decimal 85) is the default address but needs to match that in the FastClock code (see below).</p> <ul> <li> <p>Using Dupont connectors connect SDA/SCL/Gnd on the clock to SDA/SCL/Gnd on the  Command Station</p> </li> <li> <p>Include the following code in your FastClock code:</p> </li> </ul> <p>Near the top of the sketch:</p> <pre><code>#include &lt;Wire.h&gt;\n</code></pre> <p>Within your Setup():</p> <pre><code>Wire.begin(I2CAddress);\nWire.onRequest(TransmitTime);\n</code></pre> <p>Add the following function within the sketch</p> <pre><code>void TransmitTime() {\n    // send the data over I2C\n    // send the time as &lt;mmmm&gt; as two bytes followed by clockspeed\n    int timetosend = (HH * 60) + MM;\n    byte TimeArray[2];\n\n    TimeArray[0] = (timetosend &gt;&gt; 8);\n    TimeArray[1] = timetosend &amp; 0xFF;\n    Wire.write(TimeArray, 2);\n    Wire.write(clockSpeed);      \n}\n</code></pre> <p>In the function above  HH is the time as hours (24hr. clock) and MM is the minutes.</p> <ul> <li>The CommandStation-EX will now poll the FastClock to request the time.  The frequency at which it does so is influenced by the clock speed (i.e. on a slow clock speed it polls less often).</li> </ul> <p>Now that you know how to connect your existing FastCLock, click the \"next\" button see how you use EX-FastClock.  </p>"},{"location":"products/ex-fastclock/hardware/","title":"Hardware","text":""},{"location":"products/ex-fastclock/hardware/#what-you-need-for-ex-fastclock","title":"What you need for EX-FastClock","text":"<ul> <li>An EX-CommandStattion running version 5.0.0 or later</li> <li>An Arduino Uno microcontroller</li> <li>An MCUFRIEND type plug in shield TFT touchscreen</li> <li>A suitable power supply</li> <li>Dupont type wires to connect the components, male to female or female to female as required</li> <li>A USB cable to connect the Arduino to a PC to load the software</li> </ul> <p>The software for the  EX-FastClock can be found in the  EX-FastClock repository in the DCC-EX GitHub.  The code can be configured to run a clock which will communicate to the Command Station by either Serial or I2C.  The options are chosen from the file config.h.  Instructions are contained in the README.md file.  Which option you choose will depend upon weather you have serial throttles connected to the serial ports in which case I2C might be the better option.  Alternatively if you already have lots of I2C devices then it might be better to run the Serial option.</p> <p>Given that the MCUFREIND style shield is a shield and uses the A4 pin as LCD_RST it is necessary to make a modification to enable the I2C communication.  This involces cutting the A4 pin and soldering a jumper from LCD_RST on the back of the TFT board to the pin that aligns with the UNO RST pin.  However if one is intending to configure the clock as a serial device then this modification is not required.</p> <p></p> <p>This modification allow the A4 &amp; A5 to operate correctly as I2C and was suggested by David Prentice who wrote the MCUFRIEND.kbv library that this project uses.  A discussion on this modification can be found on the Arduino forum here.</p> <p>If using Serial communication no modification is required. Pins 0 &amp; 1 (TX/RX) are unused on the LCD PCB therefore wires may be soldered to the Arduino PCB to run to Serial connections on the CS.</p> <p>Now that you know what you need, click the \"next\" button see how you use  EX-FastClock.</p>"},{"location":"products/ex-fastclock/installation/","title":"Installation","text":"<p>The EX-FastClock Software will be found in the appropriate repository in the DCC-EX repository on Github</p> <p>This repositry currently contains two branches:</p> <ol> <li>Main.  This branch contains a copy of the code and ancilliary files on PlatformIO configuration.</li> <li>Arduino IDE.  This branch contains the files in the necessary structure for use with the Ardiuino IDE</li> </ol>"},{"location":"products/ex-fastclock/installation/#libraries","title":"Libraries","text":"<p>The project requires three libraries -</p> <ul> <li>Adafruit_GFX</li> <li>Adafruit_Touchscreen</li> <li>MCUFRIEND_kbv.  </li> </ul> <p>All three can be installed from the Arduino IDE library manager or Platformio Library system as required however for compatability where possible use the copies supplied in the repositiory folder.</p>"},{"location":"products/ex-fastclock/installation/#platformio","title":"Platformio","text":"<p>Select the Main branch from the repository and click on the CODE button.  Select Download ZIP file option.  Extract the files from the download and place the files in a folder within your Projects directory.</p>"},{"location":"products/ex-fastclock/installation/#arduino-ide","title":"Arduino IDE","text":"<p>Select the Arduino IDE branch from the repository and click on the CODE button.  Select Download ZIP file option.  Create a folder within your Arduino sketch folder called EX-Fast_Clock.  Copy the files EX-Fast_Clock.ino, EX-FastClock.h and config.h to this folder.  Copy the directories from the libraries folder into the Arduino libraries folder.</p>"},{"location":"products/ex-fastclock/installation/#both-environments","title":"Both Environments","text":"<p>I have  generated two special fonts for the project which can be found in the Fonts folder in the Adafruit GFX Library in this repository.  These should be copied into the fonts folder in the Adafruit_GFX library once installed. The file Arial9pt7b.h congtains a fullset of the Arial Font as used in Windows.  The file Arial48pt7b.h contains a large 48pt Arial font containing only charachters 0-9 and :.  This is used to display the time clock on the screen.  The full font was too large to fit into the Uno memory.</p>"},{"location":"products/ex-fastclock/operation/","title":"Operation","text":"<p>At startup the clock will calculate a start time based on either a) a coded start time (currently 6:00 a.m.) or b) a run time stored in the EEPROM (see item 2) below.</p> <p>The clock will start in a paused state and will display the speed rate factor (default = x 4).  Once any adjustemts have been made the clock can be started.  The usage of the six buttons are as below:</p> <ol> <li>Start - Pressing this button will start the clock and the button text will change to Pause.  </li> <li>Save - Pressing this button will pause the clock and save the current time and Speed Factor to the EEPROM.  These figures will be used to initialise the clock on nextstartup.</li> <li>Reset - Pressing this button will pause the clock and set the time to 06:00 with a speed factor of 4.</li> <li>T+ - Pressing this key will pause the clock and add 15 minutes to the time.</li> <li>T- - Pressing this key will pause the clock and deduct 15 minutes from the time.</li> <li>Rate - Pressing this key will increase the speed factor to the next level.  The speed factor will cycle around the seven speed settings of 1, 2, 4, 6,, 8, 12 &amp; 30.</li> </ol> <p>In Serial Mode, at startup the initial clock time will be sent to the Command Station but when in a paused state no further time commands are sent until the START button is pressed.</p> <p>In I2C mode the Command Station polls the FastClock at intervals.</p>"},{"location":"products/ex-fastclock/overview/","title":"EX-FastClock","text":"<p>Welcome to the home of EX-FastClock, a fully integrated Fast Clock for EX-CommandStation.</p> <p>EX-FastClock is a standalone adjustable speed clock built using an additional Arduino Uno microcontroller and a plug-in shield type TFT touch screen.  The commands built into the DCC_EX Command Station make it possible to also integrate an existing microcontroller based fast clock.</p> <p>Note: if you only want a real-time clock to make things happen at certain times of day, then the DS1307 is a simpler/cheaper alternative.</p>"},{"location":"products/ex-fastclock/overview/#background","title":"Background","text":"<p>This project is based on a project originally written by Jim Gifford (Hallet Cove Southern) in June 2017.  This project used a 32 x 8 LED matrix to display the time and was controlled by a number of pushbuttons.</p> <p>See Jim's Original Project here.</p> <p>I felt that this project was ripe for an update and decided to convert Jim's code to operate using a cheap TFT/LCD touch screen to run on my own layout. This project is the result.  Much of the code has been rewritten into smaller functions with additional features added, but the time clock calculations are the originals.</p> <p>This project has now been extended to add the capability of integrating the clock to the DCC-EX Command Station and more specifically the EXRAIL automation feature which now allows time based control. This feature is optional and can be controlled by the config.h file.</p>"},{"location":"products/ex-fastclock/overview/#what-is-ex-fastclock","title":"What is EX-FastClock?","text":"<p>EX-FastClock is a standalone microprocessor based fast adjustable speed clock, using an additional Arduino Uno in conjunction with a shield based TFT touchscreen. Features have been added to EX-CommandStation to allow the clock to integrate to the EX-CommandStation and control EXRAIL based on time events.</p> <p></p> <p>Each time the time changes the EX-CommandStation looks for a time change event and if it finds a match it executes the commands recorded for that event as defined in the EXRAIL myAutomation.h file.  Additionally the EX-CommandStation will issue a time broadcast so that other devices such as clock repeaters can capture the time.  Also where WiThrottle devices are connected a WiThrottle broadcast is made which means that connected devices such as Engine Driver can display the time.</p> <p>EX-FastClock allows the FastClock device to connect to the EX-CommandStation via either Serial Communications or I2C.  Even though EX-FastClock provides the code for an Uno based Clock it should be possible for tinkerer level users to add the relevant code if they already have a working clock that they wish to integrate to EX-CommandStation.</p> <p>To make full use of EX-FastClock**, you will need a basic understanding of EX-RAIL automation, but we'll share the details and some examples to help with this.</p> <p>NOTE: EX-FastClock is in public Beta testing, and as such, we encourage regular feedback on the success or otherwise of both the software and documentation. Please reach out via any of our support methods and help us get EX-FastClock as easy to use and reliable as possible.</p> <p>The EX-FastClock integration includes:</p> <ul> <li>A ready-made Arduino program for an Arduino Uno based Fast Clock</li> <li>Support for Serial connection</li> <li>|I2C| device driver</li> <li>EX-RAIL automation support</li> <li>Time Broadcast for time display on WiThrottle controllers such as |Engine Driver|</li> <li>Debug output to Serial Monitor</li> </ul>"},{"location":"products/ex-fastclock/overview/#credit-where-credit-is-due","title":"Credit where credit is due","text":"<p>*The EX-FastClock is based on a project originally written by Jim Gifford (Hallet Cove Southern) in June 2017. That project used a 32 x 8 LED matrix to display the time and was controlled by a number of pushbuttons. You can see Jim's Original Project here.</p> <ul> <li>MCUFRIEND.kbv credit: This library was written by David Prentice and has become the De-Facto standard for the shield based TFT screens used in this project. This library inherits from the Adafruit GFX library.</li> <li>Adafruit for the Adafruit GFX Library.</li> </ul>"},{"location":"products/ex-fastclock/overview/#next-steps","title":"Next Steps","text":"<p>Now that you have a general overview of EX-FastClock's features and capabilities, click the \"next\" button see what is needed to create an EX-FastClock.</p>"},{"location":"products/ex-fastclock/timecontrol/","title":"Time Control","text":""},{"location":"products/ex-fastclock/timecontrol/#exrail-commands","title":"EXRAIL Commands","text":"<p>Commands have been included in EXRAIL allow events to be controlled by the clock.  The new commands are:</p> <pre><code>ONCLOCKTIME( hour, mins)\n</code></pre> <p>and</p> <pre><code>ONCLOCKMINS( mins )\n</code></pre> <p>For details of how to use these commands see the Clock Control Cookbook.</p>"},{"location":"products/ex-fastclock/timecontrol/#testing-timed-sequences","title":"Testing Timed Sequences","text":"<p>If one is testing out a sequence using a timed command it can be done quickly without using the clock by entering commands from the System Monitor.  The form of the command is:</p> <pre><code>&lt;JC mmmm ss&gt; \n</code></pre> <p>Details are again on the Clock Control Cookbook.</p>"},{"location":"products/ex-ioexpander/ex-ioexpander/","title":"EX-IOExpander","text":"<p>Refer to the legacy EX-IOExpander documentation for the time being.</p>"},{"location":"products/ex-motorshield8874/ex-motorshield8874/","title":"EX\u2011MotorShield8874","text":"<p>Designed in conjunction with the DCC-EX development team, the EX\u2011MotorShield8874 is extremely simple to use with all current and future generations of EX\u2011CommandStation hardware.</p> <p>This board is the new standard by which we compare other boards.</p>"},{"location":"products/ex-motorshield8874/ex-motorshield8874/#features","title":"Features","text":"<ul> <li>Pin compatible with the original Arduino Motor Shield Rev3 but provides significantly improved electrical performance for driving higher loads, and improved usability.</li> <li>Rated for 5 Amps of continuous output current.</li> <li>No need to cut traces or bend out pins for stacking on the EX-CommandStation.</li> <li>2 outputs (Main and Programming Track or 2 Mains).</li> <li>Single power supply input powers the shield, the Arduino, and the track (motor output). Powering of Arduino boards is possible due to the onboard DC/DC buck converter, supporting a wide input supply range from 9 to 30V. The reverse polarity protection prevents damage to the circuit and its components in case the power supply is accidentally connected backwards.</li> <li>Wide input voltage range from 9V to 30V DC.</li> <li>5V and 3.3V compatible.</li> <li>Virtually no voltage drop, even at high currents.</li> <li>I2C header and STEMMA Qwiic connector for accessories (displays, port expanders, servo boards, etc.).</li> <li>Reverse polarity protection.</li> <li>Fault detection in addition to overcurrent reporting for extra safety.</li> <li>Alternative power in and out solder pads for different connector types.</li> <li>Stackable (Support Multiple Power Districts).</li> <li>Optional OLED header to connect a display directly to the shield.</li> <li>Based on two DRV8874 H-bridge motor drivers with integrated current sensing from Texas Instruments (TI). It is used to drive inductive loads like relays, solenoids, DC, stepping motors, as well as provide the DCC signal, and power to the model railroad tracks. Status LED for supply, which provides a visual indication of the power supply status in addition to LEDs to show each side of the A and B power outputs.</li> </ul> <p>The boards 5V and 3V friendly design makes it suitable for a broad range of Arduino compatible platforms, with an override that compensates for designs with incomplete support (such as an incorrect IORef voltage).</p>"},{"location":"products/ex-motorshield8874/ex-motorshield8874/#why-did-we-make-it","title":"Why did we make it","text":"<p>EX\u2011MotorShield8874 is specifically designed for use with DCC-EX Command Station for controlling model railroads, but can also be used as generally better replacement for Arduino Motor Shield R3 in any device that needs to control a motor. We needed higher current capacity to power more motors/trains and have little to no voltage drop due to advanced MOSFET driver technology.</p>"},{"location":"products/ex-motorshield8874/ex-motorshield8874/#purchase","title":"Purchase","text":"<p>The EX\u2011MotorShield8874 is available from many suppliers.</p>"},{"location":"products/ex-motorshield8874/ex-motorshield8874/#licensing","title":"Licensing","text":"<p>The EX\u2011MotorShield8874 was created through the gracious support and design facilities of Semify, who, along with DCC-EX, license it to manufacturers. The hardware design has been made open source for individual users and the schematics are available on the DCC-EX GitHub repository.</p> <p>For quantities of 10 or less per annum, you may utilise a PCB manufacturing and assembly service such as JLCPCB without licensing fees. A donation to DCC-EX would be appreciated, so click the donate button. The production files are available on the DCC-EX GitHub.</p> <p>Entrepreneurs wanting to use the design to offer commercial quantities to their local communities should contact Semify (service @ semify-eda.com) to arrange a bulk purchase or DCC-EX (support @ dcc-ex.com) for a license to manufacture. Licensing includes donating a royalty to DCC-EX per board sold.</p>"},{"location":"products/ex-motorshield8874/ex-motorshield8874/#assembly-with-ex-motorshield8874","title":"Assembly with EX-MotorShield8874","text":"<p>The shield stacks onto a CSB1 without modification. The CSB1 firmware must be configured with the EX-Installer to recognise the additional two tracks. </p> <p>For self-built command station, please consult the relevant build instructions.</p> <p>DO NOT connect power to BOTH the EX-MotorShield8874 barrel jack and the underlying Arduino motherboard via its DC barrel jack as you may damage your Arduino and/or EX-MotorShield8874.</p>"},{"location":"products/ex-motorshield8874/ex-motorshield8874/#engineering-notes","title":"Engineering notes","text":"<p>The EX-MotorShield8874 DC barrel jack is the only power source required to power both the tracks and the EX\u2011CommandStation into which it is plugged into. It supplies carefully regulated 7.2V DC power to the underlying Arduino R3 compatible motherboard via the VIN pin. This voltage is safely regulated down from the track power input to ensure Command Station motherboards will stay cool and work well. There is no need to power the Command Station via its barrel jack, or USB power. It is safe, however, to connect the USB cable as it will not create a conflict.</p> <p>Applying a voltage above what a decoder was designed for, may permanently damage it, because the EX-MotorShield8874 does not drop voltage like the standard L298 based motor shields take care over track voltage selection.</p> <p>NOTE: The EX-MotorShield8874 can supply up to 5A of track power per channel, a power supply of more than 10A peak capacity is required to run both channels at full peak current and have power left for the Command Station. A power supply that is unable to provide the current at which the software detects a short-circuit will not be safe as the Command Station will not be able to detect the short.</p> <p>If the track power supply is not plugged in, the Command Station will report track faults.</p>"},{"location":"products/ex-motorshield8874/ex-motorshield8874/#stacking-two-motor-shields","title":"Stacking two motor shields","text":"<p>Stacking an EX-8874 and another motor shield type is not recommended. There are complex pin conflicts and software configuration requirements.</p> <p>The CSB1 can only have a single EX8874 stacked on it, unmodified. There are insufficient pins available on the internal ESP32 processor to handle more.</p>"},{"location":"products/ex-motorshield8874/ex-motorshield8874/#steps-to-stack","title":"Steps to Stack","text":"<ul> <li>Leave the first EX-MotorShield8874 in the stack entirely unmodified. </li> </ul> <p>NOTE: If you are using an Ethernet shield, it must be the very first board in the stack, with the unmodified EX-MotorShield8874 next immediately on top of that. Test this first before proceeding to modifying the second EX-MotorShield8874 and adding it on.</p> <ul> <li>You must CUT the regulator to VIN pin on the top of the PCB which is not labelled on the original version, but has been labelled on later versions</li> </ul> <p></p> <ul> <li>Cut the \u201cRegulator Enable\u201d trace on the bottom of the board</li> </ul> <p></p> <ul> <li>Cut the jumper pads for both Driver A and Driver B, except for the Fault pins.</li> </ul> <p></p> <ul> <li>Solder bridge the right hand ALT pads but NOT the FAULT pins</li> </ul> <p></p> <p>The reason we did not solder the FAULT pins to their righthand ALT pads is that this would connect the FAULT pins to D0/D1 on the Arduino R3 headers which is not ideal because D0/D1 typically carry the serial port. You can of course bend those pins out if you wish to use them, and simply jumper them that way. Please refer to the self-build instructions for your processor type.</p> <p>Leaving the Fault pins on A4, A5 facilitates bending and jumpering them to nearby pins, such as A6, A7 on Arduino Mega PC2, PC3 on Nucleo-64</p> <p>After hardware installation, you will need to re-run the EX-Installer to configure the Command Station code to recognize the new board and allow you to control the third and fourth tracks.</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/","title":"EX-SensorCAM Abridged Manual","text":""},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#contents","title":"CONTENTS","text":"<ol> <li> <p>Overview</p> </li> <li> <p>ESP32-CAM</p> </li> <li> <p>Physical Installation</p> </li> <li> <p>Notation&amp; Help commands</p> </li> <li> <p>Configuration</p> </li> <li> <p>PROCESSING4 monitor/console</p> </li> <li> <p>Wiring Requirements</p> </li> <li> <p>Host Communication</p> </li> </ol>"},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#appendix","title":"Appendix","text":"<p>A. ESP32 sensorCAM Command Summary</p> <p>B. Check List for Optimising Sensor Resonse</p> <p>C. Parsed DCC EX-CS sensorCAM commands</p> <p>E. Tabulated DCC-EX-CS id's for sensorCAM</p> <p>F. Hardware Interface (PCA9515A &amp; Endpoints)</p> <p>H. Notes on use of EX-Rail with SensorCAM</p> <p>J. WROVER-CAM notes</p> <p>Addenda</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#1-overview","title":"1. Overview","text":"<p>The sensorCAM is a video camera replacement for physical proximity sensors/detectors on a model railroad. It can replace up to 80 detectors and their associated power and signal wiring using artificial vision alone. It offers the flexibility of sensor placement or relocation instantly by software command with no physical layout modification.The railroad can be automated using artificial vision of train activity. Each virtual sensor can produce a logical state of 1 (occupied) or 0 (unoccupied) and is readable over an i2c cable. SensorCAM originally used the ESP32-CAM module. However, the ESP32-WROVER-DEV CAM (v1.6) is the preferred substitute with potentially simpler setup.</p> <p>The sensorCAM takes 10 frames per second in RGB565 format at QVGA resolution of 240 x 320. Each sensor consists of a square group of 16 pixels which equates to approximately 20x20mm square with the standard lens at 1500mm. The software decodes and saves only the 80 sensor images (1280 pixels) and then compares each sensor image with a reference image prerecorded either at startup, on request, or by a \"recent\" automatic update. If the images do not match the references well, then the sensor is \"tripped\" or \"occupied\" &amp; status '1' is registered. A good match results in '0' output. The state of virtual sensors can be manually monitored on the USB monitor, or polled by microcontroller over the i2c interface cable. Note: The sensorCAM is sensing only when the Flash LED is pulsing at 10Hz (for each new frame).</p> <p></p> <p>2PCS ESP32-CAM-MB, ESP32-CAM Board, Micro USB to Serial Port CH-340G with OV2640 2MP Camera Module 4MB PSRAM</p> <p></p> <p>Note: While the full manual primarily talks about the ESP32-CAM-MB, the focus here is the alternative in the newer ESP32 WROVER-CAM single board option. For some further preliminary details refer to Section 7 Wiring, Figure 6.  The software is identical for both CAMs.</p> <p>Dealing with video images involves complexities not normally associated with model railroading sensors. The sensorCAM is a complex device with a number of commands explicitly for setup and evaluation. In addition to these, several \"output\" commands can be used by a host to interrogate the \"virtual sensor\" output states. The initial setup can be somewhat involved and requires familiarity with many of the 25 commands discussed below.</p> <p>The sensorCAM has two mutually exclusive modes of operation; the sensorCAM mode and the webCAM mode. The webCAM mode is essentially as described in the on-line tutorials. Use that mode only for education and alignment. Invoke webCAM video mode by issuing the v1 (or v2) sensorCAM command to get a webCAM URL (e.g.192.168.0.64)</p> <p>The WROVER-CAM has USB integrated.  The WROVER or MB is far simpler to use than a separate FTDI used in the videos.</p> <p>The ESPRESSIF guide will show how to install the Arduino-ESP32 support.</p> <p>Installing Arduino-ESP32 2.0.6 documentation (readthedocs-hosted.com)</p> <p>A tutorial on setting up the ESP32 on Arduino IDE is available on YouTube  </p> <p>ESP32 CAM-10 Dollar Camera for IoT Projects</p> <p>Introduction to ESP32- Getting Started</p> <p>The sensorCAM software is uploaded to the ESP32-CAM using the Arduino IDE. The sensorCAM has been programmed with two modes of operation; a webCAM mode (as in the on-line tutorial) and a sensorCAM mode. The limited power of an ESP32 prevents both functioning at the same time. Consequently, to see an image of the railway while sensorCAM is operational requires a third application (Processing 4.3) to retrieve a still image from the CAM over the USB cable to a computer. The Processing 4 sensorCAM.pde app replaces the Arduino IDE and IDE monitor retaining the sensorCAM command set and offering a (slow) image capture capability over USB cable. Processing 4 allows virtual sensors to be placed interactively on an image of the railway with a simple mouse click.</p> <p>In addition to the USB interface, you may need a daughter board, \"perf\" board or prototyping board to connect to the real world (power, indicators, control wires, and i2c.) Further details are given below. However to test the sensorCAM functions, one only needs the CAM and a USB interface, with power from the PC's USB port.  The Wrover Cam minimises this need.</p> <p>To control a railway, the railway needs a microcontroller based management system. This typically could be an Arduino Mega (or CSB1) based system running software such as the DCC-EX CommandStation and EX-RAIL automation application. The EX Command Station(CS) includes a sensorCAM specific driver as detailed later.</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#2-esp32wrover-cam","title":"2. ESP32/WROVER-CAM","text":"<p>The heart of the sensorCAM is the ESP32 CAM module with an ov2640 camera sensor and a 32bit ESP32-S microprocessor. The sensorCAM software/sketch is loaded into the ESP32 using the Arduino IDE over a USB port with settings newline/115200 baud. Follow the above guidelines and run the camera example first, to get a demo webserver and CAM operational with a simple coloured test image. Experiment with settings to \"get a feel\" for the parameter effects. The CAM has a considerable number of video related on-screen settings. The standard ov2640 can see some Infra Red light which may be utilised to see a bright IR LED as a beam-break sensor.</p> <p></p> <p>Figure 1. \u00a0 webCAM mode</p> <p>Figure 1. is an example of the standard webCAM browser presentation. It is a very useful mode for alignment and as a training aid in investigating the effects of the many video adjustments possible, but does not allow placement of sensors as sensorCAM mode can't be simultaneously enabled.</p> <p>The sensorCAM uses QVGA but VGA is better in webCAM mode. These settings can be changed after the CAM images are stable, but the default values should be adequate.</p> <p>If you \u201cStart Stream\u201d, parameter changes will seem almost immediate. But with \u201cstills\u201d, after changing a variable, you may have to click \"Get Still\" 3 times to clear the pipeline and get a changed image. In Stream mode, close observation will reveal changing whole image brightness/colour for several seconds after image disturbance (e.g. a hand in front of CAM) as the auto adjustments \u201ccorrect\u201d the image. These types of changes can trip the sensorCAM even if the obstruction does not block the virtual sensor. Consequently after power-up, the sensorCAM may stabilize and then turn off some auto adjustments in the first 15 seconds. Changing environment lighting may result in a need to use a \"re-reference\" command, for example perhaps after sunset or turning on extra lighting.</p> <p>Due to the slowness of the ESP32 &amp; wifi, the \"live stream\" is slow and a webCAM delay in response will be observed.  The delay is inevitable in webCAM WiFi mode.</p> <p></p> <p>Figure 2 \u00a0 Initiall sensorCAM settings</p> <p>After the sensorCAM has booted up, it reads frames for 9 seconds before automatically doing a reference grab for all defined sensors (the r00 command). </p> <p>The ESP32-CAM has an Infra-Red(IR) filter to enhance colour response. The sensorCAM relies on strong colour contrast(saturation) to detect changes. Low lighting levels and poor contrast degrades performance.  Some IR penetrates, so the CAM may use an IR LED for reliable beam-break sensing.</p> <p>To run the sensorCAM.ino, it will be necessary to configure the Arduino IDE for the ESP32 as covered in the above you-tube tutorial links. Load and run the demonstration. For the sensorCAM, you will require new files as described in the sensorCAM installation Guide. </p> <p>The ESP32-CAM can take rgb565 frames at 13/second. However it is a 3 step process; image sensing, processing and storing. It will then take further cycles to assess the state of the 80 virtual sensors in the frame(another two cycles) A total of 5 cycles places a significant limit on the sensorCAM speed of response time (up to 0.5 seconds at 10 frames/second). A fast HO loco can travel 160mm @ 100kph, so this latency might need to be accommodated in planning virtual sensor locations.</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#3-physical-installation","title":"3. Physical Installation","text":"<p>For testing purposes you will need a computer with a spare USB port and the Arduino IDE software installed. The PROCESSING 4 software is also advisable as it gives a more reliable and convenient image for setup. A long powered USB cable (5m?) may be an advantage as the sensorCAM may be some distance from the PC. For a final installation the sensorCAM would be connected via a cat5/6 cable carrying power and a differential i2c bus (of up to 30m) to a Command Station or similar. Some different practical wiring solutions are explored in Appendix F.</p> <p>For a test hookup between a USB powered sensorCAM and a Command Station(mega) with a short existing i2c bus, provided the total length is under say 3 meters, a simple, cheap arrangement could be tried using a PCA9515A as both buffer and level shifter if needed. The CAM on i2c bus is best used theoretically with the USB computer running on battery power alone (unplugged) to absolutely avoid ground loops and associated electrical noise, but will probably function OK anyway.</p> <p></p> <p>Figure 3 \u00a0 CAM with 3.3 to 5V i2c interface and optional LTC4311 \u201cterminator\u201d for greater reach</p> <p>The sensorCAM is preferably placed above and square-on to a section of layout at a height of 1 to 1.8m above the surface. 1.2m gives a max. coverage of approximately 1.2x0.9m with the standard lens. Tilting the CAM by up to 30 degrees can increase the layout coverage by up to 50%.  </p> <p>Lighting is critical for reliable operation. The lighting should be steady. Both LED flood and Fluorescent lighting might degrade results due to the flickering levels of illumination at 100/120 Hz. Use quality LED lights. The light fittings should not be visible in the camera's field of view. A uniform level of lighting is the objective, with a minimum influence from fluctuating daylight, fans or direct sun and cloud shadows through windows. Some experimentation may be needed to avoid local \u201cglare\u201d.  Bright lighting is desirable (good quality LEDS) to enhance colour differentiation. Check your lighting for flicker by taking a \u201cslo-mo\u201d test video on a cell phone. Fluoro's are bad!</p> <p>The CAM mount needs to be rigid to avoid vibration which may trip sensors due to small image movements. It also needs to have a suitable route for a (cat5) cable for its own power supply and the necessary i2c communications. The length of this cable needs to be considered if the railway's i2c network is otherwise long. The quick connection above (using PCA9515A) is for short lengths only (i2c under 3m). Up to 7m may be achieved using 2k pull-up resistance and one LTC4311 \u201cterminator\u201d to enhance signal rise time.  The recommended alternative for longer cables is the Sparkfun differential Endpoint system.  Power should be regulated near the remote sensorCAM if not using a short USB cable.</p> <p>Most reliable results may be obtained with light grey coloured ballast and darker sleepers. If results are inadequate, light green (grass?) or yellow \"reflectors\" between the rails may relieve any problem (recommended in fiddle yards). If lighting throws shadows beside targeted rolling stock, the shadows may be used advantageously by good sensor placement.</p> <p>For initial configuration, access to the sensorCAM's USB port is important. Loading computer code over a long USB cable is problematic, but monitoring and tweaking settings may be done with a reduced BAUD rate or a (5m?) buffered USB cable at 115200 BAUD.</p> <p>With regards lighting, fluoroescent or LED lighting normally flickers at twice mains frequency so it pulses at 100 or 120Hz. Tolerable to humans, but it can be seen in a sensorCAM image on a uniformly white test panel as below (Figure 5). In 100mSec there could be up to 10 bands in one image.  the faint bands will drift across the sensors and potentially trip them in the worst case scenario. Set the threshold high enough to avoid such trips or (better) change lighting. Figure 4 shows an example of bad 100Hz banding.</p> <p></p> <p>Figure 4 \u00a0 Test image showing fluorescent or LED light banding</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#4-notation","title":"4. Notation","text":"<p>The notation used in all sensorCAM reference material uses symbols according to the following convention:</p> <p>%\u00a0 \u00a0 \u00a0 used to designate a digit as part of a bank/sensor designator in bsNo style. i.e. 0/2, b/s or %/% or %% # \u00a0 \u00a0 \u00a0 used to designate a digit as part of a decimal number as in ### for a 3 digit decimal number. $ \u00a0 \u00a0 \u00a0 used to designate a single alphanumeric character(0-9 or A-Z) depending on context. S \u00a0 \u00a0 \u00a0 Capital S may be used to refer to a specific sensor such as S02 for example. Designation format: S%% [ ] \u00a0 \u00a0\u00a0 Square brackets may be used to indicate optional command arguments(don't include[ ] in command).</p> <p>Sensor \"bsNo.\" number consists of two digits preferably written separated by a '/' as in 1/2 but in commands this is reduced to 12 as in command i12. Command 'i' has the form i%% indicating it requires a 2-digit bsNo. As 49 is an invalid bsNo.(s range is 0-7), i49 is invalid. Some commands require a DECIMAL number and are expressed as having form t## for example. t49 is therefore a valid command. The 'm' command takes the form m$,## requiring a single digit and a 2-digit decimal number. For more details on commands see APPENDIX A.</p> <p>Where bsNo.'s are printed, they can take several equivalent forms depending on context. Where possible they are printed as %/% e.g. 2/3. However an equivalent form is 023. Any printed sensor number starting with a '0' can be treated as equivalent to the '/' form so 023 == 2/3 == bank 2 sensor 3. The 0%% form is in fact the \"OCTAL\" format of bsNo. (Note: 087 and 097 are invalid. Keeping usage to banks ranging from 0 to 7 avoids any confusion).</p> <p>Some diagnostic output (e.g. f%%) may resort to another numbering system  (i.e.HEXADECIMAL) for compactness, but for normal usage this notation can generally be avoided. Just be aware of the context in which numbers are being used.</p> <p>Where words are in italics, these are the actual names used in the C++ programs for sensorCAM. Consequently they may seem cryptic, but their function is hopefully clear. </p>"},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#5-configuration","title":"5. Configuration","text":""},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#51-plan-a-grand-sensor-numbering-strategy","title":"5.1 Plan a grand sensor numbering strategy","text":"<p>The first step is to decide a sensor distribution strategy &amp; numbering strategy (not set in stone) . A sensorCAM has 10 banks (0-9) of eight (0-7) individual sensors available (total 80). Each bank can be tested as a whole to see if ANY sensors tripped or NO sensors tripped. Also placing a string of sensors in a row, for example along a platform, can indicate train position with the binary bank value increasing as the train approaches a signal as it crosses sensors 0 through 7. (see Figure 5 for examples) Sensors are generally referred to with a two digit bank/sensor designation (their bsNo.) e.g. Sensor 68 and 69 are therefore invalid bs numbers, 97 is valid. Use one bank for a platform (set of 8 sensors). Sensor S00 is reserved as a brightness reference sensor. Sensor S06 is also RESERVED for now. It is suggested that user's Sensors start with bank 1, i.e. S10, S11 &amp; upwards, with related sensors in their own bank. They do NOT need to be sequential (Follow the installation Guide for full details). With the recommended definitions set up, the user does not need to remember or refer to vPins for sensorCAM sensors at all - just use the S%% identifier.</p> <p>For an EX-Command Station (CS), the 80 sensors will have vPin numbers ranging from #00 to #79 (DECIMAL) and mapped to 80 b/s id's(S00 to S97). Users can use, for example, AT(CAM 0%%) in EXRAIL commands where a vPin ID is called for.  For the technically minded, CS invisibly calculates vPin=BasePin+bx8+s. </p>"},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#52-preset-the-wifi-ssid-and-password","title":"5.2 Preset the wifi SSID and password","text":"<p>Before uploading the software into CAM, check that it has the appropriate WiFi definitions for your railway WIFI_SSID &amp; WIFI_PWD, and perhaps for your test area ALTWIFI_SSID &amp; ALTWIFI_PWD are in your configCAM.h file.</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#53-adjust-other-configcamh-settings","title":"5.3  Adjust other configCAM.h settings","text":"<p>\u00a0 \u00a0 a) If i2c address 0x11 is in use, change to 0x12 (or 0x13) i.e. I2C_DEV_ADDR 0x11 in your configCAM.h  \u00a0 \u00a0 b) If you want to use \u201clarger\u201d sensors, Place #define SEN_SIZE 2 (0-7) in your configCAM.h (ver319+)  </p>"},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#54-load-sensorcam-software","title":"5.4 Load sensorCAM software","text":"<p>Follow you-tube to pre-configure the Arduino IDE for ESP32.  Using this IDE, load the software into sensorCAM with it unmounted. Then mount the CAM in a suitable place for tests. A long USB cable is problematical.</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#55-establish-a-monitor-screen-to-sensorcam","title":"5.5 Establish a monitor screen to sensorCAM","text":"<p>Establish a USB connected monitor (e.g. Arduino IDE monitor, or PROCESSING4 monitor, preferably at 115200 baud. The PROCESSING 4 monitor coded for the sensorCAM has the advantage of displaying the CAM's railroad image (or selected part thereof), albeit rather slowly!). Because of the many changeable CAM parameters, the WiFi link (webCAM) is not a reliable indicator of the sensorCAM image quality. It may be better or worse. The PC (using Arduino IDE) is only able to show images via WiFi, but because the sensorCAM runs on RGB565 format it cannot send WiFi (jpeg) images without rebooting into WiFi/jpg webCAM mode (under which it cannot read sensors!). The reboot/display/reboot cycle for WiFi webCAM is also tediously time consuming.</p> <p>The sensorCAM takes some time to boot and establish sensing mode. The flash LED starts flashing on every frame after about 10 seconds and data flows to the USB terminal. A period of averaging ensues with \u201cgood\u201d sensing by about 30 seconds. This flow of data (and sensing) can be suspended with the \u2018w\u2019 (wait) monitor command. Some commands (including a blank line entry) will subsequently restart the sensing camera and sensor output. The CAM may crash if it is left waiting for input for over 30 minutes. Reference images would also be long out of date. Note: t1 toggles output srolling data ON/OFF without suspending either flashing or sensing.</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#56-verify-wifi-webcam-operation","title":"5.6 Verify wifi webCAM operation","text":"<p>The CAM can be switched to webCAM WiFi video mode with the 'v1' command. 'v2' can select your alternate WiFi network. ('v' will give sensorCAM software version). 'v1' (or 'v2') will reboot and load webCAM mode connecting to the network selected, and providing a URL e.g. http://192.168.0.xx that can be used to connect with a browser. An image, like Figure 1 above, should be seen with controls for experimenting with Brightness etc. This image is educational and useful for camera alignment, but not necessarily a good indication of the sensorCAM (sensor mode) image because of the unpredictable parameter effects. To see a more reliable image, run the PROCESSING 4 SensorCAM.pde monitor instead of Arduino webCAM example (refer Section 6.). To exit video mode, try the monitor command 'R' (or 'F'). If this software reset fails, try manually rebooting the sensorCAM (power OFF/ON or via the on-board RST push-button using a non-metallic tool!).</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#57-familiarise-with-sensorcam-command-set","title":"5.7 Familiarise with sensorCAM command set.","text":"<p>Review the sections below (5.8 etc.), before mounting the camera over the railroad, as it is advisable to be familiar with the sensorCAM command set. The setup commands will have to be repeated accurately once the CAM is mounted in its final location (Step 5. Installation Guide).</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#58-sensor-placement","title":"5.8 Sensor placement","text":"<p>Setting up the CAM first requires locating sensors. When deciding on sensor location, be aware that the sensor response is slow compared to conventional sensors. Allowing for 500mSec delay, which at 100kph equates to 150mm of travel (in HO), may influence sensor placement. Best performance is obtained if the sensors are not within 20 rows/columns of an image edge. Remember to save to EPROM with the \u2018e\u2019 command once satisfied. Virtual sensor location can be set up in several ways. Option d. is preferred.</p> <p>a. \u00a0 Automatic loading from EPROM on bootup. This is only applicable after an initial sensor set has been established and command 'e' used to save them to EPROM.</p> <p>b. \u00a0 The bright LED method: Place a bright LED at the required location and reduce room lighting if needed.  Issue an 's%%' command (e.g. S00 for an off-track reference sensor) and wait for the CAM to scan and locate the LED and setup sensor coordinates. Remove the LED, restore lighting, and perform an \u2018r%%\u2019 for new reference images.</p> <p>c. \u00a0 Issue a \u2018k%%,rrr,xxx\u2019 command to place sensor %% at CAM pixel position rrr(row) and xxx(column). This method is most useful for \"tweaking\" coordinates if you want to adjust the result of the LED method. The CAM has 240 rows/lines of 320 pixels each, numbered from 0. Use the \u2018i%%\u2019 command for info. on sensor S%%. NOTE: Use \u2018k' to set up test sensors initially, but delay setting final positions until Processing 4 installed and enhanced GUI \u2018k\u2019 and \u2018a\u2019 available. The \u2018a\u2019 command does 3 commands in one (i.e. k, a(enable) &amp; r).</p> <p>d. \u00a0 Running Processing 4, an image can be downloaded, a bsNo. nominated by typing k%% (or a%%) and the mouse click on the image appends coordinates to k%%. Press Enter if the command is complete and correct. Similarly, the long version of 'a%%' sets position, enables, and records a reference all in one command.</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#59-sensor-status-and-save","title":"5.9 Sensor status and save","text":"<p>Once a sensor has been located, the 'p$' command can show/tabulate all defined positions up to bank$. To enable a sensor use the 'a%%' command. This will enable AND record a new reference image for the sensor. It will then be included in the screen \u201cdata dump\u201d. Only \u201cenable\u201d sensors when UN-occupied, or do an r%% later when the sensor is empty. Also, remember to do an 'e' command when you want to save positions in EPROM for next time.</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#510-set-a-sensor-threshold","title":"5.10 Set a Sensor Threshold","text":"<p>A threshold needs to be set to define the level of difference in image required to register a sensor trip or \u201cOccupation\u201d. This typically ranges from 40 to 60. Try \u2018t45\u2019 for starters. Some fluctuating lighting and electrical \u201cnoise\u201d needs to be tolerated, but a higher threshold reduces sensor sensitivity for dark-on-dark contrast in particular. If there are \u201cnoise\u201d trips, adjust the threshold or min2trip a little higher. See APPENDIX B for more.  </p>"},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#511-limit-printout-to-manageable-range","title":"5.11 Limit printout to manageable range","text":"<p>It is desirable to set (using 'm') a maxSensors parameter (e.g. 030) to limit diagnostic printouts to a manageable screen width, and especially important to set the min2flip parameter which helps filter out noise trips. However min2flip slows the response to valid trips by 100mSec (frame rate) per extra count. Suggest settings of 2(default) or 3. e.g.'m3,30'. Note: maxSensors (pulled from EPROM) limits the following....</p> <p>a. the data stream for console/monitor, limited to enabled sensors below maxSensors (and above minSensors)</p> <p>b. histogram printout, to enabled sensors below maxSensors (see statistics command \u2018&amp;\u2019)</p> <p>c. the boxlt() sensor boxes seen on Processing 4 images, to enabled sensors below maxSensors</p> <p>d. i2c buffer data for 't' record, to bsn's below maxSensors (and above minSensors)(sent to Command Station) The cmd 't' acts as a flag to prepare a packet of i2c data that the CS can reconstitute as per the USB ASCII data stream/scroll.</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#512-led-bank-trip-indicator-eprom","title":"5.12 LED bank trip indicator &amp; EPROM","text":"<p>If you want a LED bank occupancy indicator on the CAM, use the 'n$' command to cause a bank occupied LED to show (default Bank 2). nLED, min2flip, maxSensors and threshold can be saved to EPROM, along with sensor positions and twins (see 5.15 below) with the 'e' command. minSensors (n10,%%) is not currently saved in EPROM.  You will of course have to add a resistor and LED to the physical CAM (GPIO14 or GPIO32).</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#513-sensor-reference-image-refreshing","title":"5.13 Sensor reference image refreshing","text":"<p>Although sensor enabling (a) causes an immediate reference capture, it may be necessary to occasionally do a fresh reference capture for all sensors (make sure they are unoccupied!) by using the 'r00' command. Individual sensor references can be refreshed using 'r%%'. The results of a refresh can be seen in the scrolling \"data dumps\" of enabled sensors, their \"difference scores\" (32-99), and their perceived occupancy state. The sensor *S00** is constantly averaged and refreshed every 6.4 seconds. Furthermore, there is an automatic refresh process that cycles through enabled sensors and regularly averages 32 consecutive sample images. If the sensor remains unoccupied, it updates the reference, compensating for slowly drifting lighting changes. </p>"},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#514-scrolling-data-interpretation","title":"5.14 Scrolling data interpretation","text":"<p>The scrolling data dump displays \"SUS\" (suspend) if auto updates are off. It also displays threshold(T), min2trip(M), the bank assigned to the on-board nLED(N), S00 reference diff. score, as well as the S00 reference brightness(R) and its current actual brightness(A), a brightness scale factor(B) and other enabled sensors. 'A' is the Actual latest sum of the 48 bytes of a sensor image (max 3024) and should be between 1200 and 2500 ideally. Following a reference refresh (r), for an unoccupied image, the (noisy) diff. scores should be 32-37. If references are being updated, a note will appear at the right hand side of the data dump in the form of \"Ref 0%%\" to indicate that a new reference for an UNOCCUPIED sensor has occurred. This dump allows for performance monitoring during commissioning. :oo46## indicates tripped sensor (## = occupied) sensor are shown by default with a central diff score (32-99). :?-46-? indicate an above threshold image potentially occupied** (waiting for min2trip). :oo47?T indicates suspected occupied but no confirmation from Twin (see 5.15).</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#6-processing4-monitorconsole","title":"6 PROCESSING4 monitor/console","text":"<p>Figure 5 \u00a0 Processing 4 Console and image window  \u00a0 Note: Sub-optimum 'c' settings caused green tint.</p> <p>The Processing application displays the image using sensorCAM settings, and also shows colour coded sensors. As previously stated, the PROCESSING4 application is a crude USB monitor that enables the user to control and configure the sensorCAM with the additional benefit of being able to invoke a display of the image. All the sensorCAM commands can be used. At 115200 baud, a full RGB565 image takes 13 seconds, but it is often convenient to reduce this by prescribing a smaller image segment of limited rows and/or columns (e.g. Y120 for lower half of a 240 row screen). The Processing 4 application can be downloaded from here</p> <p>The SensorCAM.pde code assumes the USB port for the sensorCAM is the lowest (comNo=0;) on the list displayed on startup. Should this not be the case, for example if another USB is being used to simultaneously run an IDE to a Command Station, then the int\u00a0comNo=0; code line (line 15?) of the sensorCAM.pde will need to be increased to, for example, int\u00a0comNo=1; You may also increase the image display window size factor by editing the next final\u00a0\u00a0int\u00a0\u00a0SF=2; line to =3; or =4; on high res. screens.</p> <p>The sensorCAM Processing 4 monitor accepts commands W, X, Y &amp; Z which allow one to nominate a \"strip\" or subsection to image. e.g. Z80 X240 Y will update the last quarter image(columns 240-319) of the 240x320 pixels in 4 seconds. This quicker shortcut method enables, for example, comparison of quarter images under different lighting conditions by using different X values. Similarly W60 Y120  will produce a quarter image from row 120 to 179. Each part image is pasted over previous images. Each new image appears more quickly if only a subsection is specified this way. The next image can be flipped Vertically(y) and Horizontally(x) by using V &amp;/or H before capture. The Figure 5 image used  V H Y60  The values for V, H, W, X &amp; Z are remembered for subsequent 'Yrrr' commands so need not be repeated. NOTE: Do not flip image before creating new sensors as cursor coordinates don't flip!</p> <p>The image will have enabled sensors (b/s) boxed and identified by a (resistor) colour code. Left bar is bank# and right bar is sensor#. Combined, they give the Sensor's bsNo (S%%). If two sensors have the same coordinates, the colour code will be for the highest bsNo. Note: Only sensors below maxSensors will appear boxed. N.B. the \u2018H\u2019 command will REVERSE the coding from b/s to s/b. (The resistor colour code is 0:black 1=brown 2=red 3=orange 4=yellow 5=green 6=blue 7=violet 8=grey 9=white)</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#processing4-command-summary","title":"PROCESSING4 command summary:","text":"<p>W### \u00a0 will limit the image to### rows wide/high(1-240) (default 240)</p> <p>X### \u00a0 will start the image from column ###(0-319) (default 0) -uses the sensorCAM 'x' command.</p> <p>Y### \u00a0 will initiate an image download starting at row ### (0-239) (default 0) -uses the sensorCAM 'y' cmd.</p> <p>Z### \u00a0 will limit the image to ### columns (1-320) (default 320) -uses the sensorCAM 'z' command.</p> <p>H \u00a0 will flip/mirror subsequent images horizontally. Note: reverses bsNo sensor colour code to sb!</p> <p>V \u00a0 will flip/mirror subsequent images vertically. (V + H effectively rotates image 180 degrees)</p> <p>R \u00a0 will cause a firmware reset of the sensorCAM via the DTR line via. the USB interface. CAM will enter a wait mode for confirmation.  Reset can be aborted with command 'aw'(Abort&amp;Wait). Ctrl-R Resets CAM instantly.</p> <p>NOTE</p> <ol> <li> <p>The above commands ARE CASE SENSITIVE. They are recognized by Processing 4 as non-sensorCAM commands and processed in the monitor/PC. Commands X, Y &amp; Z in turn automatically issue related sensorCAM commands x, y &amp; z respectively, with appropriate parameters.  The 'Y' command suspends sensorCAM imaging, holding a single \u201cfrozen\u201d frame until a terminating command ('yy') is received. </p> </li> <li> <p>If you use H to mirror, the colour coding for boxed sensor number (bsNo.) has to be read right to left.  Do NOT click on image to create sensors if image has been flipped.</p> </li> <li> <p>Ctrl-E and Ctrl-N enable/disable echo of commands as typed, to the monitor/log file. It can replace the user's focus on the CAM image Cmd: window. YO should toggle the verbose mode. The command Y images from row 0 by default.</p> </li> </ol>"},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#7-wiring-requirements","title":"7 Wiring Requirements","text":"<p>Refer to Figure 6 and Appendix F for alternate solutions for connecting sensorCAM to an i2c bus for remote control. For initial testing from a PC, the basic ESP32-CAM-MB or Wrover-CAM (CH340 based USB interface) could be sufficient via. USB.  With i2c, take care to use level shifting (PCA9515A or Endpoints) if using a 5V Mega CS. </p> <p>The recommended hardware interface to a CS is currently the Sparkfun Endpoint system (Figure 6. &amp; APPENDIX\u00a0F) which permits the i2c bus to be run over long standard Cat5 twisted pair cable.  It can also carry the required raw power supply. The Sparkfun Endpoints are used in pairs and can cater for voltage shifting between 5V Command Stations  (e.g. Mega) and 3.3V sensorCAM as required. For the very simplest off-the-shelf arrangement, an ESP32-WROVER-DEV CAM with a cheap ESP32 breakout board (including regulator) can be linked to an Endpoint with 4 Dupont wires for a working CAM system on the end of a cat5 cable of considerable length as indicated in Figure 6 &amp; APPENDIX\u00a0F, needing only a remote, preferably electrically isolated(floating), 7-10Vdc 0.5A power supply and a matching endpoint on a Command Station.  For a cheaper solution, use the PCA9515A with dupont jumpers for a limited (2m?) reach with either esp32-CAM or Wrover-CAM powered via USB. Note: The Sparkfun Endpoint may also need a jumper cut or joined for i2c bus voltage level matching to the Command Station.  </p> <p>The ESP32-WROVER-DEV board is a good alternative to the original ESP32-CAM-MB. The slightly bigger CAM will be a little more convenient with the ESP32S Expansion board. This 38 pin expansion board with 5V regulator is poorly described in the video below. IGNORE PRESENTERS DESCRIPTION OF HIS FAULTY 5V REGULATOR past the 5minute mark.  With NO Wrover, verify the regulator gives 5V from 9V at the barrel jack and remove power before inserting or removing the Wrover.  For want of a better video...</p> <p>ESP32S 38P/V4/ Expansion board</p> <p>The SensorCAM software has been almost exclusively tested on the ESP32-CAM-MB as seen in Figure 7. The original prototype was fitted with some enhancements that may not be needed for the user's application.  However, at least one \u201csuper bright\u201d LED (the \"programmable nLED\") is recommended for convenience to visually indicate when a sensor is \u201ctripped\u201d, connected between 3.3V via a resistor (~470R) to GPIO14.</p> <p>The ESP32-CAM reset button, remotely mounted on CAM, may be difficult to access. To reset the device, two options need to be available. These can be via software command, either from the attached USB monitor, or i2c connected Command Station, or via a power supply induced reboot. A switch at the (\u201cwall-wart\u201d) 9V supply is recommended independent of the CS supply. The USB connection is needed to set up the sensors initially and view images, but should be able to be disconnected once setup testing is complete.  Some esp32's may need a 1uF or 2.2uF on the reset pin for reliable reset.</p> <p>Note: Care is needed as the WROVER CAM has 40 pins (not 38) but the spare end Gnd and Vcc can remain disconnected (cut off?).</p> <p></p> <p>Figure 6 \u00a0 ESP32 WROVER-CAM and interface</p> <p></p> <p>Figure 7 \u00a0 PCA9515A 3.3V to 5V i2c interface improvisation compared to a full feature prototype solution  \u00a0 Note: for 3.3V microprocessors (e.g. CSB1) ensure Vcc1 is connected to 3.3V (Vcc0) not 5V.</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#8-host-communication","title":"8 Host Communication","text":""},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#81-introduction","title":"8.1 Introduction","text":"<p>The operation of the railway depends on a Control Station that polls the sensorCAM for sensor states. This might be a dedicated Arduino Mega 2560 for example. It might be a CSB1 Command Station running DCC-EX and EXRAIL software. If the sensorCAM is powered up with default settings (from EPROM), or adjusted by the user at the start, the program need only talk to sensorCAM over an i2c bus using the commands a,b,i,l &amp; o for example, or it may be more sophisticated, providing a command channel from a Control Station monitor to the sensorCAM to enable most configuration commands via the i2c bus.</p> <p>The i2c bus is running at 100kHz on the prototype software. It has not been tested at any higher speed yet. It has been running fine over a 10m long i2c bus to the master microcontroller (CSB1, Mega or others).</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#82-dcc-ex-command-station","title":"8.2   DCC-EX Command Station","text":"<p>Setting up a DCC-EX Command Station, should you have one, requires configuration details placed in files config.h and mySetup.h along with a driver IO_EXSensorCAM.h and myAutomation.h. These must go in the directory containing file CommandStation-EX.ino. Refer to APPENDIX H for installation details.  EXSensorCAM.h code mirrors the sensorCAM command set with a few exceptions.  Imaging and graphic placement is not available.  Functionality was added using the DCC-EX sensorCAM native command &lt;N&gt; format. </p>"},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#84-monitor-lighting","title":"8.4 Monitor Lighting","text":"<p>Stable good lighting is needed.  Gross Lighting changes will have two effects, namely cause trips of most sensors and stop automatic reference refreshes, it may be wise to include monitoring for this eventuality by detecting and setting an \u201calarm\u201d state. The reference sensor (S00) is automatically re-referenced every 6.4 seconds so will indicate a fault-trip for a maximum of 6.4 seconds. All other sensors will continue to indicate a trip until the user resets the references with an r00 (having checked all unoccupied). See full manual for creating a fault LED indicator.  PLED uses GPIO14 and QLED uses GPIO32 (Wrover).</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#appendix-a","title":"APPENDIX A","text":""},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#esp32-sensorcam-command-summary","title":"ESP32 sensorCAM Command Summary","text":"<p>rev 1DEC25</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#introduction","title":"Introduction","text":"<p>Up to 10 banks (0-9) of sensors. Each bank can have up to 8 enabled sensors (0-7). Bank/sensor (%%) up to '97'.  Array Sensor[n] holds coordinates(rx) of sensor n.  Sensors are grouped into banks(b) of sensors(s). e.g. bsNo 6/7 identifies bank 6, sensor 7 (n=8x6+7=55=067). Sensors are undefined if coordinates(rx) are set to 00. They are disabled if SensorActive[n] is set to false. If a sensor detects differences, then any output LED (e.g. pLED qLED) assigned to the associated Bank of sensors should turn ON. On reset (power-up), reference grabs are taken for all defined (in EEPROM) sensors, and then enables them. To define a sensor, use 'a' command,  Processing4, or (outdated method) a bright LED on the desired spot and dim lighting with a \"scan\" (s%%). Save in EEPROM (e). SensorCAM uses RGB565 image format which is incompatible with JPG, so auto reboots between SensorCAM or webCAM modes occurs.</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#serial-command-usb-format","title":"Serial Command USB format","text":"<p>a%%[, rr, xx] enAble Sensor[%%] &amp; refresh Sensor_ref[%%], cRatios etc. 4x4 from image in latest frame. (Note 20.)</p> <p>b#[,$] Bank # sensors. Show which sensors OCCUPIED(in bits 7-0).(1=occ.)(b#,$ sets brightSF to $)</p> <p>c$$$$ reCalibrate camera CCD occasionally and grab new references for all enabled sensors(Beware of doing this while any sensors are occupied) N.B. Obstructed sensors will later need an r%%. Check all bank LEDs are off AND check all sensors are unoccupied before recalibrate. Can set AWB AEC AGC CB through $$$$ e.g. c0110 Also able to change default setting for Brightness, Contrast &amp; Saturation with extra digits e.g. c$$$$012</p> <p>d%%[#] *Difference score in colour&amp; brightness between Ref &amp; actual image. Show # grabs.</p> <p>e EPROM save of any new Sensor offset positions, pvtThresholds, new twins and 5 default parameter settings.</p> <p>f%% *Frame buffer sample display. Print latest bytes in Sensor_ref[%%] &amp; Sensor S%% positions.</p> <p>g *Get Camera Status. Displays most current settings available in webcam window (both sensor &amp; video mode).</p> <p>h$[,#] *Help(debug) output.  h9  to turn all OFF,  h0  turn ON detailed USB output. 'h7,#' \"Waits\" scroll on a bank# trip.</p> <p>i%%[,$$] Info. on S%%.  Status(enabled/occupied), position(r,x), any twin(S$$), pvtThreshold &amp; brightness.</p> <p>j$# *adJust camera setting $ to value # and display most settings (as for 'g'). 'j' alone lists options for $#.</p> <p>k%%,rrr,xxx *set coordinates of Sensor S$$ to row: rrr &amp; column: xxx. Follow with  r%%. Verify values with p$. </p> <p>l%% \u00a0 \u00a0 \u00a0 (Lima) Latch sensor S%% to on(1 = occupied(LED lit) &amp; also set SensorActive[%%] false to disable sensing.</p> <p>m$[,%%] *Minimum $(1-4) sequential frames over Threshold to trigger/trip sensor. Shows list of parameters. (Note 14)</p> <p>n#[,%%] nLED bank Number assigned to the programmable status nLED. Optional  n10,%%  to set minSensors.</p> <p>o%% \u00a0 \u00a0 \u00a0 (Oscar) force Off sensor%% (0=UN-occupied, LED off) Also set SensorActive[##] false to disable updating.</p> <p>p$ *Position Pointer table info for banks 0 to $ giving DEFINED sensor r/ x) positions.  p%% shorter.</p> <p>q$ *Query bank$, to show which sensors ENABLED(in bits 7-0). 1=enabled. q9 gives ALL banks.</p> <p>r%%[,0] Refresh Average Sensor_Ref[##] (if defined), enable &amp; calc. cRatios etc. r%%,0 refreshes block S%0 to S%%. </p> <p>r00 Refresh Average Refs etc. for ALL defined sensors. Ignores enable[]. Sensor[00] reserved for brightness ref.</p> <p>s%% *Scan for new location for sensor  S%%(00-97). If found, records location in Sensor[0%%]. (Note 12)</p> <p>t##[,%%] Threshold level##(31-98 only) set as default. [t##,%% sets the pvtThreshold for sensor %% (t0,%% to clear)]</p> <p>t## Tabulates ##(2-30 only) rows of scroll data (continuous scroll toggled off) Note: t1 alone toggles scroll on/off.</p> <p>t1,%% Trash 1 entire bank of pvtThresholds. Use t1,99 to clear ALL banks (0-9). Note: t99 lists all pvtThresholds</p> <p>u%% *Un-define/remove sensor %%  (Sensor S%%=0 &amp; set DISABLED) u99 for ALL. 'e' will erase from EPROM.</p> <p>v[1|2] Video mode. Causes reboot as a webserver. 'v2' will connect to  2nd (alt.) router ssid.(v or v0 for version)</p> <p>w *Wait for new command line (\\n) before resuming sensing (handy to freeze display data scroll - see t1 toggle)</p> <p>x### \u00a0 \u00a0 \u00a0 *selects first pixel column(0-319) &amp; z### selects image width (### columns(1-320)) for imaging.</p> <p>y### \u00a0 \u00a0 \u00a0 *selects first row for image and initiates a binary data dump for that row (header + #x2 bytes) using rgb565.   \u00a0 \u00a0 \u00a0 \u00a0 This command starts a process that must, after a series of 'y' commands, end with a terminator of 'yy'.</p> <p>R &amp; F Reset commands- will Reset CAM and initiate the Sensor mode. Both will Finish the WebServer('v*') mode.</p> <p>\\%,#,$ \u00a0 \u00a0  Convert bank to linear sensor starting with  S$$  and using r,x step sizes of #,$(0-31) Slope is \"down-right\".</p> <p>/%,#,$ \u00a0 \u00a0  Convert bank to linear sensor starting with S$$ as for '\\' but line will slope \"down-left\" (-deltaX).</p> <p>&amp; statistics histogram on trips and potential trips since last '&amp;', then reset counters and start another sample process. The table gives number of single highs, double highs etc. and totals for No. of frames/run time</p> <p>@## \u00a0 \u00a0 \u00a0  *set the \"occupied\" symbol in the scroll to ASCII character ##. Default is 35(\"#\") Arduino IDE @12 is bolder!</p> <p>+#,$ \u00a0 \u00a0 \u00a0 *add offset(# pixels) in $ direction to re-centre sensors after physical drift in CAM alignment. $(0-7) for N-NW</p> <p>\u00a0 \u00a0 \u00a0 * These commands typically for diagnostic/setup use only. They wait for a line feed or command to resume.</p> <p><code>Note: The value of \"bs\"(80 sensors 0-79dec) is printed in several formats. For data entry, bsNo format %% (e.g. 47) is bank/sensor, so bsn=8*4+7=39dec.(vpin). S47 may be printed as(char) 47, 4/7, (octal) 047,(or hex 0x27) depending on context. Debug output likely uses OCT(or HEX). Note: OCT 0107=8/7, 0117=9/7.</code></p>"},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#startup-notes","title":"Startup Notes:","text":"<ol> <li>Normal power up reset will initiate Sensor mode, as will the 'R' command, and uses EPROM data settings.  </li> <li>Sensor mode startup flashes white LED at 10Hz after ~10 seconds, and exhibits a \"flicker\" at ~20 seconds.  </li> <li>Requested (v1) WebServer mode reset will flash LED at  ~3seconds and again (brighter) at ~8 seconds.  </li> <li>After the 8 second flash the Webserver will be operational at web address 192.168.0.xx (xx from display).  </li> <li>If the OV2640 camera or WiFi fails to initialize, the CAM resets and may restart/revert into Sensor mode.  </li> <li>If USB FTDI/MB is removed or not connected to PC, then WebServer may fail/reboot. Power issue?  </li> </ol>"},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#i2c-command-notes","title":"I2C command Notes:","text":"<p>(EX-CS may exhibit small variations &amp; reduced cmd functionality refer APPENDIX C)</p> <p>1. The same commands are valid from an I2C Master Arduino, but there are some variations. 2. The commands with asterisks normally pause CAM execution so the operator can read USB output on a monitor screen. The same commands from I2C DO NOT wait for a new line, with the exception of 'w'. 3. Commands b,d,i,m,p,q&amp;t can return data to the I2C master Arduino(Mega). This data is delivered if the master calls a Wire.requestFrom(addr,#); following the command, from the slave CAM address 17(0x11). 4. The I2C data returned(after header byte) is in binary bytes and in a format depending on the last command. 5. Header byte[0] is the ASCII command character (b,d.i,m,p,q,or t) or an error code(OxFE) if no valid data. 6. If the error code is generated, it is followed by the last received (inappropriate) command string. 7. b$ cmd returns $+1 sensor status bytes for bank$,$-1 etc. down to bank 0. 'b' defaults to 'b9'(all). 8. d%% cmd returns 4 data bytes with binary values for bsn, maxDiff+bright, maxDiff &amp; bright in that order. 9. i%% cmd returns 2 data bytes: byte[1]= bsn and byte[2]=0 if unoccupied or 1(true) if occupied. (+ more) 10. p$ cmd returns Byte[0] header + count +3 data bytes per enabled (bank$) sensor + parity (max 27 bytes). 11. q$ cmd returns $+1 bank sensor enabled status bytes for bank$,$-1 etc. down to bank 0. 'q' defaults to 'q1' 12. s%% Scan looks for a bright LED on a dimmer background. The LED should be placed on the desired sensor position. This old method of placing sensors is not recommended. The Scan command is the last resort when USB is unavailable. 13. t##[,%%] cmd. initially sends CS the old threshold value (i.e. BEFORE change in the case of t##). Also returns sensor scores(bpd) in 2-byte pairs with MSB set so: bsn(+0x80 if undecided) &amp; bpd(+0x80 if OCCUPIED). Byte[0]header;[1]threshold;[2]S00bpd;[3]bsn;[4]bpd;[5]bsn;[6]bpd etc. Ends with bsn=80 (max 15 enabled) 14. m$,%% sets maxSensors to %% (USB or i2c) (as can h%% (%%&lt;98)). m0,1%% sets minSensors. Data sent to screen is bound between min and maxSensors. Extra parameter status bytes added to i2c bus for display. 15. The \" character is just a null cmd. Used before R, d &amp; t to prevent BCD Mega itself pre-interpreting them. 16. N.B.: The ESP32-CAM uses old ESP32S which has I2C limitations. It has a \u201cpipeline\u201d for returning data which results in a delay in response. i.e. the first request after a command will return OLD data. A SECOND request should return the desired data described above. A third or fourth request may return updated data. 17. Some commands take time to complete, as command processing can only happen once per 100mSeconds (i.e. the frame rate of the CAM). The I2C master should allow for latency in response where necessary. Place a DELAY(400) between all PARSE(\"\") EXRAIL commands.  18. Data requested over i2c may have a parity byte appended, and a check byte in byte[31]. 19. NOTE Automatic updating of ref image of unoccupied sensors now starts after last SUS (suspend) indicator. 20. a%%,rrr,xxx performs extended 'create sensor' equivalent to  k%%,rrr,xxx + a%% + r%% for new sensor S%% 21. Connection to DCC-EX Command Station has cmd. variations. See APPENDIX C for revised command detail."},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#appendix-b","title":"APPENDIX B","text":""},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#check-list-for-optimising-sensor-response","title":"Check List for Optimising Sensor Response","text":"<p>In the situation where sensors may be tripping undesirably, there is a range of adjustments that can be made to find a satisfactory operating point. Some have disadvantages that need to be considered and compromises may be necessary.</p> <p>1. First step is to refresh the sensor reference image. Try Cmd: r00, or r%% for a single sensor. This may be necessary after any disturbance to the environment such as changed lighting.</p> <p>2. Check the \"Diff\" scores on the scrolling display. After a refresh they should be in the range 32-37 for normal operation. If occasional trips occur, one remedy is to increase the threshold with Cmd: t46 say. Increasing the threshold reduces the sensitivity to low contrast objects (e.g. black over brown) If unoccupied Diff scores are consistently 32-35, reduce threshold for greater sensitivity.</p> <p>3. Is the lighting adequate? Steady muted daylight is ideal. Beware of rotating fans and other moving shadows (clouds?) (Note: may need to consider extreme case of mains induced ripple from 50/60Hz LED/fluoro lighting-to be discussed later) Brighter stable lighting means reduced \"noise\".</p> <p>4. Sensitivity to electrical \"noise\" can be reduced by increasing the \"min2trip\" parameter to 3 consecutive frames using Cmd: m3 (default is m2). However this increases response time by 100mS.</p> <p>5. You can create a \"Twin\" sensor for a \"second opinion\" by placing a Second Sensor S$$ on the track adjacent to the primary sensor S%% (3-4 pixels away) by using the Cmd: a$$,123,234 selecting the position from that of the primary sensor (obtained from Cmd: i%%) To avoid increasing response time, use a twin bsNo LOWER than the primary sensor (possibly in a \u201creserved\u201d bank, perhaps a matching bsNo in that bank). This twin S$$ can be assigned to the primary sensor S%% with the Cmd: i%%,$$ The primary sensor will not trip unless the twin agrees. This suppresses pixel noise spikes.</p> <p>6. Check that there isn't anything elsewhere in the field of view that is moving and could trigger the auto exposure in the camera. e.g. spectators near the edge of the field of view.(It is possible to change camera ov2640 module settings with 'j' and 'c' commands, but this can be a frustrating experience and needs considerable practice as some settings interact and can be order dependent)</p> <p>7. Make sure you do a refresh/record reference (r) after any changes or the benefit will be obscured.</p> <p>8. Is the camera steady? No vibration or movement since the last reference images (r)?</p> <p>9. There is a 2-frame (experimental) averaging applied to low bank sensors (currently 0-2) This can be extended to cover all banks, if desired by increasing CAM parameter TWOIMAGE_MAXBS above 3/0</p> <p>10. There has been poorer behavior observed with sensors placed near the edge of the frame. They seem to experience more electrical noise than mid-frame sensors and may need extra attention.</p> <p>11. A statistics function can be obtained to see how bad spurious tripping is. The '&amp;' cmd gives a table of stats accumulated since the previous '&amp;' command. May be useful. HINT: You can compare two or more sensors with different settings on the same spot. Accumulate data with no genuine trips.</p> <p>12. Consider whether a pixel may be faulty or unduly noisy. Try another nearby sensor position.</p> <p>13. If necessary, enhance the brightness of the Sensor location with light colour or a small reflector.</p> <p>14. It is possible to set private thresholds on individual sensors if other solutions inadequate. (t##,%%)</p> <p>15. Consider adjusting brightSF($) if colour contrast is generally poor (b#,$) default 3, try 1-5.</p> <p>16. In some situations, repositioning sensor slightly to include loco shadow will give extra sensitivity.</p> <p>17. Consider repositioning CAM for better oblique view angle giving more contrast for better detection, catching sides of coaches/wagons, shadows and some trackside references.</p> <p>18 Consider a beam break enhancement by placing an IR led between rails at the sensor position (power from DCC track?)</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#appendix-c","title":"APPENDIX C","text":""},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#parsed-dcc-ex-cs-sensorcam-commands","title":"Parsed DCC EX-CS sensorCAM commands","text":"<p>The file CamParser.cpp has been added to the CS specifically tailored to provide a mechanism for the CS to send commands more easily than by using the clumsy diagnostic command style \\&lt;D\u00a0 ANOUT\u00a0vpin\u00a0parm1\u00a0parm2&gt;. The CS Native CAM command format is &lt;N\u00a0c\u00a0[parm1]\u00a0[parm2]&gt; where command character 'c' can be any of those listed below. Generally, to effect changes in sensorCAM, the CAM must be in the run mode (flashing).</p> <p>The base vpin address defaults to 700 but one can use the #define SENSORCAM_VPIN ### for another value (in config.h). With 2 to 4 CAM's, use &lt;N\u00a0C\u00a0#&gt; (1-4) when a switch is needed. The CAM# may also be placed, if defined in config.h, prefixing the sensor bsNo. e.g. &lt;Ni 2%%&gt; &lt;Nr\u00a02%%&gt; also &lt;Nm 200&gt; &lt;Nf 212&gt; &lt;Nt 243&gt;</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#user-commands","title":"User commands","text":"Command Example Equivalent sensorCAM command &amp; action (some commands only return \"ACK OK\" to CS) &lt;N&gt; &lt;N&gt; n/a Lists current &amp; alt. defined CAM baseVpins. &lt;N C ###&gt; &lt;NC 600&gt; n/a CAM base vpin(&gt;99) for following commands OR &lt;NC #&gt; selects CAM # (1-4) &lt;N a %%&gt; &lt;Na 12&gt; a12 enAble sensor S%% (bsNo). &lt;N\u00a0a%%\u00a0row\u00a0col&gt; &lt;Na\u00a012\u00a032\u00a043&gt; a12,32,43 enAble &amp; also set new coordinates for sensor bsNo &amp; refresh &lt;N b bank#&gt; &lt;Nb 1&gt; b1 Bank sensor states(all 8).(used by IFGTE() ATLT() e.g. to locate loco). &lt;N e&gt; &lt;Ne&gt; e EPROM write any changed settings to sensorCAM EPROM. &lt;N f %%&gt; &lt;Nf 12&gt; f12 Frame image pixel data for Sensor_ref[%%] and sensor666[%%] (RGB bytes). &lt;N F&gt; &lt;NF&gt; F Forced reboot, restoring sensorCAM sensor mode &amp; EPROM defaults. &lt;N g&gt; &lt;Ng&gt; g Get status ov2640 camera module settings (on sensorCAM monitor). &lt;N h %%&gt; &lt;Nh 30&gt; h30 set maxSensors to limit display to below sensor S%%. Also Help (0-9) &lt;N i %%&gt; &lt;Ni 12&gt; i12 Information on sensor bsNo state, position &amp; twin (0=No twin). &lt;N i %%[ $$]&gt; &lt;Ni 12&gt; i12,02 Info. &amp; assigns new twin sensor(S$$) for \"second-opinion\" on S%%. &lt;N j $ #&gt; &lt;Nj B 2&gt; jB2 adJust ov2640 parameters($)(Brightness, Contrast etc)(values 0-2 only). &lt;N l %%&gt; &lt;Nl 12&gt; l12 (lima) Latch output state of sensor bsNo to 1 &amp; disable. &lt;N m $ [%%]&gt; &lt;Nm 3 20&gt; m3,20 Min/max min2trip(1-4) frames [maxSensors] &lt;NM&gt; shows CAM parameters &lt;N n$ [%%]&gt; &lt;Nn 1 10&gt; n1,10 set nLED= bank $ [and minSensors=%% to limit display range] &lt;Nn v&gt; verifies. &lt;N o %%&gt; &lt;No 12&gt; o12 (oscar) Zero output state of sensor bsNo. Reset to 0 &amp; disable. &lt;N p %%&gt; &lt;Np 1&gt; p1 Positions(r,x) of all enabled sensors in bank are listed. &lt;N q #&gt; &lt;Nq 1&gt; q1 Query bank# enabled states of sensors (0 indicates sensor disabled). &lt;N Q&gt; &lt;NQ&gt; n/a Query state of all sensorCAM Sensors &lt;N r [%%]&gt; &lt;Nr 12&gt; r12 Refresh Reference image for sensor S%% (default ALL=r00). &lt;N s %%&gt; &lt;Ns 12&gt; s12 Scan image for brightest spot and set S%% to center that pixel. &lt;N t ## [%%]&gt; &lt;Nt 43 12&gt; t43,12 Threshold displayed, sets global threshold (32-98) [sets a pvtThreshold]. &lt;N t ##&gt; &lt;Nt 10&gt; t10 Tabulate ## (2-31) rows of scroll data similar to CAM scroll. &lt;N t # %%&gt; &lt;Nt 0 12&gt; t0,12 Trash pvtThresholds. &lt;Nt 0 %%&gt; individually, &lt;Nt 1 %%&gt; for bank, &lt;Nt\u00a01\u00a099&gt; trashes ALL pvtThresholds.  &lt;Nt\u00a099&gt; lists ALL pvtThresholds. &lt;N t 1&gt; &lt;Nt 1&gt; t1 toggles scroll on/off. &lt;N u %%&gt; &lt;Nu 12&gt; u12 Undefine and disable sensor bsNo(erase coordinates). &lt;Nu 99&gt; for ALL &lt;N v [#]&gt; &lt;N v 1&gt; v1 Video mode(1-2) invoke webCAM, or alt webCAM with v 2. v for version &lt;N\u00a0w&gt; &lt;Nw&gt; w Wait. Stop/start CAM imaging (flash), status sensing &amp; streaming. x \u00a0 y \u00a0 z Reserved for binary export for Processing 4 images &lt;N ### ## ##&gt; &lt;N\u00a0711\u00a075\u00a085&gt; a13,75,85 Note: This uses the vpin for a sensor, NOT id/bsNo.(ref. Appendix E). <p>Notes: The'i' cmd prints bsNo(bsn) where bsn/vPin offsets range from(7)00 to(7)79(e.g. baseVpin address 700). Some commands return previous(old) values then update sensorCAM. Use &lt;Nm&gt; to confirm change. Space after &lt;N is optional, as is capitalization of command. e.g.&lt;N t 42&gt;=&lt;NT 42&gt;,&lt;N r 00&gt;=&lt;NR&gt; Multiple CAM selections can be achieved by config.h entry and use of a prefix on param1 e.g.&lt;N i 212&gt; for CAM 2 For commands to work fully, need latest CamParser.cpp, CS driver(IO-EXSensorCAM.h) &amp; sensorCAM.ino</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#appendix-e","title":"APPENDIX E","text":""},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#tabulated-dcc-ex-cs-ids-for-sensorcam","title":"Tabulated DCC-EX-CS ID's for sensorCAM","text":"<p>Table B below shows the colour code used to identify sensors on the Processing 4 track image. For example, sensor S12 has a bsNo 1/2 for which the colours are Brown/Red (seen on sensor box edges). For CAM number 1, the full CS sensor S12 ID is 112 when used in CS native &lt;N&gt; commands such as &lt;N i 112&gt;  The use of the CAM # can be optional.  If only one CAM is installed (or selected), &lt;Ni 12&gt; is sufficient. For EXRAIL it can be tested so: AT(CAM 012) where the vpin is invisibly calculated as (700+012). N.B. The use of the '0' after CAM is essential in EXRAIL. The colour code is the standard resistor value colour code for 0-9.</p> <p>Under normal circumstances if the CS has been configured as per the installation instructions, there is no need to refer to the vpin of any Sensor.  They are all relative to the baseVpin of the CAM.</p> <p>The full ID consists of CAM number #-bank-sensor or #bs. Each bank(0-9) contains 8 sensors(0-7) vPin is the (CAM number # baseVpin) + 0bs,  bsNo skips id's ending in 8 or 9.  (e.g. 700 + 012 = 710) vPin is the base/first vPin number (e.g. 700) + DEC.number(bsn) in the conversion table below.</p> <p></p> <p>Table E \u00a0 \u00a0 Reference Sensor ID to colour code conversion table</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#appendix-f","title":"APPENDIX F","text":""},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#hardware-interface-pca9515a-endpoints","title":"Hardware Interface (PCA9515A &amp; Endpoints)","text":"<p>Note: This Appendix originally focused on the ESP32-CAM-MB implementation, but for that information now refer to the full sensorCAM Manual. The information below pertains mostly to the newer WROVER-CAM, as mentioned in Section 7, Figure 6 for a simpler implementation.</p> <p>The ESP32 CAM drives GPIO pins with 3.3V logic. This may well be incompatible with the master l2C signals at 5V. It is essential that appropriate voltage level shifting and buffering is used where necessary. Unbuffered I2C is limited in range but a Sparkfun differential i2c driver/endpoint may also be used to achieve long lengths and voltage shifting (3.5v to 5v) if needed. </p> <p>The sensorCAM can be Reset remotely by software or by cycling the power supply. The CAM MUST be rigidly mounted as it's response to any image vibration can trip sensors. It is best not moved after sensor location programming as precise realignment could be tedious. It is, however, advisable to make guides or jig arrangement to at least be able to remove (for maintenance) and return with minimal misalignment to cover the same field of view. The LED method of placing/positioning sensors may be necessary if a long USB cable is impractical. A 5m buffered USB cable might be advantageous. Even so, programming or imaging over a long USB cable may not be satisfactory.</p> <p>The PCA9515A based module offers a simpler, but limited, interface to an i2c bus the use of will act as a level changer (3.3V to 5V) and can connect to a SHORT i2c bus (max 2-3m). If the i2c length is near or just over the limit, an optional LTC4311 extender can be attached to boost the signal. As indicated, this option relies on 5V USB power so needs a dedicated (permanent) USB cable connection.  A local 5v buck converter can be used beside the CAM for a better supply.  This is included on the Wrover breakout board. You could also extend a cable between the PCA9515 buffer and CAM (1m).</p> <p>A programmable nLED and 330ohm resistor may be attached between 3.3V VCC to GPIO14 to aid testing.</p> <p>The Sparkfun endpoint is perhaps the best overall solution at this stage for driving one (or more) sensorCAMs. It provides greater lengths of cable without extending the Command Station i2c local bus. The endpoints are used in pairs, connected by a long (&lt;100m) differential pair cat5 cable providing power and communications. It can provide buffering, level shifting and power, but care is needed at the CS end to avoid over-voltage damage. It is suggested, with a 5V CS, that the Endpoint pullup 0-1 jumpers at the CS end be cut for safety. The sensorCAM Endpoint default pullups are needed for the 3.3V CAM i2c bus. The CS Endpoint requires 3.3V power(from the CS) and a separate (7 to 9V) DC supply for the Regulator &amp; CAM.</p> <p>Typical device applications (with BUCK 5V inverters):</p> <p></p> <p>Sparkfun endpoints(requires a matching sparkfun endpoint at CS)</p> <p></p> <p>Recommended CAM wiring is with Endpoints and 5V dedicated regulator with power over GRN-GRNW(Vin) (CAT 5) with Vin(7-9V) from an ungrounded 0.5A DC supply (wall-wart/plug pack).</p> <p>There are two basic variations below for connecting the Endpoints to the CS. The choice depends on the current system being extended. Options A applies to a 5V CS(Mega) with or without other existing I2C accessory connections, while Option C is the simplest connection to a 3.3Volt CS (e.g. CSB1) i2c bus.  The i2c bus should be \"tuned\" to include the CAM load before the CAM is attached.  The Endpoint has a pair of 4k7 pullups that may be disconnected by jumper cuts.  Refer to Tinkerers Guide to Tuning documentation on i2c.</p> <p>The 2x Endpoints require about  10mA  each from the 3.3V PS. All options can be adapted for use with a mux if necessary. </p> <p>Option A: CUT CAM endpoint jumper 0-1 and supply 5V and 3.3V from the CS. Option A connections results in a 5V i2c interface to 3.3V differential cable for 5V microprocessor based CS (e.g. Mega).</p> <p>Option C: used with newer (32bit) MPU's (e.g. CSB1) &amp; uses 3V3 throughout. No Endpoint jumpers need to be cut. Whichever option is used, the user should consider if the I2C bus needs to be tuned differently. For very short extra cable length to the Endpoint and only one extra device count on an I2C bus under 1m in length, tuning may be unnecessary. In marginal conditions consider returning as per DCC-EX recommendations.</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#a-for-33v-differential-drive-5v-cs-i2c-bus","title":"A. \u00a0 FOR 3.3V Differential drive 5V CS I2C BUS","text":""},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#c-for-33v-differential-drive-33v-cs-i2c-bus","title":"C. \u00a0 FOR 3.3V Differential drive 3.3V CS I2C BUS","text":""},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#appendix-h","title":"APPENDIX H","text":""},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#notes-on-use-of-ex-rail-with-sensorcam","title":"Notes on use of EX-RAIL with sensorCAM","text":""},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#1-sensorvpin-numbering","title":"1. Sensor/vpin Numbering","text":"<p>The numbering of sensors can be consecutive by vPin, which is the common practice with multi-pin peripherals (e.g. PCA9685 16-channel Servo driver and MCP23017 16-channel GPIO Expander). Sequential vPin numbers within a device is hardware enforced, but this loses some of the advantages available by a more meaningful ID notation. Such ID's are available for jmri use and so can also be used for sensorCAM. Use of IDs, as suggested below, can remove any need to program with vPin numbers.</p> <p>For any peripheral device, the vPin is needed for commands (e.g.700+5), but, if predefined (e.g. in config.h), alphanumeric names such as CAM or CAM2 or ESSEX can be used in place of the base vPin to identify the camera. Then commands for CAM pin 5 become: e.g. AT(CAM 05) or AT(ESSEX 05)</p> <pre><code> e.g.  \n #define SENSORCAM_VPIN 700    //place in config.h or myAutomation.h or mysetup.h  \n #define CAM  SENSORCAM_VPIN+  //in config.h or myAutomation.h or mysetup.h  \n\n Valid EXRAIL commands: AFTER(CAM 5)  AT(SENSORCAM_VPIN+7)  IFGTE(CAM 010, 2)  \n\n To avoid frequent \u201cCAM\u201d in scripts, an alias can be assigned e.g. ALIAS(ESSEX_P1, CAM+0x10)\n</code></pre> <p>With each sensorCAM having up to 80 sensors, it is desirable to test groups of (1 to 8) sensors with a single EXRAIL test using the IFGTE() or IFLE() commands. To do this, the sensors are logically arranged in \u201cbanks\u201d of (consecutive) vpins. The logical grouping available can be written in the form \u201cbs\u201d or b/s where b can have bank values of 0-9 (10 banks) and s values 0-7 (8 sensors). IFGTE and IFLT read a whole bank \"value\". Native CAM commands can also be issued e.g. PARSE(\"&lt;N b 4&gt;\") for bank 4.</p> <p>EXRAIL can accept \u201cb/s\u201d numbering (e.g. 047) if we add the leading 0. e.g. vpin= SENSORCAM_VPIN+ 047 e.g. IFGTE(CAM 047,1) provided values are defined for SENSORCAM_VPIN &amp; CAM(as above).</p> <p>(N.B. \u201cCAM\u201d includes the \u2018+\u2019) Using this method there is no need to remember assigned vPin values!</p> <p>Example 1: For the approach to a signal, several sensors may be deployed (say S13 to S17) with S17 last at the signal. As a train approaches the signal, the (bank) \u201cvalue\u201d of the tripping sensors will increase. This can be used to control the loco speed for a smooth and precise stop at a platform for example. Commands IFGTE(CAM 013,8) SPEED(40)... IFGTE(CAM 013,16) SPEED(30) etc. can be used to control the loco approach speed with some precision. Finally, at the signal(S17), IFGTE(CAM 013,128) STOP</p> <p>Aliases could also be defined and used for station/bank or line sensors. e.g.IFGTE(TRENTHAM, 0x80)</p> <p>Example 2: The CAM can have up to 10 occupation/line detectors. If two \"linear\" line sensors are needed, and we have bank 1 allocated (S10-S17), the following 16 vPins could be assigned to 2 banks of linear sensors. We can use (bs#) ID of 20 to 27 for first linear sensor (bank2) and 30-37 of bank3. The Command Station can easily handle banks of 8, using an ID based format of (CAM 020) and (CAM 030). The \"bank\" or b/s notation requires the leading \u20180\u2019 on the bsNo. for automatic vpin calculation. The linear segments at S21 to S27 may also be tested individually and a common bank threshold can be set if needed. e.g. IFGTE(CAM 020,1)...// bank occupied, or IFGTE(CAM 024,16) \u00a0 //2nd half occupied.</p> <p>Note: With \u20180%%\u2019 notation, unless you understand the issue, avoid using bank 8 &amp; 9 as mistakes may arise. (08# must be expressed as 010# and 09# as 011# for correct outcome)</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#2-multiple-cams","title":"2. Multiple Cams","text":"<p>Multiple sensorCAMs can be easily handled if CAM2, CAM3 etc are defined along the lines of CAM above, so IF(CAM2 012) tests a different sensor to IF(CAM3 012), provided SENSORCAM2_ VPIN etc. are defined. Using CS native commands, e.g. &lt;Ni 212&gt; and &lt;Ni 312&gt;, can also access S12 on different CAMs. The #define SENSORCAM_VPIN ### is essential for cam1. Do NOT insert a 1 in to SENSORCAM_VPIN. You may use SENSORCAM2_VPIN and SENSORCAM3_VPIN with CAM2 and CAM3 in config.h</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#appendix-j","title":"APPENDIX J","text":""},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#wrover-cam-notes","title":"WROVER-CAM notes.","text":""},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#1-note-on-i2c-clock-frequency","title":"1 Note on i2c clock frequency","text":"<p>The newer sensorCAM drivers default to an i2c bus frequency of 100,000 Hz. With caution, this may be increased somewhat (e.g. 200000) if the i2c bus is well tuned and all attached devices can handle higher frequencies. To set a higher frequency, for example, place the following in mySetup.h or myHal.cpp I2Cmanager.forceClock(200000); //place after void halSetup()</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#2-notes-on-40-pin-wrover-cam-and-38-pin-breakout-board","title":"2. Notes on 40-pin WROVER CAM and 38-pin breakout board","text":"<p>Potentially simplest commercially available hookup for 40 pin WROVER-CAM:</p> <p>Software configuration: add #define CAMERA_MODEL_WROVER_KIT to bottom of configCAM.h</p> <p>2x\u201cSpare\u201d (USB end) Vcc and GND pins not used with the 38 pin breakout board shown. (remove?)</p> <p>Adding 1.0uF capacitor between reset (EN) pin and gnd ensures more reliable power-on reset.</p> <p>Add a super-bright green LED and 330R from 3.3V to GPIO14 for programmable LED indicator.</p> <p>There is no white \u201cflash\u201d LED but, in sensorCAM mode, the on-board blue LED flashes instead. (GPIO2)</p> <p>The breakout board USB connectors are for an optional 5V power source ONLY. No comm's.</p> <p>Limit Vin barrel jack to 7-10V max to avoid destruction of the 1117C 5V regulator. (Vne= 16V)</p> <p>For a limited reach, perhaps using a LTC4311 terminator/buffer at the CS to boost signal rise times and range, the cheaper PCA9515A may be used with the Wrover-CAM connected as below.  The wires from PCA9515A to the CAM can be up to 2m long (with extra pullups) using twisted pairs (cat5?).</p> <p></p>"},{"location":"products/ex-sensorcam/ex-sensor-manual-abridged/#additional-random-notes","title":"ADDITIONAL RANDOM NOTES:","text":"<p>ALL FOLLOWING IMAGES ARE FOR GENERAL INFORMATION ONLY&amp; NOT DIRECTLY REFERENCED IN THE FULL MANUAL ABOVE</p> <p></p> <p></p> <p></p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/","title":"EX-SensorCAM Manual","text":""},{"location":"products/ex-sensorcam/ex-sensor-manual/#contents","title":"CONTENTS","text":"<ol> <li> <p>Overview</p> </li> <li> <p>ESP32-CAM</p> </li> <li> <p>Physical Installation</p> </li> <li> <p>Notation &amp; Help commands</p> </li> <li> <p>Configuration</p> </li> <li> <p>PROCESSING4 monitor/console</p> </li> <li> <p>Wiring Requirements</p> </li> <li> <p>Host Communication</p> </li> <li> <p>Methodology of operation</p> </li> </ol>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#appendix","title":"Appendix","text":"<p>A. ESP32 sensorCAM Command Summary</p> <p>B. Check List for Optimising Sensor Resonse</p> <p>C. Parsed DCC EX-CS sensorCAM commands</p> <p>D. Linear Sensor Commands</p> <p>E. Tabulated DCC-EX-CS id's for sensorCAM</p> <p>F. Hardware Interface (PCA9515A &amp; Endpoints)</p> <p>G. I2C sensorCAM commands&amp; PROTOCOL</p> <p>H. Notes on use of EX-Rail with SensorCAM</p> <p>I. Configuring EX-CS to connect to sensorCAM as an EXIO device</p> <p>J. WROVER &amp; ESP32-CAM notes</p> <p>Addenda</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#1-overview","title":"1. Overview","text":"<p>The sensorCAM is a video camera replacement for physical proximity sensors on a model railroad. It can replace up to 80 sensors and their associated power and signal wiring using artificial vision alone. It offers the flexibility of sensor placement or relocation instantly by software command with no physical layout modification. The railroad can be automated using artificial vision of train activity. Each virtual sensor can produce a logical state of 1 (occupied) or 0 (unoccupied) and is readable over an i2c cable. SensorCAM uses the ESP32-CAM module. However, the ESP32-WROVER-DEV CAM (v1.6) is a recommended substitute with simpler wiring.</p> <p>The sensorCAM takes 10 frames per second in RGB565 format at QVGA resolution of 240 x 320. Each sensor consists of a square group of 16 pixels which equates to approx. 20x20mm square with the standard lens at 1500mm. The software decodes and saves only the 80 sensor images(1280 pixels) and then compares each sensor image with a reference image prerecorded either at startup, on request, or by a \"recent\" automatic update. If the images do not match the references well then the sensor is \"tripped\" or \"occupied\" &amp; status '1' is produced. Good match results in '0' output. The state of virtual sensors can be manually monitored on the USB monitor, or polled by microcontroller over the i2c interface cable. N.B. The sensorCAM is sensing only when the Flash LED is pulsing (for each new frame).</p> <p></p> <p>2PCS ESP32-CAM-MB, Aideepen ESP32-CAM W BT Board ESP32-CAM-MB Micro USB to Serial Port CH-340G with OV2640 2MP Camera Module Dual Mode</p> <p></p> <p>Note: While this manual primarily talks about the ESP32-CAM-MB, there is a similar tested and recommended alternative in the newer ESP32 WROVER CAM single board option requiring simpler wiring with the 38P expander board. For some further preliminary details refer to Section 7 Wiring, Figure 6. The software is identical for both CAMs.</p> <p>Dealing with video images involves complexities not normally associated with model railroading sensors. The sensorCAM is a complex device with a number of commands explicitly for setup and evaluation. In addition to these, several \"output\" commands can be used by a host to interrogate the \"virtual sensor\" output states. The initial setup can be somewhat involved and requires familiarity with most of the 25 commands discussed below.</p> <p>The sensorCAM has two mutually exclusive modes of operation; the sensorCAM mode and the webCAM mode. The webCAM mode is essentially as described in the on-line tutorials. Use that mode only for education and curiosity. Invoke webCAM video mode by issuing the v1 (or v2) sensorCAM command to get a webCAM URL(e.g.192.168.0.64)</p> <p>The ESP32-CAM does not have a USB port so you will need an FTDI interface or MB. We prefer the ESP32-CAM-MB (MotherBoard) interface which plugs directly behind the CAM. Check \"The Workshop\" You tube videos on-line for guidance. The MB is far simpler to use (needing no jumpers or cables) than a separate FTDI used in the videos.</p> <p>The ESPRESSIF guide will show how to install the Arduino-ESP32 support. BE WARNED: using an FTDI(rather than MB) that has a jumper set to 5V and connecting it to the CAM 3V3 pin will destroy the ESP32-CAM. Many have died.</p> <p>Installing Arduino-ESP32 2.0.6 documentation (readthedocs-hosted.com)</p> <p>A tutorial on setting up the ESP32 on Arduino IDE is available on YouTube ESP32 CAM-10 Dollar Camera for IoT Projects</p> <p>Introduction to ESP32- Getting Started</p> <p>The sensorCAM software is uploaded to the ESP32-CAM using the Arduino IDE. The sensorCAM has been programmed with two modes of operation; a webCAM mode (as in the on-line tutorial) and a sensorCAM mode. The limited power of an ESP32 prevents both functioning at the same time. Consequently, to see an image of the railway while sensorCAM is operational requires a third application (Processing 4.3) to retrieve a still image from the CAM over the USB cable to a computer. The Processing 4 .pde app replaces the Arduino IDE and IDE monitor retaining the sensorCAM command set and offering a (slow) image capture capability over USB cable. Processing 4 allows virtual sensors to be placed on an image of the railway with a simple mouse click.</p> <p>In addition to the USB interface, you may need a prototyping board or Wrover expansion board to connect to the real world (power, indicators, control wires, and i2c.) Further details are given below. However to test the sensorCAM functions, one only needs the CAM with a USB port, with power from the USB port.</p> <p>To control a railway, the railway needs a microcontroller based management system. This typically could be an Arduino Mega based system running software such as the DCC-EX CommandStation and EX-RAIL automation application. The EX Command Station(CS) solution requires the addition of sensorCAM specific code (sketches) as detailed later.</p> <p>The lens system on the cam comes in (std) 66deg., 120 and 160deg. field of view. One can get longer ribbon versions and even 850nm(IR) versions to experiment with. These versions may be sourced independently of the ESP32-CAM. A wider coverage is possible with a 75-120deg(fish eye) lens, if needing to accommodate a lower ceiling height.</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#2-esp32-cam","title":"2. ESP32-CAM","text":"<p>The heart of the sensorCAM is the ESP32-CAM module containing an ov2640 camera sensor and a 32bit ESP32-S microprocessor. The sensorCAM software/sketch is loaded into the ESP32 using the Arduino IDE over a USB port with settings newline/115200 baud. Follow the above guidelines and run the camera example first, to get a demo webserver and CAM operational with a simple coloured test image. Experiment with settings to \"get a feel\" for the parameter effects which need optimization. The CAM has a considerable number of video related on-screen settings. Alternative ov2640 CAM Modules can be obtained with various viewing angles(66,75,120,130deg) if std.(66?) is too low. A \"fish eye\" lens(120deg.) will give barrel distortion, but the sensorCAM should still function acceptably but the low viewing angle could be problematical. The standard ov2640 can see some Infra Red light which may be utilised to see a bright IR LED as a beam-break sensor.</p> <p></p> <p>Figure 1. \u00a0 webCAM mode</p> <p>Figure 1. is an example of the standard webCAM browser presentation. It is a very useful mode for alignment and as a training aid in investigating the effects of the many video adjustments possible, but does not allow placement of sensors as sensorCAM mode can't be simultaneously enabled.</p> <p>Brightness, Contrast, Saturation, AutoWhiteBalance(AWB), AWBgain, AutomaticExposureCtl(AEC), AECdsp, AELevel, AutomaticGainCtl(AGC), AGGainCeiling and more can be adjusted. The QVGA startup settings of sensorCAM are:</p> <p>Bri=0,Con=1,Sat=2,AWB=1,AWBg=1,AEC=1,AECd=1,AEL=1,AGC=1,AGg=9;(initial settings of 'c' parameters)</p> <p>These can be changed after the CAM images are stable. C++ variables AWB9 and AGC9 may be set to 0 after 9 seconds in code. Find them and change in the sensorCAM.ino file if required.</p> <p>If you \"Start Stream\", parameter changes will seem almost immediate. But with \"stills\", after changing a variable, you may have to click \"Get Still\" 3 times to clear the pipeline and get a changed image. In Stream mode, close observation will reveal changing whole image brightness/colour for several seconds after image disturbance (e.g. a hand in front of CAM) as the auto adjustments \"correct\" the image. These types of changes can trip the sensorCAM even if the obstruction does not block the virtual sensor. Consequently after power-up, the sensorCAM may stabilize and then turn off some auto adjustments in the first 15 seconds. Changing environment lighting may result in a need to use a \"re-reference\" command, for example perhaps after sunset or turning on extra lighting.</p> <p>Due to the slowness of the ESP32 &amp; wifi, the \"live stream\" is slow and a webCAM delay in response will be observed. This may be a little quicker for the sensorCAM sensing mode. The delay is inevitable in webCAM WiFi mode.</p> <p></p> <p>Figure 2 \u00a0 Initial sensorCAM settings</p> <p>After the sensorCAM has booted up, it reads frames for 9 seconds before automatically doing a reference grab for all defined sensors (the r00 command). ver320 by default sets the CAM configuration to those below. When sensorCAM is running, a user may tweak these settings via a USB monitor 'c' or 'j' commands if required. Bri=0, Con=1, Sat=2, AWB=1, AWBg=1, AEC=1, AECd=1, AEL=1, AGC=1, AGg=9; \u00a0 (initial settings of'c' parameters)</p> <p>The ESP32-CAM has an Infra-Red(IR) filter to enhance colour response. The sensorCAM relies on strong colour contrast(saturation) to detect changes. Low lighting levels and poor contrast degrades performance. Some IR penetrates, so the CAM may use an IR LED for reliable beam-break sensing.</p> <p>To run the sensorCAM.ino, it will be necessary to configure the Arduino IDE for the ESP32 as covered in the above you-tube tutorial links. Load and run the demonstration. For the sensorCAM, you will require new files as described in the sensorCAM installation Guide. The ESP32-CAM uses the \"Al Thinker ESP32-CAM\" found under Tools:Board:ESP32 (select Tools&gt; Board: ESP32:\"ESP32 Wrover Module\" for WROVER-CAM). Select Partition Scheme: Huge APP. Check the correct Port is selected, compile sensorCAM.ino, and upload to the CAM before opening the Arduino monitor.</p> <p></p> <p>The ESP32-CAM can take rgb565 frames at 13/second. However it is a 3 step process; image sensing, processing and storing. It will then take further cycles to assess the state of the 80 virtual sensors in the frame (another two cycles). A total of 5 cycles places a significant limit on the sensorCAM speed of response time (up to 0.5 seconds at 10 frames/second). A fast HO loco can travel 160mm @ 100kph, so this latency might need to be accommodated in planning virtual sensor locations.</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#3-physical-installation","title":"3. Physical Installation","text":"<p>For testing purposes you will need a computer with a spare USB port and the Arduino IDE software installed. The PROCESSING software is also advisable as it gives a more reliable and convenient image for setup. A long powered USB cable(5m?) may be an advantage as the sensorCAM may be some distance from the PC. For a final installation the sensorCAM would be connected via a cat5/6 cable carrying power and a differential i2c bus (of up to 30m) to a microcontroller, Command Station or similar. Some different practical solutions are explored in Appendix F.</p> <p>For a test hookup between a USB powered sensorCAM and a Command Station (mega) with a short existing i2c bus, provided the total length is under say 3 meters, a simple, cheap arrangement could be tried using a PCA9515A buffer and level shifter. It requires soldering 5 wires to the underside of the MB USB interface. This improvisation is not an ideal \"universal\" arrangement. The PCA9515A is mounted on 1/16\" thick double-sided adhesive foam mounting tape. The CAM on i2c bus is best used theoretically with the USB computer running on battery power alone (unplugged) to absolutely avoid ground loops and associated electrical noise, but will probably function OK anyway.</p> <p></p> <p>Figure 3 \u00a0 CAM with 3.3 to 5V i2c interface and optional LTC4311\u201cterminator\u201d for greater reach</p> <p>The sensorCAM is preferably placed above and square-on to a section of layout at a height of 1 to 1.8m above the surface. 1.2m gives a max. coverage of approximately 1.2x0.9m with the standard lens. Another arrangement with several advantages is to place the CAM near the surface so as to view the surface via some good mirror tiles placed on the ceiling, positioned to ensure coverage of the desired sensor locations. This may increase coverage, especially if multiple mirrors are at slight angles. The mirror arrangement with benchtop level mount allows for wider coverage with low ceilings, and also places the CAM in a more accessible spot for wiring and maintenance. Mirror tiles do not need to be perfectly flat, some image distortion is acceptable, but they must be stable. Oblique camera angles may also be used to advantage, but sensor location and tripping point may be compromised somewhat.</p> <p>Lighting is critical for reliable operation. Theoretically, the lighting should be steady. Both LED flood and Fluorescent lighting might degrade results due to the flickering levels of illumination at 100/120 Hz. Use quality LED lights. The light fittings should not be visible in the camera's field of view. A uniform level of lighting is the objective, with a minimum influence from fluctuating daylight, fans and cloud shadows through windows. Some experimentation may be needed to avoid local \"glare\". Images may show white test panels to have several drifting horizontal dull bands produced between cycles of the mains supply (Figure 4). Bright lighting is desirable (good quality LEDs?) to enhance colour differentiation. Check for flicker by taking a \"slo-mo\" video on a cell phone. Fluoro's are bad!</p> <p>The mount needs to be rigid to avoid vibration which can trip sensors due to small image movements. It also needs to have a suitable route for a (cat5) cable for its own power supply and the necessary i2c communications. The length of this cable needs to be considered if the railway's i2c network is otherwise long. The prototype CAM has been fitted with i2c buffers and used on a 20m buffered 5 Volt i2c Cat5 bus, but the quick connection above (using PCA9515A) is for short lengths only(i2c under 3m). Up to 7m may be achieved using 2k pull-up resistance and one LTC4311 \"terminator\" to enhance signal rise time. Benchtop mounting with mirrors minimizes this length issue. A very good alternative for longer cables is the Sparkfun differential Endpoint system.</p> <p>Most reliable results may be obtained with light grey coloured ballast and dark sleepers. If results are inadequate, light green (grass?) or yellow \"reflectors\" between the rails may relieve any problem (recommended in fiddle yards). If lighting throws shadows beside rolling stock, the shadows can be used advantageously by good sensor placement.</p> <p>For initial configuration, access to the sensorCAM's USB port is important. Loading computer code over a long USB cable is problematic, but monitoring and tweaking settings may be done with a reduced BAUD rate or a (5m?) buffered USB cable at 115200 BAUD. A benchtop mounting with mirror would help here.</p> <p>With regards lighting, fluoroescent or LED lighting normally flickers at twice mains frequency so it pulses at 100 or 120Hz. This is normally tolerable, but it can be seen in a sensorCAM image on a uniformly white test panel as below (Figure 5). In 100mSec there could be up to 10 bands in one image. SensorCAM tries to synchronise with the mains frequency, but if it fails the faint bands will drift across the sensors and potentially trip them in the worst case scenario. Set the threshold high enough to avoid such trips or (better) change lighting. Figure 4 shows an example of bad 100Hz banding.</p> <p></p> <p>Figure 4 \u00a0 Test image showing fluorescent or LED light banding</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#4-notation-help-commands","title":"4. Notation &amp; Help commands","text":""},{"location":"products/ex-sensorcam/ex-sensor-manual/#41-notation","title":"4.1 Notation","text":"<p>The notation used in the reference material uses symbols according to the following convention:</p> <p>%\u00a0 \u00a0 \u00a0 used to designate a digit as part of a bank/sensor designator in bsNo style. i.e. 0/2, b/s or %/% or %% # \u00a0 \u00a0 \u00a0 used to designate a digit as part of a decimal number as in ### for a 3 digit decimal number. $ \u00a0 \u00a0 \u00a0 used to designate a single alphanumeric character (0-9 or A-Z) depending on context. S \u00a0 \u00a0 \u00a0 Capital S may be used to refer to a specific sensor such as S02 for example. Designation format: S%% [ ] \u00a0 \u00a0\u00a0 Square brackets may be used to indicate optional command arguments (don't include[] in command).</p> <p>Sensor \"bsNo.\" number consists of two digits preferably written separated by a '/' as in 1/2 but in commands this is reduced to 12 as in command i12. Command 'i' has the form i%% indicating it requires a 2-digit bsNo. As 49 is an invalid bsNo.(s range is 0-7), i49 is invalid. Some commands require a DECIMAL number and are expressed as having form t## for example. t49 is therefore a valid command. The 'm' command takes the form m$,## requiring a single digit and a 2-digit decimal number. For more details on commands see APPENDIX A.</p> <p>Where bsNo.'s are printed, they can take several equivalent forms depending on context. Where possible they are printed as %/% e.g. 2/3. However an equivalent form is 023. Any printed sensor number starting with a '0' can be treated as equivalent to the '/' form so 023 == 2/3 == bank 2 sensor 3. The 0%% form is in fact the \"OCTAL\" format of bsNo. (Note: OCTAL for 8/7 is 0107 &amp; 9/5 = 0115. Keeping usage to banks ranging from 0 to 7 avoids any confusion).</p> <p>Some diagnostic output (e.g. f%%) may resort to another numbering system  (i.e.HEXADECIMAL) for compactness, but for normal usage this notation can generally be avoided. Just be aware of the context in which numbers are being used.</p> <p>Where words are in italics, these are the actual names used in the C++ programs for sensorCAM. Consequently they may seem cryptic, but their function is hopefully clear. NOTE: sensorCAM c++ Code may use \"active\" &amp; \"enabled\" interchangeably.</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#42-help-commands","title":"4.2 Help commands","text":"<p>As the sensorCAM is still under development, the sketch still has numerous debugging options and a couple may be useful in understanding and optimizing the device. The help command has the form 'h#' where the digit# turns ON a debug output. The following h# output options might be useful, particularly h7, i.e. a triggered wait (w):</p> <p>h \u00a0 \u00a0 \u00a0 \u00a0 shows current settings for help, maxSensors and brightSF</p> <p>h%% \u00a0 sets maxSensors to%% for%% from 10 to 97 (m0,%% is better alternative)</p> <p>h0 \u00a0 \u00a0 \u00a0 some detailed debug values for each sensor including the algorithms colour Cratios, Xratios etc.</p> <p>h1 \u00a0 \u00a0 \u00a0 outputs timing measurements for parts of code</p> <p>h2 \u00a0 \u00a0 \u00a0 more general debug including brightness numbers</p> <p>h3 \u00a0 \u00a0 \u00a0 outputs i2c related info. (if communicating)</p> <p>h4 \u00a0 \u00a0 \u00a0 produces some auto-reference refresh info</p> <p>h5 \u00a0 \u00a0 \u00a0 spare</p> <p>h6 \u00a0 \u00a0 \u00a0 Outputs a text message whenever ALL enabled sensor references are refreshed.</p> <p>h7[,#] \u00a0 causes the program to suspend any new data streaming upon any trip of the bank 1 sensors, allowing inspection of sensor data by using commands like f%%, &amp; , etc. \u00a0 h7,# changes default(1) to bank #</p> <p>h8 \u00a0 \u00a0 \u00a0 This causes up to 30 i2c commands from CS to be echoed to the wait screen e.g. EOE#E7E2E2E2E4E4E4 E6 is not echoed because of its 50/sec frequency the pattern would be E4E6E6E6E6E4E6E6...</p> <p>h9 \u00a0 \u00a0 \u00a0 turns OFF all debug options.</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#5-configuration","title":"5. Configuration","text":""},{"location":"products/ex-sensorcam/ex-sensor-manual/#51-plan-a-grand-sensor-numbering-strategy","title":"5.1 Plan a grand sensor numbering strategy","text":"<p>The first step is to decide a sensor distribution strategy &amp; numbering strategy (not set in stone). A sensorCAM has 10 banks (0-9) of eight (0-7) individual sensors available (total 80). Each bank can be tested as a whole to see if ANY sensors tripped or NO sensors tripped. Also placing a string of sensors in a row, for example along a platform, can indicate train position with the binary bank value increasing as the train approaches a signal as it crosses sensors 0 through 7 (see Figure 5 for examples). Sensors are generally referred to with a two digit bank/sensor designation (their bsNo.) e.g Sensor 68 and 69 are therefore invalid bs numbers, 97 is valid. Use one bank for a platform (set of 8 sensors). Sensor S00 is reserved as a brightness reference sensor. Sensor S06 is also RESERVED for now. It is suggested that user's Sensors start with bank 1, i.e. S10 (vPin #08), S11 &amp; upwards, with related sensors in their own bank. They do NOT need to be sequential (Follow the installation Guide for full details). With the recommended definitions set up, the user does not need to remember or refer to vPins for sensorCAM sensors at all - just use the S%% idntifier.</p> <p>For an EX-Command Station(CS), the 80 sensors will have vPin numbers ranging from #00 to #79(DECIMAL) and mapped to 80 b/s id's(S00 to S97). Users can use, for example, AT(CAM 0%%) in EXRAIL commands where a vPin ID is called for. For the technically minded, vPin=BasePin+bx8+s. For further details on adopted notation, refer to section 4.1.</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#52-preset-the-wifi-ssid-and-password","title":"5.2 Preset the wifi SSID and password","text":"<p>Before uploading the software into CAM check that it has the appropriate WiFi definitions for your railway WIFI_SSID &amp; WIFI_PWD and perhaps for your test area ALTWIFI_SSID &amp; ALTWIFI_PWD are in your configCAM.h</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#53-adjust-other-configcamh-settings","title":"5.3  Adjust other configCAM.h settings","text":"<p>\u00a0 \u00a0 \u00a0 a) If i2c address 0x11 is in use, change to 0x12 (or 0x13) i.e. I2C_DEV_ADDR 0x11 in your configCAM.h  \u00a0 \u00a0 \u00a0 b) If you want to use \"larger\" sensors, Place #define SEN_SIZE 2(1-7) in your configCAM.h(ver169+)  \u00a0 \u00a0 \u00a0 c) The first TWOIMAGE_MAXBS sensors use 2 consecutive image averaging to suppress noise spikes. If you want to set a different range to use this feature, change configCAM.h from the default(030) before upload.</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#54-load-sensorcam-software","title":"5.4 Load sensorCAM software","text":"<p>Follow you-tube to pre-configure the Arduino IDE for ESP32. IF using an FTDI interface take EXTREME care not to connect 5V to the 3.3V CAM supply pin as this destroys CAMs. Using this IDE, load the software into sensorCAM with it unmounted. Then mount the CAM in a suitable place for tests. A long USB cable is problematical.</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#55-establish-a-monitor-screen-to-sensorcam","title":"5.5 Establish a monitor screen to sensorCAM","text":"<p>Establish a USB connected monitor (e.g. Arduino IDE monitor, or PROCESSING monitor, preferably at 115200 baud. The PROCESSING monitor coded for the sensorCAM has the advantage of displaying the CAM's railroad image (or selected part thereof), albeit rather slowly!). Because of the many changeable CAM parameters, the WiFi link(webCAM) is not a reliable indicator of the sensorCAM image quality. It may be better or worse. The PC (using Arduino IDE) is only able to show images via WiFi, but because the sensorCAM runs on RGB565 format it cannot send WiFi (jpeg) images without rebooting into WiFi/jpg webCAM mode (under which it cannot read sensors!). The reboot/display/reboot cycle for WiFi webCAM is also tediously time consuming.</p> <p>The sensorCAM takes some time to boot and establish sensing mode. The white flash LED starts flashing on every frame after about 10 seconds and data flows to the USB terminal. A period of averaging ensues with \"good\" sensing by about 30 seconds. This flow of data (and sensing!) can be suspended with the 'w' wait command. Some commands (including a blank line entry) will subsequently restart the sensing camera and sensor output. The CAM may crash if it is left waiting for input for over 30 minutes. Reference images would also be long out of date.</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#56-verify-wifi-webcam-operation","title":"5.6 Verify wifi webCAM operation","text":"<p>The CAM can be switched to WiFi webCAM video mode with the 'v1' command. 'v2' can select your alternate WiFi network. ('v' will give sensorCAM software version). 'v1' (or\u00a0'v2') will reboot and load WiFi mode connecting to the network selected, and providing a URL e.g. http://192.168.0.xx that can be used to connect with a browser. An image, like Figure 1 above, should be seen with controls for experimenting with Brightness etc. This image is educational but not necessarily a good indication of the sensorCAM (sensor mode) image because of the unpredictable parameter effects. To see a more reliable image run the PROCESSING SensorCAM.pde monitor instead of Arduino IDE monitor (refer Section 6.). To exit video mode, try the monitor command 'R' (or'F') If this software reset fails, try manually rebooting the sensorCAM (power OFF/ON) or via the on-board black push-button using a non-metallic tool!</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#57-familiarise-with-sensorcam-command-set","title":"5.7 Familiarise with sensorCAM command set.","text":"<p>Proceeding with the steps below, before mounting the camera over the railroad, is advisable to learn the steps and familiarize oneself with the sensorCAM command set. The setup commands will have to be repeated accurately once the CAM is mounted in its final location.</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#58-sensor-placement","title":"5.8 Sensor placement","text":"<p>Setting up the CAM first requires locating sensors. When deciding on sensor location, be aware that the sensor response is slow compared to conventional sensors. Allowing for 500mSec delay, which at 100kph equates to 150mm of travel(in HO), may influence sensor placement. Best performance is obtained if the sensors are not within 20 rows/columns of an image edge. Remember to save to EPROM with the 'e' command once satisfied. Virtual sensor location can be set up in several ways. Option d. is preferred.</p> <p>a. \u00a0 Automatic loading from EPROM on bootup. This is only applicable after an initial sensor set has been established and command 'e' used to save them to EPROM.</p> <p>b. \u00a0 The bright LED method: Place a bright LED at the required location and reduce room lighting if needed. Issue an 's%%' command (e.g. s00 for an off-track reference sensor) and wait for the CAM to scan and locate the LED and setup sensor coordinates. Remove the LED, restore lighting, and perform an 'r%%' for new reference images.</p> <p>c. \u00a0 Issue a 'k%%,rrr,xxx' command to place sensor[%%] at CAM pixel position xxx(column) and row rrr(y). This method is most useful for \"tweaking\" coordinates if you want to adjust the result of the LED method(the CAM has 240 rows/lines of 320 pixels each, numbered from 0). Use the 'i%%' command for status of sensor.NOTE: Use 'k' to set up test sensors initially, but delay setting final positions until Processing 4 installed and enhanced 'k' and 'a' available. The alternate advanced 'a' command does 3 commands in one (i.e. k, a &amp; r).</p> <p>d. \u00a0 Running Processing 4, an image can be downloaded, a bsNo. nominated by typing k%% (or a%%) and the mouse click on the image appends coordinates to k%%. Press Enter if the command is complete and correct. Similarly, the enhanced version of 'a%%' sets position, enables, and records a reference all in one command.</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#59-sensor-status-and-save","title":"5.9 Sensor status and save","text":"<p>Once a sensor has been located, the 'p$' command can show/tabulate all defined positions up to bank$. To enable a sensor use the 'a%%' command. This will enable AND record a new reference image for the sensor. It will then be included in the screen \"data dump\". Only \"enable\" sensors when UN-occupied, or do an 'r%%' later when the sensor is empty. Also, remember to do an 'e' command when you want to save positions in EPROM for next time.</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#510-set-a-sensor-threshold","title":"5.10 Set a Sensor Threshold","text":"<p>A threshold needs to be set to define the level of difference in image required to register a sensor trip or \"Occupation\". This typically ranges from 40 to 60. Try 't45' for starters. Some fluctuating lighting and electrical \"noise\" needs to be tolerated, but a higher threshold reduces sensor sensitivity for dark-on-dark contrast in particular. If there are \"noise\" trips, adjust the threshold or min2trip a little higher. See APPENDIX B for more.  </p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#511-limit-printout-to-manageable-range","title":"5.11 Limit printout to manageable range","text":"<p>It is desirable to set (using 'm') a maxSensors parameter (e.g. 030) to limit diagnostic printouts to a manageable screen width, and especially important to set the min2flip parameter which helps filter out noise trips. However min2flip slows the response to valid trips by 100mSec (frame rate) per extra count. Suggest settings of 2(default) or 3. e.g.'m3,30' say. Note: maxSensors (pulled from EPROM) limits the following....</p> <p>a. the data stream for monitor, limited to enabled sensors below maxSensors (and above minSensors)</p> <p>b. histogram printout, to enabled sensors below maxSensors (see statistics command '&amp;')</p> <p>c. the boxlt() sensor boxes seen on Processing images, for enabled sensors below maxSensors</p> <p>d. i2c buffer data for 't' record, to bsn's below maxSensors (and above minSensors)(sent to Command Station) The cmd 't' acts as a flag to prepare a packet of i2c data that the CS can reconstitute as per the USB ASCII data stream.</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#512-led-bank-trip-indicator-eprom","title":"5.12 LED bank trip indicator &amp; EPROM","text":"<p>If you want a LED bank occupancy indicator on the CAM, use the 'n$' command to cause a bank occupied LED to show (default Bank 2). nLED, min2flip, maxSensors and threshold can be saved to EPROM, along with sensor positions and twins (see 5.15 below) with the 'e' command. minSensors is not currently saved in EPROM (set by'n')</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#513-sensor-reference-image-refreshing","title":"5.13 Sensor reference image refreshing","text":"<p>Although sensor enabling (a) causes an immediate reference capture, it may be necessary to occasionally do a fresh reference capture for all sensors (make sure they are unoccupied!) by using the 'r00' command. Individual sensor references can be refreshed using 'r%%'. The results of a refresh can be seen in the scrolling \"data dumps\" of enabled sensors, their \"difference scores\" (32-99), and their perceived occupancy state. The sensor S00 is constantly averaged and refreshed every 6.4 seconds. Furthermore, there is an automatic refresh process that cycles through enabled sensors and regularly averages 32 consecutive sample images. If the sensor remains unoccupied, it updates the reference, compensating for slow lighting changes. This is SUSpended initially (after Reset) until an 'r%%' command is issued by the user, after which \"SUS\" will disappear from the output data. The latest version of sensorCAM ASSUMES the sensors are all empty, and automatically ends SUSpend mode early.</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#514-scrolling-data-interpretation","title":"5.14 Scrolling data interpretation","text":"<p>The scrolling data dump displays \u201cSUS\u201d (suspend) if auto updates are off. It also displays threshold(T), min2trip(M), the bank assigned to the on-board LED (N), S00 reference diff. score, as well as the S00 reference brightness(R) and its current actual brightness(A) and other enabled sensors. \u2018A\u2019 is the Actual latest sum of the 48 bytes of a sensor image (max 3024) and should be between 1200 and 2500 ideally. Following a reference refresh (r), for an unoccupied image, the (noisy) diff scores should be 32-37. If references are being updated, a note will appear at the right hand side of the data dump in the form of \u201cRef 0%%\u201d to indicate that a new reference for an UNOCCUPIED sensor has occurred. This dump allows for performance monitoring during commissioning. :oo46## indicates tripped sensor (## = occupied) sensor are shown by default with a central diff score (32-99). :?-46-? indicate an above threshold image potentially occupied (waiting for min2trip). :oo47?T indicates suspected occupied but no confirmation from Twin (see 5.15).</p> <p>Using the '@##' command, the \"#\" \"tripped\" indicator (35) can be changed to any ASCII character (01-127). For recent versions of Arduino IDE monitor, '@' or '@12' command gives a particularly wide BOLD \"spade\" occupied character that is easier to spot (don't use @ or @12 if it doesn't produce the \"spade\" as it will misalign columns. Try @11 instead.).</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#515-second-opinions-twin","title":"5.15 Second opinions (Twin)","text":"<p>If necessary, another option can be tried to address \"noise\" trips if all else fails. It is possible to \"get a second opinion\" on a sensor by assigning a \"Twin\" sensor (using i%%,$$). For example if sensor S15 is prone to noise trips, set a Twin using sensor S05(say). Set up the Twin position to touch or slightly overlap the primary sensor(S15) with the commands \u2018a05,rrr,xxx\u2019. The primary sensor will not register \u201cOccupied\u201d (tripped) unless the Twin agrees. Note: The Twin should have a bsNo less than the primary sensor to avoid introducing an extra 100mSec delay to the trip time as the lowest bsNo is evaluated first. We suggest using bank 0 for twins, or a lower number in the same bank.</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#516-other-diagnostic-commands","title":"5.16 Other diagnostic commands","text":"<p>There are other commands that can be used to optimise the CAM performance by trial-and-error. These include Frame(f), GetCAMsettings(g), adJustCAMsettings(j) and Statistics(&amp;), also Calibrate(c)(not recommended). If the scene contrast is inadequate, a lighter reflector between the tracks is a cure particularly in fiddle yards (e.g. light green grass).</p> <p>Explore and familiarize: Operational output commands will give the sensor states and include Individual(i), Bank(b), Diff(d), Position(p), &amp; Query enabled(q). Other input sensor commands include Zero(o), One(l), Enable(a), Undefine(u) &amp; the define coordinate(k) command. Zero 'o'(oscar) and One 'l'(lima) preset and disable sensors.</p> <p>NOTE: Historically the term \"activate\" has been used in the CAM program rather than \"enable\". In the context of sensorCAM, activated means \"enabled\" rather than output \"1\" as typically may be used in EX-CS sensor documentation. This manual has been rewritten to use the \"enabled\" terminology, but names and references in the actual program still use the original terminology, so interpret \u201cactivated\u201d, in a sensorCAM context, as \"enabled\". Sensor output is referred to as \"tripped\" (1/occupied) or \"untripped\" (0/unoccupied).</p> <p>Test image with Fluorescent or LED lighting - note three faint dull stripes across white test panel in Figure 5 below. Strong banding is also evident in Figure 4. Horizontal stripe position varies frame-to-frame as not effectively synchronized with mains yet. (Figure 5 image was obtained using V, H &amp; Y60 Processing commands)</p> <p>The mains supply synchronization is currently inadequate (ESP32-CAM limitation) so drifting illumination bands will add a little to the \"noise\" seen by the sensors. The significance of this may need evaluation by experiment.</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#517-pvtthresholds-sensor-size","title":"5.17 pvtThresholds &amp; sensor size","text":"<p>Two additional features have been added which may resolve lingering issues. Individual thresholds can be set to override the \"global\" threshold set with 't##'. The command 't##,%%' will set a pvtThreshold for sensor S%% replacing the \"global\" (t##) value. It can be removed with the 't00,%%' command. This way a higher threshold can be set on a \"noisy\" sensor.  While an increased pvtThreshold may reduce its sensitivity, it has no effect on the other sensors. 't1,%%' will cancel all pvtThresholds in one bank, while 't1,99' cancels ALL pvtThresholds in the CAM.</p> <p>The second feature enables the size of the sensor to be increased. This is done by inserting spare pixels in a cross(+) through the 4x4 sensor moving 4 pixels out to each of the corners of a larger footprint. The parameter SEN_SIZE (default 0) adds from 1 to 9 rows of spare pixels. This parameter is set in configCAM.h and may, for example, allow a sensor to be placed so as to register a greater variation in pixel values. A uniform 16 identical pixels is less effective than ones capturing various colours/shades. If it can include a shadow of a passing loco/wagon, then the \"diff\" can be stronger and a more positive trip attained. A footprint size increase affects ALL sensors.</p> <p>It is desirable to place sensors where they generate a \"mottled\" image of pixels rather than a uniform colour which makes distinguishing grey roofs against plain grey track hard. Pixel size is therefore relevant. It is helpful if the pixels are the width of sleepers so they can be distinguished. If they can't then try an offset sensor that sees track bed and trackside grass/shadows say. Table 1 indicates pixel/sensor sizes relative to sleepers and track gauge. It shows that sleeper detection is limited with the ov2640 QVGA (240x320) resolution. Future sensorCAM variants may do better.  An angled camera (less than 30degrees) could benefit from a glimpse of the side of the loco/coach/wagon and increase the field of view, but parallax issues may arise.</p> OV2640 CAM(std.  lens) field of\u00a0view 54 deg CAMERA HEIGHT: (mm) 800 800 1000 1000 1200 1200 1500 1500 1800 1800 app. image width (mm) 810 810 1016 1016 1220 1220 1525 1525 1830 1830 QVGA pixel size (mm) 2.18 2.18 2.73 2.73 3.27 3.27 4.09 4.09 4.91 4.91 SEN_SIZE: setting 0 2 0 2 0 2 0 2 0 2 Sensor Size (pixels) 4x4 6x6 4x4 6x6 4x4 6x6 4x4 6x6 4x4 6x6 ratio:gauge/sensor scale sleeper std gauge O  1:43 5 32 3.7 2.4 2.9 2.0 2.4 1.6 2.0 1.3 1.6 1.1 HO 1:87 2.5 16.5 1.9 1.3 1.5 1.0 1.3 0.8 1.0 0.7 0.8 0.6 TT\u00a01:120 1.8 12 1.4 0.9 1.1 0.7 0.9 0.6 0.7 0.5 0.6 0.4 N 1:160 1.3 9 1.0 0.7 0.8 0.6 0.7 0.5 0.6 0.4 0.5 0.3 (mm) (mm) <p>Table 1. Comparison of sensor sizes and track features  Ratio of gauge/sensor dimension</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#6-processing4-monitorconsole","title":"6 PROCESSING4 monitor/console","text":"<p>Figure 5 \u00a0 Processing 4 Console and image window  \u00a0 Note: Sub-optimum 'c' settings caused green tint.</p> <p>The Processing application displays the image using sensorCAM settings, and also shows colour coded sensors. As previously stated, the PROCESSING application is a crude USB monitor that enables the user to control and configure the sensorCAM with the additional benefit of being able to invoke a display of the image. All the sensorCAM commands can be used. At 115200 baud, a full RGB565 image takes 13 seconds, but it is often convenient to reduce this by prescribing a smaller image segment of limited rows and/or columns(e.g. Y120 for lower half of a 240 row screen). The Processing 4 application can be downloaded from here</p> <p>The SensorCAM.pde code assumes the USB port for the sensorCAM is the lowest (comNo=0;) on the list displayed on startup. Should this not be the case, for example if another USB is being used to simultaneously run an IDE to a Command Station, then the comNo=0; code line (15) of the sensorCAM.pde will need to be increased to, for example, int comNo=1; You may also increase the image display window size by editing the final int SF=2; line (16) to =3; or =4; on high res. screens.</p> <p>The sensorCAM Processing 4 monitor accepts commands W, X, Y &amp; Z which allow one to nominate a \"strip\" or subsection to image. e.g. Z80 X240 Y will update the last quarter image(columns 240-319) of the 240x320 pixels in 4 seconds. This shortcut method enables, for example, comparison of quarter images under different lighting conditions by using different X values. Similarly W60 Y120  will produce a quarter image from row 120. Each part image is pasted over previous images. Each new image appears more quickly if only a subsection is specified this way. The next image can be flipped Vertically(y) and Horizontally(x) by using V &amp;/or H before capture. The Figure 5 image used  V H Y60  The values for V, H, W, X &amp; Z are remembered for subsequent 'Yrrr' commands so need not be repeated. NOTE: Do not flip image before creating new sensors as cursor coordinates don't flip!</p> <p>The image will have enabled sensors (b/s) boxed and identified by a (resistor) colour code. Left bar is bank# and right bar is sensor#. Combined, they give the bsNo. If two sensors have the same coordinates, the colour code will be for the highest bsNo. N.B. Only sensors below maxSensors will be boxed. Note the 'H' command will REVERSE the coding from b/s to s/b. (The std. resistor code is 0:black 1:brown 2:red 3:orange 4:yellow 5:green 6:blue 7:violet 8:grey 9:white)</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#processing4-command-summary","title":"PROCESSING4 command summary:","text":"<p>W### \u00a0 will limit the image to ### rows wide/high(1-240) - default 240</p> <p>X### \u00a0 will start the image from column ###(0-319)-default 0 - uses the sensorCAM 'x' command.</p> <p>Y### \u00a0 will initiate an image download starting at row ###(0-239)-default 0 - uses the sensorCAM's 'y' cmd.</p> <p>Z### \u00a0 will limit the image to ### columns(1-320)- default 320 - uses the sensorCAM 'z' command.</p> <p>H \u00a0 will flip/mirror subsequent images horizontally(x).(Note: reverses bsNo sensor colour code to s-b!)</p> <p>V \u00a0 will flip/mirror subsequent images vertically(y). (V + H effectively rotates image 180 degrees)</p> <p>R \u00a0 will cause a firmware reset of the sensorCAM via the DTR line of the FTDI interface. CAM will enter a wait mode for confirmation. Reset can be aborted with command 'aw'(Abort&amp;Wait). Ctrl-R Resets CAM instantly.</p> <p>NOTES:</p> <ol> <li> <p>The above commands ARE CASE SENSITIVE. They are recognized by Processing 4 as non-sensorCAM commands and processed in the monitor/PC. Commands X, Y &amp; Z in turn automatically issue related sensorCAM commands x, y &amp; z respectively, with appropriate parameters. The 'y' command is used repeatedly, once for each new image line(row). The 'y' command suspends sensorCAM immaging, holding a single \"frozen\" frame until a terminating command ('yy') is received. To resume normal operation at the end of command 'Y', the double-y command 'yy' is automatically sent. However, if the user enters a'y' by error (rather than upper case 'Y'), the monitor may show a binary string of data(verbose mode) and a manually entered 'yy' is needed to recover. Typing lower case x or z may also negate any previous X or Z settings.</p> </li> <li> <p>If you use H to mirror, the colour coding for boxed sensor number (b/s) has to be read right to left.</p> </li> <li> <p>Ctrl-E and Ctrl-N enable/disable echo of commands, as typed, to the monitor/log file. It can replace the user's focus on the CAM image Cmd: window. YO helpfully toggles the verbose mode. The command Y images from row 0 by default.</p> </li> </ol>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#7-wiring-requirements","title":"7 Wiring Requirements","text":"<p>Refer to Figure 7 and Appendix F for alternate solutions for connecting sensorCAM to an i2c bus for remote control. For initial testing, the basic ESP32-CAM and ESP32-CAM-MB (CH340 based USB Mother Board) could be sufficient.  Take care to use level shifting(PCA9515A or Endpoints) if using a 5V mega CS.</p> <p>The recommended hardware interface to a CS is currently the Sparkfun Endpoint system which permits the i2c bus to be run over long standard Cat5 twisted pair cable, which can also carry the required raw power supply. The Sparkfun Endpoints are used in pairs and can cater for voltage shifting between 5V Command Stations(e.g. Mega) and 3.3V sensorCAM as required. For the very simplest off-the-shelf arrangement, an ESP32-WROVER-DEV CAM with a cheap ESP32 breakout board including regulator can be linked to an Endpoint with 4 Dupont wires for a working CAM system on the end of a cat5 cable of considerable length as indicated in Figure 6, needing only a remote, preferably electrically isolated (floating), 9-12Vdc 0.5A power supply and a matching Endpoint on a Command Station.  For a cheaper solution, use the PCA9515 with dupont jumpers for a limited (2m?) reach with either esp32-CAM or Wrover-CAM. Note: The Sparkfun Endpoint may also need a jumper cut or joined for i2c bus voltage level matching to the Command Station.  </p> <p>The SensorCAM software has been almost exclusively tested on the ESP32-CAM-MB as seen in Figure 7. The original prototype was fitted with some enhancements that may not be needed for the user's application, such as an external antenna and extra LED indicators. NOTE that an Antenna attachment to the ESP32-CAM requires a solder link adjustment on the CAM (refer you-tube CAM tutorials) but most wi-fi works with the on-board antenna. However, at least one \"super bright\" LED (the \"programmable nLED\") is recommended for convenience to visually indicate when a sensor is \"tripped\", connected between 3.3V via a resistor (~470R) to GPIO14.</p> <p>For testing beyond that available via a USB cable, the most basic interface to a short i2c cable to a Command Station (Mega) is based on the PCA9515A level shifter shown in Figure 7. This is limited in range and may require tuning of the i2c bus for best performance. See Appendix F for a more capable Sparkfun Endpoint configuration using a separate 5V switching regulator, at a small increase in cost, reliability and effort.  The connection cable between PCA9515A and CAM may be up to 2m long for extra reach. </p> <p>The ESP32-WROVER-DEV board is a good alternative to the ESP32-CAM-MB. The slightly bigger CAM will be a little more convenient with the ESP32S 38P Expansion board. This 38 pin expansion board with 5V regulator is described in the video below. IGNORE PRESENTERS DESCRIPTION OF HIS FAULTY 5V REGULATOR past the 5minute mark. With NO Wrover, verify the regulator gives 5V from 9V at the barrel jack and remove power before inserting or removing the Wrover. For want of a better video...</p> <p>ESP32S 38P/V4/ Expansion board</p> <p>The SensorCAM software has been almost exclusively tested on the ESP32-CAM-MB as seen in Figure 7. The original prototype was fitted with some enhancements that may not be needed for the user's application. However, at least one \u201csuper bright\u201d LED (the \"programmable nLED\") is recommended for convenience to visually indicate when a sensor is \u201ctripped\u201d, connected between 3.3V via a resistor (~470R) to GPIO14.</p> <p>The ESP32-CAM reset button, remotely mounted on CAM, may be difficult to access. To reset the device, two options need to be available. These can be via software command, either from the attached USB monitor, or i2c connected Command Station, or via a power supply induced reboot. A switch at the (\u201cwall-wart\u201d) 9V supply is recommended independent of the CS supply. The USB connection is needed to set up the sensors initially and view images, but should be able to be disconnected once setup testing is complete. Some esp32's may need a 1uF on the reset pin for reliable reset.</p> <p>Note: Care is needed as the WROVER CAM has 40 pins (not 38) but the spare end Gnd and Vcc can remain disconnected (cut off?).</p> <p></p> <p>Figure 6 \u00a0 ESP32 WROVER-CAM and interface</p> <p></p> <p>Figure 7 \u00a0 PCA9515A 3.3V to 5V i2c interface improvisation compared to a full feature prototype solution  \u00a0 Note: for 3.3V microprocessors (e.g. CSB1) ensure Vcc1 is connected to 3.3V (Vcc0) not 5V.</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#8-host-communication","title":"8 Host Communication","text":""},{"location":"products/ex-sensorcam/ex-sensor-manual/#81-intro","title":"8.1 Intro","text":"<p>The operation of the railway depends on a Control Station that polls the sensorCAM for sensor states. This might be a dedicated Arduino Mega 2560 for example. It might be a CSB1 Command Station running DCC-EX and EXRAIL software. If the sensorCAM is powered up with default settings (from EPROM), or adjusted by the user at the start, the program need only talk to sensorCAM over an i2c bus using the commands a,b,i,l &amp; o for example, or it may be more sophisticated, providing a channel from a Control Station console to the sensorCAM to enable all configuration commands via the i2c bus.</p> <p>The i2c bus is running at 100kHz on the prototype software. It has not been tested at any higher speed yet. It is running fine over a 20m long i2c bus to the master microcontroller(mpu or Mega).</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#82-dcc-ex-command-station","title":"8.2   DCC-EX Command Station","text":"<p>Setting up a DCC-EX Command Station, should you have one, requires configuration details placed in files config.h and mySetup.h along with a driver IO_EXSensorCAM.h and myAutomation.h. These must go in the directory containing file CommandStation-EX.ino. The IO_EXSensorCAM.h driver is based on the modified IO_EXIOExpander.h code. Refer to APPENDIX H for installation details. EXSensorCAM.h code mirrors the i,I,o,t &amp; m commands, while the EXIODPUP command may serve as the enable function(a). EXIOExpander.h codes don't have the \"control &amp; setup\" sensorCAM functions otherwise available from a USB console so additional functionality was added using the DCC-EX sensorCAM native command&lt;N&gt;(if using the newest CamParser.cpp).</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#83-non-dcc-ex-system","title":"8.3 Non-DCC-EX system","text":"<p>Proprietary Master:  If writing raw code for another Command Station, you will need details on the protocol used by sensorCAM on the i2c bus, and code to interpret the bus bytes and reconstitute text for the console. Two such prototype examples exists. V155 of sensorCAM incorporates a subset of the DCC-EX IOexpander codes so that EXRAIL can use sensorCAM without further modification. V301 &amp; later mostly use ASCII code characters.</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#84-monitor-lighting","title":"8.4 Monitor Lighting","text":"<p>Stable good lighting is needed.  Gross Lighting changes will have two effects, namely cause trips of most sensors and stop automatic reference refreshes, it may be wise to include monitoring for this eventuality by detecting and setting an \"alarm\" state. The reference sensor(S00) is automatically re-referenced every 6.4 seconds so will indicate a fault-trip for a maximum of 6.4 seconds. All other sensors will continue to indicate a trip until the user resets the references with an r00 (having checked all unoccupied). Setting up a second \"reference\" sensor (say S01) that would NOT get reset automatically and would stay tripped as a more enduring fault indicator could be helpful. You could reserve entire bank 0 for this purpose or use the 'nO' command to set the programmable pLED to light up if there is any enduring trip on bank 0.  Consider using the \"qLED\" GPIO2.   By default BLKOLED was set to GPIO2 LED, with BLK1LED to BLK3LED all set to GPIO33 LED. PLED is set to GPIO14.</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#9-methodology-of-operation","title":"9. Methodology of operation","text":""},{"location":"products/ex-sensorcam/ex-sensor-manual/#91-overview","title":"9.1 Overview","text":"<p>The sensorCAM monitors up to 80 small square images (virtual sensors) each consisting of 16 pixels (4x4) the coordinates of which relate to the row/column of the top left pixel. The top left pixel of the QVGA (240x320) image is an r,c coordinate of 0,0. Sensors with coordinate 0,0 are considered \"undefined\". Sensors are electrically \"noisy\", so much effort was applied to avoid noise trips.</p> <p>After boot-up, every virtual sensor is imaged and a Sensor_ref[ ] recorded. This is a ONE frame grab as a first guess.  All sensors should preferably be un-occupied at boot up. If not, the user will have to manually take reference grabs at an appropriate time using the 'r%%' commands. The 'r%%' also triggers an IMMEDIATE start of a 3.2sec average Ref for S%%. 'r00' triggers a 1 frame reference refresh for ALL sensors but also starts the auto reference process, as does r%%. The latest version, at boot-up, commences regular averaged reference updates assuming all unoccupied.  If an \"occupied\" state occurs during the averaging, the averaged ref. is rejected.</p> <p>Every 100mSec the sensor pixels are decoded from the RGB565 QVGA image(2-byte) into RGB666 3-byte format and compared with the reference sensor image (in Sensor_ref[]) for changes. To allow for drifting light intensity, Sensor_ref[] needs to be periodically updated. The automatic updates occur for each enabled sensor(0/1 through 9/7 sequentially, each using a 32 sample average (in ~3.5 seconds) and replacing the old Sensor_ref[] provided there were no \"trips\" of the sensor during the sample period (3.5sec.). Hence updates occur only when sensor is UNoccupied, and only once every Nx3.5sec.(N being the number of enabled sensors). The brightness sensor(S00) is updated independently every 6.4 seconds with a 64 sample average. Each update is flagged to the monitor as it occurs(as \"Ref 0%%\"  ). It is inadvisable to leave a sensor occupied for long periods if best reliability is desired. If a sensor is occupied for long periods of drifting illumination, the ref can become out-of-date to an extent that the sensor can remain PERMANENTLY \"occupied\". Manual re-referencing (r%%) would become necessary.  EXRAIL code may accomplish this.</p> <p>To detect a \"trip\" of a sensor, an algorithm evaluates a \"difference\" score between Sensor666[] and Sensor_ref[]. The (bpd) score is a brightness plus colour-diff sum. This (bpd) score is compared with the threshold ('t##') value. If it exceeds threshold, a flag is set and if after min2trip frames it remains set, then the Sensor \"trips\". It will then fall back (untrip) if min2trip frames go below threshold. min2trip is set to 2 by default as 3 will give an extra +100mS delayed response. The monitor data stream (scroll) includes the bsNo.%%, potential for trip ?- , the bpd score, or actual trip oo__##. If a twin (see below) inhibits trip, it indicates this with ?T. Minimum bpd score is 32 (identical). e.g. (using t45) \u00a0 \u00a0 12:--38--* 13:?-46-?* 14:oo50##* 15:?-53?T* 16:--35--* \u00a0 \u00a0 Only S14 has tripped.</p> <p>A \"second opinion\" may be used to maintain a quick \"trip\" with greater reliability. This involves setting up a second \"twin\" sensor adjacent to the primary sensor. The primary sensor will only trip if the secondary sensor agrees (e.g. example for S15 above). The 'i%%,$$' command nominates a twin sensor (S$$) for sensor S%%. The (non-S00) twin should have a lower bsNo. than the primary to avoid extra delay, as they are evaluated in ascending bsNo. order.</p> <p>As the sensor image suffers from excessive noise at low light levels, another averaging process has been included. For bsNo's below 3/0 (parameter TWOIMAGE_MAXBS), two consecutive images are averaged to remove noise spikes. The effect can be observed if one watches two sensors with the same coordinates but above and below 3/0, and with a suitably low temporary threshold. This cutoff point(3/0) can be moved to higher banks as well by editing the #define TWOIMAGE_MAXBS 030 statement in sensorCAM.ino or configCAM.h </p> <p>The sensor size can be padded out(enlarged) with dummy pixels using #define SEN_SIZE 2 in file configCAM.h</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#92-algorithm-description","title":"9.2 Algorithm description","text":"<p>The algorithm fo r bpd is weighted heavily towards colour changes rather than brightness.  The default brightness scale factor is set to 3 ('b10,3') but can go higher. This reduces the sensitivity to mains frequency flicker and drifting light intensity (e.g. daylight).  The algorithm for comparing colours is somewhat complex and may well be improved in later versions.  The focus of detection is changing colours as opposed to changing brightness.  To this end each sensor (4x4) is divided into four quadrants of rgb colour.  The colour brightness factor is removed by an algorithm computing the colour ratios r/g g/b b/r in each quadrant. These ratios are compared to that of the reference image for changes. The process in more detail is as follows:</p> <p>Each sensor is split into 4 quadrants (quad), each quad has 4 pixels of 3 colours (48 x 6-bit bytes in total)</p> <p>The sum of all 12 bytes(4x3) in a quad is found as a quad brightness (4 off) and the sum (4) of each colour (rgb) for each quad is found giving a total of 12 colour sums (3 colours x 4 quads) plus 4 brightness values.</p> <p>Within each quad, 3 colour ratios are calculated for Red/green green/blue blue/red(largest(x32) divided by smallest(any 0 changed to 1) to give 12 colour ratios, each &gt;=32 (32 if identical) (placed in array Cratio[12])</p> <p>Compare the values in Cratio[12] with the reference array (precomputed from Sensor_ref[]) and find the maximum \u201cXratio\u201d between the two sets of 12 \u201cCratios\u201d using the same formula (giving Xratios of 32 to 2016)</p> <p>Set maxDiff to the largest ratio for a sensor from the 12 \"Xratios\"</p> <p>A brightness score is similarly calculated between the full ref. brightness and that for the current sensor using formula 16x bright/Sen_Brightness_Ref[bsn]-16. It is scaled to give a value from 0 upwards. With brightSF =2, a score of 2 represents about 7% brighter so is relatively insensitive. Code uses int so &lt;=6% difference gives a 0 score.</p> <p>The \"diff\" score(bpd) comprises of (bright_x_brightSF+maxDiff) (&gt;=32) and is weighted towards colour difference+small brightness component (of 2 for 7% change).</p> <p>The diff (bpd) is compared to threshold for a decision on trip state. If greater than threshold, several additional checks are made including requiring 2 (min2trip) consecutive frames to exceed threshold, averaging pixels over two frames, and possibly confirmation from a twin sensor. These contribute to an additional response time delay (+100mSec).Furthermore the reference image is normally based on a 32 frame average pixel to eliminate any \u201cnoise\u201d in the sensor reference itself.</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#93-program-summary","title":"9.3 Program Summary","text":"<p>Once the sensorCAM parameters and environmental conditions are set, the sensorCAM will run continuously, looping once per 100mSec. Each loop takes the following steps:</p> <p>1.//*IF IN MYWEBSERVER MODE, JUST MONITOR SERIAL PORTS FOR RESET (R* or F)</p> <p>2.//**CALCULATE AND PRINT LOOP TIME-&amp; IF CALLED FOR, UPDATE NEW CAMERA SETTINGS</p> <p>3.//**TAKE A FULL FRAME INTO fb IN RGB565 FORMAT</p> <p>4.//**DECODE RGB565 FRAME INTO COMPACT SENSOR FRAME OF RGB666 FORMAT</p> <p>5.//**SEE IF IMAGE DUMP(TO PROCESSING4) CALLED FOR&amp; DUMP AS REQUESTED BEFORE NEW FRAME INITIATED</p> <p>6.//**BEFORE DISCARDING RGB565 fb FRAME, CHECK IF NEEDED TO PROCESS A sCAN or cALIBRATE COMMAND REQUEST</p> <p>7.//**DO A STEP TOWARDS AVERAGING Sensor[bsNo] IF COUNTER SET.</p> <p>8.//**CALCULATE ROLLING AVERAGE FOR Sensor[00] AND AVERAGE NOISE(&amp; PEAK NOISE?)</p> <p>9.//**DELAY TO REDUCE FRAMES PER SECOND FROM one/80mS to one/100mSec FOR PSRAM 25% IDLE(DE-STRESS) TIME.</p> <p>10.//**FOR FLUORESCENT LIGHTING TRY TO SYNCHRONISE release/start image WITH 50Hz MAINS USING INTERNAL CLOCK</p> <p>11.//**IF CALLED FOR BY c####, OR STARTUP(), DO A FULL REFERENCE UPDATE FOR ALL ENABLED SENSORS</p> <p>12.//**NOW WANT TO CLEAR CAMERA PIPELINE&amp; START NEW IMAGE CAPTURE FOR NEXT LOOP</p> <p>13.//**DO COMPARE OF ALL SENSORS WITH THEIR REF'S, DECIDE IF OCCUPIED\\&amp; IF SO SET STATUS.</p> <p>14.//**USE 2 image average for compare only if bsNo&lt; TWOIMAGE_MAXBS as a method for improving algorithm.</p> <p>15.//**CHECK DFLAG AND OUTPUT REQUESTED INFO FOR'd' cmd</p> <p>16.//**FLASH A LED ON EACH LOOP. Use FLASHLED pin</p> <p>17.//**CHECK FOR USB COMMAND INPUT- PROCESS ANY COMMAND</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#appendix-a","title":"APPENDIX A","text":""},{"location":"products/ex-sensorcam/ex-sensor-manual/#cam-command-summary","title":"CAM Command Summary","text":"<p>rev 1DEC25</p> <p>Introduction</p> <p>Holds up to 10 banks (0-9) of sensors. Each bank can have up to 8 enabled sensors (0-7). Bank/sensor (%%) up to '97'.  Array Sensor[n] holds coordinates(rx) of sensor n.  Sensors are grouped into banks(b) of sensors(s). e.g. bsNo 6/7 identifies bank 6, sensor 7 (n=8x6+7=55=067). Sensors are undefined if coordinates(rx) are set to 00. They are disabled if SensorActive[n] is set to false. If a sensor detects differences, then any output LED (e.g. pLED, qLED) assigned to the associated Bank of sensors should turn ON. On reset (power-up), reference grabs are taken for all defined (in EEPROM) sensors, and then enables them. To define a sensor, use 'a' command,  Processing4, or (outdated method) a bright LED on the desired spot and dim lighting with a \"scan\" (s%%). Save in EEPROM (e). SensorCAM uses RGB565 image format which is incompatible with JPG, so auto reboots between SensorCAM or webCAM modes occurs.</p> <p>Serial Command USB format </p> <p>a%%[, rr, xx] enAble Sensor[%%] &amp; refresh Sensor_ref[%%], cRatios etc. 4x4 from image in latest frame. (Note 20.)</p> <p>b#[,$] Bank # sensors. Show which sensors OCCUPIED(in bits 7-0).(1=occ.)(b#,$ sets brightSF to $)</p> <p>c$$$$ reCalibrate camera CCD occasionally and grab new references for all enabled sensors(Beware of doing this while any sensors are occupied) N.B. Obstructed sensors will later need an r%%. Check all bank LEDs are off AND check all sensors are unoccupied before recalibrate. Can set AWB AEC AGC CB through $$$$ e.g. c0110 Also able to change default setting for Brightness, Contrast &amp; Saturation with extra digits e.g. c$$$$012</p> <p>d%%[,#] *Difference score in colour&amp; brightness between Ref &amp; actual image. Show # grabs.</p> <p>e EPROM save of any new Sensor offset positions, pvtThresholds, new twins and 5 default parameter settings.</p> <p>f%% *Frame buffer sample display. Print latest bytes in Sensor_ref[%%] &amp; Sensor S%% positions.</p> <p>g *Get Camera Status. Displays most current settings available in webcam window (both sensor &amp; video mode).</p> <p>h$[,#] *Help(debug) output.  h9  to turn all OFF,  h0  turn ON detailed USB output. 'h7,#' \"Waits\" scroll on a bank# trip.</p> <p>i%%[,$$] Info. on S%%.  Status(enabled/occupied), position(r,x), any twin(S$$), pvtThreshold &amp; brightness.</p> <p>j$# *adJust camera setting $ to value # and display most settings (as for 'g'). 'j' alone lists options for $#.</p> <p>k%%,rrr,xxx *set coordinates of Sensor S$$ to row: rrr &amp; column: xxx. Follow with  r%%. Verify values with p$. </p> <p>l%% \u00a0 \u00a0 \u00a0 (Lima) Latch sensor S%% to on(1 = occupied(LED lit) &amp; also set SensorActive[%%] false to disable sensing.</p> <p>m$[,%%] *Minimum $(1-4) sequential frames over Threshold to trigger/trip sensor. Shows list of parameters. (Note 14)</p> <p>n#[,%%] nLED bank Number assigned to the programmable status nLED. Optional  n10,%%  to set minSensors.</p> <p>o%% \u00a0 \u00a0 \u00a0 (Oscar) force Off sensor%% (0=UN-occupied, LED off) Also set SensorActive[##] false to disable updating.</p> <p>p$ *Position Pointer table info for banks 0 to $ giving DEFINED sensor r/ x) positions.  p%% shorter.</p> <p>q$ *Query bank$, to show which sensors ENABLED(in bits 7-0). 1=enabled. q9 gives ALL banks.</p> <p>r%%[,0] Refresh Average Sensor_Ref[##] (if defined), enable &amp; calc. cRatios etc. r%%,0 refreshes block S%0 to S%%. </p> <p>r00 Refresh Average Refs etc. for ALL defined sensors. Ignores enable[]. Sensor[00] reserved for brightness ref.</p> <p>s%% *Scan for new location for sensor  S%%(00-97). If found, records location in Sensor[0%%]. (Note 12)</p> <p>t##[,%%] Threshold level##(31-98 only) set as default. [t##,%% sets the pvtThreshold for sensor %% (t0,%% to clear)]</p> <p>t## Tabulates ##(2-30 only) rows of scroll data (continuous scroll toggled off) Note: t1 alone toggles scroll on/off.</p> <p>t1,%% Trash 1 entire bank of pvtThresholds. Use t1,99 to clear ALL banks (0-9). Note: t99 lists all pvtThresholds</p> <p>u%% *Un-define/remove sensor %%  (Sensor S%%=0 &amp; set DISABLED) u99 for ALL. 'e' will erase from EPROM.</p> <p>v[1|2] Video mode. Causes reboot as a webserver. 'v2' will connect to  2nd (alt.) router ssid.(v or v0 for version)</p> <p>w *Wait for new command line (\\n) before resuming sensing (handy to freeze display data scroll - see t1 toggle)</p> <p>x### \u00a0 \u00a0 \u00a0 *selects first pixel column(0-319) &amp; z### selects image width (### columns(1-320)) for imaging.</p> <p>y### \u00a0 \u00a0 \u00a0 *selects first row for image and initiates a binary data dump for that row (header + #x2 bytes) using rgb565.   \u00a0 \u00a0 \u00a0 \u00a0 This command starts a process that must, after a series of 'y' commands, end with a terminator of 'yy'.</p> <p>R &amp; F Reset commands- will Reset CAM and initiate the Sensor mode. Both will Finish the WebServer('v*') mode.</p> <p>\\%,#,$ \u00a0 \u00a0  Convert bank to linear sensor starting with  S$$  and using r,x step sizes of #,$(0-31) Slope is \"down-right\".</p> <p>/%,#,$ \u00a0 \u00a0  Convert bank to linear sensor starting with S$$ as for '\\' but line will slope \"down-left\" (-deltaX).</p> <p>&amp; statistics histogram on trips and potential trips since last '&amp;', then reset counters and start another sample process. The table gives number of single highs, double highs etc. and totals for No. of frames/run time</p> <p>@## \u00a0 \u00a0 \u00a0  *set the \"occupied\" symbol in the scroll to ASCII character ##. Default is 35(\"#\") Arduino IDE @12 is bolder!</p> <p>+#,$ \u00a0 \u00a0 \u00a0 *add offset(# pixels) in $ direction to re-centre sensors after physical drift in CAM alignment. $(0-7) for N-NW</p> <p>\u00a0 \u00a0 \u00a0 * These commands typically for diagnostic/setup use only. They wait for a line feed or command to resume.</p> <p><code>Note: The value of \"bs\"(80 sensors 0-79dec) is printed in several formats. For data entry, bsNo format %% (e.g. 47) is bank/sensor, so bsn=8*4+7=39dec.(vpin). S47 may be printed as (char) 47, 4/7, (octal) 047,(or hex 0x27) depending on context. Debug output likely uses OCT(or HEX). Note: OCT 0107=8/7, 0117=9/7.</code></p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#startup-notes","title":"Startup Notes:","text":"<ol> <li>Normal power up reset will initiate Sensor mode, as will the 'R' command, and uses EPROM data settings.</li> <li>Sensor mode startup flashes white LED at 10Hz after ~10 seconds, and exhibits a \"flicker\" at ~20 seconds.</li> <li>Requested (v1) WebServer mode reset will flash LED at ~3seconds and again (brighter) at ~8 seconds.</li> <li>After the 8 second flash the Webserver will be operational at web address 192.168.0.xx (xx from display).</li> <li>If the OV2640 camera or WiFi fails to initialize, the CAM resets and may restart/revert into Sensor mode.</li> <li>If USB FTDI/MB is removed or not connected to PC, then WebServer may fail/reboot. Power issue?</li> </ol>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#i2c-command-notes","title":"I2C command Notes:","text":"<p>(EX-CS may exhibit small variations &amp; reduced cmd functionality refer APPENDIX C)</p> <p>(EX-CS may exhibit small variations &amp; reduced cmd functionality refer APPENDIX C)</p> <p>1. The same commands are valid from an I2C Master Arduino, but there are some variations. 2. The commands with asterisks normally pause CAM execution so the operator can read USB output on a monitor screen. The same commands from I2C DO NOT wait for a new line, with the exception of 'w'. 3. Commands b,d,i,m,p,q&amp;t can return data to the I2C master Arduino(Mega). This data is delivered if the master calls a Wire.requestFrom(addr,#); following the command, from the slave CAM address 17(0x11). 4. The I2C data returned(after header byte) is in binary bytes and in a format depending on the last command. 5. Header byte[0] is the ASCII command character (b,d.i,m,p,q or t) or an error code(OxFE) if no valid data. 6. If the error code is generated, it is followed by the last received (inappropriate) command string. 7. b$ cmd returns $+1 sensor status bytes for bank$,$-1 etc. down to bank 0. 'b' defaults to 'b9'(all). 8. d%% cmd returns 4 data bytes with binary values for bsn, maxDiff+bright, maxDiff &amp; bright in that order. 9. i%% cmd returns 2 data bytes: byte[1]= bsn and byte[2]=0 if unoccupied or 1(true) if occupied. (+ more) 10. p$ cmd returns Byte[0] header + count +3 data bytes per enabled (bank$) sensor + parity (max 27 bytes). 11. q$ cmd returns $+1 bank sensor enabled status bytes for bank$,$-1 etc. down to bank 0. 'q' defaults to 'q1' 12. s%% Scan looks for a bright LED on a dimmer background. The LED should be placed on the desired sensor position. This old method of placing sensors is not recommended. The Scan command is the last resort when USB is unavailable. 13. t##[,%%] cmd. initially sends CS the old threshold value (i.e. BEFORE change in the case of t##). Also returns sensor scores(bpd) in 2-byte pairs with MSB set so: bsn(+0x80 if undecided) &amp; bpd(+0x80 if OCCUPIED). Byte[0]header;[1]threshold;[2]S00bpd;[3]bsn;[4]bpd;[5]bsn;[6]bpd etc. Ends with bsn=80 (max 15 enabled) 14. m$,%% sets maxSensors to %% (USB or i2c) (as can h%% (%%&lt;98)). m0,1%% sets minSensors. Data sent to screen is bound between min and maxSensors. Extra parameter status bytes added to i2c bus for display. 15. The \" character is just a null cmd. Used before R, d &amp; t to prevent BCD Mega itself pre-interpreting them. 16. N.B.: The ESP32-CAM uses old ESP32S which has I2C limitations. It has a \u201cpipeline\u201d for returning data which results in a delay in response. i.e. the first request after a command will return OLD data. A SECOND request should return the desired data described above. A third or fourth request may return updated data. 17. Some commands take time to complete, as command processing can only happen once per 100mSeconds (i.e. the frame rate of the CAM). The I2C master should allow for latency in response where necessary. Place a DELAY(400) between all PARSE(\"\") EXRAIL commands.  18. Data requested over i2c may have a parity byte appended, and a check byte in byte[31]. 19. NOTE Automatic updating of ref image of unoccupied sensors now starts after last SUS (suspend) indicator. 20. a%%,rrr,xxx performs extended 'create sensor' equivalent to  k%%,rrr,xxx + a%% + r%% for new sensor S%% 21. Connection to DCC-EX Command Station has cmd. variations. See APPENDIX C for revised command detail."},{"location":"products/ex-sensorcam/ex-sensor-manual/#appendix-b","title":"APPENDIX B","text":""},{"location":"products/ex-sensorcam/ex-sensor-manual/#check-list-for-optimising-sensor-response","title":"Check List for Optimising Sensor Response","text":"<p>In the situation where sensors may be tripping undesirably, there is a range of adjustments that can be made to find a satisfactory operating point. Some have disadvantages that need to be considered and compromises may be necessary.</p> <p>1. First step is to refresh the sensor reference image. Try Cmd: r00, or r%% for a single sensor. This may be necessary after any disturbance to the environment such as changed lighting.</p> <p>2. Check the \"Diff\" scores on the scrolling display. After a refresh they should be in the range 32-37 for normal operation. If occasional trips occur, one remedy is to increase the threshold with Cmd: t46 say. Increasing the threshold reduces the sensitivity to low contrast objects (e.g. black over brown) If unoccupied Diff scores are consistently 32-35, reduce threshold for greater sensitivity.</p> <p>3. Is the lighting adequate? Steady muted daylight is ideal. Beware of rotating fans and other moving shadows (clouds?) (Note: may need to consider extreme case of mains induced ripple from 50/60Hz LED/fluoro lighting-to be discussed later) Brighter stable lighting means reduced \"noise\".</p> <p>4. Sensitivity to electrical \"noise\" can be reduced by increasing the \"min2trip\" parameter to 3 consecutive frames using Cmd: m3 (default is m2). However this increases response time by 100mS.</p> <p>5. You can create a \"Twin\" sensor for a \"second opinion\" by placing a Second Sensor S$$ on the track adjacent to the primary sensor S%% (3-4 pixels away) by using the Cmd: a$$,123,234 selecting the position from that of the primary sensor (obtained from Cmd: i%%) To avoid increasing response time, use a twin bsNo LOWER than the primary sensor (possibly in a \u201creserved\u201d bank, perhaps a matching bsNo in that bank). This twin S$$ can be assigned to the primary sensor S%% with the Cmd: i%%,$$ The primary sensor will not trip unless the twin agrees. This suppresses pixel noise spikes.</p> <p>6. Check that there isn't anything elsewhere in the field of view that is moving and could trigger the auto exposure in the camera. e.g. spectators near the edge of the field of view.(It is possible to change camera ov2640 module settings with 'j' and 'c' commands, but this can be a frustrating experience and needs considerable practice as some settings interact and can be order dependent)</p> <p>7. Make sure you do a refresh/record reference (r) after any changes or the benefit will be obscured.</p> <p>8. Is the camera steady? No vibration or movement since the last reference images (r)?</p> <p>9. There is a 2-frame (experimental) averaging applied to low bank sensors (currently 0-2) This can be extended to cover all banks, if desired by increasing CAM parameter TWOIMAGE_MAXBS above 3/0</p> <p>10. There has been poorer behavior observed with sensors placed near the edge of the frame. They seem to experience more electrical noise than mid-frame sensors and may need extra attention.</p> <p>11. A statistics function can be obtained to see how bad spurious tripping is. The '&amp;' cmd gives a table of stats accumulated since the previous '&amp;' command. May be useful. HINT: You can compare two or more sensors with different settings on the same spot. Accumulate data with no genuine trips.</p> <p>12. Consider whether a pixel may be faulty or unduly noisy. Try another nearby sensor position.</p> <p>13. If necessary, enhance the brightness of the Sensor location with light colour or a small reflector.</p> <p>14. It is possible to set private thresholds on individual sensors if other solutions inadequate. (t##,%%)</p> <p>15. Consider adjusting brightSF($) if colour contrast is generally poor (b#,$) default 3, try 1-5.</p> <p>16. In some situations, repositioning sensor slightly to include loco shadow will give extra sensitivity.</p> <p>17. Consider repositioning CAM for better oblique view angle giving more contrast for better detection, catching sides of coaches/wagons, shadows and some trackside references.</p> <p>18 Consider a beam break enhancement by placing an IR led between rails at the sensor position (power from DCC track?)</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#appendix-c","title":"APPENDIX C","text":""},{"location":"products/ex-sensorcam/ex-sensor-manual/#dcc-ex-cs-cam-commands","title":"DCC-EX CS CAM commands","text":"<p>The file CamParser.cpp has been added to the CS specifically tailored to provide a mechanism for the CS to send commands more easily than by using the clumsy diagnostic command style \\&lt;D\u00a0 ANOUT\u00a0vpin\u00a0parm1\u00a0parm2&gt;. The CS Native CAM command format is &lt;N\u00a0c\u00a0[parm1]\u00a0[parm2]&gt; where command character 'c' can be any of those listed below. Generally, to effect changes in sensorCAM, the CAM must be in the run mode (flashing).</p> <p>The base vpin address defaults to 700 but one can use the #define SENSORCAM_VPIN ### for another value (in config.h). With 2 to 4 CAM's, use &lt;N\u00a0C\u00a0#&gt; (1-4) when a switch is needed. The CAM# may also be placed, if defined in config.h, prefixing the sensor bsNo. e.g. &lt;Ni 2%%&gt; &lt;Nr\u00a02%%&gt; also &lt;Nm 200&gt; &lt;Nf 212&gt; &lt;Nt 243&gt;</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#user-commands","title":"User commands","text":"Command Example Equivalent sensorCAM command &amp; action (some commands only return \"ACK OK\" to CS) &lt;N&gt; &lt;N&gt; n/a Lists current &amp; alt. defined CAM baseVpins. &lt;N C ###&gt; &lt;NC 600&gt; n/a CAM base vpin(&gt;99) for following commands OR &lt;NC #&gt; selects CAM # (1-4) &lt;N a %%&gt; &lt;Na 12&gt; a12 enAble sensor S%% (bsNo). &lt;N\u00a0a%%\u00a0row\u00a0col&gt; &lt;Na\u00a012\u00a032\u00a043&gt; a12,32,43 enAble &amp; also set new coordinates for sensor bsNo &amp; refresh &lt;N b bank#&gt; &lt;Nb 1&gt; b1 Bank sensor states(all 8).(used by IFGTE() ATLT() e.g. to locate loco). &lt;N e&gt; &lt;Ne&gt; e EPROM write any changed settings to sensorCAM EPROM. &lt;N f %%&gt; &lt;Nf 12&gt; f12 Frame image pixel data for Sensor_ref[%%] and sensor666[%%] (RGB bytes). &lt;N F&gt; &lt;NF&gt; F Forced reboot, restoring sensorCAM sensor mode &amp; EPROM defaults. &lt;N g&gt; &lt;Ng&gt; g Get status ov2640 camera module settings (on sensorCAM monitor). &lt;N h %%&gt; &lt;Nh 30&gt; h30 set maxSensors to limit display to below sensor S%%. Also Help (0-9) &lt;N i %%&gt; &lt;Ni 12&gt; i12 Information on sensor bsNo state, position &amp; twin (0=No twin). &lt;N i %%[ $$]&gt; &lt;Ni 12&gt; i12,02 Info. &amp; assigns new twin sensor(S$$) for \"second-opinion\" on S%%. &lt;N j $ #&gt; &lt;Nj B 2&gt; jB2 adJust ov2640 parameters($)(Brightness, Contrast etc)(values 0-2 only). &lt;N l %%&gt; &lt;Nl 12&gt; l12 (lima) Latch output state of sensor bsNo to 1 &amp; disable. &lt;N m $ [%%]&gt; &lt;Nm 3 20&gt; m3,20 Min/max min2trip(1-4) frames [maxSensors] &lt;NM&gt; shows CAM parameters &lt;N n$ [%%]&gt; &lt;Nn 1 10&gt; n1,10 set nLED= bank $ [and minSensors=%% to limit display range] &lt;Nn v&gt; verifies. &lt;N o %%&gt; &lt;No 12&gt; o12 (oscar) Zero output state of sensor bsNo. Reset to 0 &amp; disable. &lt;N p %%&gt; &lt;Np 1&gt; p1 Positions(r,x) of all enabled sensors in bank are listed. &lt;N q #&gt; &lt;Nq 1&gt; q1 Query bank# enabled states of sensors (0 indicates sensor disabled). &lt;N Q&gt; &lt;NQ&gt; n/a Query state of all sensorCAM Sensors &lt;N r [%%]&gt; &lt;Nr 12&gt; r12 Refresh Reference image for sensor S%% (default ALL=r00). &lt;N s %%&gt; &lt;Ns 12&gt; s12 Scan image for brightest spot and set S%% to center that pixel. &lt;N t ## [%%]&gt; &lt;Nt 43 12&gt; t43,12 Threshold displayed, sets global threshold (32-98) [sets a pvtThreshold]. &lt;N t ##&gt; &lt;Nt 10&gt; t10 Tabulate ## (2-31) rows of scroll data similar to CAM scroll. &lt;N t # %%&gt; &lt;Nt 0 12&gt; t0,12 Trash pvtThresholds. &lt;Nt 0 %%&gt; individually, &lt;Nt 1 %%&gt; for bank, &lt;Nt\u00a01\u00a099&gt; trashes ALL pvtThresholds.  &lt;Nt\u00a099&gt; lists ALL pvtThresholds. &lt;N t 1&gt; &lt;Nt 1&gt; t1 toggles scroll on/off. &lt;N u %%&gt; &lt;Nu 12&gt; u12 Undefine and disable sensor bsNo(erase coordinates). &lt;Nu 99&gt; for ALL &lt;N v [#]&gt; &lt;N v 1&gt; v1 Video mode(1-2) invoke webCAM, or alt webCAM with v 2. v for version &lt;N\u00a0w&gt; &lt;Nw&gt; w Wait. Stop/start CAM imaging (flash), status sensing &amp; streaming. x \u00a0 y \u00a0 z Reserved for binary export for Processing 4 images &lt;N ### ## ##&gt; &lt;N\u00a0711\u00a075\u00a085&gt; a13,75,85 Note: This uses the vpin for a sensor, NOT id/bsNo.(ref. Appendix E). <p>Notes: The 'i' cmd prints bsNo(bsn) where bsn/vPin offsets range from (7)00 to (7)79 (e.g. baseVpin address 700). Some commands return previous (old) values then update sensorCAM. Use &lt;Nm&gt; to confirm change. Space after &lt;N is optional, as is capitalization of command. e.g.&lt;N t 42&gt;=&lt;NT 42&gt;,&lt;N r 00&gt;=&lt;NR&gt; Multiple CAM selections can be achieved by config.h entry and use of a prefix on param1 e.g.&lt;N i 212&gt; for CAM 2 For commands to work fully, need latest CamParser.cpp, CS driver(IO-EXSensorCAM.h) &amp; sensorCAM.ino</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#appendix-d","title":"APPENDIX D","text":""},{"location":"products/ex-sensorcam/ex-sensor-manual/#linear-sensor-commands","title":"Linear Sensor Commands","text":"<p>To enable an intrusion detection \"curtain\" or a linear \"siding\" or \"spur\" occupancy detector, a variation on the standard 4x4 pixel sensor was introduced with sensorCAM version 3.07. These sensors can detect the presence of any wagon/coach/loco obstructing any part of a (potentially curved) siding. Unlike conventional electrical occupancy detectors, it requires no extensive axle replacement on all rolling stock or complex IR or other style detectors and wiring.</p> <p>The \u201clinear\u201d detector consists of a series of spot sensors utilizing multiple sensors in one bank and normally ending with the last sensor in the bank (i.e. S%7). The four spots of one S%% are spaced at an even multiple of pixels from 0 to 15 sloping to right or left. Spacing of deltaX and deltaR are specified as integers from 0 to 63 giving a theoretical maximum length of 63 x 1.41 x 8 pixels (710 pixels). The sensorCAM resolution is 240x320 only, so shorter spacing is normal and gives a practical result. One may also use up fewer std. Sensors (max 8/bank) to cover the required distance.</p> <p></p> <p>After creating a line, a refresh (Y) of the Processing4 image should show a series of standard sensors placed on every fourth spot (e.g. S34-S37). Interpolate between top left sensor quadrants for visual line alignment. v312+ shows the(orange) spots between Sensors.</p> <p>To create a \"curved\" intrusion curtain line, one can start at the top with a straight line and then change the slope() on each successive S%% checking the image after each adjustment. Alternatively place up to 8 std. consecutive sensors and then convert each in turn to a joining line using \\%% repeatedly.</p> <p>While individual sensor segments can be read by the Command Station in the usual way, a line sensor should normally be read/tested as a bank. The sensorCAM 'b' command shows a byte value dependent on all sensors in the bank in bits 7-0. The \"value\" of a bank will rise if sensors set the bits such that, for the example above, the value will exceed 16 (2^4) if any sensor in the range S34-S37 is tripped. The EX-RAIL commands, such as IFGTE(CAM 034, 16), will respond to the tripping of the line sensor.</p> <p>The line sensors may require an individual pvtThreshold rather than Threshold as their sensitivity will differ. The line sensor can have a pvtThreshold PROVIDED it is only stored in the last sensor (e.g. S37). If a pvtThreshold is set (under 99) in the last sensor, it trims the line by 3 steps restoring the (S%7) sensor to a normal (4x4) square. Remember to save (to EPROM) the new line sensor with the 'e' command.</p> <p>If precision less than 1 degree is needed, consider a tiny CAM rotation to help alignments (e.g. fiddle yard).</p> <p>While setup without an advanced GUI is fiddly, most situations can be handled. The following examples may help visualize the requirements. Note: To get good image updates make sure the CAM has flashed before the new Y cmd. One sure way to do this is to issue the 't2' command for two new frames.</p> <p>Straight line sensors (S33 to S37 &amp; S40 to S47) were created by positioning end Sensors &amp; using \\%%,%% End Sensors were initially placed using a%% followed by a click on the image and Enter and then issuing the '\\' cmd. (e.g. \\40,47) to automatically interpolate for the nearest straight line. These lines can go upward.</p> <p>Curved sensor banks can be constructed from a series of prepositioned standard 4x4 sensors and then converting them individually using '\\%%' to join two consecutive sensor positions as was done for bank 2 (S21-S27) in this example. Place the cursor fingertip exactly where you want a linear point as the point is placed in the top left corner of the Sensor box.</p> <p>Line sensors, developed for visitor intrusion curtains, are currently automatically bent if needed to avoid crossing the bottom edge or placing sensors very close to the edge where they have been found to be particularly noise sensitive. In the image below, line sensor generated from '/40,15,15' has hit the edge.</p> <p></p> <p></p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#appendix-e","title":"APPENDIX E","text":""},{"location":"products/ex-sensorcam/ex-sensor-manual/#tabulated-dcc-ex-cs-ids-for-sensorcam","title":"Tabulated DCC-EX-CS ID's for sensorCAM","text":"<p>Table B below shows the colour code used to identify sensors on the Processing 4 track image. For example, sensor S12 has a bsNo 1/2 for which the colours are Brown/Red (seen on sensor box edges). For CAM number 1, the full CS sensor S12 ID is 112 when used in CS native &lt;N&gt; commands such as &lt;N i 112&gt;  The use of the CAM # can be optional.  If only one CAM is installed (or selected), &lt;Ni 12&gt; is sufficient. For EXRAIL it can be tested so: AT(CAM 012) where the vpin is invisibly calculated as (700+012). N.B. The use of the '0' after CAM is essential in EXRAIL. The colour code is the standard resistor value colour code for 0-9.</p> <p>Under normal circumstances if the CS has been configured as per the installation instructions, there is no need to refer to the vpin of any Sensor.  They are all relative to the baseVpin of the CAM.</p> <p>The full ID consists of CAM number #-bank-sensor or #bs. Each bank(0-9) contains 8 sensors(0-7) vPin is the (CAM number # baseVpin) + 0bs,  bsNo skips id's ending in 8 or 9.  (e.g. 700 + 012 = 710) vPin is the base/first vPin number (e.g. 700) + DEC(bsn)number in the conversion table below.</p> <p></p> <p>Table E \u00a0 \u00a0 Reference Sensor ID to colour code conversion table</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#appendix-f","title":"APPENDIX F","text":""},{"location":"products/ex-sensorcam/ex-sensor-manual/#hardware-interface-pca9515a-endpoints","title":"Hardware Interface (PCA9515A&amp; &amp; Endpoints)","text":"<p>Note: This Appendix focuses on the ESP32-CAM-MB implementation, but as an alternative, consider the newer ESP32 WROVER-CAM and breakout board, as mentioned in Section 7, Figure 6 for a simpler implementation.</p> <p>The ESP32 CAM drives GPIO pins with 3.3V logic. This may well be incompatible with the master l2C signals at 5V. It is essential that appropriate voltage level shifting and buffering is used where necessary. Unbuffered I2C is limited in range but a Sparkfun differential i2c driver/endpoint may also be used to achieve long lengths and voltage shifting (3.5v to 5v) if needed.</p> <p>The sensorCAM can be Reset remotely by software or by cycling the power supply. The CAM MUST be rigidly mounted as its response to any image vibration can trip sensors. It is best not moved after sensor location programming as precise realignment could be tedious. It is, however, advisable to make guides or jig arrangement to at least be able to remove (for maintenance) and return with minimal misalignment to cover the same field of view. The LED method of placing/positioning sensors may be necessary if a long USB cable is impractical. A 5m buffered USB cable might be advantageous. Even so, programming or imaging over a very long USB cable may not be satisfactory.</p> <p>The PCA9515A based module offers a simpler, but limited, interface to an i2c bus the use of will act as a level changer (3.3V to 5V) and can connect to a SHORT i2c bus (max 2-3m). You may use 2mm foam adhesive tape to mount a PCA9515A on the back of an ESP32-CAM-MB and solder on the 5 jumper wires directly as shown below. If the i2c length is near or just over the limit, an optional LTC4311 extender can be attached to boost the signal. As indicated, this option relies on 5V USB power so needs a dedicated (permanent) USB cable connection.  A local 5v buck converter can be used beside the CAM for a better supply.  This is included on the Wrover breakout board. You could also extend a cable between the PCA9515 buffer and CAM (1m).</p> <p>A programmable nLED and 330ohm resistor may be attached to the PCA9515A from 3.3V VCC to GPIO14 to aid testing.  Also useful on a Wrover CAM if on that path.</p> <p></p> <p>Alternatively, The Sparkfun endpoint is perhaps the best overall solution at this stage for driving one (or more) sensorCAMs. It provides greater lengths of cable without extending the Command Station i2c local bus. The endpoints are used in pairs, connected by a long (&lt;100m) differential pair cat5 cable providing power and communications. It can provide buffering, level shifting and power, but care is needed at the CS end to avoid over-voltage damage. It is suggested, with a 5V CS, that the Endpoint pullup jumpers at the CS end be cut for safety. The sensorCAM Endpoint default pullups are needed for the 3.3V CAM i2c bus. The CS Endpoint requires 3.3V power(from the CS) and a separate (7 to 9V) DC supply for the Buck &amp; CAM.</p> <p>Typical device applications (with BUCK 5V inverters):</p> <p></p> <p>Sparkfun endpoints(requires a matching sparkfun endpoint at CS)(CS interface option B)</p> <p></p> <p>(Dual optional) CAM wiring with Endpoints and 5V Buck reg. powered over GRN-GRNW(Vin) with Vin(&gt;7V)</p> <p></p> <p>With Dual CAM header:</p> <p></p> <p></p> <p>NOTE: Take care to cut copper strips appropriately!</p> <p></p> <p>There are three basic variations below for connecting the Endpoints to the CS. The choice depends on the current system being extended. Options A &amp; B apply to a 5Volt I2C bus on a 5V CS with or without existing I2C accessory connections, while Option C is the simplest connection to a 3.3Volt CS i2c bus.</p> <p>The 2x Endpoints require about  10mA  each. All options can be adapted for use with a mux if necessary. The choice between A and B depends on the power supplies available. If the CS Endpoint is to be tapped into a \"remote\" 5V i2c bus location, a CS 3.3V supply may not be available, only a 5V I2C supply. Option B removes one 10k pullup resistor pair from the bus to avoid inappropriate pull-up voltage(3.3V).</p> <p>Option A: CUT CAM endpoint jumper 0-1 and supply 5V and 3.3V from the CS. Option A connections results in a 5V i2c interface to 3.3V differential cable for 5V microprocessor based CS (e.g. Mega).</p> <p>Option B: may be used if the CS 3V3 regulator is more convenient. CUT two CS Endpoint I2C jumpers to disconnect the on-board I2C pullup 10k resistors and 3v3 from the bus. This adds load to the i2c bus data so may need extra pullups to 5V. This does function but is not recommended.</p> <p>Option C: used with newer (32bit) MPU's (e.g. CSB1) &amp; uses 3V3 throughout. No Endpoint jumpers need to be cut. Whichever option is used, the user should consider if the I2C bus needs to be tuned differently. For very short extra cable length to the Endpoint and only one extra device count on an I2C bus under 1m in length, tuning may be unnecessary. In marginal conditions consider returning as per DCC-EX recommendations.</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#a-for-33v-differential-drive-5v-cs-i2c-bus","title":"A FOR 3.3V Differential drive 5V CS I2C BUS","text":""},{"location":"products/ex-sensorcam/ex-sensor-manual/#b-for-33v-differential-drive-5v-cs-i2c-bus","title":"B FOR 3.3V Differential drive 5V CS I2C BUS","text":""},{"location":"products/ex-sensorcam/ex-sensor-manual/#c-for-33v-differential-drive-33v-cs-i2c-bus","title":"C FOR 3.3V Differential drive 3.3V CS I2C BUS","text":""},{"location":"products/ex-sensorcam/ex-sensor-manual/#appendix-g","title":"APPENDIX G","text":""},{"location":"products/ex-sensorcam/ex-sensor-manual/#i2c-command-protocol","title":"I2C command PROTOCOL","text":"<p>With version 3.00 of IO_EXSensorCAM.h CS driver, commands and parameters are sent to the CAM as a short string of binary bytes to be interpreted by sensorCAM. Return data (if it is applicable) is also in compact byte format as below.  Other commands respond with \"ACK OK\".</p> <p>The sensorCAM sends packets of data to the i2c bus master upon request. The data sent is dependent on the last command received as that command prepares a packet in anticipation of a bus Request. Only nine commands can affect the return packet format. They will contain the relevant ASCII command character in the first (header) byte, followed by data. These are listed below.</p> <p></p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#appendix-h","title":"APPENDIX H","text":""},{"location":"products/ex-sensorcam/ex-sensor-manual/#notes-on-use-with-ex-rail","title":"Notes on use with EX-RAIL","text":""},{"location":"products/ex-sensorcam/ex-sensor-manual/#1-sensorvpin-numbering","title":"1. Sensor/vpin Numbering","text":"<p>The numbering of sensors can be consecutive by vPin, which is the common practice with multi-pin peripherals (e.g. PCA9685 16-channel Servo driver and MCP23017 16-channel GPIO Expander). Sequential vPin numbers within a device is hardware enforced, but this loses some of the advantages available by a more meaningful ID notation. Such ID's are available for jmri use and so can also be used for sensorCAM. Use of IDs, as suggested below, can remove any need to program with vPin numbers.</p> <p>For any peripheral device, the vPin is needed for commands (e.g.700+5), but, if predefined (e.g. in config.h), alphanumeric names such as CAM or CAM2 or ESSEX can be used in place of the base vPin to identify the camera. Then commands for CAM pin 5 become: e.g. AT(CAM+05) or AT(ESSEX+05)</p> <pre><code> e.g.  \n #define SENSORCAM_VPIN 700    //place in config.h or myAutomation.h or mysetup.h  \n #define CAM  SENSORCAM_VPIN+  //in config.h or myAutomation.h or mysetup.h  \n\n Valid EXRAIL commands: AFTER(CAM 5)  AT(SENSORCAM_VPIN+7)  IFGTE(CAM 010, 2)  \n\n To avoid frequent \u201cCAM\u201d in scripts, an alias can be assigned e.g. ALIAS(ESSEX_P1, CAM+0x10)\n</code></pre> <p>With each sensorCAM having up to 80 sensors, it is desirable to test groups of (1 to 8) sensors with a single EXRAIL test using the IFGTE() or IFLE() commands. To do this, the sensors are logically arranged in \"banks\" of (consecutive) vpins. The logical grouping available can be written in the form \"bs\" or b/s where b can have bank values of 0-9 (10 banks) and s values 0-7 (8 sensors). IFGTE and IFLT read a whole bank \"value\". Native CAM commands can also be issued e.g. PARSE(\u201c&lt;N b 4&gt;\u201d) for bank 4.  However consecutive PARSE() commands should be separated by a PAUSE(400) to give the CAM time to complete its action.</p> <p>EXRAIL can accept \"b/s\" numbering (e.g. 047) if we add the leading 0. e.g. vpin= SENSORCAM_VPIN+ 047 so use IFGTE(CAM 047,1) provided values are defined for SENSORCAM_VPIN &amp; CAM(as above).</p> <p>(N.B. \"CAM\" includes the '+') Using this method there is no need to remember assigned vPin values!</p> <p>Example 1: For the approach to a signal, several sensors may be deployed (say S13 to S17) with S17 last at the signal. As a train approaches the signal, the (bank) \"value\" of the tripping sensors will increase. This can be used to control the loco speed for a smooth and precise stop at a platform, for example. Commands IFGTE(CAM 013,8) SPEED(40)... IFGTE(CAM 013,16) SPEED(30) etc. can be used to control the loco approach speed with some precision. Finally, at the signal(S17), IFGTE(CAM 013,128) STOP</p> <p>Aliases could also be defined and used for station/bank or line sensors.e.g. IFGTE(TRENTHAM, 0x80)</p> <p>Example 2: The CAM can have up to 10 occupation/line detectors. If two \"linear\" line sensors are needed, and we have bank 1 allocated (S10-S17), the following 16 vPins could be assigned to 2 banks of linear sensors. We can use (bs#) ID of 20 to 27 for first linear sensor(bank2) and 30-37 of bank3. The Command Station can easily handle banks of 8, using an ID based format of (CAM 020) and (CAM 030). The \"bank\" or b/s notation requires the leading '0' on the bsNo. for automatic vpin calculation. The linear segments at S21 to S27 may also be tested individually and a common bank threshold can be set if needed. e.g. IFGTE(CAM 020,1)...// bank occupied, or IFGTE(CAM 024,16) \u00a0 //2nd half occupied.</p> <p>Note: With '0%%' notation, unless you understand the issue, avoid using bank 8 &amp; 9 as mistakes may arise. (08# must be expressed as 010# and 09# as 011# for correct outcome)</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#2-multiple-cams","title":"2. Multiple Cams","text":"<p>Multiple sensorCAMs can be easily handled if CAM2, CAM3 etc are defined along the lines of CAM above, so IF(CAM2 012) tests a different sensor to IF(CAM3 012), provided SENSORCAM2_ VPIN etc. are defined. Using CS native commands, e.g. &lt;Ni 212&gt; and &lt;Ni 312&gt;, can also access S12 on different CAMs. The #define SENSORCAM_VPIN ### is essential for cam1. Do NOT insert a 1 in to SENSORCAM_VPIN. You may use SENSORCAM2_VPIN and SENSORCAM3_VPIN with CAM2 and CAM3 in config.h</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#appendix-i","title":"APPENDIX I","text":""},{"location":"products/ex-sensorcam/ex-sensor-manual/#configuring-cam-and-ex-cs","title":"Configuring CAM and EX-CS","text":"<p>A number of parameters and files may need to be changed or included to get the EX Command Station to respond appropriately to the sensorCAM. The (CS) modifications are to be placed in the directory containing CommandStation-EX.ino BEFORE final compilation and upload to the CS(Mega). Some further changes to vpins and i2c addresses may be required to avoid conflicts with previously installed EX-CS devices.</p> <p>Refer to the sensorCAM Installation Guide for more detail on the EX-CS installation procedure.</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#file-edits-configcamh","title":"File edits: configCAM.h","text":"<p>(refer to the latest InstallationGuide for details)</p> <p>adjust ADDR, SSID &amp; PWD and other parameters if required before uploading sensorCAM.ino</p> <pre><code>#define WIFI_SSID \"xxxxxxxxx\"   //insert your#1 WiFi network nane here(2.5GHz)\n#define WIFI_PWD \"xxxxxxxxx\"   //\"your network password\"\n#define TWOIMAGE_MAXBS 030    //slower&amp; more reliable averaging if below S30.(&lt;097)  \n#define I2C_DEV_ADDR 0x11    //17==0x11 for BCD layout so can use existing Mega Master  \n#define SUPPLY 10           //local mains frequency dependent(currently just use 10)\n#define BAUD 115200        //any slower will degrade image transfer speed  \n#define SEN_SIZE 0        //0 gives standard 4x4 pixels\n</code></pre>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#commandstationcs","title":"CommandStation(CS)","text":"<p>following files all in CommandStation-EX.ino folder or separate folder for installer.</p> <p>IO_EXSensorCAM.h </p> <p>CamParser.h, CamParser.cpp &amp; EX-SensorCAM.h (v3.08) are now included in CommandStation-EX versions 5.4.0+ by default. Different versions (driver v3.09) are included in CS devel 5.5.40+)</p> <p>config.h             //standard should do for single CAM at Vpin 700&amp; address 0x11</p> <pre><code>#define SENSORCAM VPIN 700     //defines a suitable virtual vPin for the FIRST sensorCAM\n#define CAM SENSORCAM VPIN+       //alias to replace vpins in EXRAIL e.g. AT(CAM 021) i.e.S21\n#define SENSORCAM2_VPIN 620       //only if a second CAM has been created in myHal.cpp\n#define CAM2 SENSORCAM2_VPIN+     //ditto\n</code></pre> <p>myHal.cpp            //(preferred: use HAL() in myAutomation.h as per Installation Guide)</p> <p>```#include\"IO_EXSensorCAM.h\"  // sensorCAM driver for CS void halSetup(){               //add in the following two lines minimum.       EXSensorCAM::create(700, 80, 0x11); //max 80 digital(0 Analogue) Vpins to 779. // or EXSensorCAM::create(SENSORCAM_VPIN, 80, 0x11);   //#define.._VPIN(s) in config.h.             // using &lt; 80 sensors(fewer banks) may save vPin &amp; RAM use.       EXSensorCAM::create(620, 80, 0x12);  //can use multiple CAMs if needed e.g.@620 <pre><code>**mySetup.h**  // a second CAM may use vpins 620 to 699 range if no conflicts \n\n```c++\nI2CManager.setClock(100000);   //to slow i2c bus clock rate (or .forceClock(100000);)\nSETUP(\"&lt;Z 100 7000\\&gt;\");     // set as output for now(used for&lt;D ANOUT&gt;\\&amp;&lt;N\\&gt; cmds)\n// start of up to 80 sesnsors numbered bsNo's 000 to 097(0/0 to 9/7)\nSETUP(\"&lt;S 100 7000\\&gt;\");     // first sensor(S00) at SENSORCAM VPINO 700 by default\nSETUP(\"&lt;S 101 701 0\\&gt;\");    //\nSETUP(\"&lt;S 102702 0\\&gt;\");\n//setup as many as you want. You can add later manually with CS native&lt;S\\&gt; cmds.\nSETUP(\"&lt;S 107707 0\\&gt;\");\nSETUP(\"&lt;S 110708 0\\&gt;\");     //note recommended id is 1%%(b/s) format, vpin is DEC.\n// etc.\n//SETUP(\"&lt;S 196 778 0\\&gt;\");\n//SETUP(\"&lt;S 197 779 0\\&gt;\");    //maximum sensor id for number \"1\" sensorCAM.\n//          vPin 700 also used by sensorCAM Native commands&lt;N\\&gt;(Appendix C)\n//SETUP(\"&lt;S 200 620 0\\&gt;\");    //e.g. for a second sensorCAM at SENSORCAM2_VPIN0 620\n//to setup bulk sensors(e.g. 210 to 297 for a cam at vpin 620+) can include C++ code here so..\n//for(uint16_t b=1; b&lt;=9;b++) for(uint16_t s=0;s&lt;8;s++) Sensor::create(200+b*10+s,620+b*8+s,1);\n</code></pre></p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#appendix-j","title":"APPENDIX J","text":""},{"location":"products/ex-sensorcam/ex-sensor-manual/#wrover-esp32-cam-notes","title":"WROVER &amp; ESP32-CAM notes","text":"<p>N.B. CAM v1.6 has 4x jumpers (cam side) near U0R/U0T pins &amp; CAM v1.9 has 6x jumpers (including RST)</p> <p>In board version v1.9, the \"GND\" pin adjacent GPIO1/U0T is used for RESET(GND/R) to ESP32-CAM and MUST NOT be tied to GND or CAM will remain in RESET mode. CHIP version shows at start of upload, e.g.</p> <p></p> <p>The esp32-CAM-MB obtained with extra headers uses a small CH340N IC unlike the 16 pin package used on the \"regular\" MB devices (micro-B). The wider MB (headers) also has an issue in that it does NOT have a reset pin because the RST/GND socket is PERMANENTLY connected to GND which will hold CAM v1.9 in permanent Reset.</p> <p>Headers (for v1.6):</p> <p></p> <p>So-without butchery, can only use the v1.6 CAM's on this board, and even then will have to hold the IO0 button in (grounding it) on reset until upload is progressing. As a workaround for v1.9, it may be possible to carefully slice off this MB GND socket completely. View the Camera side of the ESP32-CAM to distinguish the CAM boards.</p> <p>Identification: ESP32-CAM v1.6 has 4x jumpers beside UOR/UOT pins and v1.9 has 6x jumpers (inc. Reset).</p> <p>Using v1.6 with no RTS/DTR reset, users will have to boot up holding IO0 button in to get into programming mode. MB boards are sold mostly without headers and can come with either Type-C or micro-B in either size, 1 or 2 button.</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#1-note-on-i2c-clock-frequency","title":"1 Note on i2c clock frequency","text":"<p>The newer sensorCAM drivers default to an i2c bus frequency of 100,000 Hz. With caution, this may be increased somewhat (e.g. 200000) if the i2c bus is well tuned and all attached devices can handle higher frequencies. To set a higher frequency, for example, place the following in mySetup.h or_ myHal.cpp_ I2Cmanager.forceClock(200000); //place after void halSetup(){ </p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#2-40-pin-wrover-cam-with-38p-breakout-board","title":"2. 40-pin WROVER CAM with 38P breakout board","text":"<p>Potentially simplest commercially available hookup for 40 pin WROVER-CAM:</p> <p>Software configuration: add #define CAMERA_MODEL_WROVER_KIT to bottom of configCAM.h</p> <p>2x \"Spare\" (USB end) Vcc and GND pins not used with the 38 pin breakout board shown. (remove?)</p> <p>Adding 1.0uF capacitor between reset (EN) pin and gnd ensures more reliable power-on reset.</p> <p>Add a super-bright green LED and 330R from 3.3V to GPIO14 for programmable LED indicator.</p> <p>There is no white \"flash\" LED but, in sensorCAM mode, the on-board blue LED flashes instead. (GPIO2)</p> <p>The breakout board USB connectors are for an optional 5V power source ONLY. No comm's.</p> <p>Limit Vin barrel jack to 7-10V max to avoid destruction of the 1117C 5V regulator (Vne = 16V).</p> <p>The CS endpoint shown should be powered with 3.3V from the CS end (NOT 5V), and 9V on GRNW/GRN Note: WROVER-CAM does not have a fitted external antenna socket like the ESP32-CAM.</p> <p></p> <p>For a limited reach, perhaps using a LTC4311 terminator/buffer at the CS to boost signal rise times and range, the cheaper PCA9515A may be used with the Wrover-CAM connected as shown.  The cable to the CAM can be up to 2m long using twisted pairs (cat5?) but may need tuning with extra pullup resistors.</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#3-enhanced-t-cmd-for-pvtthresholds","title":"3. Enhanced 't' cmd for pvtThresholds","text":"<p>t0,%% will cancel a pvtThreshold on S%% as always. t1,%% will cancel ALL pvtThresholds in bank% e.g.t1,30 t1,99 will cancel ALL pvtThresholds in the sensorCAM(i.e.S00 to S97) t99 will list ALL pvtThresholds in the sensorCAM by bank#(10 banks) t1 will toggle SCROLL ON/OFF as always. The'e' command is needed to make changes\"permanent\"</p> <p>Version v319 also accepts minSensors up to maxSensors-1 m#,%% will set maxSensors to%%. e.g. m10,30 sets maxSensors=030 (leaving min2trip unchanged as does m0,30) n#,%% will set minSensors to%%. e.g. n10,27 sets minSensors=027 leaving nLED unchanged. n0,27 would set nLED to 0)</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#4-cs-drivers-v308-v309","title":"4. CS drivers v308 &amp; v309","text":"<p>Driver version v308 is intended for use with Prod versions 5.4.6 to 5.4.16. DCC-EX CS Prod. Versions 5.4.16+ incorporate v308 by default. v308 will not work with CS devel 5.5.15+. For CS devel versions look to v309 (default). Both these drivers MUST be used with sensorCAM version v320+ as earlier versions will not be recognized.</p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#additional-random-notes","title":"ADDITIONAL RANDOM NOTES:","text":"<p>ALL FOLLOWING IMAGES ARE FOR GENERAL INFORMATION ONLY &amp; NOT DIRECTLY REFERENCED IN THE FULL MANUAL ABOVE</p> <p></p> <p></p> <p></p> <p>Antenna solder jumper adjustment</p> <p></p> <p></p> <p></p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#esp32-cam_v16_v19_mb","title":"ESP32-CAM_V1.6_V1.9_MB","text":"<p>\u25cf ESP32-CAM-MB, base module design, schematic</p> <p>\u25cf ESP32-CAM V1.6 modification to uses external RESET pin and the auto download</p> <p>\u25cf ESP32-CAM V1.6 modification, more stable</p> <p>\u25cf upgrade to ESP32-CAM V1.9</p> <p>looks like V1.6 is the same as V1.9, really? - The jumper difference is on ov2640 side.</p> <p></p> <p>Spec sheet: Typical applications include a 22uF cap between AMS1117 3v3 reg ADJ/GND pin and Vout, not on CAM but can be added as above for \"better\" performance.(hopefully less noise?). Also shows 10uF on 5Vin</p> <p>There is a range of ov2640 cam modules available with ESP32 or independently sold. The\"IR\" option would be an interesting experiment and might open up new possibilities, but monochrome IR images harder to spot intrusions. The usual ov2640 is  66deg., but  120deg fish-eye covers more, at the expense of detail.  100deg might be better for low ceilings depending on situation.</p> <p>Web offers range of lenses including \"850nm night vision\" which probably is OV2640 sans IR filter? (IR&gt;700nm)</p> <p>Long(75mm) and short(21mm) ribbon ov2640, angles 66(std?),100,120,160deg lens,650nm or 850nm(night vision), opt. antenna for marginal wifi. NONE, other than standard 66deg OV2640, are currently recommended.</p> <p></p> <p></p> <p></p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#esp32-cam-8mb-psram","title":"ESP32 CAM 8MB PSRAM","text":"<p>Cameramodulekit 2,4 GHz WiFi Bluetooth 8 MB PSRAM OV2640 Cameramodule 120 66 160 graden 850 nm Nachtzicht 2 MP</p> <p></p>"},{"location":"products/ex-sensorcam/ex-sensor-manual/#acceptable-alt-wrover-cam","title":"Acceptable alt. WROVER CAM","text":""},{"location":"products/ex-sensorcam/ex-sensorcam-command-reference/","title":"Native EX-SensorCAM Command List","text":""},{"location":"products/ex-sensorcam/ex-sensorcam-command-reference/#conventions-used-on-this-page","title":"Conventions used on this page","text":"<p><code>, space</code>   Equivalent parameter separators.  CS must use space character <code>%%</code> \u00a0 \u00a0 \u00a0 \u00a0 Represents a Sensor's bank/sensor two digit identifier (digits 0-7 only) <code>rr xx</code>\u00a0 \u00a0 Represent the row and column position of sensor (range 1-236 &amp; 1-316 only) <code>#</code> \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 Represents a single decimal digit (0-9) <code>$</code> \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 Represents a single alpha-numeric character (A-Z or 0-9 as relevant to command) <code>[ ]</code> \u00a0 \u00a0 \u00a0  \u00a0Indicates enclosed parameter is optional.  Do NOT type brackets into commands <code>&lt; &gt;</code> \u00a0 \u00a0 \u00a0  \u00a0Encloses native CS command and MUST be typed to define CS command  </p>"},{"location":"products/ex-sensorcam/ex-sensorcam-command-reference/#native-cam-usb-cs-cmd-formats","title":"Native cam USB &amp; CS cmd formats","text":"native CAM native CS \u00a0 \u00a0 \u00a0  Command Description a%%[,rr,xx] <code>&lt;Na %%[ rr xx]&gt;</code> enAble Sensor and refresh reference Sensor will respond to changing image. rr,xx set as new coordinates b#[,$] <code>&lt;Nb #&gt;</code> Bank occupancy status [&amp; Brightness ScaleFactor $]Trip status of 8 sensors in a single byte (8 bits) (hex &amp; binary) c$$$$ <code>&lt;n/a&gt;</code> Camera re-Calibration and re-reference SensorsSevere changes to camera settings.  Refer to manuals before use! d%%[#] <code>&lt;n/a&gt;</code> Difference Score for Sensor [# repeats]Prints colour diff score, brightness score and sum of both e <code>&lt;Ne&gt;</code> EPROM - save sensorCAM configuration to EPROMRecords parameters in EPROM to be restored upon next Reset f%% <code>&lt;Nf %%&gt;</code> Frame print. Full 16x3 byte Sensor pixel valuesTabulates 4x4 (RGB) pixels for current and reference sensor images g <code>&lt;Ng&gt;</code> Get Camera Global Config. Status (to USB)Lists 14 different parameters of the ov2640 \"Calibration\" settings h$[,#] <code>&lt;Nh $ #&gt;</code> Help cmd.(debug for devel)Debug. h alone lists options. h7,# pauses scroll if bank # trips i%%[,$$] <code>&lt;Ni %%[ $$]&gt;</code> Info. on Sensor state and configurationprints sensor state &amp; full definition. [add a \"twin\" sensor S$$] j$,# <code>&lt;Nj $ #&gt;</code> adJust ov2640 global parameters &amp; lists 'g' statusSets a single parameter(\\$) for ov2640. \u00a0 j alone, lists options k%%,rr,xx <code>&lt;n/a&gt;</code> locate a basic sensor at row rr, column xxDefines sensor at rr,xx but DOES NOT enable or reference/refresh it l%% <code>&lt;Nl %%&gt;</code> (Lima) Latch sensor on (occupied=1)Sensor disabled, &amp; set 1 until a%%, r%% or cleared by o%% m$[,%%] <code>&lt;Nm $[ %%]&gt;</code> Min2trip frames setting [MaxSensor setting]Sets min/max parameters.  m0,%% leaves min2trip unchanged n$[,%%] <code>&lt;Nn $[ %%]&gt;</code> Number for bank trip LED indicator. [minSensor]Sets programmable LED to indicates when bank Number $ is tripped o%% <code>&lt;No %%&gt;</code> (Oscar) turn sensor Off (un-occupied=0)Sensor disabled, &amp; set 0 until Latched or enabled using a%% or r%% p# <code>&lt;Np #&gt;</code> Position table for a bank of sensorsPrints positions for enAbled sensors of bank #. \u00a0 p%% similar q# <code>&lt;Nq #&gt;</code> Query enAbled state of sensors in bankPrints enabled state of all 8 sensors (1/0).  Use q9 for ALL banks r%% <code>&lt;Nr %%&gt;</code> Refresh reference image for sensorenAbles sensor and captures a new reference image.  Use r00 for ALL s%% <code>&lt;Ns %%&gt;</code> Scan video to define a new Sensor position (superseeded)Scan for brightest spot (LED) and position sensor there. t##[,%%] <code>&lt;Nt ##[ %%]&gt;</code> Theshold setting (32-98) global [pvtThreshold for S%%]Sets new global threshold, [or a  pvtThreshold] (t99 lists pvtThresholds)For ## of (2-31), print ## data rows. \u00a0 (t00,%% clears a pvtThreshold) t1[,%%] <code>&lt;Nt 1[ %%]&gt;</code> Toggle data scroll on/off. \u00a0 [or Trash pvtThresholds for S%% bank]clears 1 bank of 8 pvtThresholds. \u00a0 (t1,99 clears ALL pvtThresholds) u%% <code>&lt;Nu %%&gt;</code> Un-define SensorResets sensor coordinates to 0,0 v[#] <code>&lt;Nv[ #]&gt;</code> Version [or Video webCAM SSID #]Displays EX-SensorCAM version info [v# starts SSID # webCAM] w <code>&lt;Nw&gt;</code> Wait for command. \u00a0 (NOTE: 't1' alternative action)Cam suspends image capture and scrolling and waits for an 'Enter' x \u00a0 y \u00a0 z <code>&lt;n/a&gt;</code> Reserved commands for image transfer managementSends binary data to USB port for Processing4 (X Y Z) image delivery n/a <code>&lt;N&gt;</code> Current CAM selection and availability (CS only)Shows the currently selected CAM and the options available n/a <code>&lt;NC ###&gt;</code> CAM selectionSwitches commands to the CAM at vpin ### or CAM number #(1-4) n/a <code>&lt;NQ&gt;</code> Query state of all SensorsTabulation of all sensor tripped states in banks of 8 F <code>&lt;NF&gt;</code> Forces immediate CAM resetReset into EX-SensorCAM mode, exting any webCAM/WiFi mode R <code>&lt;n/a&gt;</code> Reset EX-SensorCAM \u00a0 (CS &lt;NR&gt; gives equivalent of &lt;Nr 00&gt;)Reset into EX-SensorCAM mode, exting any WiFi mode &amp; <code>&lt;n/a&gt;</code> Print statistics since last '&amp;' cmd.USB histogram of trips and potential trips of 1-3 frames +#,$ <code>&lt;n/a&gt;</code> Add offset of # pixels in $ direction to ALL enabled Sensorsrealign ALL sensors by # pixels in direction specified (N-NW) \\ \u00a0 / \u00a0 @ Commands for lines and trip symbol - refer to manual <p>NOTE:  The EX-SensorCAM USB input will also accept most CS formatted commands.</p>"},{"location":"products/ex-sensorcam/ex-sensorcam/","title":"EX-SensorCAM","text":"<p>EX-SensorCAM is a video based multi-channel position sensing camera.</p>"},{"location":"products/ex-sensorcam/ex-sensorcam/#introduction","title":"Introduction","text":"<p>This single camera is capable of replacing up to 80 detectors/sensors on a model railroad along with their extensive wiring. As it is a cheap device, on large railroads, several cameras can be used for adequate coverage. It can detect, and be used to control, train movements without any trackside sensors at all.</p> <p>Used in conjunction with an I2C bus to a DCC-EX Command Station, the options through X-RAIL automation seem unlimited.</p> <p>It does not, however, include loco or rolling stock identification.</p>"},{"location":"products/ex-sensorcam/ex-sensorcam/#hardware","title":"Hardware","text":""},{"location":"products/ex-sensorcam/ex-sensorcam/#base-processor-module","title":"Base Processor Module","text":"<p>The Camera is a standard ESP32-CAM with an ESP32-CAM-MB (CH-340G based) to add USB capability and, in its simplest form, a PCA9515A i2c interface module. To connect the sensorCAM to i2c, some limited soldering is required to connect the PCA9515A (5 wires) to the USB MB on the CAM. An advanced proto-daughter board is preferable to the PCA9515, to include long i2c buffering (up to 30metres), an isolated power supply, and indicator LEDs. A cheap commercial aerial may be useful in marginal WiFi situations. The newer ESP32-Wrover-CAM and 38P/V4/Expansion board provides compatible and more convenient hardware with all power regulators on-board.  </p>"},{"location":"products/ex-sensorcam/ex-sensorcam/#camera-module","title":"Camera Module","text":"<p>The sensorCAM uses the 32bit ESP32-S microcontroller with an OV2640 camera module. It is fitted with a 4Mbyte PSRAM for image storage and a built in WiFi aerial. It also has 3Mb of available program storage, EPROM memory for parameters, and 327kbytes of dynamic memory. </p>"},{"location":"products/ex-sensorcam/ex-sensorcam/#software-requirements","title":"Software requirements","text":"<p>The Arduino IDE is recommended for the sensorCAM and, if used, the connected EX-Command Station DCC-EX-CS software (5.4.16+) with EX-RAIL. The ESP32-CAM has an Arduino library of software that is needed to enable the camera image manipulation and the WiFi imaging of the railroad. In addition, the Processing 4 application is highly desired to enable railroad images to be captured and sensor positions to be located and seen, as the Arduino IDE cannot give visual feedback.</p> <p>You can download Processing from the website</p> <p>The webserver WiFi images are not a substitute for the Processing 4 utility, as sensorCAM cannot \"sense\" in webserver mode. Specific SensorCAM files are provided for each of the above apps.</p> <p>NOTE: For enhanced versions, rather than \"main/master\" branch, use a recent \"devel\" version of Command Station (5.5.40+) and \"devel\" branch of sensorCAM (0.3.20+)</p>"},{"location":"products/ex-sensorcam/ex-sensorcam/#documentation","title":"Documentation","text":"<p>The sensorCAM is a complex device needing some in depth understanding to achieve its full potential. A 30 page manual is provided to assist with this process.</p> <p>If you want clarification or wish to discuss the implementation please contact the developer on Discord (@Barryd) or at bcdaniel2@optusnet.com.au and he will attempt to address your issues. All feedback is welcome.</p>"},{"location":"products/ex-sensorcam/ex-sensorcam/#outline-of-install-process","title":"Outline of install process","text":"<ol> <li>Acquire ESP32-CAM and MB or ESP32-WROVER-CAM and 38P expander board </li> <li>install Arduino IDE with the ESP32 libraries (includes a WiFi CAM example)</li> <li>Load the CAM with the WiFi (webCAM) example and test.</li> <li>Install the sensorCAM.ino software and configure.</li> <li>Test the basic sensorCAM functions to confirm functional install.</li> <li>Load Processing 4 app. and sensorCAM.pde code.</li> <li>Use the Processing 4 app to replace the Arduino Monitor.  Familiarise and test.</li> <li>Create test sensors and test detection with moving targets.</li> <li>Setup the CAM viewing the model railroad and test a virtual sensor with moving rolling stock.</li> <li>Optimise parameters for best performance.</li> <li>Connect CAM to an i2c interface (e.g. PCA9515A or better).</li> <li>Depending on system, integrate sensorCAM into Command Station using appropriate code.</li> </ol> <p>For a detailed 12 step guide refer to the Installation Guide.</p>"},{"location":"products/ex-sensorcam/installation-guide/","title":"Installation Guide","text":"<p>EX-SensorCAM is an advanced concept foreign to most model railroaders and consequently deals with many unfamiliar issues. It also calls on multiple software applications to address them. The initial software setup for an inexperienced tinkerer is consequently involved and needing perseverance. The Arduino IDE, the ESP32 libraries, the Processing 4 App, the EX-Command Station and EXRAIL (if used) combine to create a unique system supporting the sensorCAM's own software. Any prior knowledge of these will vastly expedite the installation.</p>"},{"location":"products/ex-sensorcam/installation-guide/#outline","title":"Outline:","text":"<p>This installation process is divided into 12 steps outlined below. It is recommended that it be treated as a learning exercise and that testing of progress occur after each major step. For example, familiarization with Arduino IDE should be developed before moving to the ESP32 example, and then familiarize with the ESP32-CAM WiFi example before moving on to the sensorCAM loading.</p> <p>As the sensorCAM is not for Conductors, and perhaps only advanced Tinkerers, it is anticipated that users will already be familiar with the Arduino IDE and maybe already have toyed with the ESP32-CAM. We have not therefore included much detail on the first few steps but rather referred to existing documentation elsewhere (e.g. Arduino &amp; YouTube). Most detail is provided in steps 4 to 8 at this stage.</p> <p>The chapters of the full manual may be referred to where additional detail is sought. The 12 steps are:</p> <ol> <li>Check youtube video then acquire ESP32-CAM and MB/FTDI (OR ESP32-WROVER-DEV CAM)</li> <li>install Arduino IDE with the ESP32 libraries (includes a WiFi CAM example)</li> <li>Load the CAM with the WiFi example and test.</li> <li>Install the sensorCAM.ino software and configure.</li> <li>Test the basic sensorCAM functions to confirm functional install</li> <li>Load Processing 4 app. and sensorCAM.pde code</li> <li>Use the Processing 4 app to replace the Arduino Monitor. Further familiarise and test.</li> <li>With a fixed camera, create test sensors and test detection with moving targets.</li> <li>Setup the CAM viewing the model railroad and test a virtual sensor with moving rolling stock.</li> <li>Optimise parameters for best performance.</li> <li>Connect CAM to an i2c interface (e.g. PCA9515A or better)</li> <li>Depending on system, integrate sensorCAM into Command Station using appropriate code.</li> </ol> <p>Note: Check version of your CH340 driver in Device Manager - Ports. Change if issues arise.</p> <p>Recommended system USB driver is 3.5.2019.1 </p> <p>See Drivers for the CH340 for detailed instructions.</p>"},{"location":"products/ex-sensorcam/installation-guide/#step-1-esp-32-cam","title":"Step 1. ESP-32 CAM","text":"<p>To understand the animal, watch the video at ESP32 CAM - 10 Dollar Camera for IoT Projects - YouTube</p> <p>Be aware that you need a USB adapter and the ESP32-CAM-MB is preferred as it avoids hazards associated with a \"wired\" FTDI power where errors can easily result in CAM destruction. Programming is also easier. Acquire a CAM from your favourite source. Also be prepared for defective product so a spare CAM may be worthwhile. I have had 2 faulty ov2640 modules. ESP32-CAM version 1.9 is preferred (has GND/Reset pin) Purchasing ESP32-CAM-MB as a pair (MB &amp; CAM) is safest. Purchasing two pairs is insurance. Alternatively consider a new compatible ESP32-WROVER-CAM with simpler wiring (see Appendix &amp; sensorCAMmanual)</p>"},{"location":"products/ex-sensorcam/installation-guide/#step-2-install-the-arduino-ide","title":"Step 2. Install the Arduino IDE","text":"<p>If you are not already familiar with this IDE (Integrated Development Environment), rather than go into details that are already covered in great detail on the Arduino web page, just follow the instructions in the following link Arduino IDE Guide and then return here.</p> <p>Step 2A. Install the IDE ESP32 libraries (including for ESP32-CAM).</p> <p>If you are new to ESP32, the board manager for ESP32 must be loaded. This is explained in the video at the 10minute mark. Note: WE MUST USE esp32 by Espressif. Select version 2.0.17 &amp; Install, NOT latest (3.1.x)</p> <p>Introduction to ESP32 - Getting Started - YouTube OR Installing - Arduino-ESP32 2.0.17 documentation</p> <p>OR follow the instructions on the official Espressif guide. again selecting version 2.0.17 to install.</p>"},{"location":"products/ex-sensorcam/installation-guide/#step-3-load-and-test-the-esp32-cam-example","title":"Step 3. Load and test the ESP32-CAM example","text":"<p>Select the tools - board manager and the AI thinker ESP32 CAM. Then run the example as per YouTube at 9:30 minutes in. Run the ESP32 - camera - webserver example. Note: wifi uses 2.4GHz NOT a 5GHz wifi.</p> <p>ESP32 CAM - 10 Dollar Camera for IoT Projects - YouTube For problems with ESP32 connections refer to</p> <p>If you have an issue uploading to an EX-CSB1 - DCC-EX Model Railroading documentation</p> <p>Note: With the MB board there is a push button (IO0) that replaces the FTDI programming link. Hold the button in when powering up the CAM to initiate programming mode. With later versions of esp32-CAM the IO0 push button on the MB may not be needed. Ensure a Huge Partition Scheme is selected.</p> <p></p> <p></p>"},{"location":"products/ex-sensorcam/installation-guide/#step4-install-the-sensorcam","title":"Step4. Install the sensorCAM","text":"<p>\u00a0 4.1 \u00a0 For v5.4.xx, Download the software zip to your PC from https://github.com/DCC-EX/EX-SensorCAM  \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 For a \"devel\" version, rather than \"main\", select the later \"devel\" software (for CS v5.5.15 or higher)  \u00a0 4.2 \u00a0  Right click the zip and click Extract all. Browse to your Arduino sketches folder e.g. Documents/Arduino  \u00a0 4.3 \u00a0  Click Extract, creating new folder e.g. Documents/Arduino/EX-SensorCAM-main  \u00a0 4.4 \u00a0  Rename EX-SensorCAM-main to sensorCAM The essential files for now are shown below. Other files may be used in later install steps.  </p> <p></p> <p>\u00a0 4.5 \u00a0  Using the configCAM.example.h as a guide, create and edit a configCAM.h to reflect your WiFi network name and password.   \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 Then with the correct com port and board selected, compile the sensorCAM.ino sketch.   \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 If all is well, load it into the CAM (replacing the ESP32 WiFi example)</p> <p>Note: It may be necessary to use the MB IO0 button (or GPIO0 link) to get the CAM into upload mode. (refer back to video and/or Appendix below)</p> <p></p> <p></p> <p></p>"},{"location":"products/ex-sensorcam/installation-guide/#step-5-test-the-basic-sensorcam-functions","title":"Step 5. Test the basic sensorCAM functions","text":"<p>The sensorCAM has a suite of command codes with which you will need familiarity. Refer to the manual summary Appendix A or Chapter 5 (Configuration) for more detailed description. For now, open the Arduino monitor and the initialization procedure should scroll out. It requires that the monitor is set for \"115200 baud\" and \"NewLine\" (CR is unacceptable).</p> <p>After about 15 seconds you can enter the 'w' (wait) command into the monitor and the scrolling should pause. Another command such as 'i00' will give a relevant command response, or Enter alone will resume scrolling tabular output. The sensors still need configuring before they can work. Command 't1' will toggle the scrolling status data ON or OFF.</p> <p></p> <p>At this time a NEW CAM will have NO sensors set and is a clean slate needing meaningful configuration data. There may be a default sensor(S00) mid field (120,160). If all is well, this would be a good time to familiarize oneself with some commands starting with k10,50,80 to DEFINE your first sensor, followed by i10 to read info. on the new sensor S10 coordinates (50,80). Try a10 to enable sensor 10, quickly followed by w to \"wait\" scrolling of new sensor values. t1 can be used to toggle ON/OFF the scrolling status data.</p> <p></p> <p>Then try a11,60,90 to DEFINE and ENABLE sensor 11. The 'p1' position pointer command should now list the new sensors and the \"difference\" score hopefully under 39 for any stable sensor provided the camera is fixed and pointing at a reasonably lit area.</p> <p></p> <p>An 'r00' command will take an internal reference photo for ALL sensors (including S10). Follow with 'w'.</p> <p></p> <p>An Enter should resume scrolling with live sensor states and a hand in front of the CAM may trip them (depending on lighting etc.). The w command will again pause scrolling. To save the new sensor settings in EPROM enter the 'e' command. You can undefine(erase) a sensor with 'u', redefine/relocate a sensor with 'a', inspect/interrogate a sensor with 'i', even display the digital (hex) values of pixels in sensor frame with 'f'. Refer to manual chapter 5 for more details on parameters, but do read Section 4.1 (Notation) first.</p> <p>Note: There are other (easier) ways to position new sensors. The coordinate method is best for \"tweaking\" positions by small amounts. Step 6 below leads to the preferable visual setting method.</p> <p></p>"},{"location":"products/ex-sensorcam/installation-guide/#step-6-load-processing-4","title":"Step 6. Load Processing 4","text":"<p>The Arduino monitor is not \"visual\". The Processing 4 software enables one to see what the CAM sees and permits one to place sensors visually. Close down the Arduino IDE to free up the sensorCAM USB com port.</p> <ul> <li>Download the \"processing-4.3-windows-r64.zip\" file from https://processing.org</li> <li>Highlight the zip file and \"Extract all\" files to a suitable Destination directory (process4 say)</li> <li>Locate and make a shortcut to the processing-4.3/processing.exe file on the desktop.</li> <li>Make a sensorCAM folder in process4 &amp; Copy the sensorCAM.pde file into a process4/sensorCAM directory.</li> <li>Click the shortcut thereby opening Processing4</li> <li>Click the GetStarted box on the Welcome window</li> <li>Click file-open, select sensorCAM.pde and open.</li> </ul> <p></p> <p></p> <ul> <li>Click the (left) circular run button to produce the test pattern shown below</li> </ul> <p></p> <p></p> <p>N.B. You may need to edit int comNo=1; if this is an inappropriate port. (see note below)</p> <ul> <li>Reposition and resize the Console window and test pattern to look like that below, wide enough to avoid line wrap-around. The Cmd: line space will be the text entry line to be used for the CAM commands previously used with Arduino monitor. The broad black Console space replaces the sensorCAM monitor display and the test pattern window is for image display and sensor positioning.</li> </ul> <p>Note the first lines of Console output. Choosing the first [0] COM port is the default. Should you have 2 (or more) COM ports listed, you may have to edit line 15: int comNo=0; to reflect your port the sensorCAM is attached to in the list (e.g. [1] as in image below). (Mac's typically show the port as /dev/cu.usbserial-xx)</p> <ul> <li>If the sensorCAM reboots and runs, enter cmd: w Enter or ver Enter which will suspend any scrolling and print the sensorCAM version. Use the scroll bar to view the top/bottom of the Console window. Note that you may have to click the mouse cursor on the Cmd: window before typing commands.</li> </ul> <p>Note the dark blue round icon on the taskbar will bring the image to the front should it vanish behind the Console window. The white round button to the right of \"Run\" will \"Stop\" the sensorCAM.pde program.</p> <p></p> <p>For convenience, locate sensorCAM/sensorCAM.pde and create a shortcut to this file on the desktop.</p> <p>Optionally, the file Users/[Barry]/AppData/Roaming/Processing/preferences.txt can be edited with a text editor (e.g. notepad) for more convenient startup of sensorCAM.pde. Depending on your screen resolution, for convenience, adjust the window.height.default=700 and window.width.default=1200 as below. This should ensure that the opening Processing 4 window is higher and wide enough to avoid undesirable line-wrapping of scrolling sensor state tabulation. You can adjust these settings later if 700x1200 is not optimum for your screen resolution and sensor count.</p> <p></p>"},{"location":"products/ex-sensorcam/installation-guide/#step-7-use-the-processing-4-app-to-replace-the-arduino-monitor","title":"Step 7. Use the Processing 4 App to replace the Arduino monitor.","text":"<ul> <li> <p>The processing app. can communicate the same commands to the sensorCAM as used in Step 5 above.</p> </li> <li> <p>Proceed to verify the sensorCAM commands are generally working as before with Arduino IDE.</p> </li> <li> <p>New commands can now be explored to see still images from the CAM and to see location of defined sensors as small squares. Enter the command 'Y' at the Cmd: line and wait 15 seconds for a full image to appear. Remember the sensors after rebooting will be those last stored in EPROM, not last defined.</p> </li> </ul> <p>To explore the imaging functions (W, X, Y, Z) in depth refer to the sensorCAM manual Chapter 6.</p> <p></p>"},{"location":"products/ex-sensorcam/installation-guide/#step-8-create-test-sensors-and-test-detection-with-moving-targets","title":"Step 8. Create test sensors and test detection with moving targets","text":"<p>Create some test sensors using Processing 4 by typing Cmd: a31 (no Enter!) and following with a click on the image previously obtained as above. The command line will be completed with the cursor coordinates. Follow up with an Enter to define a new sensor S31. Verify the new sensor with a 'p3' command and SEE the new sensor with a new 'Y' command. Later versions \"box\" the new sensor automatically.</p> <p>The sensor squares on the image are colour coded with the b/s number using the standard resistor colour codes (refer manual Appendix E).</p> <p>Place a coloured object at the sensor position and observe the change in the scrolling tabulation for the sensor. Without the obstruction, after a reference command ('r00'), the difference score should be below 39 and with the obstruction the diff score should rise substantially. If the threshold is set ('t42' say) the sensor will \"trip\" and indicate occupied confirming successful installation. A moving hand test is an easy quick test to do.</p> <p>It is advisable to define a \"reference\" sensor S00 that will NOT be obstructed. Any trips of this sensor will indicate an unwanted change to the environment (e.g. lighting). To define such a sensor use a00 and a Processing 4 image \"click\" on a quiet location away from tracks but with \"good\" mid-range illumination</p> <p>(see Manual section 8.4). S00 is reserved and displayed separately at the left of the scrolling status table.</p>"},{"location":"products/ex-sensorcam/installation-guide/#step-9-setup-the-cam-viewing-a-railroad-and-test-a-virtual-sensor-with-moving-rolling-stock","title":"Step 9. Setup the CAM viewing a railroad and test a virtual sensor with moving rolling stock.","text":"<p>The CAM must be rigidly mounted, in a \"convenient\" location for testing at this stage. It may be limited by your cabling reach with USB control. Later, with buffered I2C and power, the sensorCAM may be able to be located more optimally.</p> <p>The Manual Chapter 5 covers many points of relevance to getting satisfactory detection. Review this chapter and test topics for clarification. Good familiarity leads to success. Initial tests should be with good contrast between track and rolling stock. Refine parameters later to handle more difficult targets.</p>"},{"location":"products/ex-sensorcam/installation-guide/#step-10-optimise-parameters-for-best-performance","title":"Step 10. Optimise parameters for best performance.","text":"<p>Initially by trial &amp; error users will learn the significance of parameters. This is an Alpha release and consequently the default settings may not be best. Refer sensorCAM manual Appendix B.</p>"},{"location":"products/ex-sensorcam/installation-guide/#step-11-connect-cam-to-an-i2c-interface-eg-pca9515a-or-better","title":"Step 11. Connect CAM to an i2c interface (e.g. PCA9515A or better)","text":"<p>The quickest and simplest method is to fit a PCA9515A to the ESP32-CAM-MB. Refer to the manual Chapter 3, the pictures in the manual (Figure 7 and Appendix F). Level shifting (3.3V to 5V) for a Mega is the primary function of the PCA9515A. Adjust voltages if not 5V compliant (e.g. ESP32 Command Station). It has 10k pull-up resistors but extra may be needed. If distance is an issue, as the PCA9515A is limited to about 3metres, either an LTC4311A enhancer or a buffered i2c solution will be needed. The manual Ch. 7 &amp; Appendix F describes the PCA9515A used, but the Sparkfun differential Endpoint is also recommended.</p>"},{"location":"products/ex-sensorcam/installation-guide/#step-12-depending-on-system-integrate-sensorcam-into-command-station-using-appropriate-code","title":"Step 12. Depending on system, integrate sensorCAM into Command Station using appropriate code.","text":"<p>The CAM can be connected to a \"Control Station\" via i2c using appropriate host code (typically C++). It has been successfully interfaced to two different (Arduino Mega) systems but most focus has been on the DCC-EX-Command Station (CS). The sensorCAM can be connected to a CS and interrogated using EXRAIL.</p> <p>If you are wanting to integrate with a CS, we assume you have installed EX-CS previously. If not, refer to the DCC-EX website for details. The following guide assumes you have a working v5.4.x CS in place.</p> <p>12.1 The EX-SensorCAM repository has an EX-CS directory. These files normally reside with the CommandStation-EX.ino beside the other standard CS files. They are a guide to what is needed in the existing files in the _CommandStation-EX._ino directory. The user generally needs to EDIT existing files rather than copy these. The CamParser.cpp and IO_EXSensorCAM.h drivers already included in CS v5.4.16+ should be adequate for a \"Production/master\" CS installation, so do NOT copy these files from folder EX-CS unless they represent a known recommended upgrade to the integrated functions. It is advisable to make backups of any file you do need to edit in installing sensorCAM (12.2-12.5 below).</p> <p></p> <p>12.2 Edit CS config.h file adding #define SENSORCAM_VPIN 700 and #define CAM SENSORCAM_VPIN+ exactly as shown below for your first CAM. If you do NOT want to use vpins 700 to 779 for the sensorCAM virtual sensors, or use multiple sensorCAM's, you may adjust the vpin number accordingly. Be careful to not change any other CS config.h code from your previous working CS installation. This suits both CS Production (main) version v5.4.0+ and versions v5.5.15+ (devel) versions.</p> <p></p> <p>12.3 Edit your myAutomation.h to tell CS to include/create a driver for sensorCAM. Add the sensorCAM driver to your myAutomation.h with a HAL(EXSensorCAM, SENSORCAM_VPIN, 80, 0x11) assuming at I2C address 0x11. The SENSORCAM_VPIN value (typically 700) has been defined in config.h (step 12.2)</p> <p></p> <p>12.4 Now the individual sensor IDs need to be assigned to vPin numbers through the mySetup.h file. They can be added in manually later, so we don't have to have all 80 defined now. (Edit &amp;) copy to the CS folder.</p> <p>Be sure to include a command I2CManager.setClock(100000); if using an older version of DCC-EX as only the latest IO_EXSensorCAM.h drivers v308 and v309 do this automatically.</p> <p></p> <p>12.5 If you are using the DCC-EX installer keep your revised \"myFiles\" in the usual place and include them when requested. Otherwise they go in the same directory (CommandStation-EX) as the CommandStation-EX.ino and related files.</p> <p>With the release of CS Production version v5.4.0, the former sensorCAM myfilter method was made redundant. Versions of CS beyond v5.4.0 all use the CamParser.cpp method and have IO_EXSensorCAM.h CamParser.cpp and CamParser.h included by default. These files DO NOT need to be overwritten. Unless you wish to (were advised to) use the latest \"bleeding edge\" devel versions offered, proceed to step 12.6.</p> <p></p> <p>12.6 Once the changes have been put in place, the CommandStation-EX.ino file will have to be recompiled and loaded into the CS (Mega?) using the Arduino IDE, to invoke the changes. Refer to the sensorCAM manual Appendix G for details on using the CS monitor to replace the sensorCAM USB monitor. Initially it would be helpful to maintain a USB monitor on the sensorCAM to catch and verify activity. Note that there are some differences in the capabilities and format of displays between CAM USB monitor and CS. No visual imagery can be obtained via CS (except webcam) once the USB is disconnected. The CAM MUST be flashing to respond correctly to most \"Native\" CS &lt;N&gt; sensorCAM commands.</p> <p>12.7 After up-loading to the Command Station, open the Arduino Monitor (at 115200 baud) to see the CS \"console\". If the sensorCAM i2c is connected and the CAM running (flashing), the user's &lt;Nw&gt; CS command should issue the CAM wait command (stops flashing) and another &lt;Nw&gt; should resume. Note it can be helpful to have 2 instances of the IDE, so you can separately monitor CS and CAM on two USB ports.</p> <p>The CS installer also has a monitor that can interface to the CS. Try the Processing4 monitor on the CAM.</p> <p></p> <p></p> <p>With CAM flashing, try &lt;N m&gt;, &lt;N i 11&gt; and &lt;N t 46&gt; to confirm functionality, then &lt;NM&gt; for current min/max settings. Note &lt;N t 0&gt; command returns the LAST value of threshold. Repeat just to confirm changes, if necessary, or just use &lt;NM&gt;. Cmd &lt;Nv&gt; will show the Vpin usage and version of sensorCAM.</p> <p></p> <p>12.8 Powering up the CS and CAM(s) can be problematical. The bootup interactions are affected by the following:</p> <p>a) ALL devices on an i2c bus should be powered for i2c communications to be reliable.</p> <p>b) Full sensorCAM boot-up calls MyWire.begin() which FAILS if a) is incomplete.</p> <p>c) CS bootup executes driver EXSensorCAM::create(); which FAILS if b) is unsuccessful.</p> <p>To avoid a race between b) and c) the CS has a STARTUP_DELAY 5000 (5sec.) to allow b) time to boot. Rebooting a sensorCAM AFTER 5 seconds (b) can break the connection the CS had established, and so it may need to be followed by a reboot of CS (c).</p> <p>Opening an Arduino IDE monitor on the CS OR sensorCAM (or uploading software) can cause a reboot of the respective microprocessor, so the above issue needs to be appreciated and catered for, possibly with a following CS or CAM reboot. It is a common issue with all \"smart\" peripherals (e.g. EX-IOExpander).</p> <p>12.9 To use EX-RAIL, refer to the EX documentation regarding general sensor usage.</p> <p>Refer to the sensorCAM manual Appendix H for further tips regarding sensorCAM with EXRAIL.</p> <p>Note: As there are up to 80 sensors or banks of sensors, the #define CAM .. in step 12.2 above helps. The vPin management can be simplified by using the substitution for vPin of (CAM 0%%) which automatically calculates the vPin for sensor S%%. For example, AT(CAM 010) will wait for S10 to trip.</p> <p>12.10 To manage MULTIPLE sensorCAMs, it is advisable to follow a convention to avoid errors, as follows:</p> <p>a) Choose a sequential address range (e.g. 0x11,0x12,0x13,0x14) for CAM1 CAM2 .. CAM4 respectively, and preferably a simple sequential base_vPin series (e.g. 500,600,700 say). Then using Arduino IDE\u2026</p> <p>b) For each CAM# in turn, open sensorCAM.ino &amp; edit configCAM.h (e.g. #define I2C_DEV_ADDR 0x12 ) AND edit sensorCAM.ino #define BCDver 320 (e.g. change 320 to 12320). THEN File&gt;SaveAs sensorCAM320.12 Upload to CAM# (CAM2). This saves distinct identifiable versions for each one of your multiple CAMs. The 'v' command will identify which CAM is which. (works best for 0x11-17 only)</p> <p>This fudge makes management of multiple sensorCAMs less error prone ('v' will show version as 12.3.20).</p> <p>c) In CS myAutomation.h create sequential drivers for CAM,CAM2, .. (starting with CAM 0x11) (e.g. then</p> <p>HAL(EXSensorCAM, SENSORCAM2_VPIN, 80, 0x12); if needed, repeat for 0x13 &amp; 14.</p> <p>d) In CS config.h, define CAM2, CAM3 &amp; CAM4 as for CAM in config.h (e.g.</p> <p>#define SENSORCAM2_VPIN 600</p> <p>#define CAM2 SENSORCAM2_VPIN+</p> <p>e) edit CS MySetup.h to display all required sensors in each CAM. e.g. for CAM2 (2bs from base vpin 600)</p> <p>for(uint16_t b=1; b&lt;=4;b++) for(uint16_t s=0;s&lt;8;s++) Sensor::create(200+b*10+s,600+b*8+s,1);_</p> <p>N.B. This consumes RAM, so unnecessary sensors my cause a MEGA to run out of memory. If memory is limited, only \"create\" (JMRI) sensors that you want to see switching/tripping on the CS monitor.</p> <p>&lt;D RAM&gt; shows remaining free memory. The Command Station cannot run with near 0 free RAM.</p> <p>f) Once loaded and booted, make use of the CamParser switch-cam commands by adding an [optional] cam # to bs numbers (e.g. &lt;N&gt; &lt;Ni 112&gt; &lt;Np 201&gt; &lt;NV 300&gt; &lt;NC vpin&gt;. &lt;N&gt; shows current CAM (vPin).</p> <p>g) In EXRAIL scripts, select CAM# by using ID format (CAM# 0%%) e.g. AT(CAM2 012) for sensor S(2)12.</p>"},{"location":"products/ex-sensorcam/installation-guide/#appendix-esp32-cam-pinout-reference-cam-version-v16-wrover-cam","title":"APPENDIX ESP32-CAM pinout reference (CAM version v1.6) &amp; WROVER-CAM","text":"<p>N.B. CAM v1.6 has 4x jumpers (cam side) near U0R/U0T pins &amp; CAM v1.9 has 6x jumpers (including RST)</p> <p>In board version v1.9, the \"GND\" pin adjacent GPIO1/U0T is used for RESET (GND/R) to ESP32-CAM and MUST NOT be tied to GND or CAM will remain in RESET mode. CHIP version shows at start of upload, e.g.</p> <p></p> <p>The esp32-CAM-MB obtained with extra headers uses an 8pin CH340N IC unlike the 16 pin package used on the \"regular\" MB devices (micro-B). The wider MB (Type C) also has an issue in that it does NOT have a reset pin because the RST/GND socket is PERMANENTLY connected to GND which may hold CAM v1.9 in permanent Reset.</p> <p></p> <p>So - without butchery, one can only use the v1.6 CAM's on this board \u2639, and even then will have to hold the IO0 button in (grounding it) on reset until upload is progressing. As a workaround for v1.9, it may be possible to slice off this MB GND socket completely. View the Camera side of the ESP32-CAM to distinguish the boards.</p> <p>Identification: ESP32-CAM v1.6 has 4x jumpers beside UOR/UOT pins and v1.9 has 6x jumpers (inc. Reset).</p> <p>Using v1.6 with no RTS/DTR reset, users may have to boot up holding IO0 button in to get into programming mode.</p> <p>ESP32-WROVER-DEV or FREENOVE ESP32-WROVER-CAM board with 4Mb PSRAM is an acceptable single board substitute for the ESP32-CAM-MB combo. Both use the ov2640 camera. Version v316 of sensorCAM incorporated minor adjustments to cater for the WROVER pinout differences. The WROVER may be about twice the cost of the ESP32-CAM-MB (without tarrifs), but, if you have one, it is simpler and may be better quality.</p> <p>The WROVER has many more pins than the CAM-MB and may be repurposed without the CAM, BUT with the ov2640 CAM module there is really only one extra pin (GPIO32) free.</p> <p>The FLASH LED is missing, but the on-board blue LED has an output pin GPIO2 instead of GPIO4. SensorCAM v316 flashes the blue LED. There is no fitted external antenna socket.</p> <p>To use sensorCAM (v316 and above) with the WROVER (using i2c pullups on Endpint):</p> <p>1. Add #define CAMERA_MODEL_WROVER_KIT to the end of configCAM.h</p> <p>2. Before compiling, select ESP32 board 'ESP32 Wrover Module' (and 'huge/No OTA' partition) (still using Board Manager installed Espressif 2.0.17, not any newer version)</p> <p>3. Compile &amp; upload sensorCAM.ino (v320) as per ESP32-CAM (using WROVER USB port).</p> <p>4. Recommended: Add a 1uF capacitor, reset(EN)-GND and, if needing the programmable LED (pLED), connect a high efficiency LED between 3.3V (NOT 5V) &amp; GPIO14 via a 470R resistor to the 38P Expander board as was suggested for the ESP32-CAM-MB.</p> <p>5. Wire the external unregulated (7-9V) power links to the barrel connector and i2c SDA &amp; SCL to matching pins (P13&amp;P15) similar to the ESP32-CAM-MB.</p> <p></p> <p></p> <p>The WROVER based sensorCAM, using an ESP32S 38-pin Expansion board and Sparkfun Endpoint, offers the simplest hardware and interconnect shown below. It is a good alternative to the ESP32-CAM-MB based options. Search for WROVER in the sensorCAM manual (v3.18) for additional details on this recommended hardware. N.B. the 2 USB ports on expander are 5V power only, without any comms.</p> <p>Note the two \"surplus\" pins on the 40-pin CAM USB end (Vcc &amp; GND) and assemble appropriately.</p> <p></p> <p></p> <p>The sensorCAM software does not use any memory card slot and uses only 4MB PSRAM so the reduced spec. of the 240MHz ESP32-WROVER-DEV product is equally adequate and has a compatible footprint.</p>"},{"location":"products/ex-toolbox/connect_wifi_throttle_via_usb/","title":"Connecting WiFi Throttles via USB","text":"<p>EX-Toolbox and WiFi throttles can't normally connect to an EX-CommandStation via USB, however it is possible to temporarily create a USB to IP connection on your PC using tools like socat or SerialToIPGUI (for windows).</p>"},{"location":"products/ex-toolbox/connect_wifi_throttle_via_usb/#using","title":"Using","text":""},{"location":"products/ex-toolbox/connect_wifi_throttle_via_usb/#using-socat-in-linux","title":"Using socat in Linux:","text":"<p><code>socat TCP4-LISTEN:2560 /dev/ttyUSB0,b115200,raw,echo=0</code></p> <p>or (to provide more information)</p> <p><code>socat -d -d -d TCP4-LISTEN:2560 /dev/ttyUSB0,b115200,raw,echo=0</code></p> <p>Note: Change 'dev/ttyUSB0' to the appropriate USB port that the command station is connected to.</p>"},{"location":"products/ex-toolbox/connect_wifi_throttle_via_usb/#using-socat-in-microsoft-windows","title":"Using socat in Microsoft Windows:","text":"<p><code>socat TCP-LISTEN:2560 /dev/ttyS11,b115200,raw,echo=0</code></p> <p>or (to provide more information)</p> <p><code>socat -d -d -d TCP-LISTEN:2560 /dev/ttyS11,b115200,raw,echo=0</code></p> <p>Note: Change S11 to the appropriate USB port.  Whatever 'COM' number appears in the Device Manager, subtract 1.  |BR| i.e. 'COM12' in the Windows Device Manager becomes '/dev/ttyS11'</p>"},{"location":"products/ex-toolbox/connect_wifi_throttle_via_usb/#using-serialtoipgui-for-microsoft-windows-recommended","title":"Using SerialToIPGUI (For Microsoft Windows) (Recommended):","text":"<p>SerialToIPGUI</p> <ul> <li>start SerialToIPGUI</li> <li>Select the correct COM port for the command station</li> <li>Enter the port of '2560' </li> <li>Click <code>Start</code></li> </ul> <p>Once started...</p> <ul> <li>Open your WiFi throttle app on your Android/iOS/etc. device</li> <li> <p>On the connection screen/fields:</p> </li> <li> <p>Enter the IP address of your PC (The one running socat or SerialToIPGUI)</p> </li> <li> <p>Enter the port of '2560' </p> </li> <li> <p>Connect</p> </li> </ul> <p>important: This 'trick' only supports a single connection at a time.  So it is important that |JMRI| (if you are using it), or the |Arduino IDE| serial monitor, or anything else that might be using the COM (USB) port are shut down first.</p>"},{"location":"products/ex-toolbox/connect_wifi_throttle_via_usb/#downloads","title":"Downloads","text":"<ul> <li>SerialToIPGUI  - https://sourceforge.net/projects/serialtoip/ |EXTERNAL-LINK|</li> <li>socat for windows requires downloading the 'cgywin' and installing the optional 'socat' package when you install - https://www.cygwin.com/ |EXTERNAL-LINK|</li> </ul>"},{"location":"products/ex-toolbox/connect_wifi_throttle_via_usb/#troubleshooting-windows-socat","title":"Troubleshooting (Windows socat)","text":"<p>In Microsoft Windows and using the command line socat, if you see a \"command not found\" error, Here is what you need to do to fix it:</p> <ul> <li>Right click on \"My Computer\" -&gt; Properties -&gt; Advanced -&gt; Environment Variables</li> <li>Add a new environment variable, called <code>CYGWIN_HOME</code> and set its value to <code>C:\\cygwin</code></li> <li>Edit the PATH environment variable and add <code>C:\\cygwin\\bin</code> to it (usually separated by a ';').</li> <li>Just click okay, exit any command prompts or bash shells (over cygwin) you may have open, and open it again - it'll work!</li> </ul> <p>Note that if you installed cgywin to a folder other than \"C:\\cgywin\" (e.g. c:\\cgywin64), use that folder name instead in the change above.</p>"},{"location":"products/ex-toolbox/ex-toolbox/","title":"EX-Toolbox - Overview","text":"<p>EX\u2011Toolbox is a free, open source, Android app to help setup and configure your EX\u2011CommandStation. It is intended for setup, configuration, debugging your Command Station rather than continuous use.</p> <p>It is designed to function if your EX\u2011CommandStation is configured with WiFi (either Access Point mode or Station mode) or Ethernet.</p> <p>However: </p> <ul> <li> <p>While it can't normally connect to a EX\u2011CommandStation through JMRI, it is possible if you 'Load DCC++ over TCP Server' in the 'DCC-EX' menu in JMRI, then connect EX\u2011Toolbox to the additional server that is presented.</p> </li> <li> <p>While it can't normally connect to a EX\u2011CommandStation though USB, there some options that can allow this to work partly. See Connecting via USB for details.</p> </li> <li> <p>While EX\u2011Toolbox normally needs to be installed on your phone or tablet, it may be installed on Windows PC under a suitable Android emulator. Refer to the Installation Guide</p> </li> </ul>"},{"location":"products/ex-toolbox/ex-toolbox/#features","title":"Features","text":"<ul> <li>CV Programming in the programming track (Service Mode)</li> <li>CV Programming in the main track (Operation Mode)</li> <li>Servo motor testing and adjustment</li> <li>Sensor testing</li> <li>Current Meter</li> <li>Track Manager</li> <li>Loco status (all active locos)</li> <li>Assist with Loco Speed Matching</li> <li>Speedometer (requires two sensors on the EX\u2011CommandStation)</li> <li>Roster list</li> <li>NeoPixel Setup</li> </ul>"},{"location":"products/ex-toolbox/installation-guide/","title":"Installing EX-Toolbox","text":""},{"location":"products/ex-toolbox/installation-guide/#installing-ex-toolbox-on-an-android-phone-or-tablet","title":"Installing EX-Toolbox on an Android phone or tablet","text":"<ul> <li>Open the Play Store app on your Android phone or tablet and search for 'EX-Toolbox'. Or use the QRCode below</li> </ul> <ul> <li> <p>Once installed, open EX\u2011Toolbox and it will go through the initial setup wizard where it will ask for one permission, and for which which theme you would like to use.</p> </li> <li> <p>After you complete the setup wizard, you will be shown the 'Connection' Screen.</p> </li> </ul>"},{"location":"products/ex-toolbox/installation-guide/#installing-ex-toolbox-on-ms-windows-macos","title":"Installing EX-Toolbox on MS Windows &amp; macOS","text":"<p>EX-Toolbox and all the Android based throttle apps listed can be run on Microsoft Windows PCs and Apple Silicon Macs using BlueStacks.</p> <p>BlueStacks</p> <p>The BlueStacks app allows you to install and run most Android apps on most recent Windows PCs.</p> <p>It has the advantages of:</p> <ul> <li> <p>Works on most recent Windows PCs and Apple Silicon Macs</p> </li> <li> <p>User Friendly installation of apps</p> </li> <li> <p>Allows you to run multiple instances of same app at the same time</p> </li> </ul> <p>Disadvantages include:</p> <ul> <li>Has advertisements</li> </ul> <p>Follow the instructions on their site  to install BlueStacks, then get the appropriate .apk to install the throttle app you want. e.g. The Engine Driver .apk is available from the EX-Toolbox Github page. </p>"},{"location":"products/ex-toolbox/installation-guide/#connecting-to-your-command-station","title":"Connecting to your Command Station","text":"<p>Please remember that to connect to a Wifi EX-CommandStation on the correct WiFi network.</p> <ul> <li> <p>If you are running your EX-Commandstation in Access Point (AP) mode, you must switch your phone or tablet Wifi to the access point / Wifi network/SSID that the EX-CommandStation has created.</p> </li> <li> <p>If you are running your EX-Commandstation in Station mode, you must switch your phone or tablet Wifi to your hopke access point / Wifi network/SSID. that same one that the EX-CommandStation is connected to.</p> </li> </ul>"},{"location":"products/ex-toolbox/installation-guide/#starting-ex-toolbox","title":"Starting EX-Toolbox","text":"<p>Other than the very first time you start EX\u2011Toolbox, when the app opens you will be shown the 'Connection' screen. </p> <p>There are three ways you can select a EX\u2011CommandStation to connect to:</p> <ul> <li> <p><code>IP Address and Port</code>    To find your EX-CommandStation's IP address and Port refer you original setup or, if you have a OLED screen on your command station the details will be displayed on it.   The port will normally be 2560.</p> </li> <li> <p><code>Discovered Servers</code>    If the server you want to connect to is in the list, simply click on it and you will be taken to the 'CV-Programming' screen.</p> </li> <li> <p><code>Recent servers</code>    If the server does not appear in the recent list try one of the other two methods. Your server not appearing in the recent list is not necessarily a problem and there can be a number of reasons why.</p> </li> </ul> <p>Notes</p> <ul> <li> <p>Important! EX\u2011Toolbox can only connect directly to an EX\u2011CommandStation or JMRI's 'DCC++ over TCP Server', however JMRI, the EX\u2011CommandStation and other devices and apps can, or do, advertise as \"WiThrottle\" mDNS services. EX-Toolbox cannot determine which are actually direct connections to an EX\u2011CommandStation or JMRI's 'DCC++ over TCP Server'.</p> </li> <li> <p>If you only ever connect to one EX\u2011CommandStation you can effectively bypass this screen by setting the 'Auto-Connect to WiThrottle Server?' preference.</p> </li> </ul> <p>Follow the User Guide</p>"},{"location":"products/ex-toolbox/user-guide/","title":"EX-Toolbox User Guide","text":"<p>Various screens can be accessed via the dropdown menu or by swiping left and right.</p>"},{"location":"products/ex-toolbox/user-guide/#cv-programming","title":"CV Programming","text":"<p>DCC Decoder CV programming is available:</p> <ul> <li>on the Programming track (PROG) - Service Mode</li> <li>on the main line (MAIN) - Operation mode / Ops Mode</li> </ul> <p>By default EX\u2011Toolbox shows the Service Mode options. To switch to Operation Mode, select \"Program on Main (Operation Mode)\" on the drop down list at the top of the screen.</p>"},{"location":"products/ex-toolbox/user-guide/#cv-programming-service-mode","title":"CV Programming (Service Mode)","text":"<p>Service Mode CV Programming is available form the 'CV Programming' screen, when 'Programming Track (ServiceMode)' is selected in the drop down list at the top of the screen.</p> <p>Service Mode CV Programming allows you to both Read (if the decoder/loco supports it) and Write CVs.</p> <p>You do not need to know the DCC Address of the decoder being changed, as all decoders/locos currently on the programming track will have the CV changed at the same time.</p> <p>Track power is managed automatically by the Command Station.</p> <p>Do not be temped to manipulate decoder addresses by reading or writing individual CVs, this is very complicated and may require as many as 6 Cvs to be understood.</p> <p>On this screen you can:</p> <ul> <li> <p>read the decoder's DCC Address. (this reads multiple CVs to obtain the driveable address, which may be a consist)    Click the Read button on the DCC Address row.</p> </li> <li> <p>write a new DCC Address to the decoder. (This writes multiple CVs to automatically manage long and short addresses.)    Enter the address and click the Write button on the DCC Address row.</p> </li> <li> <p>read a CV value from the decoder    Enter the CV number and click the Read button on the CV row.</p> </li> <li> <p>write a CV value to the decoder    Enter the CV number, enter the value and click the Write button on the CV row.</p> </li> <li> <p>select from a list of named, common CVs    If you select a 'common CV value' it will enter the CV number into the field. From there follow the instructions above for reading or writing the CV.</p> </li> <li> <p>issue &lt;&gt; commands to the EX\u2011CommandStation</p> </li> </ul>"},{"location":"products/ex-toolbox/user-guide/#cv-programming-operation-mode","title":"CV Programming (Operation Mode)","text":"<p>Operation Mode CV Programming is available from the 'CV Programming' screen, when 'Program on Main (Operation Mode)' is selected in the drop down list at the top of the screen.</p> <p>Operation Mode CV Programming ONLY allows you to Write CVs.</p> <p>To use Operation Mode CV Programming you must know the DCC Address of the decoder/loco you want to change. Note: you should never try to change the DCC Address of the decoder/loco using Operation Mode CV Programming.</p> <p>On this screen you can:</p> <ul> <li> <p>write a CV value to the decoder    Enter the DCC Address of the decoder, enter the CV number, enter the value and click the Write button on the CV row.</p> </li> <li> <p>select from a list of named, common CVs    If you select a 'common CV value' it will enter the CV number into the field. From there follow the instructions above for writing the CV.</p> </li> <li> <p>issue &lt;&gt; commands to the EX\u2011CommandStation</p> </li> </ul>"},{"location":"products/ex-toolbox/user-guide/#issuing-commands","title":"Issuing &lt;&gt; Commands","text":"<p>On several of the screens in EX\u2011Toolbox you can issue native DCC-EX <code>&lt;&gt;</code> commands to your EX\u2011CommandStation.</p> <p>Enter the command you want to send, and click <code>Send</code>.</p> <p>The command you send, and any responses from the command station will be shown below.</p> <p>If you select a 'common command value' it will enter the command the field. From there follow the instructions above for issuing the command.</p> <p>You can use the Next and Prior buttons to retrieve previously issued commands.</p>"},{"location":"products/ex-toolbox/user-guide/#speed-matching","title":"Speed Matching","text":"<p>Speed Matching assists with making two or more locos run at similar speeds.</p>"},{"location":"products/ex-toolbox/user-guide/#requirements","title":"Requirements","text":"<ul> <li> <p>A loop of track.</p> </li> <li> <p>A loco that you wish to be the Master. i.e. that you want to make the other locos match.</p> </li> <li> <p>One or more 'Second' locos that you wish to match to the Master.</p> </li> <li> <p>All the locos have been run for 5-10 minutes to warm them up. Many locos run differently when warm.</p> </li> </ul>"},{"location":"products/ex-toolbox/user-guide/#assumptions","title":"Assumptions","text":"<ul> <li> <p>You have already configured the 'Master' to be the way you want it and the other locos to behave.</p> </li> <li> <p>The 'Master' should be the naturally slowest loco of the set, not necessarily the one that will be run in the lead position.    i.e. Test your locos on their default settings first, and find the slowest.</p> </li> <li> <p>The low speed test uses a speed setting of 5 (0-126). If your locos don't start moving at that setting it would be advisable to adjust Low speed setting and/or the Kick Start of the 'Master' first.</p> </li> <li> <p>At least, the 'Second' loco is configured to use the High, Mid, Low CVs, not the full 28 step 'Speed Table'. (Part of CV29) Not critical, but it is advisable to have the 'Master' also use the High, Mid, Low CVs.</p> </li> <li> <p>The 'CV Programming' Page of EX\u2011Toolbox has a feature specific to CV29. When you read CV29, it explains what you need to change the value to to disable the 'Speed Table'.</p> </li> <li> <p>It is highly advisable that BACK-EMF is turned off on all locos that will be run in a consist. If you don't you will likely encounter surging of the locos as they speed up and slow down under individual load.    BACK-EMF is referred to by some manufacturers as 'Dynamic Compensation for Speed Stabilisation', 'Scaleable Speed Stabilisation' or 'Load Compensation'. Unfortunately there is no standard way to disable BACK-EMF. You will need to refer to the manuals for your decoders.</p> </li> </ul> <p>This page has a detailed explanation of BACK-EMF and details on how to change it for a number of manufacturers.</p> <p>It is well worth viewing the video before starting as it makes the process clear in a way text does not.</p>"},{"location":"products/ex-toolbox/user-guide/#instructions","title":"Instructions","text":"<ul> <li> <p>Put the/a second (non-master) loco on the PROG track. (see Notes)</p> </li> <li> <p>Click <code>Read -PROG trk</code>.    This reads 8 CV values, including the loco address and CV29, and loads them in to the fields, with a 3 second delay between each read.    Watch for any -1 responses (failed reads), and redo the read if any have failed.</p> </li> <li> <p>Put the 'Master' on the MAIN track (the loop of track), along with the 'Second' loco.</p> </li> <li> <p>Enter the DCC address of the Master.</p> </li> <li> <p>Click the <code>Low Set Speed</code> button.    Watch and adjust the speeds of the Second loco in relation the Master, util they run at the same speed.    Use the speed input or use the <code>+</code> and <code>-</code> buttons to adjust the second loco speed.</p> </li> <li> <p>Repeat for the 'Mid' Speed.</p> </li> <li> <p>Repeat for the 'High' Speed.</p> </li> </ul> <p>Adjust the decoder momentum (Acceleration/Deceleration) and Kick Start as needed. Test by starting and stopping the locos from the three different speeds.</p> <p>If you have more locos to match, repeat from step 2.</p> <p>Notes:</p> <ul> <li> <p>By default, the <code>+</code> and <code>-</code> buttons change the CV values by 1. You can change this step amount by editing the 'Step' field.    e.g. When I start on a loco, I normally have the Step at 10. When it gets closer to a match I change the step to 1.</p> </li> <li> <p>You don't need a separate PROG track. You can use the 'Track Manager' screen to temporarily set the loop of track to PROG for steps 2-3, then change it back to MAIN for steps 4 on.</p> </li> <li> <p>Some decoders don't support Kick Start.</p> </li> <li> <p>Some decoders don't allow you to turn BACK-EMF off. Check your decoder manual.</p> </li> <li> <p>The low speed test uses a speed setting of 5 (0-126). If your locos don't start moving at that setting it would be advisable to adjust Low speed setting and/or the Kick Start of the 'Master' first.</p> </li> </ul>"},{"location":"products/ex-toolbox/user-guide/#speedometer","title":"Speedometer","text":"<p>The Speedometer allows you to calulate the scale speed of a loco as it passes two defined sensors. The sensors can be of any type, but must be configured in your EX\u2011CommandStation and be a known (any) distance apart.</p> <ul> <li>Define you sensors in the EX\u2011CommandStation configuration, and note their numbers.    You will need to make them monitored for updates by adding JMRI_SENSOR commands in myAutomation.h, or by using the command input screen to enter <code>&lt;S vpin vpin 1&gt;</code> commands for each sensor.   e.g.</li> </ul> <pre><code>JMRI_SENSOR(160,2)  // pins 160 and 161\nor \nJMRI_SENSOR(160) JMR_SENSOR(161)\n</code></pre> <p>or Enter commands:</p> <pre><code>&lt;S 160 160 1&gt;\n&lt;S 161 161 1&gt;\n</code></pre> <p>When you run with either of these methods, the sensors will emit <code>&lt;Q 160&gt;</code> or <code>&lt;q 160&gt;</code> messags which the Toolbox will recognize.</p>"},{"location":"products/ex-toolbox/user-guide/#speedometer-instructions","title":"Speedometer Instructions","text":"<ol> <li> <p>Measure the distance between the sensors.</p> </li> <li> <p>Enter the two sensor numbers on the speedometer screen.</p> </li> <li> <p>Enter the distance between the sensors, and select the Scale.</p> </li> <li> <p>Put the loco you want to measure on the track before the first sensor.</p> </li> <li> <p>Start the loco moving.</p> </li> <li> <p>The Speedometer will display the speed as the loco after it passes the second sensor.</p> </li> </ol> <p>The speed and times will automatically reset after 10 seconds, but you can overide this by clicking the Start button. Or you can change the delay period. </p> <p>To check the speed in the opposite direction, simply reverse the sensor numbers, using the Swap button.</p> <p>The Speedometer will remember the last used sensors and distance between sessions.</p>"},{"location":"products/ex-toolbox/user-guide/#loco-status","title":"Loco Status","text":"<p>Loco Status allows you to watch changes to all locos being controlled by the command station.</p>"},{"location":"products/ex-toolbox/user-guide/#track-manager","title":"Track Manager","text":"<p>Track Manager allow you to change up to 8 channels (depending on the Motor Driver you are using)</p> <p>Each channel can be one of:</p> <ul> <li><code>DCC PROG</code> - Programming Track</li> <li><code>DCC MAIN</code> - Main Track</li> <li><code>DCC AUTO</code> - Main track with auto reverse</li> <li><code>DC</code></li> <li><code>DC reversed polarity (DCX)</code></li> <li><code>OFF</code></li> </ul> <p>Select the value you want for the channels and click <code>Set</code>.</p> <p>Notes:</p> <ul> <li> <p>If you select <code>DC</code> or <code>DCX</code> you must select a DCC address for the channel before pressing Set. What ever address you select, selecting that address on your throttle (e.g. Engine Driver) will result in the DC locomotive on the track connected to that channel to respond.</p> </li> <li> <p>Only one channel can be <code>PROG</code>. If you select more that one, one will turned OFF.</p> </li> </ul>"},{"location":"products/ex-toolbox/user-guide/#servo-motor-testing-and-adjustment","title":"Servo motor testing and adjustment","text":"<p>The 'Servo Motor Test' screen will allow you to test and fine tune the settings needed for configuring servo motors attached to the EX\u2011CommandStation. This is intended to be temporary. To permanently configure a servo motor you will need to record the values and include the in the configuration of your EX\u2011CommandStation.</p> <ul> <li> <p>Make sure your servo is NOT physically connected to anything that could be damaged if you move the serve too far</p> </li> <li> <p>Enter the VPin of the servo motor you want adjustment</p> </li> <li> <p>Enter any known starting values for Close, Mid, Throw</p> </li> <li> <p>Test the 'Close', 'Mid', 'Throw' positions by pressing the appropriate button. The servo will move to that position.</p> </li> <li> <p>Fine adjust any of the three positions by using the + or - buttons    The servo will gradually move.</p> </li> <li> <p>when you are happy, record the three values</p> </li> </ul> <p>EX\u2011Toolbox remembers the servos that you have changed (up to 10) in this and previous sessions, and you can select one of the previous servos from the drop down list. EX\u2011Toolbox will restore the last settings you used for the selected servo to the main fields.</p>"},{"location":"products/ex-toolbox/user-guide/#sensor-testing","title":"Sensor testing","text":"<p>The 'Sensor Test' screen will allow you to test any sensors configured in your EX\u2011CommandStation, but only if they have been (temporarily) defined using JMRI_SENSOR in EXRAIL, or the <code>&lt;S vpin vpin 1&gt;</code> command.</p> <p>When the screen opens the first 100 sensors found will be shown. Activity on the sensors will be shown on the screen. Scroll down to if needed.</p> <p>The Watch button is generally not needed, but will force EX\u2011Toolbox to check the available sensors on the EX\u2011CommandStation again.</p>"},{"location":"products/ex-toolbox/user-guide/#current-meter","title":"Current Meter","text":"<p>The 'Current Status' screen will show you the current values for up to eight channels on the motor driver on your EX\u2011CommandStation.</p> <p>For each channel the following is shown:</p> <ul> <li>the up-to-date value in Milliamps</li> <li>the highest value seen recently in Milliamps</li> <li>the maximum value able to be supplied by the moto shield in Milliamps</li> </ul> <p>The readings start as soon as you open the screen and are paused as soon as you exit the screen. The readings are taken every three seconds.</p> <p>You can manually stop the readings with the Stop button.</p> <p>You can manually restart the readings with the Start button. This will also clear the 'Highest' values.</p>"},{"location":"products/ex-toolbox/user-guide/#roster","title":"Roster","text":"<p>The 'Roster' screen will show you the current roster on your EX\u2011CommandStation.</p> <p>Clicking on any individual loco in the roster will show you the details of that roster entry (the Loco's functions).</p> <p></p>"},{"location":"products/ex-toolbox/user-guide/#neopixel-setup","title":"Neopixel Setup","text":"<p>The 'Neopixel' screen will allow you to experiment with any neopixels configured on your EX\u2011CommandStation.</p> <p>Enter:</p> <ul> <li>the <code>Vpin</code> of the Neopixel device</li> <li>the <code>count</code> - The number of neopixels connected</li> </ul> <p>You can then adjust the colours (RGB values) of the neopixels with the sliders</p>"},{"location":"products/ex-toolbox/user-guide/#power","title":"Power","text":"<p>There are two ways to turn the Track Power on/off:</p> <ul> <li>Power Screen - accessed from the menu</li> <li>Power Action Bar button - needs to be enabled in the preferences</li> </ul> <p>The Power Screen can be accessed from the <code>Menu \u2023 Power</code>. This will open the Power Screen where there is a simple button that to turn the power on or off. Use the Close button or Android's Back button to return to the CV-Programming Screen.</p> <p>If the Power Action Bar button is enabled, simply click on it to turn track power on or off.</p> <p>Note, you can also optionally enable the Power Button on the Action bar in the preferences.</p>"},{"location":"products/ex-toolbox/user-guide/#preferences","title":"Preferences","text":"<p>Most configuration options are found in the Preferences which is accessed via the overflow menu which is normally three dots (\u205e) or three bars (\u2261).</p>"},{"location":"products/ex-toolbox/user-guide/#view-log","title":"View log","text":"<p>Accessed from any of the main screens via Menu \u2023 View Log.</p> <p>This screen allows you to view the internal EX-Toolbox log of events. (referend to as 'logcat').</p> <p>The option to Start recording to file creates a user-accessible file that can be sent to the EX\u2011Toolbox app developers to assist you in resolving a problem.</p> <p>The file will be located on your Android device/phone at: Internal storage /Android/data/dcc_ex.ex_toolbox/files and will be named something like: logcat9999999999999.txt</p> <p>Optionally enable the preference to include the timestamp on each line of the log.</p>"},{"location":"products/ex-toolbox/user-guide/#saving-a-log-file","title":"Saving a Log File","text":"<p>To record a log file in EX\u2011Toolbox\u2026.</p> <ul> <li>Start EX\u2011Toolbox.</li> <li>From the menu, select <code>View Log</code></li> <li>Click Start recording to a file</li> <li>Click <code>Close</code></li> </ul> <p>Attempt whatever is causing the problem a few times</p> <ul> <li> <p>Exit EX\u2011Toolbox</p> </li> <li> <p>Connect a USB cable to your device/phone and PC</p> </li> <li> <p>Allow access if the device/phone asks.    In some versions of Android you may also need to change the connection type on the device/phone from 'charging' to 'file transfer'</p> </li> <li> <p>Open a file manager and find the connected device/phone</p> </li> <li> <p>Browse down to the folder \u2026Internal shared storage/Android/data/dcc_ex.ex_toolbox/files</p> </li> <li> <p>Find the most recent file that looks like <code>logcatxxxxxxxxxxxxx.txt</code> e.g. logcat1699833098998.txt</p> </li> <li> <p>Attach that file to a message in discord using the <code>+</code> button on the row of the message content</p> </li> </ul>"},{"location":"products/ex-toolbox/user-guide/#about","title":"About","text":"<p>This screen displays</p> <ul> <li> <p>Information about EX\u2011Toolbox</p> </li> <li> <p>Information about the EX\u2011CommandStation it is currently connected to (if any)</p> </li> <li> <p>A page of basic information about EX\u2011Toolbox</p> </li> </ul>"},{"location":"products/ex-turntable/ex-turntable/","title":"EX-Turntable","text":"<p>Refer to the legacy EX-Turntable documentation for the time being.</p>"},{"location":"products/ex-wifishield8266/ex-wifishield8266/","title":"EX-WiFiShield 8266","text":"<p>Designed in conjunction with the DCC-EX development team\u2026</p>"},{"location":"products/ex-wifishield8266/ex-wifishield8266/#overview","title":"Overview","text":"<p>The new v1.1 WiFi shield is a joint DCC-EX and Makerfabs project. It comes already flashed with DCC-EX EX-CommandStation compatible firmware and can now be easily updated with an Arduino or USB to TTL Adapter.</p> <p>The EX-WiFiShield 8266 is a cost-effective and highly integrated UART-WiFi module for DCC-EX and general IoT applications. It comes in a standard Arduino Uno shield format and uses ULP technology (Ultra Low Power).</p> <p>This WiFi Shield is based on ESP-12F, which is a newer version of the proven ESP8266 chip. With this Shield, you can connect your Command Station to your network, or have it operate as a stand alone Access Point to connect directly from your phone, tablet, laptop, or WiFi hardware throttle.</p>"},{"location":"products/ex-wifishield8266/ex-wifishield8266/#features","title":"Features","text":"<ul> <li>Wireless 2.4GHz 802.11 b/g/n</li> <li>supports the STA/AP/STA + AP operation modes</li> <li>Built-in TCP/IP protocol stack</li> <li>multiple TCP Client connections</li> <li>Supports Smart Link intelligent networking</li> <li>Dimensions: 2.1\u201d(53mm) x 1.9\u201d(47mm) x 0.9\u201d(23mm)</li> </ul>"},{"location":"products/ex-wifishield8266/ex-wifishield8266/#purchase","title":"Purchase","text":"<p>The EX\u2011MotorShield8874 is available from many suppliers.</p>"},{"location":"products/ex-wifishield8266/ex-wifishield8266/#assembly","title":"Assembly","text":"<p>Follow the simple assembly instructions, Mega and Nucleo installs are essentially the same.</p> <ul> <li>WiFiShield8266 install</li> </ul>"},{"location":"purchasing/merchandise/","title":"DCC-EX Merchandise","text":"<p>Another way you can support the DCC-EX Project is to buy our DCC-EX branded merchandise, EX-Merch! Show everyone you are part of our team. There are several items to choose from in various sizes and colours:</p> <ul> <li>Regular T-Shirts</li> <li>Premium T-Shirts</li> <li>Women's T-Shirts</li> <li>Long Sleeve T-Shirts</li> <li>Pullover Hoodies</li> <li>Baseball Hats</li> <li>Toboggans (winter hats)</li> <li>Mugs</li> <li>Stickers</li> </ul> <p>NOTE: There are 3 styles of shirts: plain back, \"I'm a DCC-EX Tinkerer\" on the back, and \"I'm a DCC-EX Engineer\" on the back. Be careful to choose the style you want. Shirts with printing on the back cost slightly more.</p> <p>DCC-EX Merchandise Store</p> <p></p> <p>Here is an example listing for shirts where you need to choose the correct description for either a blank back or the \"Tinkerer\" or \"Engineer\" printing on the back</p> <p></p> <p>And here is an example of an order page where you can select your size and colour for the T-Shirts, Long-Sleeve Shirts, Hoodies, etc.</p> <p></p> <p>We also have 2 kinds of hats, a mug, a sticker, and several different types of shirts. You can click on an image to go directly to that section in the store.</p> <p></p> <p></p> <p></p> <p></p> <p>DCC-EX Merchandise Store</p>"},{"location":"purchasing/official-sellers/","title":"Official DCC-EX Suppliers","text":"<p>With the ever increasing demand for hardware that is guaranteed to be DCC-EX compatible, and the uptake of EX-CommandStation by more Conductor level users, we are striving to make the DCC-EX ecosystem more accessible.</p> <p>As part of that, and starting with the release of the EX-MotorShield8874, we have a number of official DCC-EX dealers that can supply various different hardware devices as well as complete EX-CommandStation systems.</p> <p>The dealers listed on this page work with the DCC-EX team to ensure these devices are compatible.</p> <p>International purchasers</p> <p>If you are not in any of these countries, be aware that each dealer can usually ship anywhere in the world. Each dealer's primary territory is listed, so purchase from the one closest to you to save on shipping and duty charges.</p>"},{"location":"purchasing/official-sellers/#in-the-united-states-serving-usa-canada-mexico","title":"In the United States serving USA, Canada, &amp; Mexico","text":"<ul> <li>DCC-EX Store</li> <li>Smart Hobby, LLC</li> </ul>"},{"location":"purchasing/official-sellers/#in-england-serving-the-uk","title":"In England serving the UK","text":"<ul> <li>Chesterfield Model Making and Miniature Electronics (Chesterfield also sells cases for DIY builds)</li> <li>ACI Model Railways</li> </ul>"},{"location":"purchasing/official-sellers/#in-austria-serving-the-european-union-eu","title":"In Austria serving the European Union (EU)","text":"<ul> <li>Model Railway Electronics powered by Semify</li> </ul>"},{"location":"purchasing/official-sellers/#in-australia-serving-au-nz-and-apac","title":"In Australia serving AU, NZ, and APAC","text":"<ul> <li>Millennium Engineering Pty Ltd</li> <li>Buckambool Model Trains</li> </ul>"},{"location":"purchasing/third-party-sellers/","title":"Third Party Products and Sellers","text":""},{"location":"purchasing/third-party-sellers/#rosscoe","title":"Rosscoe","text":"<p>One of our very active Discord users Rosscoe offers various different accessory products, both DCC and I2C.</p> <p>Visit the Rosscoe Shop to see what's on offer.</p>"},{"location":"purchasing/third-party-sellers/#david-yale","title":"David Yale","text":"<p>David provides the files to make a 3D printed case or can sell an already made case to fit the Mega |EX-CS| with a motor shield, Wi-Fi shield, and LCD display. He has several designs.</p> <p>David's Makerbot Thingiverse page</p> <p>David's DCC-EX case designs</p> <p></p>"},{"location":"purchasing/third-party-sellers/#command-station-rack-the-mac-rack","title":"Command Station Rack (The Mac Rack)","text":"<p>Created by Neil McKechnie, this is a rack style 3D printed case that can hold the Command Station Arduino, Motor Shield and Raspberry Pi.</p> <p>Neil's DCC++/EX Controller Case</p> <p></p>"},{"location":"purchasing/third-party-sellers/#sumners-mega-dual-configuration-case-3d-print","title":"Sumner's Mega Dual Configuration Case (3D Print)","text":"<p>Created by Sumner Patterson, this is a range of Mega Command Station cases with different configurations and different tops at different heights to handle your boards:</p> <ul> <li>Uno and Motor Shield Case</li> <li>Mega and Motor Shield Case</li> <li>Mega, Motor Shield, and WiFi Board Case</li> <li>Mega, Motor Shield, and Raspberry Pi Case (for JMRI Users)</li> </ul> <p>Sumner's Thingiverse Case Page</p> <p>List of Sumner's 3D printed cases</p> <p></p>"},{"location":"purchasing/third-party-sellers/#hans-tanners-iott-cube-case-system-3d-print","title":"Hans Tanner's ioTT cube case system (3D Print)","text":"<p>Hans has created a stacking system of cases similar to the M5Stack system. Using his skill in design and TinkerCAD, he is offering the design files for free for you to 3D print yourself or have printed. He also sells kits and accessories (like a Loconet board) in his Tindie store:</p> <ul> <li>UNO Stackable Case</li> <li>MotorShield Stackable Case</li> </ul> <p>There are various remixes of Hans' designs, so be sure to check them all out.</p> <p>TinkerCAD design files</p> <p>Hans Tanner's IoTT Tindie store</p> <p>YouTube Video describing the enclosure system</p> <p></p> <p></p>"},{"location":"purchasing/third-party-sellers/#nebbishs-arduino-mega-case-for-dcc-ex-3d-print","title":"Nebbish's Arduino Mega case for DCC-EX (3D Print)","text":"<p>Case to hold Arduino Mega, motor shield, and .96\" display for DCC-EX</p> <ul> <li>Cover options with and without display</li> <li>Plain cover or one that says DCC Command Station</li> <li>Options for external connections</li> </ul> <p>Nebbish's cases on Thingiverse</p> <p></p> <p></p>"},{"location":"reference/advanced-config-h/","title":"Advanced config.h settings for Command Station build","text":"<p>The basic Motor Shield, WiFi and Ethernet settings are covered in detail in basic config.h</p> <p>The following additional settings are for special cases and are not normally created automatically by the EX-Installer.</p> <p>These options should be coded in the file <code>config.h</code> which will be automatically included in the compilation process.</p>"},{"location":"reference/advanced-config-h/#non-standard-motor-shields","title":"Non-standard Motor Shields","text":"<p>See also:Motor Shield basic config.h</p> <p>Further pre-defined shield names can be found in the code file MotorDrivers.h although their presence there does not necessarily mean that we can provide support for issues.</p> <p>In extreme cases, it is possible to craft your own definition for example:</p> <pre><code>#define MY_SHIELD F(\"MINE\"), \\\n new MotorDriver( 3, 12, UNUSED_PIN, 9, A0, 5.08, 3000, A4), \\\n new MotorDriver(11, 13, UNUSED_PIN, 8, A1, 5.08, 1500, A5)\n#define MOTOR_SHIELD_TYPE MY_SHIELD\n</code></pre> <p>refer to MotorDrivers.h for details of parameter meanings. Do NOT attempt to alter MotorDrivers.h or you will face versioning difficulties.</p> <p>NOTE: Before connecting these boards and selecting one in this software check the quick install guides! Some of these boards require a voltage generating resistor on the current sense pin of the device. Failure to select the correct resistor could damage the sense pin on your Arduino or destroy the device.</p>"},{"location":"reference/advanced-config-h/#motor-shield-max-current","title":"Motor shield max current","text":"<p>If you want to restrict the maximum current LOWER than what your motor shield can provide, you can do that here. For example if you have a motor shield that can provide 5A and your power supply can only provide 2.5A then you should restrict the maximum current to 2.25A (90% of 2.5A) so that DCC-EX shuts off the track before your PS does shut DCC-EX. MAX_CURRENT is in mA so for this example it would be 2250, adjust the number according to your PS. If your PS has a higher rating than your motor shield you do not need this. You can use this as well if you are cautious and your trains do not need full current.</p> <pre><code>#define MAX_CURRENT 2250\n</code></pre>"},{"location":"reference/advanced-config-h/#tcpip-advanced-settings","title":"TCP/IP Advanced settings","text":"<ul> <li>Control of IP port (default 2560). We cant think of any reason why this would ever need to be changed.</li> </ul> <pre><code>#define IP_PORT 2560\n</code></pre> <ul> <li>DONT_TOUCH_WIFI_CONF means WIFI config will be done with the <code>&lt;+&gt;</code> commands and this sketch will not change anything over AT commands and the other WIFI_* defines do not have any effect.</li> </ul> <pre><code>#define ENABLE_WIFI true\n#define DONT_TOUCH_WIFI_CONF\n</code></pre> <ul> <li>WIFI_HOSTNAME: The default is \"dccex\" but you can change this if you have more than one CS on you home router to make them show up with different names on the network. Host names starting with \"dccex\" are more readily found by WiFi throttles.</li> </ul> <pre><code>#define WIFI_HOSTNAME \"dccex-csb1\"\n</code></pre> <ul> <li>Ethernet IP_ADDRESS can be set but it is preferable to omit this and have the router assign an address using DHCP.</li> </ul> <pre><code>#define IP_ADDRESS { 192, 168, 1, 200 }\n</code></pre> <ul> <li> <p>MAX_NUM_TCP_CLIENTS: If you on STM32 Ethernet (and only there) want more than  9 () TCP clients, change this number to for example 20 here *AND** in  STM32lwiopts.h and follow the instructions in STM32lwiopts.h</p> <p>(*) It would be 10 if there would not be a bug in LwIP by STM32duino.</p> </li> </ul> <pre><code>#define MAX_NUM_TCP_CLIENTS 20\n</code></pre>"},{"location":"reference/advanced-config-h/#lcdoled-support","title":"LCD/OLED support","text":"<p>See also:LCD/OLED basic config.h</p> <p>In order to avoid wasting memory the current scroll buffer is limited to 8 lines.  Some users wishing to display additional information such as TrackManager power states have requested additional rows aware of the warning that this will take extra RAM.  if you wish to include additional rows</p> <pre><code>#define MAX_CHARACTER_ROWS 12\n</code></pre>"},{"location":"reference/advanced-config-h/#disable-eeprom","title":"Disable EEPROM","text":"<p>The EEPROM feature is only there for backward support of deprecated methods of turnout, sensor and output creation inherited from DCC++. You are advised to turn this off to save memory.</p> <pre><code> #define DISABLE_EEPROM\n</code></pre>"},{"location":"reference/advanced-config-h/#disable-prog","title":"Disable PROG","text":"<p>If you do not need programming capability, you can disable all program track related commands. You might want to do that if you are building a command station that drives multiple tracks and you do not have a spare track output for programming.</p> <pre><code> #define DISABLE_PROG\n</code></pre>"},{"location":"reference/advanced-config-h/#redefine-dcc-boundary-between-short-and-long-loco-addresses","title":"Redefine DCC boundary between SHORT and LONG loco addresses","text":"<p>According to NMRA the last short address is 127 and the first long address is 128. There are manufacturers which have another view. Lenz CS, for example, have considered addresses long from 100. If you want to change to that mode, do:</p> <pre><code>#define HIGHEST_SHORT_ADDR 99\n</code></pre> <p>If you want to run all your locos addressed long format, you could even do</p> <pre><code>#define HIGHEST_SHORT_ADDR 0\n</code></pre> <p>DCC-EX does not support using the same address, for example 100(long) and 100(short) at the same time, therefore there must be a border.</p>"},{"location":"reference/advanced-config-h/#redefine-locomotive-state-table-size","title":"Redefine locomotive state table size","text":"<p>This is the maximum number of locos that can be controlled at the same time. This defaults to 50 (8 on a UNO/NANO). If you have enough free memory you can increase this to a maximum of 255. If you are short of memory (typically a Mega with WiFi and lots of accessories) you can decrease it  to a minimum of 2.</p> <pre><code>#define MAX_LOCOS 100\n</code></pre>"},{"location":"reference/advanced-config-h/#define-turnouts-and-accessories-to-follow-norm-rcn-213","title":"Define TURNOUTS and ACCESSORIES to follow norm RCN-213","text":"<p>According to norm RCN-213 a DCC packet with a 1 is closed-straight and one with a 0 is thrown-diverging.  In DCC++ Classic, and in previous versions of DCC++EX, a turnout throw command was implemented in the packet as '1' and a close command as '0'. The #define below makes the states match with the norm.  But we don't want to cause havoc on existent layouts, so we define this only for new installations. If you don't want this, don't add it to your config.h.</p> <pre><code>#define DCC_TURNOUTS_RCN_213\n</code></pre> <p>By default, the driver which defines a DCC accessory decoder does send out the same state change on the DCC packet as it receives. This means a VPIN state=1 sends D=1 (close turnout or signal green) in the DCC packet. This can be reversed if necessary.</p> <pre><code>#define HAL_ACCESSORY_COMMAND_REVERSE\n</code></pre> <p>If you have issues with that the direction of the accessory commands is reversed (for example when converting from another CS to DCC-EX) then you can use this to reverse the sense of all accessory commands sent over DCC-EX. This #define likewise inverts the behaviour of the <code>&lt;a&gt;</code> command for triggering DCC Accessory Decoders, so that <code>&lt;a addr subaddr 0&gt;</code> generates a DCC packet with D=1 (close turnout) and <code>&lt;a addr subaddr 1&gt;</code> generates D=0 (throw turnout).</p> <pre><code>#define DCC_ACCESSORY_COMMAND_REVERSE\n</code></pre>"},{"location":"reference/advanced-config-h/#handling-multiple-serial-throttles","title":"Handling multiple serial throttles","text":"<p>The command station always operates with the default Serial port. Diagnostics are only emitted on the default serial port and not broadcast. Other serial throttles may be added to the Serial1...Serial6 ports which may or may not exist on your CPU (Mega has 3, CSB1 has 1, and STM32 have up to 6.). To monitor a throttle on one or more serial ports, supply a #define for each serial port required.</p> <p>NOTE: DO NOT define here the WiFi shield serial port or your Wifi will not work.</p> <pre><code>// SERIAL1 in use by Wifi\n#define SERIAL2_COMMANDS\n#define SERIAL3_COMMANDS\n#define SERIAL4_COMMANDS\n#define SERIAL5_COMMANDS\n#define SERIAL6_COMMANDS\n</code></pre>"},{"location":"reference/advanced-config-h/#bluetooth-serial-on-esp32","title":"Bluetooth serial ON ESP32","text":"<p>On ESP32 you have the possibility to use the builtin BT serial to connect to the CS.</p> <p>The CS shows up as a pairable BT Classic device. Name is \"DCCEX-hexnumber\". BT is as an additional serial port, debug messages are still sent over USB, not BT serial.</p> <p>If you enable this there are some implications:</p> <ol> <li>WiFi will sleep more (as WiFi and BT share the radio). So WiFi performance may suffer</li> <li>The app will be bigger that 1.2MB, so the default partition scheme will not work any more. You need to choose a partition scheme with 2MB (or bigger). For example \"NO OTA (2MB APP, 2MB SPIFFS)\" in the Arduino IDE.</li> <li>There is no securuity (PIN) implemented. Everyone in radio range can pair with your CS.</li> </ol> <pre><code>#define SERIAL_BT_COMMANDS\n</code></pre>"},{"location":"reference/advanced-config-h/#booster-input-pin-on-esp32-cs","title":"Booster input pin on ESP32 CS","text":"<p>On ESP32 you have the possibility to define a pin as booster input</p> <p>Arduino pin D2 is GPIO 26 is Booster Input on ESPDuino-32</p> <pre><code>#define BOOSTER_INPUT 26\n</code></pre> <p>GPIO 32 is Booster Input on EX-CSB1</p> <pre><code>#define BOOSTER_INPUT 32\n</code></pre>"},{"location":"reference/advanced-config-h/#esp32-led-wifi-indicator","title":"ESP32 LED Wifi Indicator","text":"<p>GPIO 2 on ESPDuino-32</p> <pre><code>#define WIFI_LED 2\n</code></pre> <p>GPIO 33 on EX-CSB1</p> <pre><code>#define WIFI_LED 33\n</code></pre>"},{"location":"reference/advanced-config-h/#sabertooth","title":"SABERTOOTH","text":"<p>This is a very special option and only useful if you happen to have a Sabertooth motor controller from Dimension Engineering configured to take commands from and ESP32 via serial at 9600 baud from GPIO17 (TX) and GPIO16 (RX, currently unused).</p> <p>The number defined is the DCC address for which speed controls are sent to the sabertooth controller as_well. Default: Undefined.</p> <pre><code>#define SABERTOOTH 1\n</code></pre>"},{"location":"reference/advanced-config-h/#tuning-for-deprecated-unonano","title":"Tuning for deprecated UNO/NANO","text":"<p>By default VDPY and DIAGs are disabled on a Uno/Nano to reduce PROGMEM and RAM requirements.</p> <p>They can be re-enabled if you have space by the commands below. It is also possible to save RAM using the MAX_LOCOS setting less than the default 8.</p> <pre><code>#define ENABLE_VDPY\n#define ENABLE_DIAG\n#define MAX_LOCOS 4\n</code></pre>"},{"location":"reference/command-station-arch/","title":"Command Station Internal Architecture","text":"<p>TODO</p> <p></p> <p>This diagram is old but basically ok. Needs editing to</p> <ul> <li>Do better at css dark/light</li> <li>TPL renamed to EXRAIL</li> <li>have hotlinks on boxes to the relevant adres of the doc and/or the actual code modules in git.</li> <li>maybe convert to mermaid.</li> </ul>"},{"location":"reference/legacy-command-reference/","title":"Legacy Command Reference","text":"<p>TODO </p> <p>Legacy command reference</p>"},{"location":"reference/serial-command-basics/","title":"Serial Command Basics","text":"<ul> <li>Serial commands are accepted as input from the USB serial connection or a TCP/IP connection.</li> <li>Commands have a single case dependent character opcode and optionaly parameters.</li> <li>Keyword parameters are shown in upper case but may be entered in mixed case.</li> <li>Value parameters are decimal numeric (unless otherwise noted)</li> <li>Not all commands have a response, and broadcasts mean that not all responses come from the last commands that you have issued.</li> <li>Commands entered like <code>&lt;JA&gt;</code> are actually read as <code>&lt;J A&gt;</code>, so <code>&lt;Ja&gt;</code> is also acceptible.</li> <li>Commands that produce diagnostic information (which is intended for human reading rather than code) only write to the USB Serial output.</li> <li>Commands that cause state changes (such as loco speeds, turnout position) cause broadcasts to all serial connections and, where appropriate, WiThrottle protocol connections.</li> </ul>"},{"location":"reference/serial-commands/","title":"DCC-EX Command Protocol","text":"<p>TODO Review tables and commands</p> <p>Complete reference guide for serial commands used with DCC command stations.</p>"},{"location":"reference/serial-commands/#system-commands","title":"System Commands","text":"Command Description Parameters <code>&lt;#&gt;</code> Request number of simultaneously supported locos None <code>&lt;!&gt;</code> Emergency stop all locos None <code>&lt;!P&gt;</code> Emergency stop and PAUSE loco movement None <code>&lt;!R&gt;</code> Resume after <code>&lt;!P&gt;</code> None <code>&lt;s&gt;</code> Command station status None <code>&lt;E&gt;</code> Store EEPROM None <code>&lt;e&gt;</code> Clear EEPROM None"},{"location":"reference/serial-commands/#power-control","title":"Power Control","text":"Command Description Parameters <code>&lt;1&gt;</code> Power ON all tracks None <code>&lt;1 MAIN&gt;</code> Power on MAIN track None <code>&lt;1 PROG&gt;</code> Power on PROG track None <code>&lt;1 JOIN&gt;</code> JOIN prog track to MAIN and power None <code>&lt;1 track&gt;</code> Power on given track <code>track</code>: Track identifier <code>&lt;0&gt;</code> Power off all tracks None <code>&lt;0 MAIN&gt;</code> Power off MAIN track None <code>&lt;0 PROG&gt;</code> Power off PROG track None <code>&lt;0 track&gt;</code> Power off given track <code>track</code>: Track identifier"},{"location":"reference/serial-commands/#locomotive-control","title":"Locomotive Control","text":"Command Description Parameters Status <code>&lt;t loco&gt;</code> Request loco status <code>loco</code>: Locomotive ID Active <code>&lt;t loco tspeed direction&gt;</code> Set throttle speed and direction <code>loco</code>: ID, <code>tspeed</code>: 0-127, <code>direction</code>: 0/1 Active <code>&lt;t ignore loco tspeed direction&gt;</code> Set throttle speed and direction Legacy format \u26a0\ufe0f Deprecated <code>&lt;- loco&gt;</code> Remove loco state and reminders <code>loco</code>: Locomotive ID Active <code>&lt;-&gt;</code> Clear loco state and reminder table None Active"},{"location":"reference/serial-commands/#function-control","title":"Function Control","text":"Command Description Parameters Status <code>&lt;F loco function onoff&gt;</code> Set loco function ON/OFF <code>loco</code>: ID, <code>function</code>: Function number, <code>onoff</code>: 0/1 Active <code>&lt;F loco DCCFREQ freqvalue&gt;</code> Set DC frequency for loco <code>loco</code>: ID, <code>freqvalue</code>: Frequency value Active <code>&lt;f loco byte1&gt;</code> Set loco function group <code>loco</code>: ID, <code>byte1</code>: Function byte \u26a0\ufe0f Deprecated <code>&lt;f loco group byte2&gt;</code> Set loco function group <code>loco</code>: ID, <code>group</code>: Group ID, <code>byte2</code>: Function byte \u26a0\ufe0f Deprecated"},{"location":"reference/serial-commands/#consist-control","title":"Consist Control","text":"Command Description Parameters Status <code>&lt;^&gt;</code> Show all consists Active <code>&lt;^ loco1 loco2 ... &gt;</code> Create Consist <code>loco</code>: ID, negative for reversed loco Active <code>&lt;^ loco1&gt;</code> Deletes consist <code>loco1</code>: ID Active"},{"location":"reference/serial-commands/#turnout-control","title":"Turnout Control","text":"Command Description Parameters <code>&lt;T&gt;</code> List all turnouts None <code>&lt;T id&gt;</code> Delete turnout <code>id</code>: Turnout ID <code>&lt;T id X&gt;</code> List turnout details <code>id</code>: Turnout ID <code>&lt;T id T&gt;</code> Throw turnout <code>id</code>: Turnout ID <code>&lt;T id C&gt;</code> Close turnout <code>id</code>: Turnout ID <code>&lt;T id value&gt;</code> Close (value=0) or Throw turnout <code>id</code>: Turnout ID, <code>value</code>: 0/1 <code>&lt;T id SERVO vpin closedValue thrownValue&gt;</code> Create servo turnout <code>id</code>: ID, <code>vpin</code>: Pin, values for positions <code>&lt;T id VPIN vpin&gt;</code> Create pin turnout <code>id</code>: ID, <code>vpin</code>: Pin number <code>&lt;T id DCC addr subadd&gt;</code> Create DCC turnout <code>id</code>: ID, <code>addr</code>: Address, <code>subadd</code>: Sub-address <code>&lt;T id DCC linearAddr&gt;</code> Create DCC turnout <code>id</code>: ID, <code>linearAddr</code>: Linear address <code>&lt;T id addr subadd&gt;</code> Create DCC turnout <code>id</code>: ID, <code>addr</code>: Address, <code>subadd</code>: Sub-address <code>&lt;T id vpin closedValue thrownValue&gt;</code> Create SERVO turnout <code>id</code>: ID, <code>vpin</code>: Pin, position values"},{"location":"reference/serial-commands/#sensor-control","title":"Sensor Control","text":"Command Description Parameters <code>&lt;S id vpin pullup&gt;</code> Create sensor <code>id</code>: Sensor ID, <code>vpin</code>: Pin, <code>pullup</code>: Pull-up setting <code>&lt;S id&gt;</code> Delete sensor <code>id</code>: Sensor ID <code>&lt;S&gt;</code> List sensors None <code>&lt;Q&gt;</code> List all sensors None"},{"location":"reference/serial-commands/#cv-programming","title":"CV Programming","text":"Command Description Parameters Status <code>&lt;W cv value&gt;</code> Write CV value on PROG track <code>cv</code>: CV number, <code>value</code>: Value Active <code>&lt;W loco&gt;</code> Write loco address on PROG track <code>loco</code>: Address Active <code>&lt;W CONSIST loco&gt;</code> Write consist address on PROG track <code>loco</code>: Address Active <code>&lt;W CONSIST loco REVERSE&gt;</code> Write consist address and reverse flag <code>loco</code>: Address Active <code>&lt;W cv bitvalue bit&gt;</code> Write CV bit on prog track <code>cv</code>: CV, <code>bitvalue</code>: Bit value, <code>bit</code>: Bit position Active <code>&lt;W cv value ignore1 ignore2&gt;</code> Write CV value on PROG track Legacy format \u26a0\ufe0f Deprecated <code>&lt;R cv&gt;</code> Read CV <code>cv</code>: CV number Active <code>&lt;R&gt;</code> Read driveable loco ID None Active <code>&lt;R LOCOID&gt;</code> Read loco ID (ignoring consist) None Active <code>&lt;R CONSIST&gt;</code> Read consist ID None Active <code>&lt;R cv ignore1 ignore2&gt;</code> Read CV value on PROG track Legacy format \u26a0\ufe0f Deprecated <code>&lt;V cv value&gt;</code> Fast read CV with expected value <code>cv</code>: CV number, <code>value</code>: Expected value Active <code>&lt;V cv bit bitvalue&gt;</code> Fast read bit with expected value <code>cv</code>: CV, <code>bit</code>: Bit position, <code>bitvalue</code>: Expected Active <code>&lt;B cv bit bitvalue&gt;</code> Write CV bit <code>cv</code>: CV number, <code>bit</code>: Bit position, <code>bitvalue</code>: Value Active <code>&lt;w loco cv value&gt;</code> POM write CV on main track <code>loco</code>: ID, <code>cv</code>: CV number, <code>value</code>: Value Active <code>&lt;r loco cv&gt;</code> POM read CV on main track <code>loco</code>: ID, <code>cv</code>: CV number Railcom dependent <code>&lt;b loco cv bit bitvalue&gt;</code> POM write CV bit on main track <code>loco</code>: ID, <code>cv</code>: CV, <code>bit</code>: Position, <code>bitvalue</code>: Value Active"},{"location":"reference/serial-commands/#dcc-accessory-commands","title":"DCC Accessory Commands","text":"Command Description Parameters <code>&lt;a address subaddress activate&gt;</code> Send DCC accessory command <code>address</code>: Address, <code>subaddress</code>: Sub-address, <code>activate</code>: 0/1 <code>&lt;a address subaddress activate onoff&gt;</code> Send DCC accessory command with on/off <code>address</code>: Address, <code>subaddress</code>: Sub, <code>activate</code>: 0/1, <code>onoff</code>: 0/1 <code>&lt;a linearaddress activate&gt;</code> Send DCC accessory command <code>linearaddress</code>: Linear address, <code>activate</code>: 0/1 <code>&lt;A address value&gt;</code> Send DCC extended accessory (Aspect) command <code>address</code>: Address, <code>value</code>: Aspect value"},{"location":"reference/serial-commands/#momentum-control","title":"Momentum Control","text":"Command Description Parameters <code>&lt;m LINEAR&gt;</code> Set momentum algorithm to linear acceleration None <code>&lt;m POWER&gt;</code> Set momentum algorithm based on speed difference None <code>&lt;m loco momentum&gt;</code> Set momentum for loco (accel and braking) <code>loco</code>: ID, <code>momentum</code>: Value <code>&lt;m loco accelerating braking&gt;</code> Set momentum for loco <code>loco</code>: ID, <code>accelerating</code>: Value, <code>braking</code>: Value"},{"location":"reference/serial-commands/#output-control","title":"Output Control","text":"Command Description Parameters <code>&lt;Z&gt;</code> List output definitions None <code>&lt;Z id pin iflag&gt;</code> Create output <code>id</code>: Output ID, <code>pin</code>: Pin number, <code>iflag</code>: Invert flag <code>&lt;Z id active&gt;</code> Set output <code>id</code>: Output ID, <code>active</code>: 0/1 <code>&lt;Z id&gt;</code> Delete output <code>id</code>: Output ID"},{"location":"reference/serial-commands/#pin-control","title":"Pin Control","text":"Command Description Parameters <code>&lt;z vpin&gt;</code> Set pin HIGH if vpin positive, LOW if negative <code>vpin</code>: Pin number (signed) <code>&lt;z vpin analog&gt;</code> Write analog device value <code>vpin</code>: Pin, <code>analog</code>: Value <code>&lt;z vpin analog profile&gt;</code> Write analog device using profile <code>vpin</code>: Pin, <code>analog</code>: Value, <code>profile</code>: Profile ID <code>&lt;z vpin analog profile duration&gt;</code> Change analog value over duration <code>vpin</code>: Pin, <code>analog</code>: Value, <code>profile</code>: Profile, <code>duration</code>: Time"},{"location":"reference/serial-commands/#neopixel-control","title":"NeoPixel Control","text":"Command Description Parameters <code>&lt;o vpin&gt;</code> Set neopixel on (vpin&gt;0) or off (vpin&lt;0) <code>vpin</code>: Pin number (signed) <code>&lt;o vpin count&gt;</code> Set multiple neopixels on/off <code>vpin</code>: Pin, <code>count</code>: Number of pixels <code>&lt;o vpin r g b&gt;</code> Set neopixel colour <code>vpin</code>: Pin, <code>r</code>: Red, <code>g</code>: Green, <code>b</code>: Blue <code>&lt;o vpin r g b count&gt;</code> Set multiple neopixels colour <code>vpin</code>: Pin, <code>r</code>: Red, <code>g</code>: Green, <code>b</code>: Blue, <code>count</code>: Count"},{"location":"reference/serial-commands/#turntable-control","title":"Turntable Control","text":"Command Description Parameters <code>&lt;I&gt;</code> List all turntables None <code>&lt;I id&gt;</code> Broadcast turntable type and current position <code>id</code>: Turntable ID <code>&lt;I id position&gt;</code> Rotate a DCC turntable <code>id</code>: ID, <code>position</code>: Position <code>&lt;I id DCC home&gt;</code> Create DCC turntable <code>id</code>: ID, <code>home</code>: Home position <code>&lt;I id position activity&gt;</code> Rotate an EXTT turntable <code>id</code>: ID, <code>position</code>: Position, <code>activity</code>: Activity <code>&lt;I id EXTT vpin home&gt;</code> Create an EXTT turntable <code>id</code>: ID, <code>vpin</code>: Pin, <code>home</code>: Home position <code>&lt;I id ADD position value angle&gt;</code> Add turntable position <code>id</code>: ID, <code>position</code>: Position, <code>value</code>: Value, <code>angle</code>: Angle"},{"location":"reference/serial-commands/#sound-control","title":"Sound Control","text":"Command Description <code>&lt;y vpin PLAY track [volume]&gt;</code> Play track <code>&lt;y vpin REPEAT track [volume]&gt;</code> Play track repeat <code>&lt;y vpin STOP&gt;</code> Stop playing <code>&lt;y vpin PAUSE&gt;</code> Pause playing <code>&lt;y vpin RESUME&gt;</code> Resume playing <code>&lt;y vpin FOLDER folder&gt;</code> Set folder to play from <code>&lt;y vpin VOLUME vol&gt;</code> Set default volume 0..30 <code>&lt;y vpin EQ type&gt;</code> Set EQ type NORMAL, POP, ROCK, JAZZ, CLASSCS, BASS <code>&lt;y vpin RESET&gt;</code> Reset player"},{"location":"reference/serial-commands/#throttle-information-commands","title":"Throttle Information Commands","text":"Command Description Parameters <code>&lt;J M&gt;</code> List stash values None <code>&lt;J M stash_id&gt;</code> Get stash value <code>stash_id</code>: Stash identifier <code>&lt;J M CLEAR ALL&gt;</code> Clear all stash values None <code>&lt;J M CLEAR stash_id&gt;</code> Clear given stash <code>stash_id</code>: Stash identifier <code>&lt;J M stashId locoId&gt;</code> Set stash value <code>stashId</code>: Stash ID, <code>locoId</code>: Loco ID <code>&lt;J M CLEAR ANY locoId&gt;</code> Clear all stash entries containing locoId <code>locoId</code>: Locomotive ID <code>&lt;J C&gt;</code> Get fastclock time None <code>&lt;J C mmmm nn&gt;</code> Set fastclock time <code>mmmm</code>: Minutes, <code>nn</code>: Rate <code>&lt;J G&gt;</code> Report gauge limits None <code>&lt;J I&gt;</code> Report currents None <code>&lt;J A&gt;</code> List routes None <code>&lt;J R&gt;</code> List roster None <code>&lt;J R id&gt;</code> Get roster for loco <code>id</code>: Locomotive ID <code>&lt;J T&gt;</code> Get turnout list None <code>&lt;J T id&gt;</code> Get turnout state and description <code>id</code>: Turnout ID <code>&lt;J O&gt;</code> List turntable IDs None <code>&lt;J O id&gt;</code> List turntable state <code>id</code>: Turntable ID <code>&lt;J P id&gt;</code> List turntable positions <code>id</code>: Turntable ID"},{"location":"reference/serial-commands/#track-manager","title":"Track Manager","text":"Command Description Parameters <code>&lt;=&gt;</code> List track manager states None <code>&lt;= track MAIN&gt;</code> Set track to MAIN <code>track</code>: Track identifier <code>&lt;= track MAIN_INV&gt;</code> Set track to MAIN inverted polarity <code>track</code>: Track identifier <code>&lt;= track MAIN_AUTO&gt;</code> Set track to MAIN with auto reversing <code>track</code>: Track identifier <code>&lt;= track PROG&gt;</code> Set track to PROG <code>track</code>: Track identifier <code>&lt;= track OFF&gt;</code> Set track power OFF <code>track</code>: Track identifier <code>&lt;= track NONE&gt;</code> Set track no output <code>track</code>: Track identifier <code>&lt;= track EXT&gt;</code> Set track to use external sync <code>track</code>: Track identifier <code>&lt;= track AUTO&gt;</code> Update track to auto reverse <code>track</code>: Track identifier <code>&lt;= track INV&gt;</code> Update track to inverse polarity <code>track</code>: Track identifier <code>&lt;= track DC loco&gt;</code> Set track to DC <code>track</code>: Track ID, <code>loco</code>: Loco ID <code>&lt;= track DC_INV loco&gt;</code> Set track to DC with inverted polarity <code>track</code>: Track ID, <code>loco</code>: Loco ID <code>&lt;= track DCX loco&gt;</code> Set track to DC with inverted polarity <code>track</code>: Track ID, <code>loco</code>: Loco ID"},{"location":"reference/serial-commands/#configuration-commands","title":"Configuration Commands","text":"Command Description Parameters <code>&lt;C PROGBOOST&gt;</code> Configure PROG track boost None <code>&lt;C RESET&gt;</code> Reset and restart command station None <code>&lt;C SPEED28&gt;</code> Set all DCC speed commands as 28 step None <code>&lt;C SPEED128&gt;</code> Set all DCC speed commands to 128 step (default) None <code>&lt;C RAILCOM ON&gt;</code> Enable Railcom cutout None <code>&lt;C RAILCOM OFF&gt;</code> Disable Railcom cutout None <code>&lt;C RAILCOM DEBUG&gt;</code> Enable Railcom cutout for scope testing None <code>&lt;C WIFI \"ssid\" \"password\"&gt;</code> Reconfigure stored WiFi credentials <code>ssid</code>: Network name, <code>password</code>: Password"},{"location":"reference/serial-commands/#diagnostic-commands","title":"Diagnostic Commands","text":"Command Description Parameters <code>&lt;D ACK ON&gt;</code> Enable PROG track diagnostics None <code>&lt;D ACK OFF&gt;</code> Disable PROG track diagnostics None <code>&lt;D ACK LIMIT value&gt;</code> Set ACK detection limit mA <code>value</code>: Current limit in mA <code>&lt;D ACK MIN value MS&gt;</code> Set ACK minimum duration mS <code>value</code>: Duration in milliseconds <code>&lt;D ACK MIN value&gt;</code> Set ACK minimum duration \u00b5S <code>value</code>: Duration in microseconds <code>&lt;D ACK MAX value MS&gt;</code> Set ACK maximum duration mS <code>value</code>: Duration in milliseconds <code>&lt;D ACK MAX value&gt;</code> Set ACK maximum duration \u00b5S <code>value</code>: Duration in microseconds <code>&lt;D ACK RETRY value&gt;</code> Set ACK retry count <code>value</code>: Retry count <code>&lt;D CABS&gt;</code> Diagnostic display loco state table None <code>&lt;D RAM&gt;</code> Diagnostic display free RAM None <code>&lt;D CMD ON&gt;</code> Enable command input diagnostics None <code>&lt;D CMD OFF&gt;</code> Disable command input diagnostics None <code>&lt;D RAILCOM ON&gt;</code> Enable Railcom diagnostics None <code>&lt;D RAILCOM OFF&gt;</code> Disable Railcom diagnostics None <code>&lt;D WIFI ON&gt;</code> Enable WiFi diagnostics None <code>&lt;D WIFI OFF&gt;</code> Disable WiFi diagnostics None <code>&lt;D ETHERNET ON&gt;</code> Enable Ethernet diagnostics None <code>&lt;D ETHERNET OFF&gt;</code> Disable Ethernet diagnostics None <code>&lt;D WIT ON&gt;</code> Enable Withrottle diagnostics None <code>&lt;D WIT OFF&gt;</code> Disable Withrottle diagnostics None <code>&lt;D LCN ON&gt;</code> Enable LCN diagnostics None <code>&lt;D LCN OFF&gt;</code> Disable LCN diagnostics None <code>&lt;D WEBSOCKET ON&gt;</code> Enable Websocket diagnostics None <code>&lt;D WEBSOCKET OFF&gt;</code> Disable Websocket diagnostics None <code>&lt;D EEPROM numentries&gt;</code> Dump EEPROM contents <code>numentries</code>: Number of entries <code>&lt;D ANOUT vpin position&gt;</code> Test analog output <code>vpin</code>: Pin, <code>position</code>: Position <code>&lt;D ANOUT vpin position profile&gt;</code> Test analog output with profile <code>vpin</code>: Pin, <code>position</code>: Position, <code>profile</code>: Profile <code>&lt;D SERVO vpin position&gt;</code> Test servo <code>vpin</code>: Pin, <code>position</code>: Position <code>&lt;D SERVO vpin position profile&gt;</code> Test servo with profile <code>vpin</code>: Pin, <code>position</code>: Position, <code>profile</code>: Profile <code>&lt;D ANIN vpin&gt;</code> Display analogue input value <code>vpin</code>: Pin number <code>&lt;D HAL SHOW&gt;</code> Show HAL devices table None <code>&lt;D HAL RESET&gt;</code> Reset all HAL devices None <code>&lt;D TT vpin steps&gt;</code> Test turntable <code>vpin</code>: Pin, <code>steps</code>: Step count <code>&lt;D TT vpin steps activity&gt;</code> Test turntable with activity <code>vpin</code>: Pin, <code>steps</code>: Steps, <code>activity</code>: Activity"},{"location":"reference/serial-commands/#raw-dcc-packets","title":"Raw DCC Packets","text":"Command Description Parameters Status <code>&lt;M ignore d0 d1 d2 d3 d4 d5&gt;</code> Send up to 5 byte DCC packet on MAIN track <code>ignore</code>: Ignored, <code>d0-d5</code>: Hex bytes Active <code>&lt;P ignore d0 d1 d2 d3 d4 d5&gt;</code> Send up to 5 byte DCC packet on PROG track <code>ignore</code>: Ignored, <code>d0-d5</code>: Hex bytes Active <code>&lt;c&gt;</code> Report main track current None \u26a0\ufe0f Deprecated <p>Speed Values</p> <ul> <li>0: Stop</li> <li>1-127: Variable speed (1=slowest, 127=fastest)</li> </ul> <p>Direction Values</p> <ul> <li>0: Reverse</li> <li>1: Forward</li> </ul> <p>Deprecated Commands</p> <p>Commands marked with \u26a0\ufe0f are deprecated and may be removed in future versions. Use the recommended alternatives where available.</p>"},{"location":"reference/throttle-writers-guide/","title":"Throttle Writers Guide (doc incomplete)","text":"<p>TODO</p> <p>The commonly used speed, function, loco programming and diagnostic commands are discussed elsewhere with users in mind. However, there are a large number of commands designed only to be used by other programs such as JMRI, Engine Driver or other throttles specifically aimed at the DCC-EX protocol. (not WiThrottle)</p> <p>Many commands that have been implemented to assist throttle authors to obtain information from the Command Station in order to implement turnout, route/automation and roster features. Some of these commands are deliberately milti-stage requests to avoid timing and blocking issues caused by massive transmissions (e.g. a full list of turnouts with descriptions) that can cause Command Station issues.</p> <p>Broadcast replies are also designed so that a throttle can maintain loco speed and function states, turnout poisitions and route states.</p>"},{"location":"reference/throttle-writers-guide/#turnouts","title":"Turnouts","text":"<p>The conventional turnout definition commands and the <code>&lt;H&gt;</code> responses do not contain information about the turnout description which may have been provided in an EXRAIL script. A turnout description is much more user friendly than T123 and having a list helps the throttle UI build a suitable set of buttons.</p> <p><code>&lt;JT&gt;</code> command returns a list of turnout ids. The throttle should be uninterested in the turnout technology used but needs to know the ids it can throw/close and monitor the current state. e.g.  response <code>&lt;jT 1 17 22 19&gt;</code></p> <p><code>&lt;JT 17&gt;</code> requests info on turnout 17. e.g. response <code>&lt;jT 17 T \"Coal yard exit\"&gt;</code> or <code>&lt;jT 17 C \"Coal yard exit\"&gt;</code> (T=thrown, C=closed) or <code>&lt;jT 17 C \"\"&gt;</code> indicating turnout description not given. or <code>&lt;jT 17 X&gt;</code> indicating turnout unknown (or possibly hidden.)</p> <p>NOTE: It is still the throttles responsibility to monitor the status broadcasts. There is no intention of providing a command that indicates the turnout list has been updated since the throttle started.</p> <p>NOTE: Turnouts marked in EXRAIL with the HIDDEN keyword instead of a \"description\" will NOT show up in these commands.</p>"},{"location":"reference/throttle-writers-guide/#automationsroutes","title":"Automations/Routes","text":"<p>A throttle need to know which EXRAIL Automations and Routes it can show the user.</p> <p><code>&lt;JA&gt;</code> Returns a list of Automations/Routes  e.g. <code>&lt;jA 13 16 23&gt;</code>  Indicates route/automation ids.  Information on each id needs to be obtained by  <code>&lt;JA 13&gt;</code>  returns e.g. <code>&lt;jA 13 R \"description\"&gt;</code> for a route  or  <code>&lt;jA 13 A \"description\"&gt;</code> for an automation.  or <code>&lt;jA 13 X&gt;</code> for id not found</p> <p>What's the difference:</p> <p>A Route is just a call to an EXRAIL ROUTE, traditionally to set some turnouts or signals but can be used to perform any kind of EXRAIL function... but its not expecting to know the loco.    Thus, a route can be triggered by sending in for example <code>&lt;/START 13&gt;</code>.</p> <p>An Automation is a handoff of the last accessed loco id to an EXRAIL AUTOMATION which would typically drive the loco away.    Thus, an Automation expects a start command with a cab id    e.g. <code>&lt;/START 13 3&gt;</code></p> <p>Routes and Automations can also have their current status and caption altered dynamically by EXRAIL (docs TODO)</p>"},{"location":"reference/throttle-writers-guide/#roster-information","title":"Roster Information","text":"<p>The <code>&lt;JR&gt;</code> command requests a list of cab ids from the roster. e.g. responding <code>&lt;jR 3 200 6336&gt;</code> or  for none. <p>Each Roster entry had a name and function map obtained by: <code>&lt;JR 200&gt;</code>  reply like <code>&lt;jR 200 \"Thomas\" \"whistle/*bell/squeal/panic\"&gt;</code></p> <p>Refer to EXRAIL ROSTER command for function map format.</p> <p>Obtaining throttle status.</p> <p><code>&lt;t cabid&gt;</code>  Requests a deliberate update on the cab speed/functions in the same format as the cab broadcast.     <code>&lt;l cabid slot speedbyte functionMap&gt;</code></p> <p>NOTE: A slot of -1 indicates that the cab is not in the reminders table and this command will not reserve a slot until such time as the cab is throttled.</p>"},{"location":"reference/throttle-writers-guide/#commands-to-avoid-todo","title":"COMMANDS TO AVOID TODO","text":"<p><code>&lt;f cab func1 func2&gt;</code>     Use <code>&lt;F cab function 1/0&gt;</code></p> <p><code>&lt;t  slot cab speed dir&gt;</code> Just drop the slot number</p> <p><code>&lt;T commands&gt;</code> other than <code>&lt;T id 0/1&gt;</code></p> <p><code>&lt;s&gt;</code></p> <p><code>&lt;c&gt;</code></p>"},{"location":"reference/throttle-writers-guide/#momentum","title":"Momentum","text":"<p>The command station can apply momentum to throttle movements in the same way that a standards compliant DCC decoder can be set to do. This momentum can be defaulted system wide and overridden on individual locos. It does not use or alter the loco CV values and so it also works when driving DC locos. The momentum is applied regardless of the throttle type used (or even EXRAIL).</p> <p>Momentum is specified in mS / throttle_step.</p> <p>There is a new command <code>&lt;m cabid accelerating [brake]&gt;</code> where the brake value defaults to the accelerating value.</p> <p>For example:  <code>&lt;m 3 0&gt;</code>   sets loco 3 to no momentum. <code>&lt;m 3 21&gt;</code>   sets loco 3 to 21 mS/step. <code>&lt;m 3 21 42&gt;</code>   sets loco 3 to 21 mS/step accelerating and 42 mS/step when decelerating.</p> <p><code>&lt;m 0 21&gt;</code>  sets the default momentum to 21mS/Step for all current and future locos that have not been specifically set. <code>&lt;m 3 -1&gt;</code>   sets loco 3 to track the default momentum value.</p> <p>EXRAIL   A new macro <code>MOMENTUM(accel [, decel])</code> sets the momentum value of the current tasks loco ot the global default if loco=0. </p> <p>Note: Setting Momentum 7,14,21 etc is similar in effect to setting a decoder CV03/CV04 to 1,2,3.</p> <p>As an additional option, the momentum calculation is based on the difference in throttle setting and actual speed. For example, the time taken to reach speed 50 from a standing start would be less if the throttle were set to speed 100, thus increasing the acceleration.</p> <p><code>&lt;m LINEAR&gt;</code> - acceleration is uniform up to selected throttle speed. <code>&lt;m POWER&gt;</code>  - acceleration depends on difference between loco speed and selected throttle speed.</p>"},{"location":"reference/throttle-writers-guide/#todo-route-status","title":"TODO- Route Status","text":""},{"location":"reference/throttle-writers-guide/#todo-gauges","title":"TODO - Gauges","text":""},{"location":"reference/esp32/esp32-acebott/","title":"ACEBOTT + EX8874","text":"<p>ACEBOTT Beta Testing</p> <p>Please note that the ACEBOTT board is currently in Beta testing, so this information may change at any time. If using this board, we highly recommend joining our Discord server and request access to the <code>#beta-testing</code> channel.</p> <p></p>"},{"location":"reference/esp32/esp32-acebott/#acebott-esp32-max-v10","title":"ACEBOTT ESP32 Max v1.0","text":"<ul> <li>Limited testing has been done with this board.</li> <li>Please report any anomalies when using the pins in the suggested custom motor defines.</li> <li>A custom motor define is required when using the ACEBOTT ESP32 board, as the pins are in different locations vs. the WeMos ESP32.</li> <li>There is another version of the ACEBOTT ESP32 which has not been tested.  ACEBOTT focus is on STEM education kits and robotics; uncertain if their quality is better than the WeMos boards, but recent prices are comparable.</li> <li>Do not be fooled by the 5V pin on the I2C header block; there is no onboard level shifting.</li> </ul>"},{"location":"reference/esp32/esp32-acebott/#acebott-vs-wemos-r1-d32","title":"ACEBOTT vs. WeMos R1 D32","text":"<ul> <li>Fewer modifications may be required.  </li> <li>WiFi does not need the resistor.  </li> <li>Pin locations A0, A1 can be used for current sensing.  </li> <li>Default pins can be used on EX8874.  </li> </ul>"},{"location":"reference/esp32/esp32-acebott/#ioref-voltage","title":"IOREF voltage","text":"<ul> <li>The IOREF pin location has the 5V pin.  If the pin on the EX8874 is bent, the IOREF could be jumpered to 3V3 pin on the EX8874.</li> <li>The preferable work-around to the incorrect 5V pin is to modify the EX8874, using the 3V3 IOREF Override solder pad on the EX8874. If voltage is not correct, the ADC inputs will receive up to 5V when the IOREF pin is 5V.</li> <li>When using the 3V3 IOREF Override, bend the IOREF pin or confirm that the trace connecting the pin is completely cut.</li> </ul>"},{"location":"reference/esp32/esp32-acebott/#one-ex8874","title":"One EX8874","text":"<ul> <li>ACEBOTT ESP32 motor defines are not included in MotorDrivers.h</li> <li>Do not edit MotorDrivers.h; a custom motor define should be added in config.h</li> <li>Note how the ESP32 GPIO pin numbers are used, and the Arduino pin locations are shown/commented.</li> </ul> <pre><code>  #define EX8874_ACEBOTT_ESP32 F(\"EX8874_ACEBOTT_ESP32\"), \\  \n    new MotorDriver(26/* 3*/, 16/*12*/, UNUSED_PIN, 19/*9*/, 32/*A0*/, 1.52, 5000, 36/*A4*/), \\  \n    new MotorDriver(17/*11*/,  5/*13*/, UNUSED_PIN, 23/*8*/, 33/*A1*/, 1.52, 5000, 39/*A5*/)  \n  #define MOTOR_SHIELD_TYPE EX8874_ACEBOTT_ESP32\n</code></pre> <ul> <li>When one EX8874 motor shield is used with ACEBOTT ESP32 Max v1.0, the default EX8874 pins are used.  </li> </ul>"},{"location":"reference/esp32/esp32-acebott/#single-ex8874-checklist","title":"Single EX8874 Checklist","text":"<ul> <li> Cover the barrel connector on ACEBOTT ESP32, as VIN power will be provided by EX8874  </li> <li> IOREF Override set to 3v3  </li> <li> Confirm that IOREF pin is bent or trace is cut  </li> <li> Add the custom motor define - 4 lines in config.h  </li> </ul>"},{"location":"reference/esp32/esp32-acebott/#stacked-ex8874","title":"Stacked EX8874","text":"<ul> <li>Reminder: No modifications are needed when installing EX8874 for 4 track outputs on EX-CSB1.</li> <li>IOREF: The IOREF override is also needed for the top shield.</li> <li> <p>VIN: Refer to instructions on cutting the VIN trace and disabling the regulator for the top shield.</p> </li> <li> <p>Stacking motor shields on ACEBOTT ESP32 requires     a. use of solder pad for 8 alternate pins     b. for Fault pins, bend A4 and A5 pins and jumper to the GPIO headers  </p> </li> </ul> <p> </p> <ul> <li>A custom motor define will be needed in config.h</li> </ul> <pre><code>  #define EX8874X2_ACEBOTT_ESP32 F(\"EX8874X2_ACEBOTT_ESP32\"), \\  \n    new MotorDriver(26/* 3*/, 16/*12*/, UNUSED_PIN, 19/*9*/, 32/*A0*/, 1.52, 5000, 36/*A4*/), \\  \n    new MotorDriver(17/*11*/,  5/*13*/, UNUSED_PIN, 23/*8*/, 33/*A1*/, 1.52, 5000, 39/*A5*/), \\  \n    new MotorDriver(27/* 2*/, 18/*10*/, UNUSED_PIN, 12/*7*/, 34/*A4*/, 1.52, 5000, 2 /*A4*/), \\  \n    new MotorDriver(14/* 5*/, 25/* 4*/, UNUSED_PIN, 13/*6*/, 35/*A5*/, 1.52, 5000, 4 /*A5*/)  \n  #define MOTOR_SHIELD_TYPE EX8874X2_ACEBOTT_ESP32\n</code></pre>"},{"location":"reference/esp32/esp32-acebott/#stacked-ex8874-checklist","title":"Stacked EX8874 Checklist","text":"<ul> <li> Cover the barrel connector on WeMos R1 D32, as VIN power will be provided by one EX8874  </li> <li> IOREF Override set to 3v3 on both EX8874 boards  </li> <li> Confirm that IOREF pin is bent or trace is cut</li> <li> VIN trace cut and regulator disabled on top EX8874  </li> <li> Alternate pins enabled via solder pads  </li> <li> Jumpers added for GPIO 2 and 4  </li> <li> Add the custom motor define - 6 lines in config.h  </li> </ul> <p>TODO</p>"},{"location":"reference/esp32/esp32-ex8874/","title":"WeMos D1 R32 + EX8874","text":"<p>Refer to Complex Build - ESP32 for a general overview. The information below may help explain how to overcome some of the complexities when using the  </p>"},{"location":"reference/esp32/esp32-ex8874/#wifi-reliability","title":"WiFi reliability","text":"<ul> <li>Solder a 250 to 330 ohms resistor, GPIO_0 to 3.3V, for reliable WiFi when using the WeMos D1 R32 ESPDuino-32.   </li> </ul>"},{"location":"reference/esp32/esp32-ex8874/#ioref-voltage","title":"IOREF voltage","text":"<ul> <li>Do not confuse adding the resistor to correct high voltage on GPIO_0 with the need to work around the incorrect voltage of the IOREF pin.</li> <li>From top to bottom the pins are: IO0, 5V (incorrect - IOREF should be 3.3V - so not Arduino Uno R3 compliant), RESET, 3.3V, 5V, GND, GND, VIN as seen here:  </li> </ul> <ul> <li>Note that some ESPDuino-32 boards may not have the IOREF pin location labelled. Measure the voltage if in doubt.  </li> <li>As the IOREF pin on the WeMos D1 R32 is 5V, modify the EX8874 using the 3V3 IOREF Override solder pad on the EX8874. If this is not done, the ADC inputs will receive up to 5V when the IOREF pin is 5V.</li> <li>Bend the IOREF pin or confirm that the trace connecting the pin is completely cut.  </li> </ul>"},{"location":"reference/esp32/esp32-ex8874/#one-ex8874","title":"One EX8874","text":"<p>Review of motor shield define from MotorDrivers.h for ESP32 WeMos R1 D32</p> <pre><code>  #elif defined(ARDUINO_ARCH_ESP32)  \n  // STANDARD shield on an ESPDUINO-32 (ESP32 in Uno form factor). The shield must be eiter the  \n  // 3.3V compatible R3 version or it has to be modified to not supply more than 3.3V to the  \n  // analog inputs. Here we use analog inputs A2 and A3 as A0 and A1 are wired in a way so that  \n  // they are not useable at the same time as WiFi (what a bummer). The numbers below are the  \n  // actual GPIO numbers. In comments the numbers the pins have on an Uno.  \n  #define STANDARD_MOTOR_SHIELD F(\"STANDARD_MOTOR_SHIELD\"), \\  \n    new MotorDriver(25/* 3*/, 19/*12*/, UNUSED_PIN, 13/*9*/, 35/*A2*/, 0.70, 1500, UNUSED_PIN), \\  \n    new MotorDriver(23/*11*/, 18/*13*/, UNUSED_PIN, 12/*8*/, 34/*A3*/, 0.70, 1500, UNUSED_PIN)  \n\n  // EX 8874 based shield connected to a 3.3V system (like ESP32) and 12bit (4096) ADC  \n  // numbers are GPIO numbers. comments are UNO form factor shield pin numbers  \n  #define EX8874_SHIELD F(\"EX8874\"),\\  \n    new MotorDriver(25/* 3*/, 19/*12*/, UNUSED_PIN, 13/*9*/, 35/*A2*/, 1.27, 5000, 36 /*A4*/), \\  \n    new MotorDriver(23/*11*/, 18/*13*/, UNUSED_PIN, 12/*8*/, 34/*A3*/, 1.27, 5000, 39 /*A5*/)  \n</code></pre> <ul> <li>STANDARD_MOTOR_SHIELD and EX8874_SHIELD are pre-defined for use with ESP32 in MotorDrivers.h</li> <li>Do not edit MotorDrivers.h; a custom motor define must be added in your config.h only</li> <li>Note how the ESP32 GPIO pin numbers are used, and the Arduino pin locations are shown/commented.</li> </ul> <p>Alternate pins A2 and A3 are required for the WeMos D1 R32 / ESPDuino-32.</p> <p>One EX8874 motor shield would use the motor define EX8874_SHIELD, and update the solder pads to use A2 and A3.</p> <p></p> <p>When one EX8874 motor shield is used with WeMos R1 D32 ESPDuino-32, the alternate current sense pins are used as the A0 and A1 pin locations cannot be used as ADC input when WiFi is enabled.</p> <p></p>"},{"location":"reference/esp32/esp32-ex8874/#single-ex8874-checklist","title":"Single EX8874 Checklist","text":"<ul> <li> Cover the barrel connector on WeMos R1 D32, as VIN power will be provided by EX8874</li> <li> Add resistor for WiFi reliability - GPIO_0 to 3v3</li> <li> IOREF Override set to 3v3</li> <li> Confirm that IOREF pin is bent or trace is cut</li> <li> Alternate pins enabled via solder pads</li> <li> <code>#define MOTOR_SHIELD_TYPE EX8874_SHIELD</code> on one line in config.h</li> </ul>"},{"location":"reference/esp32/esp32-ex8874/#stacked-ex8874","title":"Stacked EX8874","text":"<ul> <li>IOREF: The IOREF override is also needed for the top shield.</li> <li>VIN: Refer to instructions on cutting the VIN trace and disabling the regulator for the top shield.</li> <li>Stacking motor shields on WeMos D1 R32 ESPDuino-32 requires a combination of solder pads and complex wiring.   Note the location of GPIO pins 15 and 33 (image above), where wires or right-angle header pins will need to be installed on the WeMos R1 D32 ESPDuino-32.</li> </ul> <ul> <li>A custom motor define will be needed in config.h</li> </ul> <pre><code>  #define EX8874_SHIELDX2 F(\"EX8874_SHIELDX2\"), \\  \n    new MotorDriver(25/* 3*/, 19/*12*/, UNUSED_PIN, 13/*9*/, 35/*A2*/, 1.52, 5000, 15), \\  \n    new MotorDriver(23/*11*/, 18/*13*/, UNUSED_PIN, 12/*8*/, 34/*A3*/, 1.52, 5000, 33), \\  \n    new MotorDriver(26/* 2*/,  5/*10*/, UNUSED_PIN, 14/*7*/, 36/*A4*/, 1.52, 5000, 2 /*A0*/), \\  \n    new MotorDriver(16/* 5*/, 17/* 4*/, UNUSED_PIN, 27/*6*/, 39/*A5*/, 1.52, 5000, 4 /*A1*/)  \n  #define MOTOR_SHIELD_TYPE EX8874_SHIELDX2\n</code></pre>"},{"location":"reference/esp32/esp32-ex8874/#stacked-ex8874-checklist","title":"Stacked EX8874 Checklist","text":"<ul> <li> Cover the barrel connector on WeMos R1 D32, as VIN power will be provided by one EX8874  </li> <li> Add resistor for WiFi reliability  </li> <li> IOREF Override set to 3v3 on both EX8874 boards  </li> <li> Confirm that IOREF pin is bent or trace is cut  </li> <li> VIN trace cut and regulator disabled on top EX8874  </li> <li> Alternate pins enabled via solder pads  </li> <li> Complex wiring added  </li> <li> Jumpers added for GPIO 15 and 33  </li> <li> Add the custom motor define - 6 lines in config.h  </li> </ul> <p>TODO</p>"},{"location":"reference/esp32/esp32-l298-shield/","title":"ESP32 + L298 Shields","text":""},{"location":"reference/esp32/esp32-l298-shield/#genuine-arduino-motor-shield-r3","title":"Genuine Arduino Motor Shield R3","text":"<ul> <li> <p>IOREF voltage </p> <ul> <li>The IOREF pin on the ESP32 Uno form factor boards is 5V -- and not correct for a 3.3V microprocessor.  </li> <li>To avoid damaging the ESP32\u2019s analog inputs, correct the IOREF voltage by bending the IOREF pin on the L298 motor shield, and use a jumper to connect the 3.3V pin to IOREF on the motor shield itself.  </li> <li>On the Genuino Arduino Motor Shield R3, the IOREF voltage is used as the supply voltage on the LMV358 op-amp and provides a spillway effect for the Schottky diodes on the A2, A3 pins of the motor shield.</li> </ul> </li> <li> <p>Current sensing </p> <ul> <li>For current sensing bend or cut the A0 and A1 pins.  </li> <li>On the top of the motor shield connect A0 to A2 and A1 to A3 via jumpers.  </li> <li>On the Wemos D1 R32 ESP32, the A0, A1 pins are connected to GPIO2 and GPIO4 -- not useable for ADC input at the same time as WiFi.  Connecting to the A2, A3 pins also provides the benefit of the Schottky diodes.</li> </ul> </li> <li> <p>Motor define - STANDARD_MOTOR_SHIELD </p> <ul> <li>When STANDARD_MOTOR_SHIELD is defined in config.h, the definition for the WeMos D1 R32 is in place when ESP32 is selected as the build target.</li> </ul> </li> </ul>"},{"location":"reference/esp32/esp32-l298-shield/#clone-motor-shields","title":"Clone Motor Shields","text":"<ul> <li> <p>IOREF voltage </p> <ul> <li>The IOREF pin on the ESP32 Uno form factor boards is 5V -- and not correct for a 3.3V microprocessor.  </li> <li>Correct the IOREF voltage by bending the IOREF pin on the L298 motor shield, then   IOREF will can be connected to the 3.3V pin to provide a spillway effect for the Schottky diodes on the A2, A3 pins of the motor shield.</li> </ul> </li> <li> <p>Current sensing </p> <ul> <li> <p>Some clone shields have current sense circuits and can be used with Mega without modifications.   With ESP32-WROOM and Nucleo-F4, modifications are needed to protect ADC inputs.  </p> </li> <li> <p>We have found no shields which have the same current sensing circuit as the Genuine Arduino R3.   Clone shields may have current sensing, but will not have the LMV358 op-amp, or the LMV358 op-amp supply voltage is connected to 5V instead of the IOREF pin.</p> </li> </ul> </li> <li> <p>Modifications to protect ADC inputs </p> <ul> <li>Connecting IOREF to 3V3 will enable the Schottky diodes which connect to the A2, A3 pins.  </li> <li>Voltage divider resistor circuit is used to reduce the voltage from the op-amp </li> </ul> </li> </ul> <ul> <li> <p>Motor define - STANDARD_MOTOR_SHIELD </p> <ul> <li>When STANDARD_MOTOR_SHIELD is defined in config.h, the definition for the WeMos D1 R32 is in place when ESP32 is selected as the build target.</li> <li>Review of motor shield define from MotorDrivers.h for ESP32 WeMos R1 D32  </li> </ul> <pre><code>#define STANDARD_MOTOR_SHIELD F(\"STANDARD_MOTOR_SHIELD\"), \\  \n    new MotorDriver(25/* 3*/, 19/*12*/, UNUSED_PIN, 13/*9*/, 35/*A2*/, 0.70, 1500, UNUSED_PIN), \\  \n    new MotorDriver(23/*11*/, 18/*13*/, UNUSED_PIN, 12/*8*/, 34/*A3*/, 0.70, 1500, UNUSED_PIN)  \n</code></pre> </li> </ul> <p></p> <ul> <li> <p>Motor define - ACEBOTT + L298 shield </p> <ul> <li>Even though the ACEBOTT A0, A1 pins locations are available, using the A2, A3 pins facilitates the voltage divider circuit along with the benefit of the Schottky diodes.  </li> <li>A custom motor define will be needed in config.h  </li> </ul> <pre><code>#define L298_ACEBOTT_ESP32 F(\"L298_ACEBOTT_ESP32\"), \\  \n    new MotorDriver(26/* 3*/, 16/*12*/, UNUSED_PIN, 19/*9*/, 34/*A2*/, 0.70, 1500, UNUSED_PIN), \\  \n    new MotorDriver(17/*11*/,  5/*13*/, UNUSED_PIN, 23/*8*/, 35/*A3*/, 0.70, 1500, UNUSED_PIN)  \n#define MOTOR_SHIELD_TYPE L298_ACEBOTT_ESP32\n</code></pre> </li> </ul> <p></p>"},{"location":"reference/ex-csb1/csb1-errors-faq/","title":"EX-CSB1 FAQ","text":"<ul> <li> <p>Error indicating the need for installing Windows drivers   link to driver</p> </li> <li> <p>Info regarding the need to add capacitor to enable uploading</p> </li> <li> <p>asdf</p> </li> <li> <p>jkl</p> </li> </ul>"},{"location":"reference/ex-csb1/csb1-technical/","title":"EX-CSB1 Technical Reference","text":"<ul> <li> <p>Link to EX-CSB1 Schematic</p> </li> <li> <p>Arduino headers </p> </li> <li> <p>I2C headers </p> </li> <li> <p>How to utilize Serial2</p> </li> <li> <p>other</p> </li> <li> <p>Difference in current sensing vs EX8874</p> </li> </ul> <p>TODO</p>"},{"location":"reference/hardware/motorboards/l298-shields/","title":"L298P &amp; L298HN Shields","text":"<ul> <li> <p>DCC mode requires motor boards/shields where the switching frequency is capable of 10kHz on each output wire.</p> </li> <li> <p>DC mode uses the brake pin for the PWM signal.  </p> </li> <li> <p>Arduino and clone L298 shields use the XNOR gate to provide the inverted signal for DCC, but this does not provide low side brake in both directions for DC mode -- an issue for a reversing loop. DC mode logic gate circuits</p> </li> <li> <p>There is a significant voltage drop when using L298 motor drivers. (see table below)  </p> </li> <li> <p>VIN from L298 motor shields should not be used to power the microprocessor board.   Cut the VIN trace or bend the VIN pin on L298 shields.  </p> </li> </ul>"},{"location":"reference/hardware/motorboards/l298-shields/#genuine-arduino-r3","title":"Genuine Arduino R3","text":"<ul> <li>The Genuine Arduino R3 motor shield can be used with 5V and 3.3V microprocessors.   Arduino Motor Shield R3 included updates to the current sense circuit, which has not been adopted by any clones tested.  </li> </ul>"},{"location":"reference/hardware/motorboards/l298-shields/#clone-shields","title":"Clone shields","text":"<ul> <li> <p>Some clone shields have current sense circuits and can be used with Mega.   With ESP32-WROOM and Nucleo-F4, modifications are needed to protect ADC inputs.  </p> </li> <li> <p>Do not buy a motor shield without current sensing. </p> </li> <li> <p>We have found no shields which have the same current sensing circuit as the Genuine Arduino R3.</p> </li> <li> <p>Clone shields may have current sensing, but will not have the LMV358 op-amp, or the LMV358 op-amp supply voltage is connected to 5V instead of the IOREF pin.</p> </li> </ul>"},{"location":"reference/hardware/motorboards/l298-shields/#voltage-drop","title":"Voltage drop","text":"<ul> <li>Note the 3V drop at 1.1A with the L298 shield.   The 9.36V amplitude is the 'across the tracks' voltage. </li> </ul>"},{"location":"reference/hardware/motorboards/schematics/","title":"Schematics","text":"<p>Links to download/view schematics, etc.</p> <ul> <li> <p>EX-MotorShield8874 EX8874 </p> </li> <li> <p>Arduino Motor Shield R3 L298P</p> </li> <li> <p>IBT_2 BTS7960 - Schematic Handson Technology datasheet</p> </li> </ul>"},{"location":"reference/nucleo/nucleo-144-ex8874/","title":"Nucleo 144 - EX8874","text":"<p>Review of motor shield define from MotorDrivers.h for F429ZI or F439ZI</p> <pre><code>  #if defined(ARDUINO_NUCLEO_F429ZI) || defined(ARDUINO_NUCLEO_F439ZI) || defined(ARDUINO_NUCLEO_F4X9ZI)  \n  // EX 8874 based shield connected to a 3V3 system with 12-bit (4096) ADC  \n  // The Ethernet capable STM32 models cannot use Channel B BRAKE on D8, and must use the ALT pin of D6,  \n  // AND cannot use Channel B PWN on D11, but must use the ALT pin of D5  \n  #define EX8874_SHIELD F(\"EX8874\"), \\  \n    new MotorDriver( 3, 12, UNUSED_PIN, 9, A0, 1.27, 5000, A4), \\  \n    new MotorDriver( 5, 13, UNUSED_PIN, 6, A1, 1.27, 5000, A5)  \n</code></pre> <p>Alternate pins D5 and D6 are required for the Nucleo-144 boards with Ethernet. One EX8874 motor shield would use the standard motor define EX8874_SHIELD, and update the solder pads to use D5 and D6.  </p> <p> </p>"},{"location":"reference/nucleo/nucleo-144-ex8874/#stacked-ex8874-motor-shields-on-f429zi-f439zi","title":"Stacked EX8874 motor shields on F429ZI F439ZI","text":"<ul> <li>When using two EX8874 motor shields, the VIN on one shield can be used to power the Nucleo-144.   Cut two traces to disable VIN on the stacked/second shield. \u00a0 Link to Hardware EX8874 page</li> </ul> <ul> <li>Review where jumpers will be required, due to pin conflict/function/availability.</li> </ul> <ul> <li>Tracks A and B can use the same alternate pins D5 and D6 as they would if only one shield was used.   Pins were selected so that the stacked motor shield pins D11,D9,D8,A4,A5 can be bent out, and short jumpers added to connect pins D7,D28,D29,D64,D65.</li> </ul> <ul> <li>A custom motor define will be needed in config.h</li> </ul> <pre><code>  #define EX8874_SHIELDX2 F(\"EX8874_SHIELDX2\"), \\  \n    new MotorDriver( 3, 12, UNUSED_PIN,  9, A0, 1.27, 5000, A4), \\  \n    new MotorDriver( 5, 13, UNUSED_PIN,  6, A1, 1.27, 5000, A5), \\  \n    new MotorDriver( 2, 10, UNUSED_PIN, 28, A2, 1.27, 5000, 64), \\  \n    new MotorDriver( 7,  4, UNUSED_PIN, 29, A3, 1.27, 5000, 65)  \n  #define MOTOR_SHIELD_TYPE EX8874_SHIELDX2\n</code></pre>"},{"location":"reference/nucleo/nucleo-144-ex8874/#ex8874-f413zh-f446ze","title":"EX8874 - F413ZH F446ZE","text":"<ul> <li> <p>If using two EX8874 motor shields, the VIN on one shield can be used to power the Nucleo-144.   Cut two traces to disable VIN on the stacked/second shield. \u00a0 Link to Hardware EX8874 page</p> </li> <li> <p>D11 can be used as there is no Ethernet conflict. Brake and Fault pin updates as shown for F429ZI F439ZI.</p> </li> </ul> <p>TODO - update MotorDrivers.h for D8</p> <ul> <li>This motor define can be used with E8874 and F413ZH F446RE   - alternate Brake pin is used for Track B   - presently a custom motor define is needed in config.h</li> </ul> <pre><code> #define EX8874_F413ZH F(\"EX8874_F413ZH\"), \\  \n    new MotorDriver( 3, 12, UNUSED_PIN, 9, A0, 1.27, 5000, A4), \\  \n    new MotorDriver(11, 13, UNUSED_PIN, 6, A1, 1.27, 5000, A5)  \n #define MOTOR_SHIELD_TYPE EX8874_F413ZH\n</code></pre> <p> </p> <ul> <li>Stacked EX8874 shields on F413ZH F446ZE   - Very similar to modifications/jumpers of F429ZI F439ZI   - D11 can be used for track B; D5 can be used for track D   - Brake and Fault pin modifications/jumpers as above   - A custom motor define will be needed in config.h</li> </ul> <pre><code>  #define EX8874_F413ZH_X2 F(\"EX8874_F413ZH_X2\"), \\  \n    new MotorDriver( 3, 12, UNUSED_PIN,  9, A0, 1.27, 5000, A4), \\  \n    new MotorDriver(11, 13, UNUSED_PIN,  6, A1, 1.27, 5000, A5), \\  \n    new MotorDriver( 2, 10, UNUSED_PIN, 28, A2, 1.27, 5000, 64), \\  \n    new MotorDriver( 5,  4, UNUSED_PIN, 29, A3, 1.27, 5000, 65)  \n  #define MOTOR_SHIELD_TYPE EX8874_F413ZH_X2\n</code></pre>"},{"location":"reference/nucleo/nucleo-144-pin-reference/","title":"Nucleo 144 - Pins","text":""},{"location":"reference/nucleo/nucleo-144-pin-reference/#pin-diagrams","title":"Pin diagrams","text":"<ul> <li>Pin diagrams of Zio headers are edited to include Arduino style pin numbers.   These are F429ZI/F439ZI; F446ZE and F413ZH are quite similar.  Refer to varaint files to confirm.</li> </ul> <ul> <li> <p>Links to st.com for each Nucleo-144 and the UM1974 pdf https://os.mbed.com/platforms/ST-Nucleo-F429ZI/ https://os.mbed.com/platforms/ST-Nucleo-F446ZE/ https://os.mbed.com/platforms/ST-Nucleo-F413ZH/ UM1974 Nucleo-144 UM1724 Nucleo-64</p> </li> <li> <p>Location of variant files   C:\\Users\\username\\.platformio\\packages\\framework-arduinoststm32\\variants\\STM32F4xx\\F427Z(G-I)T_F429ZET_F429Z(G-I)(T-Y)_F437Z(G-I)T_F439Z(G-I)(T-Y)   C:\\Users\\username\\AppData\\Local\\Arduino15\\packages\\STMicroelectronics\\hardware\\stm32\\2.9.0\\variants\\STM32F4xx\\F427Z(G-I)T_F429ZET_F429Z(G-I)(T-Y)_F437Z(G-I)T_F439Z(G-I)(T-Y)</p> </li> </ul>"},{"location":"reference/nucleo/nucleo-144-pin-reference/#8-district-pcb","title":"8 District PCB","text":"<p>This is a prototype/development board - - almost plug-n-play, once the headers and other components are soldered.  Motor shields are installed without modifications.</p> <ul> <li> <p>Table of pins used in motor define   \u00a0 \u00a0 \u00a0 \u00a0 </p> </li> <li> <p>Link to pdf with pins assigned for 8 districts and other accessories Nucleo-144 pin use table - pdf</p> </li> <li> <p>Add custom motor define in config.h   Example shows two EX8874 and two L298 motor shields</p> </li> </ul> <pre><code>  #define F439_4X2 F(\"F439_4X2\"), \\\n    new MotorDriver(16, 21, UNUSED_PIN, 10, A13, 1.27, 5000, 20), \\  \n    new MotorDriver(22, 23, UNUSED_PIN, 5, A6, 1.27, 5000, 25), \\  \n    new MotorDriver(26, 43, UNUSED_PIN, 28, A2, 1.27, 5000, 27), \\  \n    new MotorDriver(30, 44, UNUSED_PIN, 29, A8, 1.27, 5000, 49), \\  \n    new MotorDriver(39, 36, UNUSED_PIN, 38, A3, 0.73, 1500, UNUSED_PIN), \\  \n    new MotorDriver(34, 35, UNUSED_PIN, 58, A4, 0.73, 1500, UNUSED_PIN), \\  \n    new MotorDriver(57, 64, UNUSED_PIN, 59, A5, 0.73, 1500, UNUSED_PIN), \\  \n    new MotorDriver(66, 65, UNUSED_PIN, 61, A14, 0.73, 1500, UNUSED_PIN)  \n  #define MOTOR_SHIELD_TYPE F439_4X2\n</code></pre> <p> </p> <ul> <li> <p>Schematic</p> </li> <li> <p>Limited availability upon request - open a ticket on the discord server</p> </li> </ul>"},{"location":"reference/nucleo/nucleo-144-wifi/","title":"Nucleo 144 - WiFi","text":""},{"location":"reference/nucleo/nucleo-144-wifi/#makerfabs-wifi-shield","title":"MakerFabs WiFi shield","text":"<ul> <li>   The shorting jumpers can be used for pins D0/D1 (USART6) to connect the 5V WiFi shield pins.    3.3V headers can be installed on the WiFi shield and flying wire jumpers used to connect USART6 or UART2 pins.  (remove the shorting jumpers)    The defined serial pins are 5V tolerant on the Nucleo-F4 boards.</li> </ul>"},{"location":"reference/nucleo/nucleo-144-wifi/#serial-pins","title":"Serial pins","text":"<ul> <li>Specific pins are defined for the Nucleo-144 boards.   This shows how 3 serial ports are defined for some Nucleo-144 boards; two are polled to see if WiFi is connected.</li> </ul> <pre><code>  HardwareSerial Serial6(PG9, PG14);  // Rx=PG9, Tx=PG14 -- USART6  \n  HardwareSerial Serial2(PD6, PD5);  // Rx=PD6, Tx=PD5 -- UART2  \n  #if !defined(ARDUINO_NUCLEO_F412ZG)  // F412ZG does not have UART5  \n    HardwareSerial Serial5(PD2, PC12);  // Rx=PD2, Tx=PC12 -- UART5  \n</code></pre> <ul> <li>WiFi Polling alias   The SERIAL1 or SERAIL3 alias would be used in config.h, if Serial6 or Serial2 are used for other purposes.</li> </ul> <pre><code>  #define SERIAL1 Serial6  \n  #define SERIAL3 Serial2  \n</code></pre> <ul> <li>Serial pins for Nucleo-64 and Nucleo-144 boards </li> </ul>"},{"location":"reference/nucleo/nucleo-144-wifi/#pin-diagram","title":"Pin diagram","text":"<ul> <li>Pin diagram for Nucleo-144 boards   Read the notes added to the diagram. </li> </ul>"},{"location":"reference/nucleo/nucleo-64-ex8874/","title":"Nucleo 64 - EX8874","text":""},{"location":"reference/nucleo/nucleo-64-ex8874/#one-ex8874-motor-shield","title":"One EX8874 motor shield","text":"<ul> <li>Review of motor shield define from MotorDrivers.h for F411RE or F446RE  </li> </ul> <pre><code>  // EX 8874 based shield connected to a 3V3 system with 12-bit (4096) ADC  \n  #define EX8874_SHIELD F(\"EX8874\"), \\  \n    new MotorDriver( 3, 12, UNUSED_PIN, 9, A0, 1.27, 5000, A4), \\  \n    new MotorDriver(11, 13, UNUSED_PIN, 8, A1, 1.27, 5000, A5)  \n</code></pre> <ul> <li>One EX8874 motor shield would use the standard motor define EX8874_SHIELD.  No modifications are needed.</li> </ul>"},{"location":"reference/nucleo/nucleo-64-ex8874/#stacked-ex8874-motor-shields-on-f411re-f446re","title":"Stacked EX8874 motor shields on F411RE F446RE","text":"<ul> <li> <p>When using two EX8874 motor shields, the VIN on one shield can be used to power the Nucleo-144.   Cut two traces to disable VIN on the stacked/second shield. \u00a0 Link to Hardware EX8874 page </p> </li> <li> <p>Tracks A and B can use the default pins as they would if only one shield was used.  </p> </li> <li> <p>Tracks C and D can use the alternates for 8 pins.   Short jumpers will be needed to connect the Fault pins.</p> </li> </ul> <ul> <li>A custom motor define will be needed in config.h</li> </ul> <pre><code>  #define EX8874_SHIELDX2 F(\"EX8874_SHIELDX2\"), \\  \n    new MotorDriver( 3, 12, UNUSED_PIN, 9, A0, 1.27, 5000, A4), \\  \n    new MotorDriver(11, 13, UNUSED_PIN, 8, A1, 1.27, 5000, A5), \\  \n    new MotorDriver( 2, 10, UNUSED_PIN, 7, A2, 1.27, 5000, 28), \\  \n    new MotorDriver( 5,  4, UNUSED_PIN, 6, A3, 1.27, 5000, 29)  \n  #define MOTOR_SHIELD_TYPE EX8874_SHIELDX2\n</code></pre>"},{"location":"reference/nucleo/nucleo-64-wifi/","title":"Nucleo 64 - WiFi and Pins","text":""},{"location":"reference/nucleo/nucleo-64-wifi/#makerfabs-wifi-shield","title":"MakerFabs WiFi shield","text":"<ul> <li>   Remove the shorting jumpers to disconnect pins D0/D1.    3.3V headers can be installed on the WiFi shield and flying wire jumpers used to connect USART6 or UART2 pins.  (remove the shorting jumpers)    The defined serial pins are 5V tolerant on the Nucleo-F4 boards; jumpers might be used to connect the 5V RxTx pins.</li> </ul>"},{"location":"reference/nucleo/nucleo-64-wifi/#serial-pins","title":"Serial pins","text":"<ul> <li>Specific pins are defined for the Nucleo-64 boards.   This shows how 2 serial ports are defined for each Nucleo-64 board; both ports are polled to see if WiFi is connected.</li> </ul> <pre><code>  #if defined(ARDUINO_NUCLEO_F401RE)  \n    HardwareSerial Serial1(PB7, PB6);  // Rx=PB7, Tx=PB6 -- CN7 pin 17 and CN10 pin 17  \n    HardwareSerial Serial6(PA12, PA11);  // Rx=PA12, Tx=PA11 -- CN10 pins 12 and 14 - F401RE  \n  #elif defined(ARDUINO_NUCLEO_F411RE)  \n    HardwareSerial Serial1(PB7, PA15);  // Rx=PB7, Tx=PA15 -- CN7 pins 17 and 21 - F411RE  \n    HardwareSerial Serial6(PA12, PA11);  // Rx=PA12, Tx=PA11 -- CN10 pins 12 and 14 - F411RE  \n  #elif defined(ARDUINO_NUCLEO_F446RE)  \n    HardwareSerial Serial3(PC11, PC10);  // Rx=PC11, Tx=PC10 -- USART3 - F446RE  \n    HardwareSerial Serial5(PD2, PC12);  // Rx=PD2, Tx=PC12 -- UART5 - F446RE   \n</code></pre> <ul> <li>WiFi Polling alias   The SERIAL1 or SERAIL3 alias would be used in config.h, if Serial1, Serial6, Serial3 or Serial5 are used for other purposes.</li> </ul> <pre><code>  #if defined(ARDUINO_NUCLEO_F401RE) || defined(ARDUINO_NUCLEO_F411RE)  \n    #define SERIAL1 Serial1  \n    #define SERIAL3 Serial6  \n  #elif defined(ARDUINO_NUCLEO_F446RE)  \n    #define SERIAL1 Serial3  \n    #define SERIAL3 Serial5  \n</code></pre> <ul> <li>Serial pins for Nucleo-64 and Nucleo-144 boards </li> </ul>"},{"location":"reference/nucleo/nucleo-64-wifi/#pin-diagram","title":"Pin diagram","text":"<ul> <li> <p>Pin diagram for Nucleo-64 boards </p> </li> <li> <p>Links to st.com for each Nucleo-64 and the UM1724 pdf https://os.mbed.com/platforms/ST-Nucleo-F411RE/ https://os.mbed.com/platforms/ST-Nucleo-F446RE/ UM1724 Nucleo-64 UM1974 Nucleo-144</p> </li> <li> <p>Location of variant files   C:\\Users\\username\\.platformio\\packages\\framework-arduinoststm32\\variants\\STM32F4xx\\F411R(C-E)T   C:\\Users\\username\\.platformio\\packages\\framework-arduinoststm32\\variants\\STM32F4xx\\F446R(C-E)T   C:\\Users\\username\\AppData\\Local\\Arduino15\\packages\\STMicroelectronics\\hardware\\stm32\\2.9.0\\variants\\STM32F4xx\\F411R(C-E)T   C:\\Users\\username\\AppData\\Local\\Arduino15\\packages\\STMicroelectronics\\hardware\\stm32\\2.9.0\\variants\\STM32F4xx\\F446R(C-E)T</p> </li> </ul>"},{"location":"reference/nucleo/nucleo-debug/","title":"Nucleo - Debug","text":"<p>One of the features of the Nucleo-F4 boards is their included debug facility.</p> <ul> <li> <p>Advanced topic -- find link/video where it is explained</p> </li> <li> <p>Images of how/where to set a breakpoint and step thru the code.</p> </li> </ul>"},{"location":"reference/nucleo/nucleo-drivers/","title":"Nucleo - USB Drivers","text":""},{"location":"reference/nucleo/nucleo-drivers/#required-for-windows","title":"Required for Windows","text":"<p>When using any of the NUCLEO series microcontrollers with Microsoft Windows, you will need to install their STLink USB drivers in order to be able to upload software to them and use the Serial Monitor in either PlatformIO or the Arduino IDE.</p> <p>Note</p> <p>You should install these drivers before plugging your NUCLEO device in for the first time. Linux and MacOS users don\u2019t need the drivers installed.</p> <ul> <li> <p>Download stsw-link009.zip from st.com </p> </li> <li> <p>Once you download and extract this zip file, you will need to install the STLink drivers located in the \u201cstsw-link009\u201d folder.</p> </li> <li> <p>Right click the \u201cstlink_winusb_install.bat\u201d file and select \u201cRun as administrator\u201d. You will need to click \u201cYes\u201d to allow it to make changes to your computer. </p> </li> <li> <p>Click \u2018Next\u2019 to install the drivers, and you should see this summary screen to confirm the drivers installed successfully: </p> </li> <li> <p>You can now plug your NUCLEO device in and proceed with upgrading the debugger firmware (highly recommended).</p> </li> </ul>"},{"location":"reference/nucleo/nucleo-firmware/","title":"Nucleo - STLink Firmware","text":""},{"location":"reference/nucleo/nucleo-firmware/#upgrade-the-debugger-firmware","title":"Upgrade the debugger firmware","text":"<ul> <li> <p>All Nucleos come with a built-in debugger interface, which is the portion of the PCB at the top near the USB connector. This is of great advantage during development as it helps us track down issues more readily. It does however mean that device drivers are needed for Windows (7, 10 and 11 supported), and that the debugger firmware may need upgrading. See notes below.</p> </li> <li> <p>During testing, it was noted with certain USB chipsets on Windows 11 that serial responses via the USB debugger port would stop being received by the Serial Monitor, even though the device continued to operate normally. The recommendation to resolve this issue is to upgrade the debugger firmware.</p> </li> <li> <p>We recommend you upgrade the debugger firmware regardless if you experience this issue or not, and regardless of whether you use Windows, Linux or MacOS. Instructions for Linux and MacOS can be found on the web but rely on using the Java app in the AllPlatforms folder.</p> </li> <li> <p>You need to ensure your NUCLEO device is plugged in to a USB port prior to commencing the upgrade.</p> </li> <li> <p>Download stsw-link007-v3-16-9.zip or later from st.com </p> </li> <li> <p>You will need to navigate through the \u201cen.stsw-link007_v3-16-9\u201d folder down to the \u201cWindows\u201d folder, which contains an executable \u201cST-LinkUpgrade.exe\u201d to upgrade the firmware on the NUCLEO devices. </p> </li> <li> <p>Double click this file to run it, which should present the upgrade window. </p> </li> <li> <p>Clicking the \u201cDevice Connect\u201d button will attempt to connect to your NUCLEO device and display the currently installed firmware version, along with the version it will attempt to upgrade to. </p> </li> <li> <p>Providing your NUCLEO device has been detected and is running an older version of the firmware, click \u201cYes &gt;&gt;&gt;&gt;\u201d to proceed with the upgrade.</p> </li> <li> <p>Hopefully you will see the \u201cUpgrade is successful\u201d pop up appear when complete. </p> </li> <li> <p>At this point, after clicking \u201cOK\u201d the software should display the new version of the firmware that has been applied to your device.</p> </li> </ul>"},{"location":"reference/nucleo/nucleo-power/","title":"Nucleo - Power","text":""},{"location":"reference/nucleo/nucleo-power/#vin-from-ex8874","title":"VIN from EX8874","text":"<ul> <li> <p>EX-MotorShield8874 provides VIN output, which can be used to power the Nucleo 64/144.  </p> </li> <li> <p>In order to take advantage of the EX-MotorShield8874\u2019s single power source capability, you will need to move the Nucleo power source jumper.  </p> </li> <li> <p>On the Nucleo-64s it\u2019s jumper JP5 which you move from the U5V position (pins 1+2 jumpered, USB 5V source being used) to the E5V position (pins 2+3 jumpered).  </p> </li> <li> <p>On the Nucleo-144s it\u2019s jumper JP3 which you move from the U5V position (centre pins 3+4 jumpered, USB 5V source being used) to the VIN-5V position (rightmost pins 5+6 jumpered).  </p> </li> <li> <p>In both cases this will power your Nucleo using the EX-MotorShield8874\u2019s onboard switch mode power supply of 7.2V to the VIN pin, and allows some 800mA of 5V power to be available for the Nucleo and peripherals.  </p> </li> <li> <p>Note for programming: Once you do this it will mean you need both the EX-MotorShield8874 barrel jack to be powered AND the USB cable to enable programming. Or you can temporarily move JP5 back to U5V whilst uploading EX\u2011CommandStation.  </p> </li> <li> <p>Power connection sequence: The correct sequence is power on the EX-MotorShield8874 barrel jack, then attach the USB cable according to the STMicroelectronics documentation. </p> </li> </ul>"},{"location":"reference/nucleo/nucleo-power/#vin-voltage","title":"VIN voltage","text":"<ul> <li>Optimum VIN voltage is 7 volts.   VIN range is from 7 V to 12 V only and input current capability is linked to input voltage:   \u00a0  \u00a0 800 mA input current when Vin = 7 V   \u00a0  \u00a0 450 mA input current when 7 V &lt; Vin &lt;= 9 V   \u00a0  \u00a0 250 mA input current when 9 V &lt; Vin &lt;= 12 V</li> </ul>"},{"location":"reference/nucleo/nucleo-power/#usb","title":"USB","text":"<ul> <li> <p>USB can be used for power, but accessory power will be limited.  </p> </li> <li> <p>Caution:  If VIN jumper is not set to use USB - and - USB is connected prior to EX8874 being powered, expect enumeration issues and reduced power.  </p> </li> <li> <p>Refer to st.com user manuals UM1974 Nucleo-144 UM1724 Nucleo-64</p> </li> </ul>"},{"location":"reference/trackmanager/dc-mode-frequency/","title":"DC Mode - PWM Frequency","text":"<p>The default PWM frequency is 131Hz.  Functions F29-F30-F31 are defined to enable other frequencies.</p> <p>The functions will toggle the bits ON/OFF as shown in the table.</p> <p> </p> <p>NOTE:</p> <ul> <li> <p>The frequency does not change until a powerON command is sent.</p> </li> <li> <p>Tracks are assigned to timers.  Throttles are assigned to tracks.   Changing the frequency for one throttle will impact all tracks assigned to the same timer. more information</p> </li> <li> <p>TODO  How to effectively use DC mode when using multiple frequencies.  </p> </li> </ul>"},{"location":"reference/trackmanager/dc-mode-logic/","title":"DC Mode - Logic Gate Circuits","text":"<p>This additional information may be useful for those who are not using CSB1 or EX8874, and would like to understand what would be needed for DC mode with other motor boards/shields.</p> <p>With DC mode, the PWM signal is provided with the brake pin.  The Signal-1 pin provides direction.</p> <p>These diagrams provide options on how logic gates could be used to provide imputs In1, In2 for motor boards, such as L298N or IBT_2.  </p> <p>NOTE: L298P and L298HN motor shields use the XNOR gate.  To enable low side brake in both directions, an additional logic gate can be used.</p> <p> </p>"},{"location":"reference/trackmanager/dc-track-sync/","title":"DC Mode Track Sync","text":"<p>This is additional information on how to sync adjacent districts when using DC mode tracks.</p> <p>The DCC signal for all tracks uses a single timer; the tracks in multiple DCC districts will be in sync.  The only issue is that the tracks must have the same phase when crossing to another district.</p> <p>With DC tracks and PWM voltages and frequencies, there are multiple timers to consider. In the case of a reversing loop, there are also hardware considerations. DC mode is not compatible with the DCC two signal pin method. (see below)  </p>"},{"location":"reference/trackmanager/dc-track-sync/#timers-brake-pins","title":"Timers / Brake Pins","text":""},{"location":"reference/trackmanager/dc-track-sync/#ex-csb1-esp32","title":"EX-CSB1 / ESP32","text":"<ul> <li>Tracks with the same throttle will be in sync.  </li> </ul>"},{"location":"reference/trackmanager/dc-track-sync/#mega","title":"Mega","text":"<ul> <li>Tracks where the brake pin is on the same timer will be in sync when using the same throttle or speed.  </li> <li>Frequency updates will impact all tracks using the same timer.</li> </ul> <pre><code>timers/pins defined for DC mode on Mega 2560\n  Pins 9, 10      :  timer 2   Track A\n  Pins 6, 7, 8    :  timer 4   Tracks D, C, B\n  Pins 44, 45, 46 :  timer 5\n</code></pre>"},{"location":"reference/trackmanager/dc-track-sync/#nucleo-f4","title":"Nucleo F4","text":"<ul> <li>Tracks with the same PWM frequency and throttle or speed will be in sync when updated code is used.  </li> <li>Frequency updates will impact all tracks using the same timer.  </li> <li>Timers 1-4, 9, 13 have been tested for use with Nucleo-F4.  Those timers should not be used for other purposes.  </li> <li>Further discussion on the Discord server may be helpful to gain an understanding of the issues.</li> </ul>"},{"location":"reference/trackmanager/dc-track-sync/#hardware-considerations","title":"Hardware considerations","text":"<p>Brake pin provides the PWM signal. Signal-1 pin provides direction in DC mode.  </p> <p>The two signal pin method is used with some motor boards for DCC.  Those boards do not work for DC mode, unless logic gate circuitry is added.</p> <p>EX-CSB1 and EX8874 provide low side brake in both directions.</p>"},{"location":"reference/trackmanager/dc-track-sync/#low-side-brake-in-both-directions","title":"Low side brake in both directions","text":"<ul> <li>The XNOR gate of the standard motor shield and clones will have high side brake in one direction and low side brake in the other.  This precludes a reversing loop, as the reverse does not result in tracks being in sync in the adjacent district.  </li> </ul> <p>The voltage between the rails results in the engine's direction.</p> <ul> <li>With low side brake, one rail is low and the other has the PWM voltage.  </li> <li>With high side brake, one rail is high and the other has a PWM voltage offset.</li> </ul> <p>\u00a0 \u00a0 \u00a0 \u00a0 Example with voltages at 25% throttle. </p> <p>Additional detail  -  DC mode - Logic Gate Circuit </p>"},{"location":"reference/trackmanager/trackmanager/","title":"Track Manager","text":"<p>If you are only interested in a standard setup using just a DCC track and PROG track, then you DO NOT need to read the rest of this document.</p> <p>What follows is for advanced users interested in managing power districts and/or running DC locomotives through DCC-EX.</p>"},{"location":"reference/trackmanager/trackmanager/#what-is-the-track-manager","title":"What is the Track Manager","text":"<p>Track Manger (TM from now on) is an integral part of the command station software that is responsible for:</p> <ul> <li>Managing track power state.</li> <li>Monitoring track overloads and shorts.</li> <li>Routing the DCC main or prog track waveforms to the correct Motor Driver and thus track.</li> <li>Managing the JOIN feature.</li> <li>Intercepting throttle commands to locos running on DC tracks.</li> <li>Handling user or EXRAIL commands to switch track status.</li> </ul> <p>In the default scenario of a single DCC track and a PROG track, the TM behaves as for the previous versions of DCC-EX so if thats what you want, you dont need to mess with it.</p> <p>The TM is able to handle up to 8 separate track domains. Each domain requires a hardware driver to supply track voltage. A typical motor driver shield supplies two tracks, which is what we have used in the past as main and prog.</p> <p>Unlike the older version of DCC-EX, where the shield channel A was always the DCC main and channel B was always the DCC prog track, TM allows:</p> <ul> <li>None, any or all the tracks can be DCC Main.</li> <li>None or ONE track may be DCC prog at any given time.</li> <li>Any track may be powered on or off independently of the others.</li> <li>Any track may be disconnected from the DCC signal and used as a DC track with a given loco address. (See DC discussion later)</li> </ul> <p>With such flexibility comes responsibility... the potential for making mistakes means taking extra care with your configuration!</p> <p>NOTE: TM does NOT use \"zero stretching\" to control your DC motor. Instead, it uses true Pulse Width Modulation (PWM) to efficiently run your loco using the same method a decoder uses to control a DCC loco's motor. DC locos can even run better on TM than they can on a normal analog throttle, especially at low speed, since it is always applying the full track voltage, albeit in pulses of varying duration.</p>"},{"location":"reference/trackmanager/trackmanager/#using-the-track-manager-dcc","title":"Using the Track Manager (DCC)","text":"<p>TM names the tracks A to H. In a default setup, you will normally have tracks A and B where A will default to be the DCC main signal and B will be the DCC prog.</p> <p>There is a new user command <code>&lt;=&gt;</code> which is used to control the TM but the <code>&lt;0&gt;</code> and <code>&lt;1&gt;</code> commands operate as before.</p> <ul> <li><code>&lt;=&gt;</code>  lists the current track settings.</li> </ul> <p>In a default setup this will normally return</p> <pre><code>&lt;=A MAIN&gt;\n&lt;=B PROG&gt;\n</code></pre> <ul> <li><code>&lt;=t MAIN&gt;</code>  sets track t (A..H) to use the DCC main track.   For example <code>&lt;=C MAIN&gt;</code> sets track C. All tracks that are set to DCC will receive the same DCC signal waveform.</li> <li><code>&lt;=t PROG&gt;</code> Sets track t (A..H) to be the one and only PROG track. Any previous PROG track is turned off.</li> <li><code>&lt;=t OFF&gt;</code> turns off the track t. It will not power on with <code>&lt;1&gt;</code> because it will not know what signal to send.</li> </ul> <p>In an all-DCC environment it is unlikely that you will need to do anything other than setting any additional tracks (C...H) as DCC in your <code>myAutomation.h</code> file.  Example:  Startup - Define Tracks</p> <p>Bear in mind that a track may actually be only connected to DCC accessories such as signals and turnouts... your layout, your choice.</p> <p>Note that when setting a track to PROG or OFF, its power is switched off automatically. (The PROG track manages power on an as-needed basis under normal circumstances. When setting a track to MAIN (or DC, DCX see later) the power is applied according to the most recent <code>&lt;1&gt;</code> or <code>&lt;0&gt;</code> command as being the most compatible with previous versions.</p>"},{"location":"reference/trackmanager/trackmanager/#using-the-track-manager-dc","title":"Using the Track Manager (DC)","text":"<p>TM allows any or all of your tracks to be individually selected as a DC track which responds to throttle commands on any given loco address. So for example if track A is set to DC address 55, then any throttle commands to loco 55 will be transmitted as DC onto track A and thus a DC loco can be driven along that track. almost exactly as if it was DCC. Your throttle (JMRI, EX-Webthrottle, Withrottle, Engine Driver etc.) do not know or care that this is a DC loco so nothing needs to change.</p> <p>For a simple Command Station setup to run just two DC tracks instead of DCC, you only need to assign DC addresses to tracks A and B. If you want DCC on track A and DC on track B, you just need to set track B to a suitable DC address.</p> <p>The command to set a track to a DC address is as follows</p> <ul> <li><code>&lt;=t DC a&gt;</code> Sets track t (A..H) to use loco address, example &lt;=A DC 3&gt;</li> </ul> <p>A simple two separate loop DC track, wired the traditional way in opposite directions, may be set like this to use loco addresses 1 and 2.  </p> <pre><code>&lt;=A DC 1&gt;\n&lt;=B DC 2&gt;\n</code></pre>"},{"location":"reference/trackmanager/trackmanager/#crossing-between-dc-tracks","title":"Crossing between DC tracks","text":"<p>There are some slightly mind-bending issues to be addressed, especially if you want to be able to cross between two separate DC tracks or use your layout in DCC or DC mode. This is because the control of DC loco direction is relative to the TRACK and not the LOCO. (you turn a DC loco round on the track and it continues in the same geographical direction. You turn a DCC loco around and it continues to go forwards or backwards in the opposite geographical direction.)</p> <p>Generally DC tracks are wired so that two mainline tracks are in opposite direction which makes operation easy BUT crossovers between tracks will cause shorts unless you have very complex switching arrangements. This is generally incompatible with DCC wiring which expects to be able to cross between tracks with impunity because they are all wired with the same polarity.</p> <p>To get over this issue TM allows the polarity of a DC track to be swapped so that tracks wired for DCC may be switched to DC with a polarity chosen at run time according to your operations. So, for example, you may have two loops with a crossing between them. Normally you need them in opposite directions, but when you need to drive over the crossing, you need to switch one or other track so that they are at the same polarity. (This is a good case for using EXRAIL to help)</p> <p>The command <code>&lt;=t DCX a&gt;</code> will set track t (A..H) to be DC but with reversed polarity compared with a track set to DC.</p> <p>Its perfectly OK to cross between DC tracks by setting them to the same loco address and making sure you get the polarity right!</p>"},{"location":"reference/trackmanager/trackmanager/#connecting-hardware","title":"Connecting Hardware","text":"<p>Each track requires hardware to control it</p> <ul> <li>Power on/off</li> <li>Polarity (direction, signal etc.)</li> <li>Brake (shorts tracks together)</li> <li>Current (analog reading)</li> </ul> <p>The standard motor shields provide this for two separate tracks and are predictable and easy to use. However STACKING shields is not a viable way of adding more tracks because it prevents the software from gaining access to the individual track pins. Similarly, wiring all the signal pins together for example, will give you a shared DCC signal but it will eliminate any possibility of switching the track purpose at run time. So, you are going to have to understand enough to wire track drivers to various pins if you wish to extend beyond 2 tracks and take advantage of TM.</p> <p>You will also need to consider the implications of differing electronic implementations that would cause unexpected issues when a loco moves between tracks. We know this works fine for a typical shield because we use <code>&lt;1 JOIN&gt;</code> quite happily but this may be different if you mix hardware types..... (NOT MY PROBLEM !)</p> <p>The easiest way to consider the wiring is to treat each track individually (either as a separate driver or as half of a shield).</p> <p>You will require, for each track, on the Arduino:</p> <ul> <li>A GPIO pin (or a HAL vpin perhaps on an I2C extender, code TBA!!!) to switch power.</li> <li>A GPIO pin to switch the signal direction</li> <li>A GPIO pin with PWM capability to switch the Brake (you may omit this if you don't want any DC capability)</li> <li>(Optional) An Analog pin to read the current (unless your hardware cant do that, perhaps its just feeding a booster)</li> <li>(Optional) A GPIO fault pin if that's how your hardware works. (NOT recommended as you're going to run out of pins)</li> </ul> <p>IF you have no more than 3 tracks and you can arrange for the signal pins to be one of 11,12,13 on a Mega, THEN there is a slight advantage internally and the waveform will be super-sharp.</p> <p>IMPORTANT: Hardware that has two signal pins still needs some code though</p>"},{"location":"reference/trackmanager/trackmanager/#configuring-the-software","title":"Configuring the Software","text":"<p>Configuring the software to provide more tracks is a simple extension of the existing method of customising the #define of MOTOR_SHIELD_TYPE in config.h.</p> <p>Since there can be no standard setup of your wiring and hardware choices, it will be necessary to create your custom-built MOTOR_SHIELD_TYPE in the manner described in MotorDrivers.h and simply continue to add more <code>new MotorDriver(</code> definitions to the list, providing all the pin numbers and electronic limits for each track [or even shorten the list to 1] )</p>"},{"location":"reference/trackmanager/trackmanager/#using-exrail-to-control-track-manager","title":"Using EXRAIL to control Track Manager","text":"<p>EXRAIL has a single additional command that can be used to automate TM.</p> <ul> <li> <p><code>SET_TRACK(t,mode)</code>, where t is the track letter A..H and mode is one of:</p> <ul> <li><code>OFF</code>: track is switched off</li> <li><code>MAIN</code>: track gets DCC signal</li> <li><code>PROG</code>: track gets DCC prog signal</li> <li><code>DC</code>: track is set to DC mode with the cab address of the currently executing EXRAIL sequence.</li> <li><code>DCX</code>: as DC but with reversed polarity.</li> </ul> </li> </ul> <p>DC/DCX are designed so that you can be automating a DCC loco, drive it onto a separate track and switch to DC without having to know the cab address. (e.g AUTOMATION) If however you are just running a ROUTE you can always do something like this:</p> <pre><code> ROUTE(77,\"Set track G to DC 123\")\n   SETLOCO(123)\n   SET_TRACK(G,DC)\n   SET_POWER(G,ON)\n   DONE\n</code></pre>"},{"location":"reference/trackmanager/trackmanager/#where-and-how-for-the-code","title":"Where and How for the Code","text":"<p>The TM code is primarily in TrackManager.cpp which is responsible for coordinating the track settings and commands.</p> <p>Each individual track is handled by an instance of MotorDriver created from the <code>MOTOR_SHIELD_TYPE</code> definition in config.h</p> <p>Many functions formerly in the DCCWaveform code have been moved to TrackManager or MotorDriver, notably the power control and checking. This makes the code easier to follow.</p>"},{"location":"reference/wiring/i2C/i2c-wiring/","title":"I2C Wiring for the Tinkerer","text":"<p>I2C expansion modules provide accessory pins, but I2C wiring requires a lot of attention to detail.</p>"},{"location":"reference/wiring/i2C/i2c-wiring/#i2c-concepts","title":"I2C concepts","text":"<ul> <li>Keep I2C wiring short.</li> <li>Use Qwiic cables.</li> <li>Know the combined resistance of connected I2C modules.</li> <li>Avoid using excess power from the microprocessor's power source.  Separate power sources can avoid degrading the I2C bus by low voltage spikes/sags or overloading the source.</li> </ul>"},{"location":"reference/wiring/i2C/i2c-wiring/#i2c-bus-voltage","title":"I2C bus voltage","text":"<ul> <li>I2C bus voltage is determined by the voltage used for the pullups on the SDA and SCL pins, which should not exceed the voltage of the microprocessor.</li> <li>Mega 2560 is 5V; CSB1, ESP32-WROOM, Nucleo-F4 are 3.3V.</li> </ul>"},{"location":"reference/wiring/i2C/i2c-wiring/#qwiicstemma-qt","title":"Qwiic/STEMMA QT","text":"<ul> <li>Qwiic a.k.a. STEMMA QT - connectors and wiring are designed for 3.3V.</li> <li>When using a Mega:  the Qwiic connector on EX8874 the power pin is 3.3V, but the SDA SCL pins have pullups to 5V. For most cases, use the I2C headers on the EX8874 when using a Mega.</li> <li>Qwiic wiring pattern is used for the Adafruit STEMMA QT / Qwiic connectors - and is different from the NXP pattern below.</li> </ul>"},{"location":"reference/wiring/i2C/i2c-wiring/#i2c-wire-length","title":"I2C wire length","text":"<ul> <li>Length increases capacitance and reduces signal quality.</li> <li>Plan to include LTC4311 or other options when length exceeds 2 meters, for example the Adafruit LTC4311 I2C Extender/Active-terminator</li> </ul>"},{"location":"reference/wiring/i2C/i2c-wiring/#combined-parallel-resistance","title":"Combined parallel resistance","text":"<ul> <li>Lower resistance results in a stronger signal and helps offset higher capacitance.</li> <li>If resistance is too low, the uC will be unable to overcome it.</li> </ul> <p>This table shows the parallel resistance values with multiple I2C modules:</p> <ul> <li>Note that Mega has 10k onboard; EX-CSB1 has 5.1k; others are weak or disabled.  </li> <li>I2C modules, such as PCA9685 and MCP23017, will generally have 10k pullups. LCD and OLED displays may have 4.7k or 10k.  </li> <li>Add/remove pullups to result in 2.5-3.0 mA.  </li> <li>With LTC4311 the need to adjust resistance may be less important, unless resistance is too low.  </li> </ul> <p></p>"},{"location":"reference/wiring/i2C/i2c-wiring/#wiring-pattern-for-lower-capacitance","title":"Wiring pattern for lower capacitance","text":"<p>https://www.nxp.com/docs/en/user-guide/UM10204.pdf </p> <p></p>"},{"location":"reference/wiring/i2C/i2c-wiring/#power-sources","title":"Power sources","text":"<ul> <li>A separate power source for the VCC pin of the I2C bus avoids potential voltage spikes/sags and noise into the power circuit of the microprocessor, and should make the I2C accessory bus more resilient.  </li> <li>Additional/separate power source is required for the +5V servo power on the PCA9685 module.  </li> <li>When using separate power sources, there is potential for a ground loop. TODO</li> </ul>"},{"location":"reference/wiring/i2C/tuning-info/","title":"Tuning an I2C Bus for the Engineer","text":""},{"location":"reference/wiring/i2C/tuning-info/#guiding-principles","title":"Guiding Principles","text":"<ol> <li> <p>The two signal lines (SCL &amp; SDA) EACH require a resistor to pull them to a logic high voltage and a device output pin to pull them low.   All devices on an i2c bus segment should use the same voltage level. (exception: passive level-shifers)   i.e. 5V (or 3.3V) supply voltage to all pull-up resistors (typically 10k ohms each).</p> </li> <li> <p>Do NOT mix incompatible 3.3V and 5V devices on a segment (without a passive level-shifter).   The segment(or sub-bus) is the full wire length  from extremities passing through some devices end-to-end (e.g. PCA9685) but NOT through a multiplexer(mux) or bus  buffers (A mux or level shifter can interface different sub-buses/segments).</p> </li> <li> <p>We need to add up the number of 10k (pairs) of resistors to see if we need to add/remove some.   Connected devices may, or may not, have a (weak) pullup resistor (pair) on them, typically 10k ohms.   (alternatively, see NOTE below about measuring this number in situ)</p> </li> <li> <p>The pull-up has to be neither too strong (output pins can't pull it down) nor too weak.   (resistor can't pull it up enough)</p> </li> <li> <p>The MAXIMUM number (of 10k ohm) that the (SCL or SDA) output pin can pull down is about 6 (5V bus)   (max 9 on a 3.3V bus) so we MAY have to disconnect some pullups (jumpers?) or use a MUX.</p> </li> <li> <p>Some devices may not have any pullups, and other devices may EFFECTIVELY have 2\u00a0or\u00a03.   (e.g 4.7k Endpoint pullup = 2x10k)</p> </li> <li> <p>The load the resistors have to drive depends on the NUMBER OF DEVICES and the total segment LENGTH.   (The full segment wire/cable length, passing through some devices, between the bus segment extremities.)</p> </li> <li> <p>The MINIMUM required NUMBER(P) of 10k pullups on SCL must not be less than...   (number of devices(D) on bus + length(L feet)) all divided by 3.   \u00a0 \u00a0 i.e.\u00a0min.\u00a0P\u00a0=\u00a0(D\u00a0+\u00a0L)/3   This ensures the signal can rise quickly to a good high level.   Adding spare pullups, up to max.(6/9), is recommended and gives better length &amp; noise margins.</p> </li> <li> <p>Inversely, MAXIMUM LENGTH(L ft) must not exceed..   number of pullups(P) x 3 - number of devices(D)   \u00a0 \u00a0 i.e.\u00a0max.\u00a0L\u00a0=\u00a0Px3\u00a0-\u00a0D   The practical length varies somewhat with cable type (twisted pair, ribbon, dupont, etc.) so limit your segment length below 2/3 of max., to avoid errors and timeouts.</p> </li> <li> <p>If number of available pullups is too low, extra pullups (max 6 @10cents each)(or a LTC4311, $10) may be added for length &amp; noise margins, up to the limit, BUT..   if number of pullups is TOO HIGH the only quick fix is to remove/cut jumpers/unsolder some pullups.</p> </li> <li> <p>If using the newer 3.3V technology and a mosfet based \"passive\" level shifter, be aware that both sides of the shifter are the same segment.  So add up the pullups on the 3.3V side and add 1.5 times the count on the 5V side for a total not to exceed 9.  In-situ measurements are for one side only.</p> </li> </ol>"},{"location":"reference/wiring/i2C/tuning-info/#measurement-in-situ","title":"Measurement in situ","text":"<p>Note:  If unsure of the effective number of active pullup resistors(10k), it is possible, after ALL POWER OFF FOR SEVERAL MINUTES, to use an ohm meter to measure the net resistance between the SCL line (or SDA) to the pullup supply rail (Vcc). Divide 10k (10000) by the resistance for the effective number of pullups. \u00a0 (e.g. if measure 2500ohm then effectively 4 pullups currently on the bus) \u00a0 (Do not use any diode test function or continuity test function on the meter, just basic resistance range.)</p>"},{"location":"reference/wiring/i2C/tuning-info/#examples","title":"Examples","text":"<p>A. Mega bus   4 Devices: Mega(10k), display(10k), PCA9685(10k) and a sparkfun Endpoint(4k7=2x10k)     \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 max length L = P x 3 - D = 5x3 - 4 = 11ft (safe 7ft)</p> <p>B. Mega bus:   7 Devices: Mega(10k), 2x PCA9685(10k), 3x MCP23017(10k), &amp; Endpoint(4k7=2x10k)     \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 Pullup count P = 8 (8x10k) too high!  Can cut Endpoint jumpers to remove 2. Then...     \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 max length L = P x 3 - D = 6x3 - 7 = 11ft (safe 7ft)</p> <p>C. MUX sub-bus: 2 Devices: Mux (no P) and a single PCA9685(10k)     \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 max length L = P x 3 - D = 1x3 - 2 = 1ft (safe 0.66ft) (use extra pullup for more length)     \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 max length L = P x 3 - D = 2x3 - 2 = 4ft (safe 2.7ft)  (includes an extra 1x10k(pair) on end)</p> <p>D. MUX sub-bus: 5 Devices: Mux (no P) 2xPCA9685(10k) &amp; 2xMCP23017(10k)     \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 max length L = P x 3 - D = 4x3 - 5 = 7ft (safe 4ft)    (add 1 or 2 extra P for 5ft)</p> <p>E. Remote bus: 3 Devices: 1x Endpoint(4k7=2x10k), 1x MCP23017(10k) &amp; 1x PCA9685(10k)     \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 max length L = P x 3 - D = 4x3 - 3 = 9ft (safe 6ft)</p> <p>F. Remote bus: 3 Devices+extras: Endpoint (4k7=2x10k), 2xESP32(no P) with EXTRA 4k7(=2x10k)     \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 max length L = P x 3 - D = 4x3 - 3 = 9ft (safe 6ft)</p> <p>G. To achieve 400kHz fast-mode use Px1.5 e.g. example F. (with 4 effective pullups)     \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 max length L = P x 1.5 - D = 4x1.5 - 3 = 3ft (safe 2ft)</p> <p>H. passive Level Shifter: 5 devices: (3.3V) Display(4.7k)-(10k)shifter &amp; (5V 3dev.) shifter(10k)-MCP23017(10k)-mux  \u00a0 \u00a0 conservatively,  \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 (3.3V side) max L = Px3-D = 3x3-2 = 7ft (safe 4ft)  \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 (5V side) \u00a0 max L = Px3-D =  2x3-3 = 3ft (safe 2ft)</p> <p>In all cases, to increase workable length, noise margin or speed, add pullups towards the max. number, OR add one LTC4311 I2C active pullup at the CS end, provided P is not over the max. allowed pullup count.  With an LTC4311, max pullups(6/9) are NOT recommended.  A limit of 3P is advised, especially with MCP23017's. Note: An LTC4311 is ineffective through a level shifter.</p> <p></p>"},{"location":"support/discord/","title":"The DCC-EX Discord Server","text":"<p>The DCC-EX team has a strong preference for providing support via the DCC-EX Discord server, and we have information on joining and using Discord on this page.</p> <p></p> <p>Discord is free to join, and provides these benefits over our other support methods:</p> <ul> <li>The DCC-EX team actively participate in Discord, so you can talk to the people who create the products</li> <li>There is a global community of over 4,000 DCC-EX users in Discord</li> <li>When people are online at the same time, you can have a live, interactive chat</li> <li>There is the opportunity for DCC-EX users to help other users, which happens frequently</li> </ul> <p>In short, Discord gives you the best access to the broadest set of people who can help with DCC-EX; an entire, global community of users.</p> <p>Please ensure when you first join, you review the Server Guide which will help you get started with our Discord server.</p>"},{"location":"support/discord/#joining-and-using-discord","title":"Joining and Using Discord","text":"<ol> <li> <p>Use the button below to navigate to your invitation to join our Discord server:</p> <p>DCC-EX Discord server</p> </li> <li> <p>Click ``Register on the sign-in page:</p> <p></p> </li> <li> <p>Fill in your details, click <code>Continue</code>, and follow the instructions:</p> <p></p> </li> <li> <p>Choose which channels you are interested in and if you're unsure, just select <code>Get help to setup an EX-CommandStation</code>:</p> <p></p> </li> </ol>"},{"location":"support/discord/#sharing-code-and-configuration-snippets","title":"Sharing Code and Configuration Snippets","text":"<p>Quite often in interactions in Discord, you will need to share either some code you have entered or parts of configuration files as text in the channel. Just pasting raw code or configuration text in Discord doesn't render well in the screen, and often characters are interpreted as emojis or other random ASCII characters which confuse the issue.</p> <p>Discord has a handy way of rendering code correctly so it appears correctly. To do this, you need to use the grave accent or backtick key  ` on your keyboard.</p> <p>On English QWERTY keyboards, this typically coexists with the tilde ~ key and is located in the top left near the Escape Esc key.</p> <p>This may appear elsewhere on other international keyboards, but Googling \"grave accent key\" or \"backtick key\" for your keyboard type should provide guidance on where it is located.</p> <p>To use this in Discord, simply surround your code or configuration snippets in three grave accents or backticks:</p> <pre><code>```\n// config.h entry for the EX8874\n#define MOTORSHIELD EX8874_SHIELD\n```\n</code></pre> <p>If you're sharing code, sometimes it can be helpful to specify the language, which in the case of DCC-EX is typically C++:</p> <pre><code>```cpp\nuint8_t dummy = 0;\n```\n</code></pre>"},{"location":"support/discord/#discord-channels","title":"Discord Channels","text":"<p>We have organised the Discord server into various channels which help keep similar topics grouped together.</p> <p>Please try to post questions in the relevant channel, and please do not post the same question in multiple channels.</p> <p>If you can't see channels which seem relevant or of interest to you, you can customise which channels you can see:</p> <ul> <li> <p>Click <code>Channels &amp; Roles</code> under the DCC-EX server menu:</p> <p></p> </li> <li> <p>You can change your customisation options if you wish:</p> <p></p> </li> <li> <p>Or you can browse the channels and select which ones you'd like to see:</p> <p></p> </li> </ul> <p>Here are some examples of commonly used channels, and there are plenty more:</p> <ul> <li><code>#support-and-issues__ex-commandstation</code> - Use this channel for general EX-CommandStation conversations and help</li> <li><code>#exrail</code> - Use this channel for general EXRAIL conversations and help</li> <li><code>#tack-manager</code> - Use this channel for general TrackManager conversations and help</li> <li><code>#accessories</code> - Use this channel for topics such as PCA9685 servo controllers and servos, MCP23017 I/O expansion boards, and other accessories</li> <li><code>#sensors</code></li> <li><code>signals</code></li> </ul> <p>Our other products typically have their own channel also:</p> <ul> <li><code>#ex-ioexpander</code> - EX-IOExpander, not to be confused with other I/O expansion modules such as PCA9685 or MCP23017 devices, see <code>#accessories</code></li> <li><code>#ex-dccinspector</code></li> <li><code>#ex-turntable</code></li> <li><code>#ex-fastclock</code></li> </ul>"},{"location":"support/discord/#opening-a-support-ticket","title":"Opening a Support Ticket","text":"<p>If you need help with a specific issue and the conversation in the general support channels haven't resolved the issue, you are welcome to open a support ticket in Discord to get help for your specific issue.</p> <ul> <li> <p>From the <code>Server Guide</code>, you can select the <code>Open a Support Ticket</code> option:</p> <p></p> <p></p> </li> <li> <p>This takes you to the TicketTool app, and clicking the <code>Create ticket</code> icon will open a support ticket:</p> <p></p> </li> <li> <p>You will see the message <code>Ticket Created</code> with the channel name of your new ticket:</p> <p></p> </li> <li> <p>Clicking on the ticket channel will take you to the ticket, and it should also appear in your channels list, and you can now share all relevant information, upload the required logs and configuration files, and share any troubleshooting steps you've already attempted:</p> <p></p> </li> </ul> <p>Once your ticket has been created, only the DCC-EX support team members and yourself will have access to the ticket, but other users can be invited if necessary.</p> <p>In order to help the DCC-EX team give you the help you need, you will need to provide as much information as possible, as we cannot read minds, see your setup, access your hardware or configuration files, nor look over your shoulder to see what is going on.</p> <p></p> <p>To upload files to the ticket, click the <code>+</code> sign in the message box and select <code>Upload a File</code>.</p> <p>Please provide this information at the time you open the support ticket:</p> <ul> <li> The product and version</li> <li> The exact hardware in use</li> <li> Upload serial/console logs</li> <li> Upload all configuration files for the software in use</li> <li> Detail any troubleshooting steps you have already performed</li> </ul>"},{"location":"support/discord/#closing-a-support-ticket","title":"Closing a Support Ticket","text":"<p>Once your issue is resolved, we encourage you to close your support ticket, as you can only have one open at a time, and a new and different issue should be in a different ticket.</p> <p>You can either click the <code>Close</code> button (you may need to scroll all the way to the top of the ticket thread):</p> <p></p> <p>Or you can type <code>/close</code> in the message box and hit the Enter key.</p>"},{"location":"support/faq/","title":"Frequently Answered Questions  (FAQ)","text":"<p>This page contains a summary of answers that are frequently asked and answered in support tickets and on our Discord server.</p> <p>We encourage our users to reference this ahead of requesting support as there's a good chance your question has been answered many times before!</p>"},{"location":"support/faq/#controlling-and-running-trains","title":"Controlling and Running Trains","text":"<ul> <li> <p>Why isn't my train responding to my throttle commands?</p> <ul> <li>A loco must be on a DCC MAIN track to respond to throttle commands, this is typically output A on an EX-CSB1, EX8874 shield, or Arduino R3 motor shield</li> <li>The DCC MAIN track must be powered on either via your throttle software or <code>&lt;1&gt;</code> in the serial console</li> <li>If your DCC loco has been configured for a consist, you must control it from the consist address, not the loco address. The lights can be switched on/off at the loco address but the loco will not move unless you use the consist address.</li> </ul> </li> </ul>"},{"location":"support/faq/#programming-and-reading-dcc-decoders","title":"Programming and reading DCC decoders","text":"<ul> <li> <p>How do I change the DCC address of my loco?</p> <ul> <li>Place the loco on the programming track and issue <code>&lt;W address&gt;</code> or use the programming screen in Engine Driver.</li> </ul> </li> <li> <p>Why does programming my decoder result in an error (eg. a JMRI 308 error)?</p> <ul> <li>Loco must be on prog track</li> <li>Dirty track, wheels or pickups</li> <li>Issue the <code>&lt;D ACK ON&gt;</code> and repeat the programming, copy resulting diagnostic trace to support (or learn to read it yourself)</li> </ul> </li> </ul>"},{"location":"support/faq/#throttle-apps-and-software","title":"Throttle apps and software","text":"<ul> <li> <p>I'm using the free WiThrottle Lite app on iOS, how can I turn track power on?</p> <ul> <li>You can't turn track power on with the free WiThrottle Lite app for iOS, you must turn it on via the serial console with <code>&lt;1&gt;</code></li> <li>Alternatively, you can enable the <code>Start with power on</code> option in EX-Installer</li> </ul> </li> </ul>"},{"location":"support/faq/#my-csb1-oled-display-isnt-working-or-looks-wrong","title":"My CSB1 OLED display isnt working or looks \"wrong\"","text":"<ul> <li>The CSB1 is shipped with whichever OLED display is available and although they look alike, they have different internals. The EX-Installer provides a dropdown list, if yours doesnt work, try selecting the other option.</li> </ul>"},{"location":"support/faq/#why-do-i-get-fault-pin-warnings","title":"Why do I get FAULT pin warnings","text":"<ul> <li> <p>You may have a short on your layout. Most common causes are</p> <ul> <li>Loco driven into turnout set for the other track</li> <li>Screwdriver or other tools left lying on layout</li> </ul> </li> <li> <p>You forgot to switch on the track power supply</p> </li> <li>When switched on, there is an inrush of power to the loco decoders which temporarily exceeds the current limits. This is automatically fixed and the state should revers to NORMAL within a second or so.</li> </ul>"},{"location":"support/faq/#why-do-my-i2c-connections-fail","title":"Why do my I2C connections fail","text":"<p>This can be complex but</p> <ul> <li>At startup, the Command Station lists all the I2C devices it can see... If yours is not in that list there is nothing that you can change or configure in the software to make it work.</li> <li>Do not twist the SCL and SDA wires together</li> <li>Avoid running SCL/SD in parallel with the track power (or track)</li> <li>Refer to I2C Wiring</li> </ul>"},{"location":"support/github/","title":"Raising GitHub Issues","text":"<p>Most of the DCC-EX GitHub repositories have issue templates which will guide you through the required information related to the type of issue you are raising.</p> <p>These typically include:</p> <ul> <li>Bug Report - Submit a bug report, preferably after interacting with the support team in Discord to validate it is a bug</li> <li>Documentation Update - Request an update to add missing information or report broken links or other inaccuracies</li> <li>Feature Request - Suggest a new feature you'd like to see</li> <li>Support Request - Request support or assistance, noting this is not as quick as interacting with the support team in Discord</li> </ul> <p>These are the common repositories you can create issues in:</p> <ul> <li>EX-CommandStation</li> <li>Documentation</li> <li>EX-Installer</li> <li>EX-CSB1</li> <li>EX-Toolbox</li> <li>EX-MotorShield8874</li> <li>EX-FastClock</li> <li>EX-WebThrottle</li> <li>EX-DCCInspector</li> <li>DCCEXProtocol</li> <li>EX-Turntable</li> <li>EX-IOExpander</li> </ul>"},{"location":"support/support/","title":"Help and Support","text":"<p>At some point you will likely need to get some help or support for our products, and the available methods are outlined on this page.</p> <p>NOTE For users of hardware products purchased from resellers, in the event of a hardware issue please contact the reseller in the first instance. Each reseller is responsible for supporting the hardware they sell.</p> <p>Please note that the DCC-EX team are all volunteers and are distributed globally, so while we endeavour to help as much and as quickly as we can, all support is provided on a best-effort basis only, and there will be times where no team members are available.</p> <p>This is why we strongly recommend Discord as the best source of support, because there is a global community of over 4,000 users, some of whom may be able to help before a DCC-EX team member is online.</p>"},{"location":"support/support/#information-required-for-support-queries","title":"Information required for support queries","text":"<p>When requesting support for any of our products, there is some critical information you must provide in order for us to be able to help you. As volunteers, our time is limited and therefore the more information you can provide up front, the quicker we can help you resolve any issues rather than spend valuable time repeating requests for missing information.</p> <p>This is the information typically required:</p> <ul> <li>The product and version</li> <li>The exact hardware in use</li> <li>Upload serial/console logs</li> <li>Upload all configuration files for the software in use</li> <li>Detail any troubleshooting steps you have already performed</li> </ul>"},{"location":"support/support/#product-and-version","title":"Product and Version","text":"<pre><code>&lt;s&gt;\n</code></pre>"},{"location":"support/support/#get-startup-logs","title":"Get startup logs","text":"<p>TODO</p> <p>Instructions required here to obtain the startup logs from EX-Installer.</p>"},{"location":"support/support/#discord-recommended","title":"Discord (recommended)","text":"<p>Our strongly recommended support option is the DCC-EX Discord server, where you can interact directly with the DCC-EX team as well as a global community of over 4,400 users. Issues are usually resolved quite quickly in comparison with the other options, and you can also interact with the community in real-time.</p> <p>Please refer to our Discord page which outlines how to join our Discord server, interact with the community, and how to raise support tickets.</p>"},{"location":"support/support/#github","title":"GitHub","text":"<p>If you are an existing GitHub user, you can also get support via GitHub which is particularly useful for bug reports. While all the DCC-EX team members have GitHub accounts and can respond, this is typically not as quick as getting support via our recommended Discord server option.</p> <p>Please refer to our GitHub page on the various repositories you can raise issues in.</p>"},{"location":"support/support/#trainboard","title":"TrainBoard","text":"<p>If you're a member of the TrainBoard forum, there is a DCC++ Forum you can post in for help. Yes, it is still called DCC++.</p> <p>Note that this isn't the busiest forum and only a few of the DCC-EX team are members of TrainBoard, so resolution of issues may be slow. There are other members of the forum that may try to assist though.</p>"},{"location":"support/support/#email-not-recommended","title":"Email (not recommended)","text":"<p>While email support is available for those who have no other way to obtain support, there is only one team member with access to reply to your queries, and therefore this is a slow process and is not recommended.</p> <p>If necessary, you can email us at support@dcc-ex.com.</p>"},{"location":"throttles/engine-driver/","title":"Engine Driver","text":""},{"location":"throttles/throttlecard/","title":"ThrottleCard","text":""},{"location":"throttles/throttles/","title":"Throttles and Other Controllers","text":"<ul> <li>Engine Driver</li> <li>Throttle Card</li> <li>JMRI</li> <li>DCCEXProtocol</li> <li>Make your own</li> </ul>"},{"location":"news/category/general-dcc-ex-news/","title":"General DCC-EX News","text":""}]}